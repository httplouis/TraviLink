===== app\layout.tsx =====
// src/app/layout.tsx
import "./globals.css";
import type { Metadata } from "next";
<link rel="preconnect" href={process.env.NEXT_PUBLIC_SUPABASE_URL} crossOrigin="" />


export const metadata: Metadata = {
  title: { default: "TraviLink", template: "%s • TraviLink" },
  description: "University Vehicle Scheduling & Reservation Portal",
  icons: {
    icon: [
      { url: "/vercel.svg" },
      { url: "/icon-32.png", sizes: "32x32", type: "image/png" },
      { url: "/icon-16.png", sizes: "16x16", type: "image/png" },
    ],
    apple: [{ url: "/apple-touch-icon.png" }],
  },
  manifest: "/site.webmanifest",      
  themeColor: "#7f1d1d",            
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      {/* globals.css sets background/text + dark mode; keep body clean */}
      <body className="min-h-dvh antialiased">{children}</body>
    </html>
  );
}


===== app\middlerware.ts =====
// middleware.ts
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";

export function middleware(req: NextRequest) {
  const { pathname, search } = req.nextUrl;

  // Only guard these routes
  const protectedPrefixes = ["/admin", "/driver", "/faculty"];
  const needsAuth = protectedPrefixes.some((p) => pathname.startsWith(p));
  if (!needsAuth) return NextResponse.next();

  // Supabase v2 cookie looks like: sb-<projectRef>-auth-token
  const cookies = req.cookies.getAll();
  const hasSbSession = cookies.some(
    (c) => /^sb-[a-z0-9]+-auth-token$/i.test(c.name) && Boolean(c.value)
  );

  if (!hasSbSession) {
    const url = req.nextUrl.clone();
    url.pathname = "/login";
    // preserve full path + query so we can return the user after login
    url.searchParams.set("next", pathname + (search || ""));
    return NextResponse.redirect(url);
  }

  return NextResponse.next();
}

export const config = {
  // Only run on protected routes
  matcher: ["/admin/:path*", "/driver/:path*", "/faculty/:path*"],
};


===== app\page.tsx =====

import { redirect } from "next/navigation";

export default function Home() {
  redirect("/login");
}


===== app\(protected)\admin\layout.tsx =====
import "@/app/globals.css";
import "@/app/styles/admin/admin.css";

import type { Metadata } from "next";
import Topbar from "@/components/admin/nav/TopBar";
import AdminLeftNav from "@/components/admin/nav/AdminLeftNav";
import Breadcrumbs from "@/components/admin/nav/Breadcrumbs";

export const metadata: Metadata = {
  title: "TraviLink · Admin",
};

export default function AdminLayout({ children }: { children: React.ReactNode }) {
  return (
    <div
      data-role="admin"
      className="flex h-dvh w-full flex-col bg-neutral-50 text-neutral-900"
      style={{ ["--topbar-h" as any]: "56px" }}
    >
      {/* Sticky top bar */}
      <div className="tl-topbar sticky top-0 z-40 h-[var(--topbar-h)] bg-white/95 shadow-sm backdrop-blur">
        <Topbar />
      </div>

      {/* 2-column shell: LeftNav • Main */}
      <div className="tl-shell flex flex-1 overflow-hidden">
        {/* LeftNav rail – its width is controlled inside AdminLeftNav */}
        <aside className="tl-leftnav shrink-0 overflow-y-auto bg-transparent">
          <AdminLeftNav />
        </aside>

        {/* Main – the only scroller */}
        <main className="tl-main min-w-0 flex-1 overflow-y-auto">
          <div className="mx-auto max-w-7xl px-6 py-5">
            <Breadcrumbs className="mb-4" />
            {children}
          </div>
        </main>
      </div>
    </div>
  );
}


===== app\(protected)\admin\page.tsx =====
import KpiRow from "@/components/admin/dashboard/containers/KpiRow";
import RequestsTable from "@/components/admin/dashboard/ui/RequestsTable";
import ChartCard from "@/components/admin/dashboard/ui/ChartCard";
import DashboardActions from "@/components/admin/dashboard/ui/DashboardActions";
import TripLogsTable from "@/components/admin/dashboard/ui/TripLogsTable";
import DeptUsageChart from "@/components/admin/dashboard/ui/DeptUsageChart";
import { getDashboardData } from "@/lib/admin/repo";

export default async function AdminDashboardPage() {
  const {
    kpis,
    requestsByDay,
    statusBreakdown,
    utilization,
    deptUsage,
    recentRequests,
    recentTrips,
  } = await getDashboardData();

  return (
    <section className="space-y-6">
      {/* KPI summary */}
      <KpiRow items={kpis.map(kpi => ({ ...kpi, value: String(kpi.value) }))} />

      {/* Analytics Row 1 */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <ChartCard title="Requests (last 8 days)" type="line" data={requestsByDay} xKey="date" yKey="count" />
        <ChartCard title="Status Breakdown" type="bar" data={statusBreakdown} xKey="status" yKey="count" />
      </div>

      {/* Analytics Row 2 */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <ChartCard title="Vehicle Utilization (%)" type="bar" data={utilization} xKey="label" yKey="percent" />
        <DeptUsageChart data={deptUsage} />
      </div>

      {/* Requests Table */}
      <div className="space-y-3">
        <DashboardActions rows={recentRequests} />
        <RequestsTable rows={recentRequests} />
      </div>

      {/* Recent Trips (3 rows only) */}
      <div className="space-y-3">
        <div className="text-sm font-medium">Recent Trip Logs</div>
        <TripLogsTable rows={recentTrips.slice(0, 3)} />
      </div>
    </section>
  );
}


===== app\(protected)\admin\drivers\DriversPageClient.tsx =====
"use client";

import * as React from "react";
import type { Driver } from "@/lib/admin/drivers/types";
import { DriversRepo } from "@/lib/admin/drivers/store";
import DriversTable from "@/components/admin/drivers/ui/DriversTable.ui";
import DriverForm from "@/components/admin/drivers/ui/DriverForm.ui";
import FiltersBar from "@/components/admin/drivers/ui/FiltersBar.ui";
import BulkBar from "@/components/admin/drivers/ui/BulkBar.ui";


export default function DriversPageClient() {
  const [rows, setRows] = React.useState<Driver[]>([]);
  const [filters, setFilters] = React.useState<{ search?: string; status?: string; compliant?: "ok" | "warn" | "bad" | "" }>({});
  const [selection, setSelection] = React.useState<string[]>([]);
  const [form, setForm] = React.useState<null | { mode: "create" } | { mode: "edit"; id: string }>(null);

  const refresh = React.useCallback(() => setRows(DriversRepo.list(filters)), [filters]);
  React.useEffect(() => { refresh(); }, [refresh]);

  return (
    <div className="space-y-4 p-4">
      <FiltersBar
        value={filters}
        onChange={(v) => { setSelection([]); setFilters(v); }}
        onAdd={() => setForm({ mode: "create" })}
      />

      {selection.length > 0 && (
        <BulkBar
          count={selection.length}
          onSuspend={() => { DriversRepo.bulkUpdate(selection, { status: "suspended" }); setSelection([]); refresh(); }}
          onActivate={() => { DriversRepo.bulkUpdate(selection, { status: "active" }); setSelection([]); refresh(); }}
          onArchive={() => { DriversRepo.bulkUpdate(selection, { status: "archived" }); setSelection([]); refresh(); }}
          onExport={() => DriversRepo.exportCsv(selection.length ? rows.filter(r => selection.includes(r.id)) : rows)}
          onClear={() => setSelection([])}
        />
      )}

      <DriversTable
        rows={rows}
        selected={selection}
        onSelectedChange={setSelection}
        onEdit={(id) => setForm({ mode: "edit", id })}
      />

      {form && (
        <DriverForm
          mode={form.mode}
          driver={form.mode === "edit" ? rows.find(r => r.id === (form as any).id) : undefined}
          onClose={() => setForm(null)}
          onSubmit={(data) => {
            if (form.mode === "create") DriversRepo.create(data as any);
            else DriversRepo.update({ id: (form as any).id, ...(data as any) });
            setForm(null);
            refresh();
          }}
        />
      )}
    </div>
  );
}


===== app\(protected)\admin\drivers\page.tsx =====
import DriversPageClient from "./DriversPageClient";
export default function Page() { return <DriversPageClient />; }


===== app\(protected)\admin\history\page.client.tsx =====
"use client";
import * as React from "react";
import type { LogEntry, LogFilters } from "@/lib/admin/logs/types";
import { LogsFiltersBar } from "@/components/admin/logs/FiltersBar.ui";
import { LogsTable } from "@/components/admin/logs/LogsTable.ui";
import { LogDetails } from "@/components/admin/logs/LogDetails.ui";
import { SummaryCards } from "@/components/admin/logs/SummaryCards.ui";
import {
  loadLogs, deleteLog, clearLogs, exportLogsCSV, getAnalytics
} from "@/lib/admin/logs/handlers";
import { Download, Trash2 } from "lucide-react";

export default function HistoryLogsPageClient(){
  const [filters, setFilters] = React.useState<LogFilters>({});
  const [rows, setRows] = React.useState<LogEntry[]>([]);
  const [selection, setSelection] = React.useState<string[]>([]);
  const [viewId, setViewId] = React.useState<string | null>(null);

  const refresh = React.useCallback(() => setRows(loadLogs(filters)), [filters]);
  React.useEffect(()=>{ refresh(); }, [refresh]);

  const onDelete = (id: string) => { if(confirm("Delete this log?")) { deleteLog(id); refresh(); } };
  const onDeleteSelected = () => {
    if (!selection.length) return;
    if (!confirm(`Delete ${selection.length} selected log(s)?`)) return;
    selection.forEach(id => deleteLog(id));
    setSelection([]); refresh();
  };
  const onClearAll = () => {
    if (confirm("Clear ALL logs? This is irreversible.")) { clearLogs(); setSelection([]); refresh(); }
  };
  const onExport = () => {
    const blob = exportLogsCSV(rows);
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "history-logs.csv"; a.click();
    URL.revokeObjectURL(url);
  };

  const current = rows.find(r => r.id === viewId) ?? null;
  const analytics = getAnalytics(rows);

  return (
    <div className="p-4 space-y-4">
      <div className="flex items-center gap-2">
        <h1 className="text-xl font-semibold">History / Logs</h1>
        <div className="ml-auto flex items-center gap-2">
          <button onClick={onExport} className="inline-flex items-center gap-2 px-3 py-1.5 rounded-md border bg-white">
            <Download size={16}/> Export CSV
          </button>
          <button disabled={!selection.length} onClick={onDeleteSelected} className="inline-flex items-center gap-2 px-3 py-1.5 rounded-md border bg-white disabled:opacity-50">
            <Trash2 size={16}/> Delete Selected
          </button>
          <button onClick={onClearAll} className="inline-flex items-center gap-2 px-3 py-1.5 rounded-md border bg-white">
            <Trash2 size={16}/> Clear All
          </button>
        </div>
      </div>

      {/* Summary Cards + Trends */}
      <SummaryCards
        total={analytics.totals.all}
        info={analytics.totals.info}
        warning={analytics.totals.warning}
        error={analytics.totals.error}
        topActions={analytics.topActions}
        trend7d={analytics.trend7d}
      />

      <LogsFiltersBar value={filters} onChange={setFilters} onClear={()=>setFilters({})} />

      <LogsTable
        rows={rows}
        selection={selection}
        setSelection={setSelection}
        onView={(id)=>setViewId(id)}
        onDelete={onDelete}
      />

      {current && <LogDetails log={current} onClose={()=>setViewId(null)} />}
    </div>
  );
}


===== app\(protected)\admin\history\page.tsx =====
import Client from "./page.client";
export default function Page(){ return <Client/>; }


===== app\(protected)\admin\maintenance\page.client.tsx =====
"use client";
import * as React from "react";
import type { Maintenance, MaintFilters } from "@/lib/admin/maintenance/types";
import { MaintForm } from "@/components/admin/maintenance/MaintForm.ui";
import { MaintTable } from "@/components/admin/maintenance/MaintTable.ui";
import { MaintFiltersBar } from "@/components/admin/maintenance/FiltersBar.ui";
import {
  loadMaintenance, getMaintenance, createMaintenance, updateMaintenance,
  deleteMaintenance, deleteManyMaintenance, exportMaintenanceCSV
} from "@/lib/admin/maintenance/handlers";
import { Plus, Download, Trash2 } from "lucide-react";

export default function MaintenancePageClient(){
  const [filters, setFilters] = React.useState<MaintFilters>({});
  const [rows, setRows] = React.useState<Maintenance[]>([]);
  const [selection, setSelection] = React.useState<string[]>([]);
  const [form, setForm] = React.useState<null | {mode:"create"} | {mode:"edit"; id:string}>(null);

  const refresh = React.useCallback(() => setRows(loadMaintenance(filters)), [filters]);
  React.useEffect(() => { refresh(); }, [refresh]);

  const onCreate = (data: Omit<Maintenance,"id"|"createdAt"|"updatedAt">) => { createMaintenance(data); setForm(null); refresh(); };
  const onUpdate = (id: string, data: Omit<Maintenance,"id"|"createdAt"|"updatedAt">) => { updateMaintenance(id, data); setForm(null); refresh(); };
  const onDelete = (id: string) => { if(confirm("Delete record?")) { deleteMaintenance(id); refresh(); } };
  const onDeleteSelected = () => { if(selection.length && confirm(`Delete ${selection.length} selected?`)){ deleteManyMaintenance(selection); setSelection([]); refresh(); } };
  const onExport = () => {
    const blob = exportMaintenanceCSV(rows);
    const url = URL.createObjectURL(blob); const a = document.createElement("a");
    a.href = url; a.download = "maintenance.csv"; a.click(); URL.revokeObjectURL(url);
  };

  const current = form && form.mode==="edit" ? getMaintenance(form.id) ?? undefined : undefined;

  return (
    <div className="p-4 space-y-4">
      {/* header actions */}
      <div className="flex items-center gap-2">
        <h1 className="text-xl font-semibold">Maintenance</h1>
        <div className="ml-auto flex items-center gap-2">
          <button onClick={onExport} className="inline-flex items-center gap-2 px-3 py-1.5 rounded-md border bg-white">
            <Download size={16}/> Export CSV
          </button>
          <button disabled={!selection.length} onClick={onDeleteSelected} className="inline-flex items-center gap-2 px-3 py-1.5 rounded-md border bg-white disabled:opacity-50">
            <Trash2 size={16}/> Delete Selected
          </button>
          <button onClick={()=>setForm({mode:"create"})} className="inline-flex items-center gap-2 px-3 py-1.5 rounded-md text-white" style={{background:"#7a0019"}}>
            <Plus size={16}/> Add Record
          </button>
        </div>
      </div>

      <MaintFiltersBar value={filters} onChange={setFilters} onClear={()=>setFilters({})} />

      <MaintTable
        rows={rows}
        selection={selection}
        setSelection={setSelection}
        onEdit={(id)=>setForm({mode:"edit", id})}
        onDelete={onDelete}
      />

      {form && (
        <div className="fixed inset-0 bg-black/40 grid place-items-center z-50">
          <div className="w-[min(760px,96vw)] max-h-[90vh] overflow-auto bg-white rounded-xl p-4 shadow-xl">
            <div className="flex items-center justify-between mb-2">
              <h2 className="text-lg font-semibold">
                {form.mode==="create" ? "Add Maintenance" : `Edit ${current?.vehicleCode}`}
              </h2>
              <button onClick={()=>setForm(null)} className="border rounded-md px-2 py-1 bg-white">Close</button>
            </div>
            <MaintForm
              initial={current}
              onCancel={()=>setForm(null)}
              onSubmit={(data)=> form.mode==="create" ? onCreate(data) : onUpdate((form as any).id, data)}
            />
          </div>
        </div>
      )}
    </div>
  );
}


===== app\(protected)\admin\maintenance\page.tsx =====
import Client from "./page.client";
export default function Page(){ return <Client/>; }


===== app\(protected)\admin\requests\page.tsx =====
"use client";

import { useEffect, useMemo, useRef, useState } from "react";
import type { RequestRow, Pagination } from "@/lib/admin/types";

import ToastProvider, { useToast } from "@/components/common/ToastProvider";
import RequestsSummaryUI from "@/components/admin/requests/ui/RequestsSummary.ui";
import FiltersBarContainer from "@/components/admin/requests/containers/FiltersBar.container";
import BulkBarContainer, { BulkBarHandle } from "@/components/admin/requests/containers/BulkBar.container";

import RequestsTableUI from "@/components/admin/requests/ui/RequestsTable.ui";
import RequestsCardGridUI from "@/components/admin/requests/ui/RequestsCardGrid.ui";
import ViewToggleUI from "@/components/admin/requests/ui/ViewToggle.ui";

import RequestDetailsModalUI from "@/components/admin/requests/ui/RequestDetailsModal.ui";
import ConfirmUI from "@/components/admin/requests/ui/Confirm.ui";

import { exportRequestsCsv } from "@/lib/admin/export";
import { approveRequests, rejectRequests, deleteRequests } from "@/lib/admin/requests/action";
import { REQUESTS } from "@/lib/admin/requests/data";

import { usePathname, useRouter, useSearchParams } from "next/navigation";

/* ---------- tiny debounce hook ---------- */
function useDebouncedValue<T>(value: T, delay = 300) {
  const [debounced, setDebounced] = useState(value);
  useEffect(() => {
    const id = setTimeout(() => setDebounced(value), delay);
    return () => clearTimeout(id);
  }, [value, delay]);
  return debounced;
}

/* ---------- URL <-> UI sync (search, filters, sort) ---------- */
function URLSync({
  draft,
  onDraftChange,
  tableSearch,
  setTableSearch,
  sortDir,
  setSortDir,
}: {
  draft: any;
  onDraftChange: (n: Partial<any>) => void;
  tableSearch: string;
  setTableSearch: (v: string) => void;
  sortDir: "asc" | "desc";
  setSortDir: (v: "asc" | "desc") => void;
}) {
  const router = useRouter();
  const pathname = usePathname();
  const searchParams = useSearchParams();
  const didInit = useRef(false);

  // On mount: read URL -> state
  useEffect(() => {
    const p = new URLSearchParams(searchParams.toString());

    const q = p.get("q") ?? "";
    const status = (p.get("status") as any) || undefined;
    const dept = (p.get("dept") as any) || undefined;
    const from = p.get("from") || "";
    const to = p.get("to") || "";
    const mode = (p.get("mode") as "auto" | "apply") || undefined;
    const sd = p.get("sort");

    if (q) setTableSearch(q);

    const patch: Record<string, any> = {};
    if (status) patch.status = status;
    if (dept) patch.dept = dept;
    if (from) patch.from = from;
    if (to) patch.to = to;
    if (mode) patch.mode = mode;
    if (Object.keys(patch).length) onDraftChange(patch);

    if (sd === "asc" || sd === "desc") setSortDir(sd);

    didInit.current = true;
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  // On state change: write state -> URL (omit defaults)
  useEffect(() => {
    if (!didInit.current) return;

    const params = new URLSearchParams();
    if (tableSearch.trim()) params.set("q", tableSearch.trim());
    if (draft.status && draft.status !== "All") params.set("status", String(draft.status));
    if (draft.dept && draft.dept !== "All") params.set("dept", String(draft.dept));
    if (draft.from) params.set("from", String(draft.from));
    if (draft.to) params.set("to", String(draft.to));
    if (draft.mode && draft.mode !== "auto") params.set("mode", String(draft.mode));
    if (sortDir === "asc") params.set("sort", "asc"); // default is 'desc'

    const qs = params.toString();
    router.replace(qs ? `${pathname}?${qs}` : pathname, { scroll: false });
  }, [draft, tableSearch, sortDir, pathname, router]);

  return null;
}

function PageInner() {
  const toast = useToast();
  const bulkRef = useRef<BulkBarHandle>(null);

  /* SOURCE rows (mock) */
  const [allRows, setAllRows] = useState<RequestRow[]>(() => [...REQUESTS]);

  /* FILTERED rows (from FiltersBarContainer) */
  const [filteredRows, setFilteredRows] = useState<RequestRow[]>(() => allRows);
  useEffect(() => setFilteredRows(allRows), [allRows]);

  /* LOCAL table/card search + sort (applied after Filters) */
  const [tableSearch, setTableSearch] = useState("");
  const debouncedQ = useDebouncedValue(tableSearch, 300);
  const [sortDir, setSortDir] = useState<"desc" | "asc">("desc");

  const postFilterRows = useMemo(() => {
    const q = debouncedQ.trim().toLowerCase();
    const searched = q
      ? filteredRows.filter((r) => {
          const s = [r.id, r.purpose, r.dept, r.requester ?? "", r.driver ?? "", r.vehicle ?? ""]
            .join(" ")
            .toLowerCase();
          return s.includes(q);
        })
      : filteredRows;

    return [...searched].sort((a, b) =>
      sortDir === "desc" ? b.date.localeCompare(a.date) : a.date.localeCompare(b.date)
    );
  }, [filteredRows, debouncedQ, sortDir]);

  /* VIEW TOGGLE */
  const [view, setView] = useState<"table" | "card">("table");

  /* SELECTION (shared across views) */
  const [selected, setSelected] = useState<Set<string>>(new Set());
  const clearSelection = () => setSelected(new Set());

  /* PAGINATION (table 15/page; card 9/page) */
  const PAGE_SIZES = { table: 15, card: 9 } as const;
  const [pagination, setPagination] = useState<Pagination>({
    page: 1,
    pageSize: PAGE_SIZES.table,
    total: postFilterRows.length,
  });

  // when view changes
  useEffect(() => {
    setPagination((p) => ({ ...p, page: 1, pageSize: PAGE_SIZES[view] }));
    clearSelection();
  }, [view]);

  // keep pagination with rows
  useEffect(() => {
    setPagination((p) => {
      const total = postFilterRows.length;
      const maxPage = Math.max(1, Math.ceil(total / p.pageSize) || 1);
      return { ...p, total, page: Math.min(p.page, maxPage) };
    });
    clearSelection();
  }, [postFilterRows]);

  // measure sticky offsets → CSS vars
  useEffect(() => {
  const selKpi = '[data-role="admin"] .admin-sticky-kpi';
  const selTb  = '[data-role="admin"] .admin-sticky-toolbar';

  function update() {
    const kpi = document.querySelector(selKpi) as HTMLElement | null;
    const tb  = document.querySelector(selTb)  as HTMLElement | null;

    const kpiH = kpi?.offsetHeight ?? 0;
    const tbH  = tb?.offsetHeight ?? 0;

    const root = document.querySelector('[data-role="admin"]') as HTMLElement | null;
    if (root) {
      root.style.setProperty("--rq-kpi", `${kpiH}px`);
      root.style.setProperty("--rq-toolbar", `${tbH}px`);
      root.style.setProperty("--rq-offset", `${kpiH + tbH}px`);
    }
  }

  update();
  window.addEventListener("resize", update);

  const obs = new MutationObserver(update);
  const kpiNode = document.querySelector(selKpi);
  const tbNode  = document.querySelector(selTb);
  if (kpiNode) obs.observe(kpiNode, { childList: true, subtree: true, attributes: true });
  if (tbNode)  obs.observe(tbNode,  { childList: true, subtree: true, attributes: true });

  return () => { window.removeEventListener("resize", update); obs.disconnect(); };
}, []);

  const pageRows = useMemo(() => {
    const start = (pagination.page - 1) * pagination.pageSize;
    return postFilterRows.slice(start, start + pagination.pageSize);
  }, [postFilterRows, pagination.page, pagination.pageSize]);

  /* DETAILS + CONFIRM */
  const [openDetails, setOpenDetails] = useState(false);
  const [activeRow, setActiveRow] = useState<RequestRow | undefined>();
  const openRow = (r: RequestRow) => {
    setActiveRow(r);
    setOpenDetails(true);
  };

  const [confirm, setConfirm] = useState<{ open: boolean; kind?: "approve" | "reject"; id?: string }>({ open: false });

  /* ---------- PATCH HELPERS (optimistic) ---------- */
  function patchStatus(ids: string[], status?: "Approved" | "Rejected") {
    setAllRows((prev) => (status ? prev.map((r) => (ids.includes(r.id) ? { ...r, status } : r)) : prev.filter((r) => !ids.includes(r.id))));
    setFilteredRows((prev) => (status ? prev.map((r) => (ids.includes(r.id) ? { ...r, status } : r)) : prev.filter((r) => !ids.includes(r.id))));
  }

  async function approveOne(id: string) {
    const snapAll = [...allRows];
    const snapFiltered = [...filteredRows];
    patchStatus([id], "Approved");
    try {
      await approveRequests([id]);
      toast({ kind: "success", message: `Request ${id} approved.` });
    } catch {
      setAllRows(snapAll);
      setFilteredRows(snapFiltered);
      toast({ kind: "error", message: `Failed to approve ${id}.` });
    }
  }

  async function rejectOne(id: string) {
    const snapAll = [...allRows];
    const snapFiltered = [...filteredRows];
    patchStatus([id], "Rejected");
    try {
      await rejectRequests([id]);
      toast({ kind: "success", message: `Request ${id} rejected.` });
    } catch {
      setAllRows(snapAll);
      setFilteredRows(snapFiltered);
      toast({ kind: "error", message: `Failed to reject ${id}.` });
    }
  }

  const doConfirm = async () => {
    const id = confirm.id!;
    if (confirm.kind === "approve") await approveOne(id);
    if (confirm.kind === "reject") await rejectOne(id);
    setConfirm({ open: false });
    setOpenDetails(false);
  };

  /* ---------- BULK ---------- */
  async function bulkApprove(ids: string[]) {
    if (!ids.length) return;
    const snapAll = [...allRows];
    const snapFiltered = [...filteredRows];
    patchStatus(ids, "Approved");
    try {
      await approveRequests(ids);
      toast({ kind: "success", message: `Approved ${ids.length} selected.` });
    } catch {
      setAllRows(snapAll);
      setFilteredRows(snapFiltered);
      toast({ kind: "error", message: "Failed to approve selected." });
    }
  }

  async function bulkReject(ids: string[]) {
    if (!ids.length) return;
    const snapAll = [...allRows];
    const snapFiltered = [...filteredRows];
    patchStatus(ids, "Rejected");
    try {
      await rejectRequests(ids);
      toast({ kind: "success", message: `Rejected ${ids.length} selected.` });
    } catch {
      setAllRows(snapAll);
      setFilteredRows(snapFiltered);
      toast({ kind: "error", message: "Failed to reject selected." });
    }
  }

  async function bulkDelete(ids: string[]) {
    if (!ids.length) return;
    const snapAll = [...allRows];
    const snapFiltered = [...filteredRows];
    patchStatus(ids, undefined);
    try {
      await deleteRequests(ids);
      toast({ kind: "success", message: `Deleted ${ids.length} selected.` });
    } catch {
      setAllRows(snapAll);
      setFilteredRows(snapFiltered);
      toast({ kind: "error", message: "Failed to delete selected." });
    }
  }

  function bulkExport(rows: RequestRow[]) {
    try {
      exportRequestsCsv(rows);
      toast({ kind: "success", message: `Exported ${rows.length} row(s).` });
    } catch {
      toast({ kind: "error", message: "Export failed." });
    }
  }

  /* ---------- Keyboard shortcuts (with typing guard) ---------- */
  useEffect(() => {
    function onKey(e: KeyboardEvent) {
      const t = e.target as HTMLElement | null;
      const tag = t?.tagName?.toLowerCase();
      const typing =
        (t && (t as HTMLElement).isContentEditable) ||
        tag === "input" ||
        tag === "textarea" ||
        tag === "select";
      if (typing) return;

      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "enter") {
        e.preventDefault();
        bulkRef.current?.approveSelected();
        return;
      }
      if (!e.ctrlKey && !e.metaKey && e.key.toLowerCase() === "a") {
        e.preventDefault();
        setSelected((prev) => new Set([...prev, ...pageRows.map((r) => r.id)]));
        return;
      }
      if (e.key.toLowerCase() === "x") {
        e.preventDefault();
        clearSelection();
        return;
      }
      if (e.key === "ArrowLeft") {
        setPagination((p) => ({ ...p, page: Math.max(1, p.page - 1) }));
        return;
      }
      if (e.key === "ArrowRight") {
        setPagination((p) => ({
          ...p,
          page: Math.min(Math.ceil(p.total / p.pageSize) || 1, p.page + 1),
        }));
        return;
      }
      if (e.key.toLowerCase() === "t") {
        setView("table");
        return;
      }
      if (e.key.toLowerCase() === "c") {
        setView("card");
        return;
      }
    }
    window.addEventListener("keydown", onKey);
    return () => window.removeEventListener("keydown", onKey);
  }, [pageRows]);

  /* KPI summary uses filteredRows (pre-search) */
  const summary = useMemo(
    () => ({
      pending: filteredRows.filter((r) => r.status === "Pending").length,
      approved: filteredRows.filter((r) => r.status === "Approved").length,
      completed: filteredRows.filter((r) => r.status === "Completed").length,
      rejected: filteredRows.filter((r) => r.status === "Rejected").length,
    }),
    [filteredRows]
  );

  return (
    <div className="space-y-4">
      {/* Sticky KPI + View toggle */}
<div className="admin-sticky-kpi">
  {/* stack the cards and the toggle with spacing + a bit of right padding */}
  <div className="space-y-2 pr-2">
    <RequestsSummaryUI summary={summary} />
    <div className="flex justify-end">
      <ViewToggleUI view={view} onChange={setView} />
    </div>
  </div>
</div>


      {/* Filters container provides filtering logic to both views */}
      <FiltersBarContainer rows={allRows} onFiltered={setFilteredRows}>
        {(controls) => (
          <>
            {/* URL sync */}
            <URLSync
              draft={controls.draft}
              onDraftChange={controls.onDraftChange}
              tableSearch={tableSearch}
              setTableSearch={setTableSearch}
              sortDir={sortDir}
              setSortDir={setSortDir}
            />

            {/* Bulk bar */}
            {selected.size > 0 && (
              <BulkBarContainer
                ref={bulkRef}
                allRows={postFilterRows}
                selectedIds={selected}
                clearSelection={clearSelection}
                onApproveSelected={bulkApprove}
                onRejectSelected={bulkReject}
                onDeleteSelected={bulkDelete}
                onExportSelected={bulkExport}
              />
            )}

            {/* TABLE VIEW */}
            {view === "table" && (
              <RequestsTableUI
                tableSearch={tableSearch}
                onTableSearch={setTableSearch}
                sortDir={sortDir}
                onSortDirChange={setSortDir}
                onAddNew={() => toast({ kind: "success", message: "Add New clicked" })}
                filterControls={{
                  draft: controls.draft,
                  onDraftChange: controls.onDraftChange,
                  onApply: controls.onApply,
                  onClearAll: controls.onClearAll,
                }}
                rows={pageRows}
                pagination={pagination}
                selectedIds={selected}
                onToggleOne={(id) =>
                  setSelected((prev) => {
                    const next = new Set(prev);
                    next.has(id) ? next.delete(id) : next.add(id);
                    return next;
                  })
                }
                onToggleAllOnPage={(checked, idsOnPage) =>
                  setSelected((prev) => {
                    const next = new Set(prev);
                    idsOnPage.forEach((id) => (checked ? next.add(id) : next.delete(id)));
                    return next;
                  })
                }
                onRowClick={openRow}
                onRowViewDetails={(row) => openRow(row)}
                onPageChange={(page) => setPagination((p) => ({ ...p, page }))}
                onPageSizeChange={(pageSize) => setPagination((p) => ({ ...p, page: 1, pageSize }))}
                onApproveRow={(id) => approveOne(id)}
                onRejectRow={(id) => rejectOne(id)}
              />
            )}

            {/* CARD VIEW */}
            {view === "card" && (
              <div className="rounded-2xl border border-neutral-200 bg-white p-4 shadow-sm">
                <RequestsCardGridUI
                  rows={pageRows}
                  pagination={pagination}
                  onPageChange={(page) => setPagination((p) => ({ ...p, page }))}
                  selectedIds={selected}
                  onToggleOne={(id) =>
                    setSelected((prev) => {
                      const next = new Set(prev);
                      next.has(id) ? next.delete(id) : next.add(id);
                      return next;
                    })
                  }
                  onRowClick={openRow}
                  onApproveRow={(id) => approveOne(id)}
                  onRejectRow={(id) => rejectOne(id)}
                />
              </div>
            )}
          </>
        )}
      </FiltersBarContainer>

      <RequestDetailsModalUI
        open={openDetails}
        onClose={() => setOpenDetails(false)}
        row={activeRow}
        onApprove={() => activeRow && setConfirm({ open: true, kind: "approve", id: activeRow.id })}
        onReject={() => activeRow && setConfirm({ open: true, kind: "reject", id: activeRow.id })}
      />

      <ConfirmUI
        open={confirm.open}
        title={confirm.kind === "approve" ? "Approve request?" : "Reject request?"}
        message={confirm.kind === "approve" ? "This will mark the request as Approved." : "This will mark the request as Rejected."}
        confirmText={confirm.kind === "approve" ? "Approve" : "Reject"}
        confirmClass={confirm.kind === "approve" ? "bg-green-600 text-white" : "bg-red-600 text-white"}
        onCancel={() => setConfirm({ open: false })}
        onConfirm={doConfirm}
      />
    </div>
  );
}

export default function AdminRequestsPage() {
  return (
    <ToastProvider>
      <PageInner />
    </ToastProvider>
  );
}


===== app\(protected)\admin\schedule\ClientWrapper.tsx =====
"use client";

import dynamic from "next/dynamic";

const SchedulePageClient = dynamic(() => import("./SchedulePageClient"), {
  ssr: false,
  loading: () => <div className="p-4 text-sm text-neutral-500">Loading…</div>,
});

export default function ClientWrapper() {
  return <SchedulePageClient />;
}


===== app\(protected)\admin\schedule\SchedulePageClient.tsx =====
// src/app/(protected)/admin/schedule/SchedulePageClient.tsx
"use client";

import * as React from "react";
import { ScheduleRepo } from "@/lib/admin/schedule/store";
import type { Schedule } from "@/lib/admin/schedule/types";

import ScheduleTable from "@/components/admin/schedule/ui/ScheduleTable.ui";
import ScheduleToolbar from "@/components/admin/schedule/toolbar/ScheduleToolbar.ui";
import ScheduleDetailsModal from "@/components/admin/schedule/ui/ScheduleDetailsModal.ui";

import { useScheduleFilters } from "@/components/admin/schedule/hooks/useScheduleFilters";
import { DEFAULT_SCH_FILTERS, filterSchedules } from "@/lib/admin/schedule/filters";

import { useScheduleKpis } from "@/components/admin/schedule/kpi/useScheduleKpis";
import KpiGrid from "@/components/admin/schedule/ui/KpiGrid.ui";

// ✅ Use ONLY the container (it manages form state + validation)
import CreateScheduleDialog from "@/components/admin/schedule/forms/CreateScheduleDialogs.container";

export default function SchedulePageClient() {
  // Avoid SSR/CSR mismatch for anything touching localStorage
  const [hydrated, setHydrated] = React.useState(false);
  React.useEffect(() => setHydrated(true), []);

  // State
  const [rows, setRows] = React.useState<Schedule[]>([]);
  const [page, setPage] = React.useState(1);
  const [pageSize] = React.useState(15);
  const [q, setQ] = React.useState("");
  const [sort, setSort] = React.useState<"newest" | "oldest">("newest");
  const [selected, setSelected] = React.useState<Set<string>>(new Set());
  const [open, setOpen] = React.useState(false);
  const [editRow, setEditRow] = React.useState<Schedule | null>(null);
  const [viewRow, setViewRow] = React.useState<Schedule | null>(null);

  const filters = useScheduleFilters(DEFAULT_SCH_FILTERS);
  const { kpis, refresh: refreshKpis } = useScheduleKpis();

  // Load repo after mount
  React.useEffect(() => {
    if (!hydrated) return;
    setRows(ScheduleRepo.list());
    refreshKpis();
  }, [hydrated, refreshKpis]);

  function refresh() {
    setRows(ScheduleRepo.list());
    refreshKpis();
  }

  const filtered = React.useMemo(() => {
    if (!hydrated) return [] as Schedule[];
    const base = filterSchedules(rows, { ...filters.applied, search: q });
    return [...base].sort((a, b) => {
      const tA = `${a.date}T${a.startTime}`;
      const tB = `${b.date}T${b.startTime}`;
      return sort === "newest" ? (tA < tB ? 1 : -1) : (tA > tB ? 1 : -1);
    });
  }, [hydrated, rows, filters.applied, q, sort]);

  const total = filtered.length;
  const pageRows = filtered.slice((page - 1) * pageSize, (page - 1) * pageSize + pageSize);

  const onToggleOne = (id: string, checked: boolean) =>
    setSelected((p) => {
      const n = new Set(p);
      checked ? n.add(id) : n.delete(id);
      return n;
    });

  const onToggleAll = (checked: boolean) =>
    setSelected((p) => {
      const n = new Set(p);
      pageRows.forEach((r) => (checked ? n.add(r.id) : n.delete(r.id)));
      return n;
    });

  // Skeleton while hydrating
  if (!hydrated) {
    return (
      <div className="space-y-3">
        <div className="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
          {Array.from({ length: 4 }).map((_, i) => (
            <div key={i} className="rounded-xl border bg-white p-4">
              <div className="h-4 w-28 animate-pulse rounded bg-neutral-200" />
              <div className="mt-2 h-8 w-12 animate-pulse rounded bg-neutral-200" />
            </div>
          ))}
        </div>
        <div className="rounded-2xl border bg-white p-4">
          <div className="mb-3 h-6 w-40 animate-pulse rounded bg-neutral-200" />
          <div className="h-48 animate-pulse rounded bg-neutral-100" />
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      <KpiGrid kpis={kpis} />

      <ScheduleTable
        rows={pageRows}
        pagination={{ page, pageSize, total }}
        selected={selected}
        onToggleOne={onToggleOne}
        onToggleAll={onToggleAll}
        onEdit={(r) => {
          setEditRow(r);
          setOpen(true);
        }}
        onDeleteMany={(ids) => {
          ScheduleRepo.removeMany(ids);
          setSelected(new Set());
          refresh();
        }}
        onSetStatus={(id, s) => {
          try {
            ScheduleRepo.setStatus(id, s);
            refresh();
          } catch (e: any) {
            alert(e?.message || "Cannot change status");
          }
        }}
        onPageChange={setPage}
        onView={(r) => setViewRow(r)}
        toolbar={
          <ScheduleToolbar
            q={q}
            onQChange={(v) => {
              setQ(v);
              setPage(1);
            }}
            sort={sort}
            onSortChange={(s) => {
              setSort(s);
              setPage(1);
            }}
            onAddNew={() => {
              setEditRow(null);
              setOpen(true);
            }}
            draft={filters.draft}
            onDraftChange={(n) => {
              filters.update(n);
              setPage(1);
            }}
            onApply={() => {
              filters.apply();
              setPage(1);
            }}
            onClearAll={() => {
              filters.clearAll();
              setPage(1);
            }}
          />
        }
      />

      {/* ✅ Only the container dialog here */}
      <CreateScheduleDialog
        open={open}
        initial={editRow ?? undefined}
        onClose={() => setOpen(false)}
        onSubmit={(data) => {
          try {
            if (editRow) {
              ScheduleRepo.update(editRow.id, data);
            } else {
              ScheduleRepo.create(data);
            }
            setOpen(false);
            refresh();
          } catch (err: any) {
            alert(err?.message || "Cannot save schedule.");
          }
        }}
      />

      <ScheduleDetailsModal
        open={!!viewRow}
        data={viewRow || undefined}
        onClose={() => setViewRow(null)}
      />
    </div>
  );
}


===== app\(protected)\admin\schedule\page.tsx =====
// Server Component (default)
import ClientWrapper from "./ClientWrapper";

export default function Page() {
  return <ClientWrapper />;
}


===== app\(protected)\admin\vehicles\VehiclesPage.tsx =====
"use client";
import VehiclesPageClient from "@/components/admin/vehicles/containers/VehiclesPage.client";
export function VehiclesPage() { return <VehiclesPageClient />; }

===== app\(protected)\admin\vehicles\page.tsx =====
export { VehiclesPage as default } from "./VehiclesPage";

===== app\(protected)\driver\layout.tsx =====
"use client";

import React from "react";
import Sidebar from "@/components/driver/Sidebar";              // container (below)
import Topbar from "@/components/driver/Topbar";
import ProfilePanel from "@/components/driver/ProfilePanel";
import MiniCalendar from "@/components/driver/MiniCalendar";
import "@/app/styles/driver.css";

const TOPBAR_H = 64; // adjust if your Topbar is not h-16

export default function DriverLayout({ children }: { children: React.ReactNode }) {
  return (
    <div data-role="driver" className="min-h-screen bg-[var(--bg)]">
      {/* keep the topbar visible while center scrolls */}
      <div className="sticky top-0 z-40">
        <Topbar title="Driver Transport Portal" />
      </div>

      {/* 3-col grid: [sidebar | main-scroll | right]  */}
      <div
        className="grid gap-0"
        style={{
          gridTemplateColumns: "260px 1fr 360px",
          height: `calc(100vh - ${TOPBAR_H}px)`, // lock height under the topbar
        }}
      >
        {/* LEFT: sidebar — fixed, no scroll */}
        <aside className="border-r border-neutral-200 bg-white">
          <Sidebar />
        </aside>

        {/* MIDDLE: the ONLY scrollable area */}
        <main className="overflow-y-auto p-5">
          <div className="min-w-0">{children}</div>
        </main>

        {/* RIGHT: profile + mini calendar — fixed, no scroll */}
        <aside className="hidden lg:block p-5">
          <div className="space-y-4">
            <div className="tl-profile">
              <ProfilePanel
                role="DRIVER"
                name="Jolo Rosales"
                code="D22-11451"
                faculty="Driver"
                campus="Lucena Campus"
                watermarkSrc="/euwhite.png"
              />
            </div>

            {/* KPIs */}
            <div className="grid grid-cols-3 gap-3">
              <div className="rounded-xl border border-neutral-200 bg-white p-3 text-center">
                <div className="text-[22px] font-semibold text-neutral-900 leading-none">5</div>
                <div className="mt-1 text-xs text-neutral-500">Active Requests</div>
              </div>
              <div className="rounded-xl border border-neutral-200 bg-white p-3 text-center">
                <div className="text-[22px] font-semibold text-neutral-900 leading-none">3</div>
                <div className="mt-1 text-xs text-neutral-500">Vehicles Online</div>
              </div>
              <div className="rounded-xl border border-neutral-200 bg-white p-3 text-center">
                <div className="text-[22px] font-semibold text-neutral-900 leading-none">4</div>
                <div className="mt-1 text-xs text-neutral-500">Pending Approvals</div>
              </div>
            </div>

            <MiniCalendar />
          </div>
        </aside>
      </div>
    </div>
  );
}


===== app\(protected)\driver\page.tsx =====
import DashboardView from "@/components/driver/dashboard/DashboardView";

export default function Page() {
  // metrics
  const metrics = { trips: 4, online: 2, pending: 2 };

  // upcoming list
  const upcoming = [
    { id: "u1", date: "2025-12-25 08:00", location: "Tagaytay",     vehicle: "Bus", status: "Approved" as const },
    { id: "u2", date: "2025-12-28 09:30", location: "MSEUF Lucena", vehicle: "Van", status: "Pending"  as const },
  ];

  // actions (no maintenance)
  const actions = [
    { icon: null, title: "Upcoming Schedules", desc: "Preview your next trips with dates, time, and locations.", href: "/driver/schedule" },
    { icon: null, title: "Trip History",       desc: "Review completed trips and past assignments.",             href: "/driver/history" },
  ];

  // ✅ Fleet data with logs so the View Logs button is enabled
  const fleet = [
    {
      id: "v1",
      name: "Bus 12",
      plate: "ABC-1234",
      type: "Bus",
      status: "available" as const,
      lastMaintenance: "2025-08-22",
      nextDue: "2025-10-22",
      logs: [
        {
          id: "M-2025-081",
          date: "2025-08-22",
          category: "Oil Change",
          odometer: 45210,
          description: "Replaced engine oil and filter.",
          nextDueDate: "2025-10-22",
        },
        {
          id: "M-2025-056",
          date: "2025-06-10",
          category: "Brake Service",
          description: "Front pads replaced; rotor resurfaced.",
        },
      ],
    },
    {
      id: "v2",
      name: "Van 03",
      plate: "XYZ-9087",
      type: "Van",
      status: "assigned" as const,
      lastMaintenance: "2025-07-30",
      nextDue: "2025-11-30",
      logs: [
        {
          id: "M-2025-073",
          date: "2025-07-30",
          category: "Tire Rotation",
          description: "Rotated all four tires; checked pressure.",
        },
      ],
    },
  ];

  return (
    <DashboardView
      metrics={metrics}
      upcoming={upcoming}
      actions={actions}
      fleet={fleet}
    />
  );
}


===== app\(protected)\driver\history\page.tsx =====
export default function DriverHistory() {
  const rows = [
    { id: "H-001", date: "2025-11-22", route: "Main — City Hall", vehicle: "Bus", status: "Completed" },
    { id: "H-002", date: "2025-11-28", route: "Campus — Lucena", vehicle: "Van", status: "Completed" },
  ];
  return (
    <div className="grid gap-4">
      <h1 className="text-xl font-semibold">Trip History</h1>
      <div className="card overflow-hidden">
        <table className="w-full text-sm">
          <thead className="bg-gray-50 text-left text-tl.gray3">
            <tr>
              <th className="px-5 py-3">ID</th>
              <th className="px-5 py-3">Date</th>
              <th className="px-5 py-3">Route</th>
              <th className="px-5 py-3">Vehicle</th>
              <th className="px-5 py-3">Status</th>
            </tr>
          </thead>
          <tbody>
            {rows.map((r) => (
              <tr key={r.id} className="border-t border-tl-line">
                <td className="px-5 py-3">{r.id}</td>
                <td className="px-5 py-3">{r.date}</td>
                <td className="px-5 py-3">{r.route}</td>
                <td className="px-5 py-3">{r.vehicle}</td>
                <td className="px-5 py-3">{r.status}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}


===== app\(protected)\driver\notifications\page.tsx =====
export default function Notifications() {
  const items = [
    { id: 1, title: "Trip assigned", note: "You have been assigned to Bus • Tagaytay 12/25 08:00", time: "2h ago" },
    { id: 2, title: "Request approved", note: "City Hall request approved for 01/12", time: "1d ago" },
  ];
  return (
    <div className="grid gap-4">
      <h1 className="text-xl font-semibold">Notifications</h1>
      <div className="card">
        {items.map((n, i) => (
          <div key={n.id} className={`px-5 py-4 ${i ? "border-t border-tl-line" : ""}`}>
            <div className="font-medium">{n.title}</div>
            <div className="text-sm text-tl.gray3">{n.note}</div>
            <div className="text-xs text-tl.gray4 mt-1">{n.time}</div>
          </div>
        ))}
      </div>
    </div>
  );
}


===== app\(protected)\driver\profile\page.tsx =====
"use client";

import { useEffect, useRef, useState } from "react";
import type { DriverProfile } from "@/app/types/driverProfile"; // ✅ correct path
import ProfileView, { type PasswordState } from "@/components/driver/profile/ProfileView"; // ✅ correct path
import { loadProfile, saveProfile, seedFromMock } from "@/lib/data/driverProfile";

export default function DriverProfilePage() {
  const [profile, setProfile] = useState<DriverProfile>(seedFromMock());
  const [password, setPassword] = useState<PasswordState>({ new: "", confirm: "" });
  const [errors, setErrors] = useState<Record<string, string>>({});
  const [saving, setSaving] = useState(false);
  const [savedAt, setSavedAt] = useState<string | null>(null);

  const fileRef = useRef<HTMLInputElement | null>(null);

  useEffect(() => setProfile(loadProfile()), []);

  const update = <K extends keyof DriverProfile>(key: K, value: DriverProfile[K]) =>
    setProfile((p) => ({ ...p, [key]: value }));

  const toggleCanDrive = (v: string) =>
    setProfile((p) => {
      const has = p.canDrive.includes(v);
      return { ...p, canDrive: has ? p.canDrive.filter((x) => x !== v) : [...p.canDrive, v] };
    });

  const validate = () => {
    const e: Record<string, string> = {};
    if (!profile.firstName.trim()) e.firstName = "Required.";
    if (!profile.lastName.trim()) e.lastName = "Required.";
    if (profile.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(profile.email)) e.email = "Invalid email.";
    if (!profile.campus.trim()) e.campus = "Required.";
    if (!profile.license.trim()) e.license = "License is required.";
    if (password.new || password.confirm) {
      if (password.new.length < 8) e.passwordNew = "Min 8 characters.";
      if (password.new !== password.confirm) e.passwordConfirm = "Passwords do not match.";
    }
    setErrors(e);
    return Object.keys(e).length === 0;
  };

  async function onSubmit(e: React.FormEvent) {
    e.preventDefault();
    if (!validate()) return;
    setSaving(true);
    await new Promise((r) => setTimeout(r, 650)); // simulate API
    saveProfile(profile);
    setSaving(false);
    setSavedAt(new Date().toLocaleString());
    setPassword({ new: "", confirm: "" });
  }

  const onAvatarFile = (file?: File) => {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => update("avatar", String(reader.result));
    reader.readAsDataURL(file);
  };

  return (
    <ProfileView
      profile={profile}
      errors={errors}
      password={password}
      saving={saving}
      savedAt={savedAt}
      fileInputRef={fileRef}
      onSubmit={onSubmit}
      onChange={update}
      onToggleCanDrive={toggleCanDrive}
      onPasswordChange={(patch) => setPassword((p) => ({ ...p, ...patch }))}
      onAvatarFile={onAvatarFile}
    />
  );
}


===== app\(protected)\driver\schedule\page.tsx =====
import ScheduleView from "@/components/driver/schedule/ScheduleView";
import type { DriverScheduleRow } from "@/app/types/schedule";

// TEMP demo data – replace with real fetch later
const ROWS: DriverScheduleRow[] = [
  { id: "1", date: "2025-12-25 08:00", location: "Tagaytay", vehicle: "Bus", driver: "Jolo Rosales", status: "Approved" },
  { id: "2", date: "2025-12-28 09:30", location: "MSEUF Lucena", vehicle: "Van", driver: "", status: "Pending" },
  { id: "3", date: "2026-01-10 06:30", location: "Batangas", vehicle: "Bus", driver: "", status: "Assigned" },
];

export default async function DriverSchedulePage() {
  // example for later:
  // const rows = await getDriverSchedule(userId);
  return <ScheduleView rows={ROWS} />;
}


===== app\(protected)\driver\settings\page.tsx =====
"use client";

import { useEffect, useState } from "react";
import SettingsView from "@/components/driver/settings/SettingsView";

const LS_KEY = "travilink_driver_settings";

/* ----------------------------- Types & Defaults ---------------------------- */
export type DriverSettings = {
  // notifications
  notifyAssignments: boolean;
  notifyChanges: boolean;
  notifyMaintenance: boolean;
  reminderMinutes: 5 | 10 | 15 | 30;

  // status/workday
  defaultStatusOnOpen: "Available" | "Off Duty";
  autoOnTripOnBegin: boolean;
  promptOffDutyEOD: boolean;

  // location/privacy
  shareLiveLocation: boolean;
  bgLocationWhileOnTrip: boolean;
  locationVisibility: "dispatcher" | "dispatcher_requester";

  // display
  language: "en" | "ph";
  theme: "system" | "light" | "dark";
  timeFormat: "12h" | "24h";
  dateMode: "local"; // fixed for now
};

export const DEFAULT_SETTINGS: DriverSettings = {
  notifyAssignments: true,
  notifyChanges: true,
  notifyMaintenance: false,
  reminderMinutes: 15,

  defaultStatusOnOpen: "Available",
  autoOnTripOnBegin: true,
  promptOffDutyEOD: true,

  shareLiveLocation: false,
  bgLocationWhileOnTrip: true,
  locationVisibility: "dispatcher",

  language: "ph",
  theme: "system",
  timeFormat: "24h",
  dateMode: "local",
};

/* --------------------------------- Page ---------------------------------- */
export default function DriverSettingsPage() {
  const [settings, setSettings] = useState<DriverSettings>(DEFAULT_SETTINGS);
  const [saving, setSaving] = useState(false);
  const [savedAt, setSavedAt] = useState<string | null>(null);

  // load on mount
  useEffect(() => {
    try {
      const raw = localStorage.getItem(LS_KEY);
      if (raw) {
        const parsed = JSON.parse(raw) as Partial<DriverSettings>;
        setSettings({ ...DEFAULT_SETTINGS, ...parsed });
      }
    } catch {}
  }, []);

  // generic setter
  const update = <K extends keyof DriverSettings>(k: K, v: DriverSettings[K]) =>
    setSettings((s) => ({ ...s, [k]: v }));

  // save
  async function onSubmit(e: React.FormEvent) {
    e.preventDefault();
    setSaving(true);
    try {
      // simulate API
      await new Promise((r) => setTimeout(r, 500));
      localStorage.setItem(LS_KEY, JSON.stringify(settings));
      setSavedAt(new Date().toLocaleString());
    } finally {
      setSaving(false);
    }
  }

  return (
    <SettingsView
      formId="driverSettingsForm"
      settings={settings}
      saving={saving}
      savedAt={savedAt}
      onChange={update}
      onSubmit={onSubmit}
    />
  );
}


===== app\(protected)\driver\status\page.tsx =====
"use client";

import { useState } from "react";
import StatusView from "@/components/driver/status/StatusView";
import type { DriverStatus } from "@/app/types/driver";
// import { saveDriverStatus } from "@/lib/data/driver"; // optional later

export default function DriverStatusPage() {
  const [status, setStatus] = useState<DriverStatus>("Available");
  const [saving, setSaving] = useState(false);

  async function handleSave() {
    try {
      setSaving(true);
      // await saveDriverStatus(userId, status);
      // toast.success("Status updated");
    } finally {
      setSaving(false);
    }
  }

  return <StatusView status={status} onChange={setStatus} onSave={handleSave} />;
}


===== app\(protected)\driver\submit\page.tsx =====
"use client";

import { useRouter } from "next/navigation";
import { useState } from "react";
import { PageHeader, PageBody } from "@/components/common/Page";

const LS_KEY = "travilink_maintenance";

export default function SubmitMaintenance() {
  const router = useRouter();
  const [form, setForm] = useState({
    vehicle: "Bus 1",
    title: "",
    date: new Date().toISOString().slice(0, 10), // yyyy-mm-dd
    note: "",
  });

  function saveToStorage() {
    const raw = localStorage.getItem(LS_KEY);
    const items = raw ? JSON.parse(raw) : [];
    items.push({
      id: crypto.randomUUID(),
      vehicle: form.vehicle,
      title: form.title || "Maintenance",
      date: form.date,
      status: "Pending",
      note: form.note,
    });
    localStorage.setItem(LS_KEY, JSON.stringify(items));
  }

  function submit(e: React.FormEvent) {
    e.preventDefault();
    saveToStorage();
    router.push("/driver/maintenance");
  }

  return (
    <>
      <PageHeader
        title="Submit a maintenance"
        description="Create a scheduled or reported maintenance item."
        actions={
          <button
            className="btn btn-outline"
            onClick={() => router.push("/driver/maintenance")}
          >
            Back to list
          </button>
        }
      />

      <PageBody>
        <form
          onSubmit={submit}
          className="rounded-xl ring-1 ring-neutral-200/70 bg-white shadow-sm p-5 grid gap-4"
        >
          <div className="grid sm:grid-cols-2 gap-4">
            <label className="grid gap-1">
              <span className="text-sm text-neutral-600">Vehicle</span>
              <select
                className="rounded-xl border border-neutral-200/80 px-3 py-2"
                value={form.vehicle}
                onChange={(e) => setForm({ ...form, vehicle: e.target.value })}
              >
                <option>Bus 1</option>
                <option>Van 1</option>
                <option>Bus 2</option>
              </select>
            </label>

            <label className="grid gap-1">
              <span className="text-sm text-neutral-600">Date</span>
              <input
                type="date"
                className="rounded-xl border border-neutral-200/80 px-3 py-2"
                value={form.date}
                onChange={(e) => setForm({ ...form, date: e.target.value })}
              />
            </label>
          </div>

          <label className="grid gap-1">
            <span className="text-sm text-neutral-600">Maintenance Title</span>
            <input
              className="rounded-xl border border-neutral-200/80 px-3 py-2"
              placeholder="e.g., Engine check, Brake service"
              value={form.title}
              onChange={(e) => setForm({ ...form, title: e.target.value })}
              required
            />
          </label>

          <label className="grid gap-1">
            <span className="text-sm text-neutral-600">Notes</span>
            <textarea
              className="min-h-[140px] rounded-xl border border-neutral-200/80 px-3 py-2"
              placeholder="Additional details…"
              value={form.note}
              onChange={(e) => setForm({ ...form, note: e.target.value })}
            />
          </label>

          <div className="flex justify-end">
            <button className="btn btn-primary" type="submit">
              Submit
            </button>
          </div>
        </form>
      </PageBody>
    </>
  );
}


===== app\(protected)\faculty\layout.tsx =====
"use client";

import Link from "next/link";
import { Bell, CircleUserRound } from "lucide-react";
import FacultyNav from "@/components/faculty/Nav";
import ProfileRail from "@/components/faculty/ProfileRail"; // Profile + KPIs (no calendar)

export default function FacultyLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="min-h-dvh bg-[var(--background)] text-[var(--foreground)]">
      {/* FIXED MAROON TOP BAR */}
      <header className="fixed inset-x-0 top-0 z-50 h-14 bg-[#7a0019] text-white">
        <div className="flex h-full items-center justify-between px-4 md:px-6">
          <div className="flex items-center gap-3">
            <Link href="/" className="inline-flex items-center gap-2">
              <span className="grid h-8 w-8 place-items-center rounded-md bg-white text-[#7a0019] text-sm font-semibold">
                TL
              </span>
              <span className="font-medium">TraviLink</span>
            </Link>
            <span className="opacity-70">|</span>
            <span className="opacity-90">Faculty</span>
          </div>
          <div className="flex items-center gap-1">
            <Link
              href="/faculty/notifications"
              className="relative rounded-full p-2 hover:bg-white/10"
              aria-label="Notifications"
            >
              <Bell className="h-5 w-5" />
              <span className="absolute -right-0.5 -top-0.5 grid h-4 min-w-4 place-items-center rounded-full bg-white px-[3px] text-[10px] leading-4 text-[#7a0019]">
                2
              </span>
            </Link>
            <Link
              href="/faculty/profile"
              className="rounded-full p-2 hover:bg-white/10"
              aria-label="Profile"
            >
              <CircleUserRound className="h-6 w-6" />
            </Link>
          </div>
        </div>
      </header>

      {/* APP SHELL — left & right rails pinned; center only scrolls */}
      <div
        className="
          pt-14
          h-[calc(100dvh-56px)]
          grid grid-cols-[260px_minmax(0,1fr)_360px]
          gap-6
          overflow-hidden
        "
      >
        {/* LEFT NAV (pinned) */}
        <aside className="h-full bg-white/90 border-r border-neutral-200">
          <div className="h-full p-3">
            <FacultyNav />
          </div>
        </aside>

        {/* CENTER (scrolls) */}
        <main className="min-w-0 h-full overflow-y-auto px-4 md:px-6">
          <div className="mx-auto max-w-[1400px]">{children}</div>
        </main>

        {/* RIGHT RAIL (pinned) */}
        <aside className="h-full bg-white/90 border-l border-neutral-200 min-w-0">
          <div className="h-full p-3">
            <ProfileRail />
          </div>
        </aside>
      </div>
    </div>
  );
}


===== app\(protected)\faculty\page.tsx =====
import DashboardView, {
  Metrics,
  UpcomingItem,
  NotificationItem,
  Profile,
} from "@/components/faculty/DashboardView";

export default async function FacultyDashboardPage() {
  // TODO: fetch from Supabase later
  const metrics: Metrics = { upcoming: 3, pending: 1, approved: 1 };

  const upcoming: UpcomingItem[] = [
    { id: "1", date: "2025-12-25 08:00", location: "Tagaytay",     vehicle: "Bus", status: "Approved" },
    { id: "2", date: "2025-12-28 09:30", location: "MSEUF Lucena", vehicle: "Van", status: "Pending"  },
    { id: "3", date: "2026-01-10 06:15", location: "Batangas",     vehicle: "Bus", status: "Assigned" },
  ];

  const notifications: NotificationItem[] = [
    { id: "n1", text: "Your request REQ-24013 was approved.",         time: "2h ago" },
    { id: "n2", text: "Schedule update: Bus departs 30 mins earlier.", time: "1d ago" },
  ];

  const profile: Profile = {
    name: "Jolo Rosales",
    code: "FAC-11234",
    role: "Faculty",
    campus: "Lucena Campus",
  };

  const rightStats = [
    { label: "Active Requests", value: 5 },
    { label: "Vehicles Online", value: 3 },
    { label: "Pending Approvals", value: 4 },
  ];

  return (
    <DashboardView
      metrics={metrics}
      upcoming={upcoming}
      notifications={notifications}
      profile={profile}
      rightStats={rightStats}
    />
  );
}


===== app\(protected)\faculty\feedback\page.tsx =====
"use client";

import { useState } from "react";
import Link from "next/link";
import { PageHeader, PageBody } from "@/components/common/Page";
// Update the import path if the actual file is named 'feedbackView.tsx' (lowercase 'f'), or adjust to the correct path and casing.
import FeedbackView from "@/components/faculty/feedback/FeedbackView";

/* ------------ Types used only by the container ------------ */
type Form = {
  category: string;
  rating: number;         // 0–5
  subject: string;
  message: string;
  anonymous: boolean;
  contact: string;        // email or phone (optional if anonymous)
  attachment?: File | null;
};
type Errors = Partial<Record<keyof Form, string>>;

/* ------------ Simple validators (can be moved to utils) ------------ */
const isEmail = (v: string) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
const isPhone = (v: string) => /^(\+?\d{10,15}|0\d{9,10})$/.test(v.replace(/\s|-/g, ""));
const validate = (f: Form): Errors => {
  const e: Errors = {};
  if (!f.category) e.category = "Please pick a category.";
  if (!f.message.trim() || f.message.trim().length < 10) e.message = "Please write at least 10 characters.";
  if (!f.anonymous && f.contact.trim() && !(isEmail(f.contact) || isPhone(f.contact))) {
    e.contact = "Enter a valid email or phone, or leave blank.";
  }
  return e;
};

export default function FacultyFeedbackPage() {
  const [form, setForm] = useState<Form>({
    category: "",
    rating: 0,
    subject: "",
    message: "",
    anonymous: false,
    contact: "",
    attachment: null,
  });
  const [errors, setErrors] = useState<Errors>({});
  const [submitting, setSubmitting] = useState(false);
  const [successId, setSuccessId] = useState<string | null>(null);

  const update = <K extends keyof Form>(key: K, val: Form[K]) =>
    setForm((f) => ({ ...f, [key]: val }));

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    const v = validate(form);
    setErrors(v);
    if (Object.keys(v).length) return;

    setSubmitting(true);

    // TODO: replace with real API call — e.g., POST /api/feedback
    await new Promise((r) => setTimeout(r, 700));

    setSubmitting(false);
    setSuccessId(`FB-${Math.floor(Math.random() * 90000) + 10000}`);

    // keep contact preference; clear other fields
    setForm((f) => ({
      ...f,
      category: "",
      rating: 0,
      subject: "",
      message: "",
      attachment: null,
    }));
  };

  const onReset = () => {
    setForm({
      category: "",
      rating: 0,
      subject: "",
      message: "",
      anonymous: false,
      contact: "",
      attachment: null,
    });
    setErrors({});
    setSuccessId(null);
  };

  return (
    <>
      <PageHeader
        title="Feedback"
        description="Send feedback about the transport service."
        actions={
          <Link href="/faculty" className="rounded-md border px-3 py-2 text-sm hover:bg-neutral-50">
            Back to Dashboard
          </Link>
        }
      />
      <PageBody>
        <FeedbackView
          /* values */
          category={form.category}
          rating={form.rating}
          subject={form.subject}
          message={form.message}
          anonymous={form.anonymous}
          contact={form.contact}
          attachmentName={form.attachment?.name ?? ""}
          /* errors */
          errors={errors}
          /* flags */
          submitting={submitting}
          successId={successId}
          /* handlers */
          onChangeCategory={(v) => update("category", v)}
          onChangeRating={(v) => update("rating", v)}
          onChangeSubject={(v) => update("subject", v)}
          onChangeMessage={(v) => update("message", v)}
          onToggleAnonymous={(v) => update("anonymous", v)}
          onChangeContact={(v) => update("contact", v)}
          onFile={(file?: File | undefined) => update("attachment", file ?? null)}
          onSubmit={onSubmit}
          onReset={onReset}
        />
      </PageBody>
    </>
  );
}


===== app\(protected)\faculty\notifications\page.tsx =====
"use client";

import { useMemo, useState } from "react";
import NotificationsView, {
  NotificationItem,
  NotificationsTab,
} from "@/components/faculty/notification/NotificationsView";

export default function FacultyNotificationsPage() {
  // demo local state (replace with real fetch later)
  const [items, setItems] = useState<NotificationItem[]>([
    // sample structure (start empty if you want)
    // { id: "1", text: "Your request REQ-24013 was approved.", time: "2h ago", read: false },
    // { id: "2", text: "Schedule update: Bus departs 30 mins earlier.", time: "1d ago", read: true },
  ]);

  const [tab, setTab] = useState<NotificationsTab>("unread");

  const unreadCount = useMemo(
    () => items.filter((n) => !n.read).length,
    [items]
  );
  const allCount = items.length;

  function onMarkAllRead() {
    if (unreadCount === 0) return;
    setItems((prev) => prev.map((n) => ({ ...n, read: true })));
  }

  function onRefresh() {
    // placeholder — fetch new data here later
    // e.g., revalidate or call your API
  }

  return (
    <NotificationsView
      tab={tab}
      unreadCount={unreadCount}
      allCount={allCount}
      items={items}
      onTabChange={setTab}
      onMarkAllRead={onMarkAllRead}
      onRefresh={onRefresh}
    />
  );
}


===== app\(protected)\faculty\profile\page.tsx =====
"use client";

import { useMemo, useState } from "react";
import ProfileView, {
  ProfileData,
  PasswordState,
  ProfileErrors,
} from "@/components/faculty/profile/ProfileView";

export default function FacultyProfilePage() {
  const [profile, setProfile] = useState<ProfileData>({
    firstName: "Jolo",
    lastName: "Santos",
    email: "jolo@example.edu",
    department: "CCMS",
    campus: "Lucena",
    phone: "09XX XXX XXXX",
    avatar: undefined,     // later: fill from DB/CDN
    notifyEmail: true,
    notifyPush: true,
  });

  const [password, setPassword] = useState<PasswordState>({ new: "", confirm: "" });
  const [errors, setErrors] = useState<ProfileErrors>({});
  const [saving, setSaving] = useState(false);
  const [savedAt, setSavedAt] = useState<string | null>(null);

  const update = <K extends keyof ProfileData>(key: K, value: ProfileData[K]) =>
    setProfile((p) => ({ ...p, [key]: value }));

  const isValidEmail = (v: string) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);

  function validate(): boolean {
    const e: ProfileErrors = {};
    if (!profile.firstName.trim()) e.firstName = "Required.";
    if (!profile.lastName.trim()) e.lastName = "Required.";
    if (!isValidEmail(profile.email)) e.email = "Invalid email.";
    if (!profile.department.trim()) e.department = "Required.";
    if (!profile.campus.trim()) e.campus = "Required.";
    if (password.new || password.confirm) {
      if (password.new.length < 8) e.passwordNew = "Min 8 characters.";
      if (password.new !== password.confirm) e.passwordConfirm = "Passwords do not match.";
    }
    setErrors(e);
    return Object.keys(e).length === 0;
  }

  async function onSubmit() {
    if (!validate()) return;

    setSaving(true);
    // TODO: call your API / Supabase
    await new Promise((r) => setTimeout(r, 700));
    setSaving(false);
    setSavedAt(new Date().toLocaleString());
    setPassword({ new: "", confirm: "" });
  }

  function onReset() {
    setProfile((p) => ({
      ...p,
      firstName: "",
      lastName: "",
      email: "",
      department: "",
      campus: "",
      phone: "",
      // keep avatar & notification prefs
    }));
    setPassword({ new: "", confirm: "" });
    setErrors({});
  }

  function onChangePassword(patch: Partial<PasswordState>) {
    setPassword((prev) => ({ ...prev, ...patch }));
  }

  function onAvatarChange(file?: File) {
    if (!file) return;
    // Preview locally (data URL). Replace this with upload to storage/CDN later.
    const reader = new FileReader();
    reader.onload = () => update("avatar", String(reader.result));
    reader.readAsDataURL(file);
  }

  // (Optional) computed initials etc. can stay in the view

  return (
    <ProfileView
      profile={profile}
      password={password}
      saving={saving}
      savedAt={savedAt}
      errors={errors}
      onChangeProfile={update}
      onChangePassword={onChangePassword}
      onAvatarChange={onAvatarChange}
      onSubmit={onSubmit}
      onReset={onReset}
    />
  );
}


===== app\(protected)\faculty\request\page.tsx =====
// src/app/(protected)/faculty/request/page.tsx
"use client";

import { useState } from "react";
import Link from "next/link";
import { PageHeader, PageBody } from "@/components/common/Page";
import { createTripRequest } from "@/lib/api";
import FacultyRequestForm, { RequestForm } from "@/components/faculty/request/Form";
import RequestSummary from "@/components/faculty/request/Summary";

// simple validator – stays here so design files remain dumb
function validate(form: RequestForm) {
  const e: Partial<Record<keyof RequestForm, string>> = {};
  if (!form.purpose.trim()) e.purpose = "Purpose is required.";
  if (!form.origin.trim()) e.origin = "Origin is required.";
  if (!form.destination.trim()) e.destination = "Destination is required.";
  if (!form.schedule.trim()) e.schedule = "Schedule is required.";
  if (form.passengers !== "" && Number(form.passengers) < 1)
    e.passengers = "At least one passenger is required.";
  return e;
}

export default function FacultyRequestPage() {
  const [form, setForm] = useState<RequestForm>({
    purpose: "",
    origin: "",
    destination: "",
    schedule: "",
    passengers: "",
    notes: "",
  });
  const [errors, setErrors] = useState<Partial<Record<keyof RequestForm, string>>>({});
  const [submitting, setSubmitting] = useState(false);
  const [submittedId, setSubmittedId] = useState<string | null>(null);

  const update = <K extends keyof RequestForm>(key: K, value: RequestForm[K]) =>
    setForm((f) => ({ ...f, [key]: value }));

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    const v = validate(form);
    setErrors(v);
    if (Object.keys(v).length) return;

    setSubmitting(true);
    try {
      // 👉 UI → DB mapping (matches your table columns)
      const payload = {
        purpose: form.purpose,
        origin: form.origin,
        destination: form.destination,
        schedule: form.schedule, // single datetime
        // keep these if your table has them (it does per latest schema)
        start_time: form.schedule || null, // optional mirror
        passengers: form.passengers === "" ? null : Number(form.passengers),
        notes: form.notes || null,
        status: "pending" as const,
      };

      const { id } = await createTripRequest(payload);
      setSubmittedId(id);

      // keep context, clear some fields
      setForm((f) => ({ ...f, purpose: "", notes: "", passengers: "" }));
      setErrors({});
    } catch (err: any) {
      setErrors((prev) => ({ ...prev, purpose: err?.message ?? "Submit failed." }));
    } finally {
      setSubmitting(false);
    }
  };

  const onReset = () => {
    setForm({
      purpose: "",
      origin: "",
      destination: "",
      schedule: "",
      passengers: "",
      notes: "",
    });
    setErrors({});
    setSubmittedId(null);
  };

  return (
    <>
      <PageHeader
        title="New Transport Request"
        description="Fill out the details below to request a vehicle. (Vehicle assignment handled by Admin.)"
        actions={
          <Link href="/faculty" className="rounded-md border px-3 py-2 text-sm hover:bg-neutral-50">
            Back to Dashboard
          </Link>
        }
      />

      <PageBody>
        <div className="grid grid-cols-1 lg:grid-cols-[1fr_360px] gap-4">
          <FacultyRequestForm
            form={form}
            errors={errors}
            submitting={submitting}
            onChange={update}
            onSubmit={onSubmit}
            onReset={onReset}
          />

          <aside className="space-y-4">
            <RequestSummary form={form} />
            <section className="rounded-lg border bg-white p-4">
              <h3 className="font-medium mb-2">Heads-up</h3>
              <ul className="list-disc pl-5 text-sm text-neutral-700 space-y-1">
                <li>Requests are subject to dispatcher approval.</li>
                <li>Vehicle will be assigned by Admin based on availability.</li>
                <li>Editing is allowed while status is <span className="font-medium">Pending</span>.</li>
              </ul>
              {submittedId && (
                <p className="mt-3 text-sm text-green-700">
                  Request <span className="font-semibold">{submittedId}</span> submitted!
                </p>
              )}
            </section>
          </aside>
        </div>
      </PageBody>
    </>
  );
}


===== app\(protected)\faculty\schedule\page.tsx =====
"use client";

import { useMemo, useState } from "react";
import ScheduleView, { type Filters } from "@/components/faculty/schedule/ScheduleView";
import type { Trip, Vehicle, Status } from "@/components/faculty/schedule/types";

// TEMP demo data; replace with Supabase fetch later
const TRIPS: Trip[] = [
  { id: "SCH-1001", start: "2025-12-25T08:00", end: "2025-12-25T12:00", vehicle: "Bus", destination: "Tagaytay",        status: "Approved" },
  { id: "SCH-1002", start: "2025-12-28T09:30", end: "2025-12-28T13:30", vehicle: "Van", destination: "MSEUF Lucena",    status: "Pending"  },
  { id: "SCH-1003", start: "2026-01-10T06:15", end: "2026-01-10T10:00", vehicle: "Bus", destination: "Batangas",        status: "Assigned" },
  { id: "SCH-0994", start: "2025-11-29T07:30", end: "2025-11-29T11:00", vehicle: "Car", destination: "San Pablo",       status: "Completed"},
  { id: "SCH-0990", start: "2025-11-15T14:00", end: "2025-11-15T16:30", vehicle: "Van", destination: "City Hall",       status: "Rejected" },
];

export default function FacultySchedulePage() {
  const [tab, setTab] = useState<"upcoming" | "history">("upcoming");
  const [filters, setFilters] = useState<Filters>({
    q: "",
    veh: "",
    stat: "",
    from: "",
    to: "",
  });

  const now = new Date();

  const trips = useMemo(() => {
    return TRIPS.filter((t) => {
      const isUpcoming = new Date(t.start) >= now;
      if (tab === "upcoming" && !isUpcoming) return false;
      if (tab === "history" && isUpcoming) return false;

      const hay = `${t.id} ${t.destination} ${t.vehicle} ${t.status}`.toLowerCase();
      if (filters.q && !hay.includes(filters.q.toLowerCase())) return false;

      if (filters.veh && t.vehicle !== (filters.veh as Vehicle)) return false;
      if (filters.stat && t.status !== (filters.stat as Status)) return false;

      if (filters.from && new Date(t.start) < new Date(filters.from)) return false;
      if (filters.to && new Date(t.start) > new Date(filters.to + "T23:59:59")) return false;

      return true;
    }).sort((a, b) => +new Date(a.start) - +new Date(b.start));
  }, [tab, filters, now]);

  const onExportCsv = () => {
    const rows = [
      ["ID", "Start", "End", "Vehicle", "Destination", "Status"],
      ...trips.map((t) => [t.id, t.start, t.end, t.vehicle, t.destination, t.status]),
    ];
    const csv = rows.map((r) => r.map((x) => `"${String(x).replace(/"/g, '""')}"`).join(",")).join("\n");
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `faculty-schedule-${tab}.csv`;
    a.click();
    URL.revokeObjectURL(url);
  };

  return (
    <ScheduleView
      tab={tab}
      onTabChange={setTab}
      filters={filters}
      onFiltersChange={(patch: Partial<Filters>) => setFilters((f) => ({ ...f, ...patch }))}
      onResetFilters={() => setFilters({ q: "", veh: "", stat: "", from: "", to: "" })}
      onExportCsv={onExportCsv}
      trips={trips}
    />
  );
}


===== app\(public)\contact\page.tsx =====
export const metadata = { title: "Contact • TraviLink" };

export default function ContactPage() {
  return (
    <main className="mx-auto max-w-3xl px-6 py-10 prose prose-sm">
      <h1>Contact</h1>
      <p>Email us at <a href="mailto:ictd@mseuf.edu.ph">ictd@mseuf.edu.ph</a>.</p>
      {/* Optional: add campus address or a simple form later */}
    </main>
  );
}


===== app\(public)\privacy\page.tsx =====
import Image from "next/image";

export const metadata = { title: "Privacy • TraviLink" };

export default function PrivacyPage() {
  return (
    <main className="mx-auto max-w-3xl px-6 py-10">
      <h1 className="text-2xl font-bold text-red-900">Privacy Policy</h1>
      <p className="mt-2 text-sm text-neutral-700">
        How we collect, use, and protect your data (RA 10173 compliant)…
      </p>

      {/* Centered placeholder image (not full screen) */}
      <div className="mt-6 flex justify-center">
        <div className="w-full max-w-xl rounded-xl overflow-hidden shadow-md border">
          <Image
            src="/monkey-1.jpg"     // ← put this in /public
            alt="Privacy"
            width={1200}                 // intrinsic size (keeps quality)
            height={675}                 // ~16:9
            className="w-full h-auto object-cover"
            priority
          />
        </div>
      </div>

      {/* Body */}
      <section className="prose prose-sm mt-8">
        <h2>Introduction</h2>
        <p>/* TODO: fill in real policy content */</p>
      </section>
    </main>
  );
}


===== app\(public)\terms\page.tsx =====
export const metadata = { title: "Terms • TraviLink" };

export default function TermsPage() {
  return (
    <main className="mx-auto max-w-3xl px-6 py-10 prose prose-sm">
      <h1>Terms of Use</h1>
      <p>Guidelines for using the reservation portal…</p>
    </main>
  );
}


===== app\api\auth\bootstrap\route.ts =====
import { NextResponse } from "next/server";
import { headers, cookies } from "next/headers";
import { createClient } from "@supabase/supabase-js";

const URL = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

/**
 * Generic bootstrap
 * - Works for admin/driver/faculty
 * - Creates public.users row if missing
 * - Patches missing fields from auth.user_metadata (name, department, birthdate, address)
 * - Returns role and sets a short-lived tl_role cookie
 */
export async function POST() {
  try {
    const h = await headers();
    const auth = h.get("authorization");
    const token = auth?.startsWith("Bearer ") ? auth.slice(7) : undefined;
    if (!token) {
      return NextResponse.json({ error: "missing token" }, { status: 401 });
    }

    const supabase = createClient(URL, KEY, {
      auth: { persistSession: false },
      global: { headers: { Authorization: `Bearer ${token}` } },
    });

    // who is this?
    const { data: who, error: uErr } = await supabase.auth.getUser();
    if (uErr || !who?.user) {
      return NextResponse.json(
        { error: uErr?.message ?? "unauthenticated" },
        { status: 401 }
      );
    }

    const authUser = who.user;
    const uid = authUser.id;
    const email = authUser.email ?? undefined;
    const meta = (authUser.user_metadata ?? {}) as {
      role?: string;
      name?: string;
      department?: string | null;
      birthdate?: string | null; // yyyy-mm-dd expected
      address?: string | null;
      phone?: string | null;
    };

    // 1) See if a profile already exists for this auth user
    const { data: existing, error: selErr } = await supabase
      .from("users")
      .select("id, role, name, email, department, birthdate, address, phone")
      .eq("auth_user_id", uid)
      .maybeSingle();
    if (selErr) {
      return NextResponse.json({ error: selErr.message }, { status: 500 });
    }

    // Role precedence:
    //   existing.role (if exists) >
    //   metadata.role (if valid) >
    //   default "faculty"
    const validRoles = new Set(["admin", "driver", "faculty", "staff"]);
    const roleFromMeta =
      meta.role && validRoles.has(meta.role) ? (meta.role as "admin" | "driver" | "faculty" | "staff") : undefined;
    const roleFinal: "admin" | "driver" | "faculty" | "staff" =
      (existing?.role as any) ?? roleFromMeta ?? "faculty";

    if (!existing) {
      // 2) Create-if-missing (RLS insert_self should allow this with the user's JWT)
      const { error: insErr } = await supabase.from("users").upsert(
        {
          auth_user_id: uid,
          email: email ?? null,
          role: roleFinal,
          status: "active",
          name: meta.name ?? "",
          department: meta.department ?? null,
          birthdate: meta.birthdate ?? null, // NEW
          address: meta.address ?? null,     // NEW
          phone: meta.phone ?? null,
        },
        { onConflict: "auth_user_id" }
      );
      if (insErr) {
        return NextResponse.json({ error: insErr.message }, { status: 500 });
      }
    } else {
      // 3) Patch only missing/empty fields from metadata (idempotent & safe)
      const patch: Record<string, any> = {};
      if (!existing.email && email) patch.email = email;
      if (!existing.name && meta.name) patch.name = meta.name;
      if (!existing.department && meta.department) patch.department = meta.department;
      if (!existing.birthdate && meta.birthdate) patch.birthdate = meta.birthdate;
      if (!existing.address && meta.address) patch.address = meta.address;
      if (!existing.phone && meta.phone) patch.phone = meta.phone;

      // allow role change only if there is none yet AND metadata provided a valid one
      if (!existing.role && roleFromMeta) patch.role = roleFromMeta;

      if (Object.keys(patch).length > 0) {
        const { error: updErr } = await supabase
          .from("users")
          .update(patch)
          .eq("auth_user_id", uid);
        if (updErr) {
          return NextResponse.json({ error: updErr.message }, { status: 500 });
        }
      }
    }

    // short-lived role cookie (5 minutes) to speed up subsequent redirects
    const c = await cookies();
    c.set({
      name: "tl_role",
      value: roleFinal,
      httpOnly: false,
      sameSite: "lax",
      maxAge: 60 * 5,
      path: "/",
    });

    return NextResponse.json({ role: roleFinal });
  } catch (e: any) {
    return NextResponse.json(
      { error: e?.message ?? "bootstrap failed" },
      { status: 500 }
    );
    }
}


===== app\api\auth\callback\route.ts =====


===== app\api\auth\logout\route.ts =====
// src/app/api/logout/route.ts
import { NextResponse } from "next/server";
import { createServerClient } from "@supabase/ssr";
import { cookies } from "next/headers";

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export async function POST() {
  const cookieStore = cookies();
  const res = NextResponse.json({ ok: true });

  // This is the official adapter: get/set/remove
  const supabase = createServerClient(supabaseUrl, supabaseAnon, {
    cookies: {
      get(name: string) {
        return cookieStore.get(name)?.value;
      },
      set(name: string, value: string, options: any) {
        res.cookies.set({ name, value, ...options });
      },
      remove(name: string, options: any) {
        res.cookies.set({ name, value: "", ...options, maxAge: 0 });
      },
    },
  });

  await supabase.auth.signOut();

  return res;
}


===== app\api\auth\role\route.ts =====
// src/app/api/auth/role/route.ts
import { NextResponse } from "next/server";
import { headers } from "next/headers";
import { createClient } from "@supabase/supabase-js";

const URL = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export async function GET() {
  try {
    // ✅ await headers()
    const h = await headers();
    const auth = h.get("authorization");
    const token = auth?.startsWith("Bearer ") ? auth.slice(7) : undefined;
    if (!token) return NextResponse.json({ error: "missing token" }, { status: 401 });

    const supabase = createClient(URL, KEY, {
      auth: { persistSession: false },
      global: { headers: { Authorization: `Bearer ${token}` } },
    });

    const { data: userData, error: uErr } = await supabase.auth.getUser();
    if (uErr || !userData.user) {
      return NextResponse.json({ error: uErr?.message ?? "unauthenticated" }, { status: 401 });
    }

    const { data, error } = await supabase
      .from("users")
      .select("role")
      .eq("auth_user_id", userData.user.id)
      .maybeSingle();
    if (error) return NextResponse.json({ error: error.message }, { status: 500 });

    return NextResponse.json({ role: (data?.role ?? "faculty") as "admin"|"driver"|"faculty" });
  } catch (err: any) {
    console.error("GET /api/auth/role failed:", err);
    return NextResponse.json({ error: String(err?.message ?? err) }, { status: 500 });
  }
}


===== app\api\dev\driver\register\route.ts =====
-- ===============================
-- Users: structured name fields
-- ===============================

CREATE EXTENSION IF NOT EXISTS pg_trgm;

-- 1) Helper IMMUTABLE formatters (used by generated columns & triggers)
CREATE OR REPLACE FUNCTION public._name_full(p_first text, p_middle text, p_last text, p_suffix text)
RETURNS text
LANGUAGE sql IMMUTABLE AS $$
  SELECT btrim(concat_ws(' ',
    NULLIF(p_first,''),
    NULLIF(p_middle,''),
    NULLIF(p_last,''),
    NULLIF(p_suffix,'')
  ))
$$;

CREATE OR REPLACE FUNCTION public._name_last_first(p_first text, p_middle text, p_last text, p_suffix text)
RETURNS text
LANGUAGE sql IMMUTABLE AS $$
  SELECT btrim(
    concat_ws(', ',
      NULLIF(p_last,''),
      btrim(concat_ws(' ', NULLIF(p_first,''), NULLIF(p_middle,'')))
    )
    || CASE WHEN NULLIF(p_suffix,'') IS NOT NULL THEN ' '||p_suffix ELSE '' END
  )
$$;

-- 2) Columns
ALTER TABLE public.users
  ADD COLUMN IF NOT EXISTS first_name     text,
  ADD COLUMN IF NOT EXISTS middle_name    text,
  ADD COLUMN IF NOT EXISTS last_name      text,
  ADD COLUMN IF NOT EXISTS suffix         text,
  ADD COLUMN IF NOT EXISTS preferred_name text;

-- 3) Generated display columns
ALTER TABLE public.users
  ADD COLUMN IF NOT EXISTS name_full text
    GENERATED ALWAYS AS (public._name_full(first_name, middle_name, last_name, suffix)) STORED;

ALTER TABLE public.users
  ADD COLUMN IF NOT EXISTS name_last_first text
    GENERATED ALWAYS AS (public._name_last_first(first_name, middle_name, last_name, suffix)) STORED;

-- 4) Best-effort parser for legacy full names
CREATE OR REPLACE FUNCTION public.split_name(fullname text,
  OUT first_name text, OUT middle_name text, OUT last_name text, OUT suffix text)
LANGUAGE plpgsql IMMUTABLE AS $$
DECLARE
  s text := btrim(coalesce(fullname,''));
  tokens text[];
  n int;
  rest text;
  maybe_suffix text;
BEGIN
  IF s = '' THEN
    first_name := NULL; middle_name := NULL; last_name := NULL; suffix := NULL;
    RETURN;
  END IF;

  -- If it looks like "Last, First [Middle] [Suffix]"
  IF position(',' IN s) > 0 THEN
    last_name := btrim(split_part(s, ',', 1));
    rest := btrim(split_part(s, ',', 2));
    tokens := regexp_split_to_array(rest, '\s+');
    n := array_length(tokens,1);

    IF n >= 1 THEN first_name := tokens[1]; END IF;
    IF n >= 3 THEN
      -- check last token for suffix
      maybe_suffix := tokens[n];
      IF lower(maybe_suffix) IN ('jr','sr','ii','iii','iv','v','phd','md') THEN
        suffix := maybe_suffix;
        last_name := coalesce(last_name, btrim(split_part(s, ',', 1)));
        IF n >= 2 THEN middle_name := array_to_string(tokens[2:n-1],' '); END IF;
      ELSE
        middle_name := array_to_string(tokens[2:n],' ');
      END IF;
    ELSIF n = 2 THEN
      middle_name := tokens[2];
    END IF;

    RETURN;
  END IF;

  -- Otherwise: "First [Middle ...] Last [Suffix?]"
  tokens := regexp_split_to_array(s, '\s+');
  n := array_length(tokens,1);

  IF n = 1 THEN
    first_name := tokens[1]; RETURN;
  ELSIF n = 2 THEN
    first_name := tokens[1]; last_name := tokens[2]; RETURN;
  ELSE
    -- Suffix check on last token
    maybe_suffix := tokens[n];
    IF lower(maybe_suffix) IN ('jr','sr','ii','iii','iv','v','phd','md') THEN
      suffix := maybe_suffix;
      last_name := tokens[n-1];
      first_name := tokens[1];
      IF n > 3 THEN middle_name := array_to_string(tokens[2:n-2],' '); END IF;
    ELSE
      suffix := NULL;
      last_name := tokens[n];
      first_name := tokens[1];
      IF n > 2 THEN middle_name := array_to_string(tokens[2:n-1],' '); END IF;
    END IF;
    RETURN;
  END IF;
END $$;

-- 5) Trigger to keep 'name' (legacy) in sync with parts
CREATE OR REPLACE FUNCTION public.users_names_sync()
RETURNS trigger LANGUAGE plpgsql AS $$
DECLARE
  f text; m text; l text; sfx text;
BEGIN
  -- If 'name' was set/changed and parts are blank, parse into parts
  IF TG_OP IN ('INSERT','UPDATE') AND (NEW.name IS NOT NULL) AND
     (coalesce(NEW.first_name,'') = '' AND coalesce(NEW.last_name,'') = '') THEN
    SELECT * INTO f,m,l,sfx FROM public.split_name(NEW.name);
    NEW.first_name  := coalesce(NULLIF(NEW.first_name,''),  f);
    NEW.middle_name := coalesce(NULLIF(NEW.middle_name,''), m);
    NEW.last_name   := coalesce(NULLIF(NEW.last_name,''),   l);
    NEW.suffix      := coalesce(NULLIF(NEW.suffix,''),      sfx);
  END IF;

  -- Always normalize legacy 'name' from parts
  NEW.name := public._name_full(NEW.first_name, NEW.middle_name, NEW.last_name, NEW.suffix);

  RETURN NEW;
END $$;

DROP TRIGGER IF EXISTS trg_users_names_sync ON public.users;
CREATE TRIGGER trg_users_names_sync
BEFORE INSERT OR UPDATE OF name, first_name, middle_name, last_name, suffix ON public.users
FOR EACH ROW EXECUTE FUNCTION public.users_names_sync();

-- 6) Backfill from existing 'name' (only fills blanks)
UPDATE public.users u
SET first_name  = COALESCE(u.first_name,  (public.split_name(u.name)).first_name),
    middle_name = COALESCE(u.middle_name, (public.split_name(u.name)).middle_name),
    last_name   = COALESCE(u.last_name,   (public.split_name(u.name)).last_name),
    suffix      = COALESCE(u.suffix,      (public.split_name(u.name)).suffix)
WHERE u.name IS NOT NULL
  AND (u.first_name IS NULL OR u.last_name IS NULL);

-- 7) Indexes for quick lookup (and fuzzy search if desired)
CREATE INDEX IF NOT EXISTS users_last_first_idx
  ON public.users (lower(last_name), lower(first_name));

CREATE INDEX IF NOT EXISTS users_last_trgm_idx
  ON public.users USING gin (last_name gin_trgm_ops);

CREATE INDEX IF NOT EXISTS users_first_trgm_idx
  ON public.users USING gin (first_name gin_trgm_ops);

-- 8) Helper: find by \"Last, First [Middle?]\" (case-insensitive; middle can be initial)
CREATE OR REPLACE FUNCTION public.find_users_by_lfm(last_name text, first_name text, middle text DEFAULT NULL)
RETURNS TABLE(id uuid, email text, name_last_first text, name_full text)
LANGUAGE sql STABLE AS $$
  SELECT u.id, u.email, u.name_last_first, u.name_full
  FROM public.users u
  WHERE lower(u.last_name)  = lower(coalesce(last_name,''))
    AND lower(u.first_name) = lower(coalesce(first_name,''))
    AND (
      middle IS NULL
      OR left(lower(coalesce(u.middle_name,'')), 1) = left(lower(middle), 1)
    )
  ORDER BY u.last_name, u.first_name, coalesce(u.middle_name,'')
$$;

-- 9) Update me view to expose new fields
CREATE OR REPLACE VIEW public.me AS
SELECT
  u.id,
  u.name,              -- legacy full name (kept in sync)
  u.name_full,
  u.name_last_first,
  u.first_name,
  u.middle_name,
  u.last_name,
  u.suffix,
  u.preferred_name,
  u.email,
  u.role::text AS role,
  u.department,
  u.department_id,
  u.status,
  u.created_at,
  u.auth_user_id,
  u.phone,
  u.birthdate,
  u.address
FROM public.users u
WHERE u.auth_user_id = auth.uid();


===== app\api\feedback\route.ts =====
import { NextResponse } from "next/server";
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY! // server-side key
);

export async function POST(req: Request) {
  try {
    const body = await req.json();
    // Expecting: { category, rating, subject, message, anonymous, contact, attachmentUrl }
    const { data, error } = await supabase
      .from("feedback")
      .insert({
        category: body.category,
        rating: body.rating,
        subject: body.subject || null,
        message: body.message,
        anonymous: body.anonymous,
        contact: body.contact || null,
        attachment_url: body.attachmentUrl || null,
      })
      .select("id")
      .single();

    if (error) throw error;
    return NextResponse.json({ id: data.id }, { status: 201 });
  } catch (e: any) {
    return NextResponse.json({ error: e.message ?? "Failed" }, { status: 400 });
  }
}


===== app\api\maintenance\route.ts =====


===== app\api\me\route.ts =====
// src/app/api/me/route.ts
import { NextResponse } from "next/server";
import { createServerClient } from "@supabase/ssr";
import { cookies, headers } from "next/headers";

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export async function GET() {
  const cookieStore = cookies();
  const headerList = headers();

  const supabase = createServerClient(supabaseUrl, supabaseAnon, {
    cookies: {
      get: (key: string) => cookieStore.get(key)?.value,
    },
    headers: {
      get: (key: string) => headerList.get(key) ?? undefined,
    },
  });

  // 1. get auth user
  const {
    data: { user },
    error: authError,
  } = await supabase.auth.getUser();

  if (authError || !user) {
    return NextResponse.json(
      { ok: false, error: "Not authenticated" },
      { status: 401 }
    );
  }

  // 2. fetch profile row from public.users
  const { data: profile, error: profileError } = await supabase
    .from("users")
    .select("*")
    .eq("auth_user_id", user.id)
    .single();

  if (profileError) {
    return NextResponse.json(
      { ok: false, error: "Profile not found", auth: user },
      { status: 404 }
    );
  }

  return NextResponse.json({
    ok: true,
    auth: {
      id: user.id,
      email: user.email,
      created_at: user.created_at,
      last_sign_in_at: user.last_sign_in_at,
    },
    profile,
  });
}


===== app\api\register\route.ts =====
// src/app/api/register/route.ts
import { NextResponse } from "next/server";
import { createServerClient } from "@supabase/ssr";
import { cookies } from "next/headers";

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseAnon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export async function POST(req: Request) {
  const body = await req.json();
  const { name, email, password, role = "faculty", department = null } = body;

  const cookieStore = cookies();
  const res = NextResponse.json({ ok: true });

  const supabase = createServerClient(supabaseUrl, supabaseAnon, {
    cookies: {
      get: (key: string) => cookieStore.get(key)?.value,
      set: (key: string, value: string, options: any) =>
        res.cookies.set({ name: key, value, ...options }),
      remove: (key: string, options: any) =>
        res.cookies.set({ name: key, value: "", ...options, maxAge: 0 }),
    },
  });

  // 1. Create auth account
  const { data, error } = await supabase.auth.signUp({
    email,
    password,
    options: {
      data: { full_name: name }, // optional metadata
    },
  });

  if (error) {
    return NextResponse.json({ ok: false, error: error.message }, { status: 400 });
  }

  const authUser = data.user;
  if (!authUser) {
    return NextResponse.json({ ok: false, error: "Auth user not created" }, { status: 400 });
  }

  // 2. Insert profile in public.users
  const { error: insertError } = await supabase.from("users").insert({
    name,
    email,
    role,
    department,
    status: "active",
    auth_user_id: authUser.id,
  });

  if (insertError) {
    return NextResponse.json({ ok: false, error: insertError.message }, { status: 500 });
  }

  return res;
}


===== app\api\trip_requests\route.ts =====
// src/app/api/faculty/requests/route.ts
import { NextResponse } from "next/server";
import { z } from "zod";
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE!,          // server-only secret
  { auth: { persistSession: false } }
);

// Minimal validation (accepts either schedule OR start/end)
const RequestSchema = z.object({
  user_id: z.string().uuid(),
  purpose: z.string().min(1, "Purpose is required."),
  pickup: z.string().min(1, "Pickup is required."),         // UI field
  destination: z.string().min(1, "Destination is required."),
  schedule: z.string().datetime().optional(),               // if using single datetime
  start: z.string().datetime().optional(),                  // if using start/end fields
  end: z.string().datetime().optional(),
  passengers: z.union([z.number().int().min(1), z.null(), z.literal("")]).optional(),
  notes: z.string().optional().or(z.null()).or(z.literal("")),
});

export async function POST(req: Request) {
  try {
    const body = await req.json();
    const parsed = RequestSchema.parse(body);

    // map UI → DB
    const origin = parsed.pickup;
    const passengers =
      parsed.passengers === "" ? null : parsed.passengers ?? null;

    // choose which time columns to write
    const useStartEnd = !!(parsed.start && parsed.end);
    const start_time = useStartEnd ? parsed.start! : parsed.schedule ?? null;
    const end_time   = useStartEnd ? parsed.end!   : null;

    // also keep old 'schedule' for backward-compat (optional)
    const schedule = parsed.schedule ?? parsed.start ?? null;

    const { data, error } = await supabase
      .from("trip_requests")
      .insert({
        user_id: parsed.user_id,
        purpose: parsed.purpose,
        origin,
        destination: parsed.destination,
        schedule,                   // keep if column exists
        start_time,
        end_time,
        passengers,
        notes: parsed.notes ?? null,
        status: "pending",
      })
      .select("id")
      .single();

    if (error) throw error;
    return NextResponse.json({ ok: true, id: data.id }, { status: 201 });
  } catch (err: any) {
    if (err instanceof z.ZodError) {
      return NextResponse.json(
        { ok: false, error: err.issues[0]?.message ?? "Invalid payload" },
        { status: 400 }
      );
    }
    return NextResponse.json(
      { ok: false, error: err?.message ?? "Server error" },
      { status: 500 }
    );
  }
}


===== app\api\trip_requests\[id]\route.ts =====


===== app\api\trips\route.ts =====


===== app\api\trips\[id]\route.ts =====


===== app\api\trips\users\routes.ts =====


===== app\api\users\route.ts =====
// src/app/api/users/route.ts
import { NextResponse } from "next/server";
import { headers } from "next/headers";
import { createClient } from "@supabase/supabase-js";

const URL = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export async function POST() {
  try {
    // ✅ await headers()
    const h = await headers();
    const auth = h.get("authorization");
    const token = auth?.startsWith("Bearer ") ? auth.slice(7) : undefined;
    if (!token) return NextResponse.json({ error: "missing token" }, { status: 401 });

    const supabase = createClient(URL, KEY, {
      auth: { persistSession: false },
      global: { headers: { Authorization: `Bearer ${token}` } },
    });

    const { data: userData, error: uErr } = await supabase.auth.getUser();
    if (uErr || !userData.user) {
      return NextResponse.json({ error: uErr?.message ?? "unauthenticated" }, { status: 401 });
    }

    const uid = userData.user.id;
    const email = userData.user.email;

    const { data: existing, error: e1 } = await supabase
      .from("users")
      .select("id, email, role, status, auth_user_id")
      .eq("auth_user_id", uid)
      .maybeSingle();
    if (e1) return NextResponse.json({ error: e1.message }, { status: 500 });
    if (existing) return NextResponse.json(existing);

    const { data: inserted, error: e2 } = await supabase
      .from("users")
      .insert({ auth_user_id: uid, email, status: "active", role: "faculty" })
      .select()
      .single();
    if (e2) return NextResponse.json({ error: e2.message }, { status: 500 });

    return NextResponse.json(inserted);
  } catch (err: any) {
    console.error("POST /api/users failed:", err);
    return NextResponse.json({ error: String(err?.message ?? err) }, { status: 500 });
  }
}


===== app\api\vehicles\route.ts =====


===== app\login\LoginView.tsx =====
"use client";

import Link from "next/link";
import * as React from "react";

type Props = {
  email: string;
  password: string;
  setEmail: (v: string) => void;
  setPassword: (v: string) => void;
  loading: boolean;
  err: string | null;
  onSubmit: (e: React.FormEvent) => void;
};

export default function LoginView({
  email,
  password,
  setEmail,
  setPassword,
  loading,
  err,
  onSubmit,
}: Props) {
  const [showPw, setShowPw] = React.useState(false);
  const [remember, setRemember] = React.useState(false);

  return (
    <div className="fixed inset-0 font-sans h-dvh overflow-hidden">
      {/* page background */}
      <div className="absolute inset-0 -z-10">
        <img
          src="/pattern-light.jpg"
          alt="Campus background"
          className="w-full h-full object-cover"
        />
        <div className="absolute inset-0 bg-black/30" />
      </div>

      {/* container */}
      <div className="relative z-10 h-full w-full flex items-center justify-center p-4 sm:p-8">
        <form
  onSubmit={onSubmit}
  className="w-full max-w-6xl grid grid-cols-1 md:grid-cols-2 rounded-3xl shadow-2xl bg-white overflow-hidden"
>
  {/* LEFT: image panel */}
  <div className="relative hidden md:block overflow-hidden rounded-l-3xl group">
    <img
      src="/pattern-light.jpg"
      alt="Campus"
      className="absolute inset-0 h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
    />
    <div className="absolute inset-0 bg-[#7A0010]/70" />

    {/* logo */}
    <div className="absolute right-6 top-6">
      <img
        src="/euwhite.png"
        alt="EU Logo"
        className="h-10 w-10 object-contain drop-shadow-lg"
      />
    </div>

    {/* overlay text */}
    <div className="absolute bottom-0 left-0 right-0 p-10 text-white">
      <p className="text-sm uppercase tracking-[0.18em] font-semibold opacity-90">
        Welcome to
      </p>
      <h1 className="mt-2 text-4xl sm:text-5xl leading-tight font-extrabold">
        TraviLink
      </h1>
      <p className="mt-3 text-base text-white/90">
        Smart Campus Transport System for Everyone
      </p>
    </div>
  </div>
  

          {/* RIGHT: form panel */}
          <div className="relative bg-white rounded-3xl shadow-2xl p-7 sm:p-10">
            <h2 className="text-2xl sm:text-[28px] font-extrabold tracking-tight text-[#7A0010] mb-6">
              SIGN IN NOW
            </h2>

            {/* Email */}
            <div className="mb-5">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Email
              </label>
              <div className="relative group">
                <span className="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-gray-600">
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2 6a2 2 0 012-2h16a2 2 0 012 2v1l-10 6L2 7V6zm0 4.236l9.445 5.667a1 1 0 001.11 0L22 10.236V18a2 2 0 01-2 2H4a2 2 0 01-2-2v-7.764z" />
                  </svg>
                </span>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  placeholder="you@mseuf.edu.ph"
                  required
                  className="h-12 w-full rounded-md border border-gray-300 pl-10 pr-3 text-gray-900 placeholder-gray-400 shadow-sm outline-none focus:border-[#7A0010] focus:ring-2 focus:ring-[#7A0010]/20"
                />
              </div>
            </div>

            {/* Password */}
            <div className="mb-2">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Password
              </label>
              <div className="relative group">
                <span className="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-gray-600">
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 1a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V6a5 5 0 00-5-5zm-3 8V6a3 3 0 016 0v3H9z" />
                  </svg>
                </span>
                <input
                  type={showPw ? "text" : "password"}
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="••••••••"
                  required
                  className="h-12 w-full rounded-md border border-gray-300 pl-10 pr-10 text-gray-900 placeholder-gray-400 shadow-sm outline-none focus:border-[#7A0010] focus:ring-2 focus:ring-[#7A0010]/20"
                />
                <button
                  type="button"
                  onClick={() => setShowPw((v) => !v)}
                  aria-label={showPw ? "Hide password" : "Show password"}
                  className="absolute right-2 top-1/2 -translate-y-1/2 rounded px-2 py-1 text-gray-500 hover:bg-gray-100"
                >
                  {showPw ? (
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7zm0 12a5 5 0 110-10 5 5 0 010 10z" />
                    </svg>
                  ) : (
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M3.707 2.293L2.293 3.707l3.22 3.22C3.66 8.17 2 12 2 12s3 7 10 7c2.107 0 3.9-.54 5.383-1.37l2.91 2.91 1.414-1.414-18-18zM12 17c-2.761 0-5-2.239-5-5 0-.6.109-1.174.304-1.705l6.401 6.401A4.96 4.96 0 0112 17zm7.696-2.295A12.61 12.61 0 0022 12s-3-7-10-7c-1.297 0-2.493.198-3.59.53l1.7 1.7c.61-.13 1.255-.2 1.89-.2 2.761 0 5 2.239 5 5 0 .635-.07 1.28-.2 1.89l1.896 1.896z" />
                    </svg>
                  )}
                </button>
              </div>
            </div>

            {/* remember / forgot */}
            <div className="mb-6 flex items-center justify-between">
              <label className="flex items-center gap-2 text-sm text-gray-700 select-none">
                <input
                  type="checkbox"
                  className="accent-[#7A0010]"
                  checked={remember}
                  onChange={(e) => setRemember(e.target.checked)}
                />
                Remember me
              </label>
              <Link href="/forgot" className="text-sm text-[#7A0010] hover:underline">
                Forgot Password?
              </Link>
            </div>

            {err && <p className="mb-4 text-sm text-red-600">{err}</p>}

            <button
              type="submit"
              disabled={loading}
              className="h-12 w-full rounded-md bg-[#7A0010] text-white font-semibold shadow-md transition hover:bg-[#69000d] disabled:opacity-60"
            >
              {loading ? "Signing in..." : "Login"}
            </button>

            <p className="mt-6 text-sm text-gray-700">
              Don’t have an account?{" "}
              <Link href="/register" className="font-semibold text-[#7A0010] hover:underline">
                Register
              </Link>
            </p>
          </div>
        </form>
      </div>
    </div>
  );
}


===== app\login\page.tsx =====
"use client";

import { useState } from "react";
import { useRouter, useSearchParams } from "next/navigation";
import { supabase } from "@/lib/supabaseClient";
import LoginView from "./LoginView";

export default function LoginPage() {
  const router = useRouter();
  const next = useSearchParams().get("next");

  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [err, setErr] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  async function handleLogin(e: React.FormEvent) {
    e.preventDefault();
    setErr(null);
    setLoading(true);

    // 1) Sign in with Supabase
   const { data: signIn, error } = await supabase.auth.signInWithPassword({ email, password });
if (error) { setErr(error.message); setLoading(false); return; }

const { data: s } = await supabase.auth.getSession();
const token = s.session?.access_token;

const res = await fetch("/api/auth/bootstrap", {
  method: "POST",
  headers: token ? { Authorization: `Bearer ${token}` } : undefined,
  cache: "no-store",
});
const { role } = await res.json();

if (next) router.replace(next);
else router.push(role === "admin" ? "/admin" : role === "driver" ? "/driver" : "/faculty");

  }

  return (
    <LoginView
      email={email}
      password={password}
      setEmail={setEmail}
      setPassword={setPassword}
      loading={loading}
      err={err}
      onSubmit={handleLogin}
    />
  );
}


===== app\register\RegisterView.tsx =====
// app/(auth)/register/RegisterView.tsx
"use client";

import Link from "next/link";
import React from "react";

/* UI atoms */
export const Input = (props: React.ComponentProps<"input">) => (
  <input
    {...props}
    autoComplete="off"
    className={
      "w-full h-10 border border-gray-300 focus:ring-2 focus:ring-red-900 focus:border-red-900 " +
      "px-3 rounded-md outline-none text-[13px] shadow-sm text-gray-900 placeholder-gray-500 " +
      (props.className ?? "")
    }
  />
);

export const Select = (props: React.ComponentProps<"select">) => (
  <select
    {...props}
    className={
      "w-full h-10 border border-gray-300 focus:ring-2 focus:ring-red-900 focus:border-red-900 " +
      "px-3 rounded-md outline-none text-[13px] shadow-sm text-gray-900 " +
      (props.className ?? "")
    }
  />
);

export const Label = ({ children }: { children: React.ReactNode }) => (
  <label className="block text-[12px] font-medium text-gray-800 mb-1">{children}</label>
);

/* Departments (Lucena) */
const DEPARTMENTS = [
  "College of Computing and Multimedia Studies (CCMS)",
  "College of Criminal Justice and Criminology (CCJC)",
  "College of Nursing and Allied Health Sciences (CNAHS)",
  "College of International Hospitality and Tourism Management (CIHTM)",
  "College of Architecture and Fine Arts (CAFA)",
  "College of Maritime Education (CME)",
  "College of Business and Accountancy (CBA)",
  "College of Arts and Sciences (CAS)",
  "College of Education (CED)",
  "College of Engineering (CENG)",
  "Enverga Law School (ELS)",
  "Institute of Graduate Studies and Research (IGSR)",
  "Basic Education Department (BED)",
  "Treasury Office",
  "Alumni Affairs Office",
  "Registrar",
  "Human Resources",
  "Finance Office",
];

/* Types */
export type RolePick = "faculty" | "driver";
export type DriverStep = "phone" | "otp" | "profile";

type Props = {
  role: RolePick;
  setRole: (r: RolePick) => void;
  loading: boolean;
  err: string | null;
  msg: string | null;
  onResend?: () => void;

  fFirst: string;
  setFFirst: (v: string) => void;
  fMiddle: string;
  setFMiddle: (v: string) => void;
  fLast: string;
  setFLast: (v: string) => void;
  fSuffix: string;
  setFSuffix: (v: string) => void;
  fDept: string;
  setFDept: (v: string) => void;
  fBirthdate: string;
  setFBirthdate: (v: string) => void;
  fAddress: string;
  setFAddress: (v: string) => void;
  fEmail: string;
  setFEmail: (v: string) => void;
  fPw: string;
  setFPw: (v: string) => void;
  fPwConfirm: string;
  setFPwConfirm: (v: string) => void;
  onFacultySubmit: (e: React.FormEvent) => void;

  dStep: DriverStep;
  dPhone: string;
  setDPhone: (v: string) => void;
  dOtp: string;
  setDOtp: (v: string) => void;
  dFirst: string;
  setDFirst: (v: string) => void;
  dMiddle: string;
  setDMiddle: (v: string) => void;
  dLast: string;
  setDLast: (v: string) => void;
  dSuffix: string;
  setDSuffix: (v: string) => void;
  dAddress: string;
  setDAddress: (v: string) => void;
  verifiedPhone: string | null;
  onDriverSendOtp: (e: React.FormEvent) => void;
  onDriverVerify: (e: React.FormEvent) => void;
  onDriverSave: (e: React.FormEvent) => void;
};

export default function RegisterView({
  role,
  setRole,
  loading,
  err,
  msg,
  onResend,
  fFirst,
  setFFirst,
  fMiddle,
  setFMiddle,
  fLast,
  setFLast,
  fSuffix,
  setFSuffix,
  fDept,
  setFDept,
  fBirthdate,
  setFBirthdate,
  fAddress,
  setFAddress,
  fEmail,
  setFEmail,
  fPw,
  setFPw,
  fPwConfirm,
  setFPwConfirm,
  onFacultySubmit,
  dStep,
  dPhone,
  setDPhone,
  dOtp,
  setDOtp,
  dFirst,
  setDFirst,
  dMiddle,
  setDMiddle,
  dLast,
  setDLast,
  dSuffix,
  setDSuffix,
  dAddress,
  setDAddress,
  verifiedPhone,
  onDriverSendOtp,
  onDriverVerify,
  onDriverSave,
}: Props) {
  return (
    <div className="relative min-h-screen">
      {/* Background */}
      <div className="fixed inset-0 -z-20 bg-neutral-100" />
      <div className="fixed inset-0 -z-20 bg-cover bg-center" style={{ backgroundImage: "url('/enverga-bg.jpg')" }} />
      <div className="fixed inset-0 -z-10 bg-black/50" />

      {/* Content */}
      <div className="relative z-10 mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-10">
        <div className="w-full">
          <div className="bg-white/95 backdrop-blur-sm rounded-xl shadow-xl ring-1 ring-black/10">
            <div className="px-6 lg:px-8 py-6">
              {/* Header */}
              <div className="flex items-center gap-3">
                <img src="/eulogo.png" alt="Enverga University Logo" className="w-10 h-10" />
                <div>
                  <h1 className="text-[18px] font-extrabold text-red-900 leading-none">Enverga University</h1>
                  <p className="text-[11px] text-gray-600">TraviLink · Scheduling & Reservations</p>
                </div>
              </div>

              <div className="h-px bg-gray-200 my-4" />

              {/* Tabs */}
              <div className="grid grid-cols-2 gap-2 mb-4">
                <button
                  type="button"
                  onClick={() => setRole("faculty")}
                  className={`rounded-md h-10 text-[13px] font-medium border transition ${
                    role === "faculty"
                      ? "bg-red-900 text-white border-red-900"
                      : "bg-white text-gray-900 hover:bg-gray-50 border-gray-300"
                  }`}
                >
                  Faculty / Staff
                </button>
                <button
                  type="button"
                  onClick={() => setRole("driver")}
                  className={`rounded-md h-10 text-[13px] font-medium border transition ${
                    role === "driver"
                      ? "bg-red-900 text-white border-red-900"
                      : "bg-white text-gray-900 hover:bg-gray-50 border-gray-300"
                  }`}
                >
                  Driver
                </button>
              </div>

              {/* FACULTY FORM */}
              {role === "faculty" && (
                <form onSubmit={onFacultySubmit} className="space-y-4">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {/* Names */}
                    <div>
                      <Label>First name</Label>
                      <Input value={fFirst} onChange={(e) => setFFirst(e.target.value)} required />
                    </div>
                    <div>
                      <Label>Middle name</Label>
                      <Input value={fMiddle} onChange={(e) => setFMiddle(e.target.value)} />
                    </div>
                    <div>
                      <Label>Last name</Label>
                      <Input value={fLast} onChange={(e) => setFLast(e.target.value)} required />
                    </div>
                    <div>
                      <Label>Suffix</Label>
                      <Input value={fSuffix} onChange={(e) => setFSuffix(e.target.value)} placeholder="Jr., III, etc." />
                    </div>

                    {/* Dept + Birthdate */}
                    <div>
                      <Label>Department</Label>
                      <Select value={fDept} onChange={(e) => setFDept(e.target.value)} required>
                        <option value="" disabled>
                          Select a department
                        </option>
                        {DEPARTMENTS.map((d) => (
                          <option key={d} value={d}>
                            {d}
                          </option>
                        ))}
                      </Select>
                    </div>
                    <div>
                      <Label>Birthdate</Label>
                      <Input type="date" value={fBirthdate} onChange={(e) => setFBirthdate(e.target.value)} required />
                    </div>

                    {/* Email full width */}
                    <div className="md:col-span-2">
                      <Label>Email</Label>
                      <Input type="email" value={fEmail} onChange={(e) => setFEmail(e.target.value)} required />
                    </div>

                    {/* Passwords side-by-side */}
                    <div>
                      <Label>Password</Label>
                      <Input type="password" value={fPw} onChange={(e) => setFPw(e.target.value)} required />
                      <p className="text-[10px] text-gray-600 mt-1">8+ chars, 1 number, 1 symbol.</p>
                    </div>
                    <div>
                      <Label>Confirm Password</Label>
                      <Input type="password" value={fPwConfirm} onChange={(e) => setFPwConfirm(e.target.value)} required />
                    </div>

                    {/* Address full width */}
                    <div className="md:col-span-2">
                      <Label>Address</Label>
                      <Input value={fAddress} onChange={(e) => setFAddress(e.target.value)} required />
                    </div>
                  </div>

                  {/* Messages */}
                  {err && <p className="text-[13px] text-red-600">{err}</p>}
                  {msg && <p className="text-[13px] text-green-700">{msg}</p>}

                  {/* Actions */}
                  <button
                    disabled={loading}
                    className="bg-red-900 text-white w-full h-10 rounded-md hover:bg-red-800 transition-all text-[13px] font-medium shadow-sm disabled:opacity-60"
                  >
                    {loading ? "Creating..." : "Register"}
                  </button>

                  {!!onResend && (
                    <button
                      type="button"
                      onClick={onResend}
                      disabled={loading}
                      className="mt-2 w-full text-center text-[13px] text-red-900 underline disabled:opacity-60"
                    >
                      Resend confirmation
                    </button>
                  )}

                  <p className="text-[12px] text-gray-700 text-center mt-1">
                    Already have an account?{" "}
                    <Link href="/login" className="text-red-900 hover:underline font-medium">
                      Login
                    </Link>
                  </p>
                </form>
              )}

              {/* DRIVER FLOW */}
              {role === "driver" && (
                <div className="space-y-4">
                  <div className="flex items-center justify-center gap-2 text-[11px] text-gray-800">
                    <span className={`px-2 py-1 rounded ${dStep === "phone" ? "bg-gray-200" : ""}`}>1. Phone</span>
                    <span>→</span>
                    <span className={`px-2 py-1 rounded ${dStep === "otp" ? "bg-gray-200" : ""}`}>2. Code</span>
                    <span>→</span>
                    <span className={`px-2 py-1 rounded ${dStep === "profile" ? "bg-gray-200" : ""}`}>3. Profile</span>
                  </div>

                  {dStep === "phone" && (
                    <form onSubmit={onDriverSendOtp} className="space-y-3">
                      <div>
                        <Label>Phone number</Label>
                        <Input placeholder="09XXXXXXXXX" value={dPhone} onChange={(e) => setDPhone(e.target.value)} required />
                      </div>
                      {err && <p className="text-[13px] text-red-600">{err}</p>}
                      {msg && <p className="text-[13px] text-green-700">{msg}</p>}
                      <button
                        disabled={loading}
                        className="bg-red-900 text-white w-full h-10 rounded-md hover:bg-red-800 transition-all text-[13px] font-medium shadow-sm disabled:opacity-60"
                      >
                        {loading ? "Sending..." : "Send Code"}
                      </button>
                    </form>
                  )}

                  {dStep === "otp" && (
                    <form onSubmit={onDriverVerify} className="space-y-3">
                      <div>
                        <Label>SMS code</Label>
                        <Input value={dOtp} onChange={(e) => setDOtp(e.target.value)} required />
                      </div>
                      {err && <p className="text-[13px] text-red-600">{err}</p>}
                      {msg && <p className="text-[13px] text-green-700">{msg}</p>}
                      <button
                        disabled={loading}
                        className="bg-red-900 text-white w-full h-10 rounded-md hover:bg-red-800 transition-all text-[13px] font-medium shadow-sm disabled:opacity-60"
                      >
                        {loading ? "Verifying..." : "Verify"}
                      </button>
                    </form>
                  )}

                  {dStep === "profile" && (
                    <form onSubmit={onDriverSave} className="space-y-3">
                      <p className="text-[12px] text-gray-600">
                        Verified phone: <span className="font-medium">{verifiedPhone ?? "—"}</span>
                      </p>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <Label>First name</Label>
                          <Input value={dFirst} onChange={(e) => setDFirst(e.target.value)} required />
                        </div>
                        <div>
                          <Label>Middle name</Label>
                          <Input value={dMiddle} onChange={(e) => setDMiddle(e.target.value)} />
                        </div>
                        <div>
                          <Label>Last name</Label>
                          <Input value={dLast} onChange={(e) => setDLast(e.target.value)} required />
                        </div>
                        <div>
                          <Label>Suffix</Label>
                          <Input value={dSuffix} onChange={(e) => setDSuffix(e.target.value)} placeholder="Jr., III, etc." />
                        </div>
                        <div className="md:col-span-2">
                          <Label>Address</Label>
                          <Input
                            value={dAddress}
                            onChange={(e) => setDAddress(e.target.value)}
                            placeholder="House No., Street, Barangay, City"
                            required
                          />
                        </div>
                      </div>
                      {err && <p className="text-[13px] text-red-600">{err}</p>}
                      {msg && <p className="text-[13px] text-green-700">{msg}</p>}
                      <button
                        disabled={loading}
                        className="bg-red-900 text-white w-full h-10 rounded-md hover:bg-red-800 transition-all text-[13px] font-medium shadow-sm disabled:opacity-60"
                      >
                        {loading ? "Saving..." : "Save Profile"}
                      </button>
                    </form>
                  )}
                </div>
              )}
            </div>
          </div>

          <p className="mt-3 text-center text-[11px] text-white/80">
            © {new Date().getFullYear()} TraviLink · Enverga University
          </p>
        </div>
      </div>
    </div>
  );
}


===== app\register\page.backup.tsx =====
"use client";

import { useState } from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { supabase } from "@/lib/supabaseClient";

const allowedDomain = (email: string) => email.endsWith("@mseuf.edu.ph"); // adjust if needed

export default function RegisterPage() {
  const router = useRouter();
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [err, setErr] = useState<string | null>(null);
  const [ok, setOk] = useState(false);

  async function handleRegister(e: React.FormEvent) {
    e.preventDefault();
    setErr(null);

    if (!allowedDomain(email)) {
      setErr("Please use your university email (e.g., @mseuf.edu.ph).");
      return;
    }

    const { data, error } = await supabase.auth.signUp({ email, password });
    if (error) { setErr(error.message); return; }

    // make sure there's a row in public.users (role defaults to faculty)
    await fetch("/api/users", { method: "POST" });

    setOk(true);
    router.push("/faculty"); // default landing after register
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100 p-6">
      <form onSubmit={handleRegister} className="bg-white rounded-xl shadow-lg p-8 w-full max-w-md border border-gray-200">
        <h1 className="text-2xl font-bold text-red-900 mb-1">Create Account</h1>
        <p className="text-sm text-gray-600 mb-6">Faculty/Staff only. Admin accounts are created by the system.</p>

        <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
        <input
          type="email"
          value={email}
          onChange={(e)=>setEmail(e.target.value)}
          className="w-full border border-gray-300 focus:ring-2 focus:ring-red-900 focus:border-red-900 p-3 rounded-md outline-none text-sm shadow-sm text-gray-900"
          placeholder="you@mseuf.edu.ph"
          required
        />

        <label className="block text-sm font-medium text-gray-700 mb-1 mt-4">Password</label>
        <input
          type="password"
          value={password}
          onChange={(e)=>setPassword(e.target.value)}
          className="w-full border border-gray-300 focus:ring-2 focus:ring-red-900 focus:border-red-900 p-3 rounded-md outline-none text-sm shadow-sm text-gray-900"
          required
        />

        {err && <p className="text-sm text-red-600 mt-3">{err}</p>}
        {ok && <p className="text-sm text-green-700 mt-3">Account created.</p>}

        <button type="submit" className="mt-6 bg-red-900 text-white w-full py-3 rounded-md hover:bg-red-800 transition-all font-medium text-sm shadow-md">
          Register
        </button>

        <p className="text-xs text-center text-gray-600 mt-4">
          Already have an account?{" "}
          <Link href="/login" className="text-red-900 hover:underline font-medium">Login</Link>
        </p>
      </form>
    </div>
  );
}


===== app\register\page.tsx =====
// app/(auth)/register/page.tsx
"use client";

import { useEffect, useState } from "react";
import { supabase } from "@/lib/supabaseClient";
import RegisterView, { DriverStep, RolePick } from "./RegisterView";

const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;

function validatePassword(pw: string): string | null {
  if (pw.length < 8) return "Password must be at least 8 characters long.";
  if (!/[0-9]/.test(pw)) return "Password must contain at least one number.";
  if (!/[!@#$%^&*(),.?\":{}|<>]/.test(pw)) return "Password must contain at least one special character.";
  return null;
}

function normalizePhone(p: string) {
  const digits = p.replace(/\D/g, "");
  if (digits.startsWith("09") && digits.length === 11) return "+63" + digits.slice(1);
  if (digits.startsWith("9") && digits.length === 10) return "+63" + digits;
  if (digits.startsWith("63")) return "+" + digits;
  if (digits.startsWith("+")) return digits;
  return "+" + digits;
}

export default function RegisterPage() {
  const [role, setRole] = useState<RolePick>("faculty");

  // Faculty
  const [fFirst, setFFirst] = useState("");
  const [fMiddle, setFMiddle] = useState("");
  const [fLast, setFLast] = useState("");
  const [fSuffix, setFSuffix] = useState("");
  const [fDept, setFDept] = useState("");
  const [fBirthdate, setFBirthdate] = useState("");
  const [fAddress, setFAddress] = useState("");
  const [fEmail, setFEmail] = useState("");
  const [fPw, setFPw] = useState("");
  const [fPwConfirm, setFPwConfirm] = useState("");

  // Driver
  const [dStep, setDStep] = useState<DriverStep>("phone");
  const [dPhone, setDPhone] = useState("");
  const [verifiedPhone, setVerifiedPhone] = useState<string | null>(null);
  const [dOtp, setDOtp] = useState("");
  const [dFirst, setDFirst] = useState("");
  const [dMiddle, setDMiddle] = useState("");
  const [dLast, setDLast] = useState("");
  const [dSuffix, setDSuffix] = useState("");
  const [dAddress, setDAddress] = useState("");

  // UI
  const [loading, setLoading] = useState(false);
  const [msg, setMsg] = useState<string | null>(null);
  const [err, setErr] = useState<string | null>(null);
  const [justSignedUpEmail, setJustSignedUpEmail] = useState<string | null>(null);

  useEffect(() => {
    setMsg(null);
    setErr(null);
  }, [role]);

  async function registerFaculty(e: React.FormEvent) {
    e.preventDefault();
    setErr(null);
    setMsg(null);

    const nameFull = [fFirst, fMiddle, fLast, fSuffix].filter(Boolean).join(" ").replace(/\s+/g, " ").trim();

    if (fFirst.trim().length < 1 || fLast.trim().length < 1) return setErr("Please enter your first and last name.");
    if (!emailRegex.test(fEmail)) return setErr("Please enter a valid email address.");
    if (!fBirthdate) return setErr("Please select your birthdate.");
    if (!fAddress.trim()) return setErr("Please enter your address.");
    const pwErr = validatePassword(fPw);
    if (pwErr) return setErr(pwErr);
    if (fPw !== fPwConfirm) return setErr("Passwords do not match.");

    try {
      setLoading(true);

      // quick duplicate check
      const dupRes = await supabase.auth.signInWithPassword({ email: fEmail, password: "__dummy__" });
      if (!dupRes.error) {
        setErr("This email is already registered. Please log in.");
        return;
      }

      const { error } = await supabase.auth.signUp({
        email: fEmail,
        password: fPw,
        options: {
          data: {
            role: "faculty",
            first_name: fFirst,
            middle_name: fMiddle || null,
            last_name: fLast,
            suffix: fSuffix || null,
            name_full: nameFull,
            department: fDept || null,
            birthdate: fBirthdate,
            address: fAddress,
          },
        },
      });

      if (error) {
        const m = error.message.toLowerCase();
        if (m.includes("already registered")) {
          setErr("This email is already registered. Please log in or reset your password.");
          return;
        }
        if (m.includes("rate limit")) {
          setErr("Too many attempts. Please wait and try again.");
          return;
        }
        throw error;
      }

      setJustSignedUpEmail(fEmail);
      setMsg(
        "If this email is new, we sent a confirmation link. If it’s already registered, please check your inbox (and spam) or try logging in / resetting your password."
      );
    } catch (e: any) {
      setErr(e.message ?? "Registration failed.");
    } finally {
      setLoading(false);
    }
  }

  async function resendConfirmation() {
    if (!justSignedUpEmail) return;
    setErr(null);
    setMsg(null);
    try {
      setLoading(true);
      const { error } = await supabase.auth.resend({ type: "signup", email: justSignedUpEmail });
      if (error) {
        const m = (error.message || "").toLowerCase();
        if (m.includes("already confirmed")) {
          setErr("This email is already confirmed. You can log in now.");
          return;
        }
        throw error;
      }
      setMsg("Confirmation email sent. Please check your inbox (and spam).");
    } catch (e: any) {
      setErr(e.message ?? "Could not resend confirmation.");
    } finally {
      setLoading(false);
    }
  }

  function driverSendOtp(e: React.FormEvent) {
    e.preventDefault();
    setErr(null);
    setMsg(null);
    const normalized = normalizePhone(dPhone);
    if (!/^\+63\d{10}$/.test(normalized)) {
      setErr("Please enter a valid PH mobile (e.g., 09XXXXXXXXX).");
      return;
    }
    setMsg("Dev mode: use code 1234 to continue.");
    setDStep("otp");
  }

  function driverVerifyOtp(e: React.FormEvent) {
    e.preventDefault();
    setErr(null);
    setMsg(null);
    if (dOtp.trim() !== "1234") {
      setErr("Invalid code. (Dev mode: the code is 1234)");
      return;
    }
    const normalized = normalizePhone(dPhone);
    setVerifiedPhone(normalized);
    setDStep("profile");
  }

  async function driverSaveProfile(e: React.FormEvent) {
    e.preventDefault();
    setErr(null);
    setMsg(null);
    if (!verifiedPhone) return setErr("Missing verified phone. Please restart driver signup.");
    if (dFirst.trim().length < 1 || dLast.trim().length < 1) return setErr("Please enter your first and last name.");
    if (!dAddress.trim()) return setErr("Please enter your address.");

    try {
      setLoading(true);
      const res = await fetch("/api/dev/driver/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          phone: verifiedPhone,
          name: [dFirst, dMiddle, dLast, dSuffix].filter(Boolean).join(" ").replace(/\s+/g, " ").trim(),
          first_name: dFirst,
          middle_name: dMiddle || null,
          last_name: dLast,
          suffix: dSuffix || null,
          address: dAddress,
        }),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "Failed to save driver profile.");
      setMsg("Profile saved (dev). Your driver account is now pending admin approval.");
    } catch (e: any) {
      setErr(e.message ?? "Could not save profile.");
    } finally {
      setLoading(false);
    }
  }

  return (
    <RegisterView
      role={role}
      setRole={setRole}
      loading={loading}
      err={err}
      msg={msg}
      onResend={justSignedUpEmail ? resendConfirmation : undefined}
      fFirst={fFirst}
      setFFirst={setFFirst}
      fMiddle={fMiddle}
      setFMiddle={setFMiddle}
      fLast={fLast}
      setFLast={setFLast}
      fSuffix={fSuffix}
      setFSuffix={setFSuffix}
      fDept={fDept}
      setFDept={setFDept}
      fBirthdate={fBirthdate}
      setFBirthdate={setFBirthdate}
      fAddress={fAddress}
      setFAddress={setFAddress}
      fEmail={fEmail}
      setFEmail={setFEmail}
      fPw={fPw}
      setFPw={setFPw}
      fPwConfirm={fPwConfirm}
      setFPwConfirm={setFPwConfirm}
      onFacultySubmit={registerFaculty}
      dStep={dStep}
      dPhone={dPhone}
      setDPhone={setDPhone}
      dOtp={dOtp}
      setDOtp={setDOtp}
      dFirst={dFirst}
      setDFirst={setDFirst}
      dMiddle={dMiddle}
      setDMiddle={setDMiddle}
      dLast={dLast}
      setDLast={setDLast}
      dSuffix={dSuffix}
      setDSuffix={setDSuffix}
      dAddress={dAddress}
      setDAddress={setDAddress}
      verifiedPhone={verifiedPhone}
      onDriverSendOtp={driverSendOtp}
      onDriverVerify={driverVerifyOtp}
      onDriverSave={driverSaveProfile}
    />
  );
}


===== app\test-supabase\page.tsx =====
"use client";

import { useEffect, useState } from "react";
import { supabase } from "@/lib/supabaseClient";

type User = {
  id: string;
  name: string;
  email: string;
  role: string;
  status: string;
};


export default function TestSupabasePage() {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(true);

  // form state
  const [name, setName] = useState("");
  const [email, setEmail] = useState("");
  const [role, setRole] = useState("faculty");

  // fetch all users
  useEffect(() => {
    fetchUsers();
  }, []);

  async function fetchUsers() {
    setLoading(true);
    const { data, error } = await supabase.from("users").select("*").order("created_at", { ascending: false });
    if (error) {
      console.error("Error fetching users:", error.message);
    } else {
      setUsers(data as User[]);
    }
    setLoading(false);
  }

  // insert user
  async function handleAddUser(e: React.FormEvent) {
    e.preventDefault();
    const { error } = await supabase.from("users").insert([{ name, email, role }]);
    if (error) {
      alert("Error adding user: " + error.message);
    } else {
      setName("");
      setEmail("");
      setRole("faculty");
      fetchUsers(); // refresh list
    }
  }

  return (
    <div className="p-6">
      <h1 className="text-2xl font-bold mb-4">🚀 Supabase Users Test</h1>

      {/* ADD USER FORM */}
      <form onSubmit={handleAddUser} className="space-y-3 mb-6">
        <input
          type="text"
          placeholder="Name"
          className="border p-2 rounded w-full"
          value={name}
          onChange={(e) => setName(e.target.value)}
          required
        />
        <input
          type="email"
          placeholder="Email"
          className="border p-2 rounded w-full"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          required
        />
        <select
          className="border p-2 rounded w-full"
          value={role}
          onChange={(e) => setRole(e.target.value)}
        >
          <option value="faculty">Faculty</option>
          <option value="staff">Staff</option>
          <option value="driver">Driver</option>
          <option value="admin">Admin</option>
        </select>
        <button type="submit" className="bg-blue-600 text-white px-4 py-2 rounded">
          Add User
        </button>
      </form>

      {/* USERS LIST */}
      {loading ? (
        <p>Loading users...</p>
      ) : users.length === 0 ? (
        <p>No users found.</p>
      ) : (
        <ul className="space-y-2">
          {users.map((u) => (
            <li key={u.id} className="border p-2 rounded">
              <strong>{u.name}</strong> ({u.email}) — role: {u.role}, status:{" "}
              <span className="italic">{u.status}</span>
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}


===== app\tw-test\page.tsx =====
export default function TwTest() {
  return (
    <div className="p-6">
      <div className="p-4 bg-black text-white rounded mb-4">Tailwind is working</div>

      <div className="grid gap-4 sm:grid-cols-2">
        <div className="card p-5">
          <h2 className="text-lg font-semibold mb-2">Card Example</h2>
          <p className="text-sm text-neutral-600">
            If this looks like a rounded white card with a light border and shadow, Tailwind is loaded.
          </p>
          <div className="mt-3 flex gap-2">
            <button className="btn">Button</button>
            <button className="btn btn-solid">Primary</button>
          </div>
        </div>

        <div className="card p-5">
          <h2 className="text-lg font-semibold mb-2">Utilities</h2>
          <div className="grid grid-cols-3 gap-2">
            <div className="h-10 rounded bg-red-500"></div>
            <div className="h-10 rounded bg-green-500"></div>
            <div className="h-10 rounded bg-blue-500"></div>
          </div>
        </div>
      </div>
    </div>
  );
}


===== app\types\domain.ts =====


===== app\types\driver.ts =====
export type DriverStatus = "Available" | "On Trip" | "Off Duty" | "Sick" | "Leave";
export const DRIVER_STATUSES: DriverStatus[] = ["Available","On Trip","Off Duty","Sick","Leave"];


===== app\types\driverProfile.ts =====
export type DriverProfile = {
  firstName: string;
  lastName: string;
  email?: string;
  campus: string;
  dept?: string;
  phone?: string;
  license: string;
  canDrive: string[];
  badges?: string[];
  avatar?: string;        // data URL for now
  notifyEmail: boolean;
  notifyPush: boolean;
};


===== app\types\schedule.ts =====
export type Status = "Approved" | "Pending" | "Assigned";

export type DriverScheduleRow = {
  id: string;
  date: string;       // "YYYY-MM-DD HH:mm"
  location: string;
  vehicle: "Bus" | "Van";
  driver?: string;
  status: Status;
};


===== components\admin\dashboard\containers\KpiRow.tsx =====
"use client";

import KpiTile from "@/components/admin/dashboard/ui/KpiTile";

export type KPI = {
  label: string;
  value: number | string;
  caption?: string;
};

export default function KpiRow({ items }: { items: KPI[] }) {
  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      {items.map((k) => (
        <KpiTile
          key={k.label}
          label={k.label}
          value={k.value}
          caption={k.caption}
        />
      ))}
    </div>
  );
}


===== components\admin\dashboard\ui\ChartCard.tsx =====
"use client";

import dynamic from "next/dynamic";
import * as React from "react";

type Props<T> = {
  title: string;
  type: "line" | "bar";
  data: T[];
  xKey: keyof T;
  yKey: keyof T;
  height?: number;           // chart drawing area height (px)
  description?: string;      // optional tiny helper text under title
  className?: string;        // optional wrapper override
};

// Lightweight skeleton while the chart bundle loads
const Recharts = dynamic(() => import("./_Recharts"), {
  ssr: false,
  loading: () => (
    <div className="mt-2 h-[220px] w-full animate-pulse rounded-lg bg-neutral-100" />
  ),
});

export default function ChartCard<T>({
  title,
  type,
  data,
  xKey,
  yKey,
  height = 240,
  description,
  className = "",
}: Props<T>) {
  const d = React.useMemo(() => data, [data]);
  const empty = !d || d.length === 0;

  return (
    <div
      className={
        "rounded-xl border border-neutral-200 bg-white p-4 shadow-sm " + className
      }
    >
      <div className="mb-2 flex items-start justify-between">
        <div>
          <div className="text-sm font-semibold text-neutral-900">{title}</div>
          {description ? (
            <p className="mt-0.5 text-xs text-neutral-500">{description}</p>
          ) : null}
        </div>

        <span className="ml-3 inline-flex items-center rounded-full border border-neutral-200 px-2 py-0.5 text-[11px] font-medium text-neutral-600">
          {type === "line" ? "Line" : "Bar"} Chart
        </span>
      </div>

      {/* Content */}
      <div
        className="relative mt-2 w-full"
        style={{ height }}
        aria-busy={empty ? undefined : false}
      >
        {empty ? (
          <EmptyState />
        ) : (
          <Recharts
            type={type}
            data={d as any}
            xKey={xKey as string}
            yKey={yKey as string}
          />
        )}
      </div>
    </div>
  );
}

function EmptyState() {
  return (
    <div className="flex h-full w-full items-center justify-center rounded-lg border border-dashed border-neutral-200 bg-neutral-50">
      <div className="text-center">
        <div className="text-sm font-medium text-neutral-800">No data to display</div>
        <p className="mt-1 text-xs text-neutral-500">
          Try adjusting the date range or filters.
        </p>
      </div>
    </div>
  );
}


===== components\admin\dashboard\ui\DashboardActions.tsx =====
"use client";

import * as React from "react";
import type { RequestRow } from "@/lib/admin/types";

type Props = {
  rows: RequestRow[];
  filename?: string;
};

export default function DashboardActions({ rows, filename = "requests.csv" }: Props) {
  const exportCsv = () => {
    const header = ["ID", "Requester", "Vehicle", "Date", "Status"];
    const body = rows.map((r) => [
      r.id ?? "",
      r.requester ?? "",
      r.vehicle ?? "",
      r.date ?? "",
      r.status ?? "",
    ]);

    const csv = [header, ...body]
      .map((cols) => cols.map(esc).join(","))
      .join("\n");

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  };

  return (
    <div className="print:hidden flex items-center gap-2">
      {/* Export Button */}
      <button
        type="button"
        onClick={exportCsv}
        className="inline-flex items-center rounded-md bg-[#7A0010] px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-[#60000C] focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[#7A0010]"
      >
        Export CSV
      </button>

      {/* Print Button */}
      <button
        type="button"
        onClick={() => window.print()}
        className="inline-flex items-center rounded-md bg-[#7A0010] px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-[#60000C] focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[#7A0010]"
      >
        Print
      </button>
    </div>
  );
}

function esc(v: string | number) {
  const s = String(v ?? "");
  return /[",\n]/.test(s) ? `"${s.replace(/"/g, '""')}"` : s;
}


===== components\admin\dashboard\ui\DeptUsageChart.tsx =====
"use client";

import * as React from "react";
import {
  ResponsiveContainer,
  PieChart,
  Pie,
  Cell,
  Tooltip,
  Legend,
} from "recharts";

type Point = { dept: string; count: number };

const COLORS = ["#7A0010", "#952035", "#B24158", "#CF6E85", "#E5A7B3"];

const TOKENS = {
  legendSize: 12,
  legendWeight: 600,
  labelSize: 12,
  labelColor: "#334155",     // neutral-700
  gapStroke: "#ffffff",
  gapWidth: 2,
};

export default function DeptUsageChart({ data }: { data: Point[] }) {
  const total = React.useMemo(
    () => data.reduce((s, d) => s + (d.count || 0), 0),
    [data]
  );

  return (
    <div className="rounded-xl border border-neutral-200 bg-white p-4 shadow-sm">
      <div className="mb-2 flex items-center justify-between">
        <div className="text-sm font-semibold text-neutral-900">Department Usage</div>
        <span className="rounded-full border border-neutral-200 px-2 py-0.5 text-[11px] text-neutral-600">
          Donut Chart
        </span>
      </div>

      <div className="h-[260px] w-full">
        <ResponsiveContainer>
          <PieChart margin={{ top: 6, right: 18, bottom: 6, left: 18 }}>
            {/* Donut */}
            <Pie
              data={data}
              dataKey="count"
              nameKey="dept"
              cx="50%"
              cy="50%"
              innerRadius={58}        // thicker ring
              outerRadius={90}
              startAngle={90}
              endAngle={-270}
              minAngle={6}            // avoid ultra-thin slices
              paddingAngle={1.5}
              label={renderValueLabel}           // custom numeric labels
              labelLine={true}
              isAnimationActive={false}
            >
              {data.map((_, i) => (
                <Cell
                  key={i}
                  fill={COLORS[i % COLORS.length]}
                  stroke={TOKENS.gapStroke}
                  strokeWidth={TOKENS.gapWidth}
                />
              ))}
            </Pie>

            {/* Center total */}
            <text
              x="50%"
              y="50%"
              textAnchor="middle"
              dominantBaseline="central"
              className="fill-neutral-900"
              style={{ fontSize: 14, fontWeight: 700 }}
            >
              {total}
            </text>
            <text
              x="50%"
              y="50%"
              dy={16}
              textAnchor="middle"
              dominantBaseline="hanging"
              className="fill-neutral-500"
              style={{ fontSize: 11, fontWeight: 500 }}
            >
              total
            </text>

            <Tooltip
              contentStyle={{
                background: "#fff",
                border: "1px solid #E5E7EB",
                borderRadius: 8,
                boxShadow: "0 4px 14px rgba(0,0,0,0.06)",
                fontSize: 12,
              }}
              formatter={(v: number, _name: string, i: any) => {
                const pct = total ? `${((v / total) * 100).toFixed(1)}%` : "0%";
                const dept = data[i?.payload?.index || 0]?.dept ?? "";
                return [v, `${dept} • ${pct}`];
              }}
            />

            <Legend
              verticalAlign="bottom"
              height={28}
              wrapperStyle={{ paddingTop: 8 }}
              formatter={(val: string) => (
                <span style={{ fontSize: TOKENS.legendSize, fontWeight: TOKENS.legendWeight, color: "#111827" }}>
                  {val}
                </span>
              )}
            />
          </PieChart>
        </ResponsiveContainer>
      </div>
    </div>
  );
}

/** Pushes numbers farther away from the arc; hides labels for very small slices */
function renderValueLabel(props: any) {
  const { cx, cy, midAngle, outerRadius, value, percent } = props;
  if (percent < 0.06) return null; // hide labels under ~6% to avoid clutter

  const RAD = Math.PI / 180;
  const r = outerRadius + 28; // farther offset so hindi dikit sa line
  const x = cx + r * Math.cos(-midAngle * RAD);
  const y = cy + r * Math.sin(-midAngle * RAD);

  return (
    <text
      x={x}
      y={y}
      textAnchor={x > cx ? "start" : "end"}
      dominantBaseline="central"
      style={{ fontSize: TOKENS.labelSize, fill: TOKENS.labelColor, fontWeight: 500 }}
    >
      {value}
    </text>
  );
}


===== components\admin\dashboard\ui\ExportCsvButton.tsx =====
"use client";

import * as React from "react";
import type { RequestRow } from "@/lib/admin/types";

type Props = {
  rows: RequestRow[];
  filename?: string;
};

export default function DashboardActions({ rows, filename = "requests.csv" }: Props) {
  const exportCsv = () => {
    const header = ["ID", "Requester", "Vehicle", "Date", "Status"];
    const body = rows.map((r) => [
      r.id ?? "",
      r.requester ?? "",
      r.vehicle ?? "",
      r.date ?? "",
      r.status ?? "",
    ]);

    const csv = [header, ...body]
      .map((cols) => cols.map(esc).join(","))
      .join("\n");

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  };

  return (
    <div className="print:hidden flex items-center gap-2">
      {/* Export Button */}
      <button
        type="button"
        onClick={exportCsv}
        className="inline-flex items-center rounded-md bg-[#7A0010] px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-[#60000C] focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[#7A0010]"
      >
        Export CSV
      </button>

      {/* Print Button */}
      <button
        type="button"
        onClick={() => window.print()}
        className="inline-flex items-center rounded-md bg-[#7A0010] px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-[#60000C] focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[#7A0010]"
      >
        Print
      </button>
    </div>
  );
}

function esc(v: string | number) {
  const s = String(v ?? "");
  return /[",\n]/.test(s) ? `"${s.replace(/"/g, '""')}"` : s;
}


===== components\admin\dashboard\ui\KpiTile.tsx =====
"use client";

type Props = {
  label: string;
  value: number | string;
  caption?: string;
};

export default function KpiTile({ label, value, caption }: Props) {
  return (
    <div className="rounded-xl border border-neutral-200 bg-white shadow-sm p-4 hover:shadow transition-shadow">
      <div className="text-xs font-medium text-neutral-500">{label}</div>
      <div className="mt-1 text-2xl font-bold tracking-tight text-neutral-900">
        {value}
      </div>
      {caption ? (
        <div className="mt-1 text-xs text-neutral-500">{caption}</div>
      ) : null}
    </div>
  );
}


===== components\admin\dashboard\ui\RequestsTable.tsx =====
"use client";

const data = [
  { id: "REQ-1001", dept: "CCMS", purpose: "Seminar", date: "2025-09-10", status: "Pending" },
  { id: "REQ-1002", dept: "HR", purpose: "Orientation", date: "2025-09-12", status: "Approved" },
];



export default function RequestsTable() {
  return (
    <div className="overflow-hidden rounded-xl border border-neutral-200 bg-white shadow-sm">
      <table className="w-full text-sm text-neutral-700">
        <thead className="bg-neutral-100/70 text-neutral-600 uppercase text-xs tracking-wide">
          <tr>
            <Th>ID</Th>
            <Th>Department</Th>
            <Th>Purpose</Th>
            <Th>Date</Th>
            <Th>Status</Th>
          </tr>
        </thead>
        <tbody className="divide-y divide-neutral-200">
          {data.map((row) => (
            <tr key={row.id} className="hover:bg-neutral-50 transition-colors">
              <Td className="font-medium text-neutral-900">{row.id}</Td>
              <Td>{row.dept}</Td>
              <Td>{row.purpose}</Td>
              <Td className="tabular-nums text-neutral-600">{row.date}</Td>
              <Td>
                <StatusBadge status={row.status} />
              </Td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

function Th({ children, className = "" }: { children: React.ReactNode; className?: string }) {
  return (
    <th className={`px-4 py-3 text-left font-semibold whitespace-nowrap ${className}`}>
      {children}
    </th>
  );
}

function Td({ children, className = "" }: { children: React.ReactNode; className?: string }) {
  return (
    <td className={`px-4 py-3 whitespace-nowrap ${className}`}>
      {children}
    </td>
  );
}

function StatusBadge({ status }: { status: string }) {
  const color =
    status === "Approved"
      ? "bg-green-100 text-green-700"
      : status === "Pending"
      ? "bg-yellow-100 text-yellow-700"
      : "bg-neutral-100 text-neutral-600";

  return (
    <span
      className={`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${color}`}
    >
      {status}
    </span>
  );
}


===== components\admin\dashboard\ui\TripLogsTable.tsx =====
import type { TripLogRow } from "@/lib/admin/types";

export default function TripLogsTable({ rows }: { rows: TripLogRow[] }) {
  return (
    <div className="overflow-hidden rounded-xl border border-neutral-200 bg-white shadow-sm">
      <table className="w-full text-sm text-neutral-700">
        <thead className="bg-neutral-100/70 text-neutral-600 uppercase text-xs tracking-wide">
          <tr>
            <Th className="w-[110px]">Trip ID</Th>
            <Th>Vehicle</Th>
            <Th>Driver</Th>
            <Th>Department</Th>
            <Th className="w-[140px]">Date</Th>
            <Th className="w-[120px] text-right">Distance (km)</Th>
          </tr>
        </thead>
        <tbody className="divide-y divide-neutral-200">
          {rows.map((r) => (
            <tr
              key={r.id}
              className="hover:bg-neutral-50 transition-colors"
            >
              <Td className="font-medium text-neutral-900">{r.id}</Td>
              <Td>{r.vehicle}</Td>
              <Td>{r.driver}</Td>
              <Td>{r.department}</Td>
              <Td className="tabular-nums text-neutral-600">{r.date}</Td>
              <Td className="tabular-nums text-right font-semibold text-neutral-800">
                {r.distanceKm.toFixed(1)}
              </Td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

function Th({ children, className = "" }: { children: React.ReactNode; className?: string }) {
  return (
    <th
      className={`px-4 py-3 text-left font-semibold whitespace-nowrap ${className}`}
    >
      {children}
    </th>
  );
}

function Td({ children, className = "" }: { children: React.ReactNode; className?: string }) {
  return (
    <td
      className={`px-4 py-3 whitespace-nowrap ${className}`}
    >
      {children}
    </td>
  );
}


===== components\admin\dashboard\ui\_Recharts.tsx =====
"use client";

import * as React from "react";
import {
  ResponsiveContainer,
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  BarChart,
  Bar,
} from "recharts";

type Props = {
  type: "line" | "bar";
  data: Array<Record<string, any>>;
  xKey: string;
  yKey: string;
  height?: number;
};

/* ---- Design tokens (tweak here) ---- */
const TOKENS = {
  color: {
    primary: "#7A0010",           // maroon
    axis: "#525252",              // neutral-600
    grid: "#E5E7EB",              // neutral-200
    legend: "#111827",            // neutral-900
    tooltipBg: "#FFFFFF",
    tooltipBorder: "#E5E7EB",
  },
  font: {
    axisSize: 12,
    legendSize: 12,
    tooltipSize: 12,
    tickWeight: 500,
    legendWeight: 600,
  },
  chart: {
    gridDash: "3 3",
    lineWidth: 2.5,
    dotR: 3,
    activeDotR: 5,
    barRadius: 6,
    barGap: 8,
    barCategoryGap: 24,
    leftPadding: 8,
  },
};

export default function RechartsBridge({
  type,
  data,
  xKey,
  yKey,
  height = 240,
}: Props) {
  const margin = { top: 8, right: 12, bottom: 8, left: TOKENS.chart.leftPadding };

  return (
    <div style={{ width: "100%", height }}>
      <ResponsiveContainer>
        {type === "line" ? (
          <LineChart data={data} margin={margin}>
            <CartesianGrid strokeDasharray={TOKENS.chart.gridDash} stroke={TOKENS.color.grid} />
            <XAxis
              dataKey={xKey}
              tick={{ fontSize: TOKENS.font.axisSize, fill: TOKENS.color.axis, fontWeight: TOKENS.font.tickWeight }}
              axisLine={{ stroke: TOKENS.color.grid }}
              tickLine={{ stroke: TOKENS.color.grid }}
              interval="preserveStartEnd"
              minTickGap={18}
            />
            <YAxis
              width={36}
              tick={{ fontSize: TOKENS.font.axisSize, fill: TOKENS.color.axis, fontWeight: TOKENS.font.tickWeight }}
              axisLine={{ stroke: TOKENS.color.grid }}
              tickLine={{ stroke: TOKENS.color.grid }}
              allowDecimals={false}
            />
            <Tooltip
              contentStyle={{
                background: TOKENS.color.tooltipBg,
                border: `1px solid ${TOKENS.color.tooltipBorder}`,
                borderRadius: 8,
                boxShadow: "0 4px 14px rgba(0,0,0,0.06)",
                fontSize: TOKENS.font.tooltipSize,
              }}
            />
            <Legend
              wrapperStyle={{ paddingTop: 6 }}
              formatter={(v) => (
                <span style={{ fontSize: TOKENS.font.legendSize, fontWeight: TOKENS.font.legendWeight, color: TOKENS.color.legend }}>
                  {v}
                </span>
              )}
            />
            <Line
              type="monotone"
              dataKey={yKey}
              stroke={TOKENS.color.primary}
              strokeWidth={TOKENS.chart.lineWidth}
              dot={{ r: TOKENS.chart.dotR, stroke: TOKENS.color.primary }}
              activeDot={{ r: TOKENS.chart.activeDotR }}
            />
          </LineChart>
        ) : (
          <BarChart data={data} margin={margin} barGap={TOKENS.chart.barGap} barCategoryGap={TOKENS.chart.barCategoryGap}>
            <CartesianGrid strokeDasharray={TOKENS.chart.gridDash} stroke={TOKENS.color.grid} />
            <XAxis
              dataKey={xKey}
              tick={{ fontSize: TOKENS.font.axisSize, fill: TOKENS.color.axis, fontWeight: TOKENS.font.tickWeight }}
              axisLine={{ stroke: TOKENS.color.grid }}
              tickLine={{ stroke: TOKENS.color.grid }}
              interval="preserveStartEnd"
              minTickGap={18}
            />
            <YAxis
              width={36}
              tick={{ fontSize: TOKENS.font.axisSize, fill: TOKENS.color.axis, fontWeight: TOKENS.font.tickWeight }}
              axisLine={{ stroke: TOKENS.color.grid }}
              tickLine={{ stroke: TOKENS.color.grid }}
              allowDecimals={false}
            />
            <Tooltip
              contentStyle={{
                background: TOKENS.color.tooltipBg,
                border: `1px solid ${TOKENS.color.tooltipBorder}`,
                borderRadius: 8,
                boxShadow: "0 4px 14px rgba(0,0,0,0.06)",
                fontSize: TOKENS.font.tooltipSize,
              }}
            />
            <Legend
              wrapperStyle={{ paddingTop: 6 }}
              formatter={(v) => (
                <span style={{ fontSize: TOKENS.font.legendSize, fontWeight: TOKENS.font.legendWeight, color: TOKENS.color.legend }}>
                  {v}
                </span>
              )}
            />
            <Bar dataKey={yKey} fill={TOKENS.color.primary} radius={[TOKENS.chart.barRadius, TOKENS.chart.barRadius, 0, 0]} />
          </BarChart>
        )}
      </ResponsiveContainer>
    </div>
  );
}


===== components\admin\drivers\filters\ComplianceDropdown.ui.tsx =====
"use client";
import * as React from "react";

export default function ComplianceDropdown({ value, onChange }: { value: string; onChange: (v: string) => void }) {
  return (
    <select className="rounded border px-3 py-2" value={value} onChange={(e)=>onChange(e.target.value)}>
      <option value="">Compliance: All</option>
      <option value="ok">Compliant</option>
      <option value="warn">Expiring soon</option>
      <option value="bad">Expired / missing</option>
    </select>
  );
}


===== components\admin\drivers\filters\DriverStatusDropdown.ui.tsx =====
"use client";
import * as React from "react";

export default function DriverStatusDropdown({ value, onChange }: { value: string; onChange: (v: string) => void }) {
  return (
    <select className="rounded border px-3 py-2" value={value} onChange={(e)=>onChange(e.target.value)}>
      <option value="">Status: All</option>
      <option value="active">Active</option>
      <option value="suspended">Suspended</option>
      <option value="archived">Archived</option>
      <option value="pending_verification">Pending verification</option>
    </select>
  );
}


===== components\admin\drivers\forms\DriverFormSections.ui.tsx =====
// Placeholder for splitting DriverForm into smaller chunks later.
// For now the single DriverForm.ui.tsx handles the layout.
export {};


===== components\admin\drivers\ui\BulkBar.ui.tsx =====
"use client";
import * as React from "react";

type Props = {
  count: number;
  onSuspend: () => void;
  onActivate: () => void;
  onArchive: () => void;
  onExport: () => void;
  onClear: () => void;
};

export default function BulkBar({ count, onSuspend, onActivate, onArchive, onExport, onClear }: Props) {
  return (
    <div className="flex items-center gap-2 rounded-lg border bg-amber-50 p-3 text-sm">
      <div className="font-medium">{count} selected</div>
      <div className="ml-auto flex items-center gap-2">
        <button className="rounded border px-3 py-1.5 hover:bg-gray-50" onClick={onActivate}>Activate</button>
        <button className="rounded border px-3 py-1.5 hover:bg-gray-50" onClick={onSuspend}>Suspend</button>
        <button className="rounded border px-3 py-1.5 hover:bg-gray-50" onClick={onArchive}>Archive</button>
        <button className="rounded border px-3 py-1.5 hover:bg-gray-50" onClick={onExport}>Export CSV</button>
        <button className="rounded bg-gray-900 px-3 py-1.5 text-white hover:opacity-90" onClick={onClear}>Clear</button>
      </div>
    </div>
  );
}


===== components\admin\drivers\ui\DriverForm.ui.tsx =====
"use client";
import * as React from "react";
import type { Driver, DriverCreate } from "@/lib/admin/drivers/types";
import { todayISO } from "@/lib/admin/drivers/utils";

type Props = {
  mode: "create" | "edit";
  driver?: Driver;
  onClose: () => void;
  onSubmit: (data: DriverCreate | Partial<Driver>) => void;
};

export default function DriverForm({ mode, driver, onClose, onSubmit }: Props) {
  const [form, setForm] = React.useState<DriverCreate>(() => ({
    employeeNo: driver?.employeeNo ?? "",
    firstName: driver?.firstName ?? "",
    lastName: driver?.lastName ?? "",
    email: driver?.email ?? "",
    phone: driver?.phone ?? "",
    status: driver?.status ?? "active",
    photoUrl: driver?.photoUrl,
    hiredAt: driver?.hiredAt ?? todayISO(),
    license: driver?.license ?? { number: "", category: "B", expiry: todayISO() },
    requirements: driver?.requirements,
    primaryVehicleId: driver?.primaryVehicleId ?? null,
    allowedVehicleTypes: driver?.allowedVehicleTypes ?? ["van","bus","car"],
    notes: driver?.notes ?? ""
  }));

  const handle = (k: any, v: any) => setForm(s => ({ ...s, [k]: v }));

  const submit = (e: React.FormEvent) => {
    e.preventDefault();
    onSubmit(mode === "create" ? form : { ...form });
  };

  return (
    <div className="fixed inset-0 z-50 grid place-items-center bg-black/40 p-4">
      <div className="w-full max-w-2xl rounded-lg bg-white shadow-lg">
        <div className="flex items-center justify-between border-b p-4">
          <h2 className="text-lg font-semibold">{mode === "create" ? "Add Driver" : "Edit Driver"}</h2>
          <button className="rounded px-2 py-1 text-sm hover:bg-gray-100" onClick={onClose}>Close</button>
        </div>

        <form onSubmit={submit} className="grid gap-4 p-4 md:grid-cols-2">
          <label className="grid gap-1">
            <span className="text-xs text-gray-600">Employee #</span>
            <input className="rounded border px-3 py-2" value={form.employeeNo} onChange={e=>handle("employeeNo", e.target.value)} required />
          </label>

          <label className="grid gap-1">
            <span className="text-xs text-gray-600">Status</span>
            <select className="rounded border px-3 py-2" value={form.status} onChange={e=>handle("status", e.target.value)}>
              <option value="active">active</option>
              <option value="suspended">suspended</option>
              <option value="archived">archived</option>
              <option value="pending_verification">pending_verification</option>
            </select>
          </label>

          <label className="grid gap-1">
            <span className="text-xs text-gray-600">First name</span>
            <input className="rounded border px-3 py-2" value={form.firstName} onChange={e=>handle("firstName", e.target.value)} required />
          </label>

          <label className="grid gap-1">
            <span className="text-xs text-gray-600">Last name</span>
            <input className="rounded border px-3 py-2" value={form.lastName} onChange={e=>handle("lastName", e.target.value)} required />
          </label>

          <label className="grid gap-1">
            <span className="text-xs text-gray-600">Email</span>
            <input type="email" className="rounded border px-3 py-2" value={form.email} onChange={e=>handle("email", e.target.value)} required />
          </label>

          <label className="grid gap-1">
            <span className="text-xs text-gray-600">Phone</span>
            <input className="rounded border px-3 py-2" value={form.phone} onChange={e=>handle("phone", e.target.value)} />
          </label>

          <label className="grid gap-1">
            <span className="text-xs text-gray-600">License Number</span>
            <input className="rounded border px-3 py-2" value={form.license.number} onChange={e=>setForm(s=>({...s, license:{...s.license, number: e.target.value}}))} required />
          </label>

          <label className="grid gap-1">
            <span className="text-xs text-gray-600">License Category</span>
            <input className="rounded border px-3 py-2" value={form.license.category} onChange={e=>setForm(s=>({...s, license:{...s.license, category: e.target.value}}))} />
          </label>

          <label className="grid gap-1">
            <span className="text-xs text-gray-600">License Expiry</span>
            <input type="date" className="rounded border px-3 py-2" value={form.license.expiry} onChange={e=>setForm(s=>({...s, license:{...s.license, expiry: e.target.value}}))} />
          </label>

          <label className="grid gap-1 md:col-span-2">
            <span className="text-xs text-gray-600">Notes</span>
            <textarea className="rounded border px-3 py-2" rows={3} value={form.notes} onChange={e=>handle("notes", e.target.value)} />
          </label>

          <div className="md:col-span-2 flex items-center justify-end gap-2 pt-2">
            <button type="button" className="rounded border px-4 py-2 hover:bg-gray-50" onClick={onClose}>Cancel</button>
            <button type="submit" className="rounded bg-[#7a1f2a] px-4 py-2 text-white hover:opacity-90">{mode === "create" ? "Create" : "Save"}</button>
          </div>
        </form>
      </div>
    </div>
  );
}


===== components\admin\drivers\ui\DriverProfile.ui.tsx =====
"use client";
import * as React from "react";
import type { Driver } from "@/lib/admin/drivers/types";
import { complianceInfo } from "@/lib/admin/drivers/utils";

export default function DriverProfile({ driver }: { driver: Driver }) {
  const initials = `${driver.firstName?.[0] ?? ""}${driver.lastName?.[0] ?? ""}`;
  const c = complianceInfo(driver); // { state, className, label }

  return (
    <div className="space-y-4">
      <div className="flex items-center gap-3">
        <div className="grid h-14 w-14 place-items-center rounded-full bg-gray-200 text-sm font-medium">
          {initials}
        </div>
        <div>
          <div className="text-lg font-semibold">
            {driver.firstName} {driver.lastName}
          </div>
          <div className="text-sm text-gray-500">{driver.email}</div>
        </div>
        <div className="ml-auto">
          <span className={`rounded px-2 py-1 text-xs ${c.className}`}>{c.label}</span>
        </div>
      </div>
      {/* Extend with tabs: Overview | Documents | Assignments | Activity */}
    </div>
  );
}


===== components\admin\drivers\ui\DriverRowActions.ui.tsx =====
"use client";
import * as React from "react";

export default function DriverRowActions({ onEdit }: { onEdit: () => void }) {
  return (
    <div className="flex items-center justify-end gap-2">
      <button className="rounded border px-2 py-1 text-xs hover:bg-gray-50" onClick={onEdit}>Edit</button>
      {/* extend: View, Suspend, Reset Access */}
    </div>
  );
}


===== components\admin\drivers\ui\DriversTable.ui.tsx =====
"use client";
import * as React from "react";
import type { Driver } from "@/lib/admin/drivers/types";
import { complianceInfo } from "@/lib/admin/drivers/utils";
import DriverRowActions from "./DriverRowActions.ui";

type Props = {
  rows: Driver[];
  selected: string[];
  onSelectedChange: (ids: string[]) => void;
  onEdit: (id: string) => void;
};

export default function DriversTable({
  rows,
  selected,
  onSelectedChange,
  onEdit,
}: Props) {
  const allChecked = rows.length > 0 && selected.length === rows.length;
  const toggleAll = () =>
    onSelectedChange(allChecked ? [] : rows.map((r) => r.id));
  const toggleOne = (id: string) =>
    onSelectedChange(
      selected.includes(id)
        ? selected.filter((x) => x !== id)
        : [...selected, id]
    );

  return (
    <div className="overflow-auto rounded-lg border bg-white">
      <table className="min-w-full text-sm">
        <thead className="bg-gray-50 text-xs uppercase text-gray-600">
          <tr>
            <th className="p-3">
              <input
                type="checkbox"
                checked={allChecked}
                onChange={toggleAll}
              />
            </th>
            <th className="p-3 text-left">Driver</th>
            <th className="p-3 text-left">Employee #</th>
            <th className="p-3 text-left">Status</th>
            <th className="p-3 text-left">License</th>
            <th className="p-3 text-left">Compliance</th>
            <th className="p-3 text-left">Primary Vehicle</th>
            <th className="p-3">Actions</th>
          </tr>
        </thead>
        <tbody>
          {rows.map((r) => (
            <tr key={r.id} className="border-t hover:bg-gray-50">
              <td className="p-3">
                <input
                  type="checkbox"
                  checked={selected.includes(r.id)}
                  onChange={() => toggleOne(r.id)}
                />
              </td>
              <td className="p-3">
                <div className="flex items-center gap-2">
                  <div className="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center">
                    <span className="text-xs font-medium">
                      {r.firstName[0]}
                      {r.lastName[0]}
                    </span>
                  </div>
                  <div>
                    <div className="font-medium">
                      {r.firstName} {r.lastName}
                    </div>
                    <div className="text-xs text-gray-500">{r.email}</div>
                  </div>
                </div>
              </td>
              <td className="p-3">{r.employeeNo}</td>
              <td className="p-3">
                <span
                  className={`rounded px-2 py-1 text-xs ${
                    r.status === "active"
                      ? "bg-green-100 text-green-700"
                      : r.status === "suspended"
                      ? "bg-yellow-100 text-yellow-700"
                      : "bg-gray-200 text-gray-700"
                  }`}
                >
                  {r.status}
                </span>
              </td>
              <td className="p-3">
                {r.license.category} · {r.license.number}
                <div className="text-xs text-gray-500">
                  exp {r.license.expiry}
                </div>
              </td>
              <td className="p-3">
                {(() => {
                  const c = complianceInfo(r);
                  return (
                    <span
                      className={`rounded px-2 py-1 text-xs ${c.className}`}
                    >
                      {c.label}
                    </span>
                  );
                })()}
              </td>
              <td className="p-3">{r.primaryVehicleId ?? "—"}</td>
              <td className="p-3">
                <DriverRowActions onEdit={() => onEdit(r.id)} />
              </td>
            </tr>
          ))}
          {rows.length === 0 && (
            <tr>
              <td colSpan={8} className="p-10 text-center text-gray-500">
                No drivers found.
              </td>
            </tr>
          )}
        </tbody>
      </table>
    </div>
  );
}


===== components\admin\drivers\ui\FiltersBar.ui.tsx =====
"use client";
import * as React from "react";
import DriverStatusDropdown from "../filters/DriverStatusDropdown.ui";
import ComplianceDropdown from "../filters/ComplianceDropdown.ui";

type Filters = { search?: string; status?: string; compliant?: "ok"|"warn"|"bad"|"" };
type Props = {
  value: Filters;
  onChange: (v: Filters) => void;
  onAdd: () => void;
};

export default function FiltersBar({ value, onChange, onAdd }: Props) {
  const set = (patch: Partial<Filters>) => onChange({ ...value, ...patch });

  return (
    <div className="flex flex-wrap items-center gap-2 rounded-lg border bg-white p-3">
      <input
        placeholder="Search name, employee #, license #"
        className="min-w-[260px] flex-1 rounded border px-3 py-2"
        value={value.search ?? ""}
        onChange={(e)=>set({ search: e.target.value })}
      />
      <DriverStatusDropdown value={value.status ?? ""} onChange={(v)=>set({ status: v })} />
      <ComplianceDropdown value={value.compliant ?? ""} onChange={(v)=>set({ compliant: v as any })} />
      <button className="ml-auto rounded bg-[#7a1f2a] px-3 py-2 text-white hover:opacity-90" onClick={onAdd}>
        Add Driver
      </button>
      <button className="rounded border px-3 py-2 hover:bg-gray-50" onClick={()=>onChange({})}>Clear</button>
    </div>
  );
}


===== components\admin\drivers\ui\index.ts =====
export { default as DriversTable } from "./DriversTable.ui";
export { default as DriverRowActions } from "./DriverRowActions.ui";
export { default as DriverForm } from "./DriverForm.ui";
export { default as DriverProfile } from "./DriverProfile.ui";
export { default as FiltersBar } from "./FiltersBar.ui";
export { default as BulkBar } from "./BulkBar.ui";


===== components\admin\logs\FiltersBar.ui.tsx =====
"use client";
import * as React from "react";
import { Search } from "lucide-react";
import type { LogFilters } from "@/lib/admin/logs/types";
import { LogConstants } from "@/lib/admin/logs/service";

export function LogsFiltersBar({
  value, onChange, onClear
}: {
  value: LogFilters;
  onChange: (v: LogFilters) => void;
  onClear: () => void;
}) {
  return (
    <div className="flex flex-wrap items-center gap-2 rounded-lg border bg-white p-2">
      <div className="flex items-center gap-2 px-2 py-1.5 rounded-md border">
        <Search size={16} className="opacity-60" />
        <input
          placeholder="Search actor, entity, details…"
          className="outline-none text-sm"
          value={value.search ?? ""}
          onChange={e => onChange({ ...value, search: e.target.value })}
        />
      </div>

      <select className="rounded-md border px-2 py-1.5 text-sm bg-white"
        value={value.actorType ?? ""} onChange={e=>onChange({ ...value, actorType: e.target.value as any })}
      >
        <option value="">All Actors</option>
        {LogConstants.actorTypes.map(a => <option key={a} value={a}>{a}</option>)}
      </select>

      <select className="rounded-md border px-2 py-1.5 text-sm bg-white"
        value={value.entityType ?? ""} onChange={e=>onChange({ ...value, entityType: e.target.value as any })}
      >
        <option value="">All Entities</option>
        {LogConstants.entityTypes.map(t => <option key={t} value={t}>{t}</option>)}
      </select>

      <select className="rounded-md border px-2 py-1.5 text-sm bg-white"
        value={value.action ?? ""} onChange={e=>onChange({ ...value, action: e.target.value as any })}
      >
        <option value="">All Actions</option>
        {LogConstants.actions.map(a => <option key={a} value={a}>{a}</option>)}
      </select>

      <select className="rounded-md border px-2 py-1.5 text-sm bg-white"
        value={value.severity ?? ""} onChange={e=>onChange({ ...value, severity: e.target.value as any })}
      >
        <option value="">All Severity</option>
        {LogConstants.severities.map(s => <option key={s} value={s}>{s}</option>)}
      </select>

      <input type="date" className="rounded-md border px-2 py-1.5 text-sm bg-white"
        value={value.dateFrom ?? ""} onChange={e=>onChange({ ...value, dateFrom: e.target.value })} title="From" />
      <input type="date" className="rounded-md border px-2 py-1.5 text-sm bg-white"
        value={value.dateTo ?? ""} onChange={e=>onChange({ ...value, dateTo: e.target.value })} title="To" />

      <button onClick={onClear} className="ml-auto px-3 py-1.5 text-sm rounded-md border hover:bg-gray-50">
        Clear
      </button>
    </div>
  );
}


===== components\admin\logs\LogDetails.ui.tsx =====
"use client";
import * as React from "react";
import type { LogEntry } from "@/lib/admin/logs/types";

export function LogDetails({ log, onClose }: { log: LogEntry; onClose: () => void }) {
  return (
    <div className="fixed inset-0 bg-black/40 grid place-items-center z-50">
      <div className="w-[min(720px,96vw)] max-h-[90vh] overflow-auto bg-white rounded-xl p-4 shadow-xl">
        <div className="flex items-center justify-between mb-3">
          <h3 className="text-lg font-semibold">Log Details</h3>
          <button onClick={onClose} className="px-2 py-1 rounded-md border bg-white">Close</button>
        </div>

        <div className="grid gap-2 text-sm">
          <Row k="Time" v={new Date(log.timestampISO).toLocaleString()} />
          <Row k="Actor" v={`${log.actorName} (${log.actorType})`} />
          <Row k="Action" v={log.action} />
          <Row k="Entity" v={`${log.entityType}${log.entityLabel ? ` • ${log.entityLabel}` : ""}`} />
          <Row k="Severity" v={log.severity} />
          {log.ip && <Row k="IP" v={log.ip} />}
          <div>
            <div className="text-gray-500 mb-1">Details</div>
            <pre className="text-xs bg-gray-50 rounded-md p-3 whitespace-pre-wrap">{log.details ?? "-"}</pre>
          </div>
        </div>
      </div>
    </div>
  );
}

function Row({ k, v }: { k: string; v: string }) {
  return (
    <div className="grid grid-cols-[140px_1fr] gap-3">
      <div className="text-gray-500">{k}</div>
      <div className="text-gray-800">{v}</div>
    </div>
  );
}


===== components\admin\logs\LogsTable.ui.tsx =====
"use client";
import * as React from "react";
import { Trash2, Eye } from "lucide-react";
import type { LogEntry } from "@/lib/admin/logs/types";

export function LogsTable({
  rows, selection, setSelection, onView, onDelete
}: {
  rows: LogEntry[];
  selection: string[];
  setSelection: (ids: string[]) => void;
  onView: (id: string) => void;
  onDelete: (id: string) => void;
}) {
  const all = rows.length > 0 && selection.length === rows.length;
  const toggleAll = () => setSelection(all ? [] : rows.map(r => r.id));
  const toggleOne = (id: string) => setSelection(selection.includes(id) ? selection.filter(x=>x!==id) : [...selection, id]);

  const sevBadge = (s: LogEntry["severity"]) =>
    s === "error" ? "bg-rose-100 text-rose-700" : s === "warning" ? "bg-amber-100 text-amber-700" : "bg-gray-100 text-gray-700";

  return (
    <div className="overflow-x-auto rounded-lg border bg-white">
      <table className="min-w-[1000px] w-full text-sm">
        <thead className="bg-gray-50 text-gray-600">
          <tr>
            <th className="w-10 p-2"><input type="checkbox" checked={all} onChange={toggleAll}/></th>
            <th className="p-2 text-left">Time</th>
            <th className="p-2 text-left">Actor</th>
            <th className="p-2 text-left">Action</th>
            <th className="p-2 text-left">Entity</th>
            <th className="p-2 text-left">Severity</th>
            <th className="p-2 text-left">Details</th>
            <th className="p-2"></th>
          </tr>
        </thead>
        <tbody>
          {rows.map(r => (
            <tr key={r.id} className="border-t">
              <td className="p-2"><input type="checkbox" checked={selection.includes(r.id)} onChange={()=>toggleOne(r.id)}/></td>
              <td className="p-2 whitespace-nowrap">{new Date(r.timestampISO).toLocaleString()}</td>
              <td className="p-2">{r.actorName} <span className="text-gray-500">({r.actorType})</span></td>
              <td className="p-2">{r.action}</td>
              <td className="p-2">{r.entityType}{r.entityLabel ? ` • ${r.entityLabel}` : ""}</td>
              <td className="p-2"><span className={`px-2 py-0.5 rounded-full text-xs ${sevBadge(r.severity)}`}>{r.severity}</span></td>
              <td className="p-2 max-w-[420px] truncate">{r.details ?? "-"}</td>
              <td className="p-2">
                <div className="flex justify-end gap-1.5">
                  <button onClick={()=>onView(r.id)} className="p-1.5 border rounded-md hover:bg-gray-50" title="View"><Eye size={16}/></button>
                  <button onClick={()=>onDelete(r.id)} className="p-1.5 border rounded-md hover:bg-gray-50" title="Delete"><Trash2 size={16}/></button>
                </div>
              </td>
            </tr>
          ))}
          {rows.length === 0 && (
            <tr><td className="p-6 text-center text-gray-500" colSpan={8}>No logs</td></tr>
          )}
        </tbody>
      </table>
    </div>
  );
}


===== components\admin\logs\SummaryCards.ui.tsx =====
"use client";
import * as React from "react";

const brand = "#7a0019";

export function SummaryCards({
  total, info, warning, error, topActions, trend7d
}: {
  total: number;
  info: number;
  warning: number;
  error: number;
  topActions: [string, number][];
  trend7d: { day: string; count: number }[];
}) {
  return (
    <div className="grid gap-3 md:grid-cols-4">
      <Card title="Total Logs" value={total} />
      <Card title="Info" value={info} pillClass="bg-gray-100 text-gray-700" />
      <Card title="Warnings" value={warning} pillClass="bg-amber-100 text-amber-700" />
      <Card title="Errors" value={error} pillClass="bg-rose-100 text-rose-700" />

      {/* Trend card spans full width */}
      <div className="md:col-span-2 rounded-xl border bg-white p-4">
        <div className="flex items-center justify-between mb-2">
          <h3 className="font-medium">Activity (last 7 days)</h3>
        </div>
        <MiniBar data={trend7d} />
      </div>

      {/* Top actions */}
      <div className="md:col-span-2 rounded-xl border bg-white p-4">
        <div className="flex items-center justify-between mb-2">
          <h3 className="font-medium">Top Actions</h3>
        </div>
        <ul className="space-y-2">
          {topActions.map(([name, cnt]) => (
            <li key={name} className="flex items-center gap-3">
              <div className="w-28 text-sm text-gray-600">{name}</div>
              <div className="flex-1 h-2 rounded-full bg-gray-100 overflow-hidden">
                <div className="h-full" style={{ width: `${Math.min(100, (cnt / (topActions[0]?.[1] || 1)) * 100)}%`, background: brand }} />
              </div>
              <div className="w-10 text-right text-sm">{cnt}</div>
            </li>
          ))}
          {topActions.length === 0 && <div className="text-sm text-gray-500">No data</div>}
        </ul>
      </div>
    </div>
  );
}

function Card({ title, value, pillClass }: { title: string; value: number; pillClass?: string }) {
  return (
    <div className="rounded-xl border bg-white p-4">
      <div className="text-sm text-gray-600">{title}</div>
      <div className="mt-1 text-2xl font-semibold">{value.toLocaleString()}</div>
      {pillClass && <div className={`mt-2 inline-block px-2 py-0.5 rounded-full text-xs ${pillClass}`}>today</div>}
    </div>
  );
}

// simple bar chart (no external lib)
function MiniBar({ data }: { data: { day: string; count: number }[] }) {
  const max = Math.max(1, ...data.map(d => d.count));
  return (
    <div className="grid grid-cols-7 gap-2 items-end h-24">
      {data.map(d => (
        <div key={d.day} className="flex flex-col items-center gap-1">
          <div
            className="w-full rounded"
            style={{ height: `${(d.count / max) * 96}%`, background: brand }}
            title={`${d.day}: ${d.count}`}
          />
          <div className="text-[10px] text-gray-500">{d.day.slice(5)}</div>
        </div>
      ))}
    </div>
  );
}


===== components\admin\maintenance\FiltersBar.ui.tsx =====
"use client";
import * as React from "react";
import { Search } from "lucide-react";
import type { MaintFilters } from "@/lib/admin/maintenance/types";
import { MaintConstants } from "@/lib/admin/maintenance/service";

export function MaintFiltersBar({
  value, onChange, onClear
}: {
  value: MaintFilters;
  onChange: (v: MaintFilters) => void;
  onClear: () => void;
}) {
  return (
    <div className="flex flex-wrap items-center gap-2 rounded-lg border bg-white p-2">
      <div className="flex items-center gap-2 px-2 py-1.5 rounded-md border">
        <Search size={16} className="opacity-60" />
        <input
          placeholder="Search vehicle, plate, description…"
          className="outline-none text-sm"
          value={value.search ?? ""}
          onChange={e => onChange({ ...value, search: e.target.value })}
        />
      </div>

      <select
        className="rounded-md border px-2 py-1.5 text-sm bg-white"
        value={value.type ?? ""}
        onChange={e => onChange({ ...value, type: e.target.value as any })}
      >
        <option value="">All Types</option>
        {MaintConstants.types.map(t => <option key={t} value={t}>{t}</option>)}
      </select>

      <select
        className="rounded-md border px-2 py-1.5 text-sm bg-white"
        value={value.status ?? ""}
        onChange={e => onChange({ ...value, status: e.target.value as any })}
      >
        <option value="">All Status</option>
        {MaintConstants.statuses.map(s => <option key={s} value={s}>{s}</option>)}
      </select>

      <button
        onClick={onClear}
        className="ml-auto px-3 py-1.5 text-sm rounded-md border hover:bg-gray-50"
      >
        Clear
      </button>
    </div>
  );
}


===== components\admin\maintenance\MaintForm.ui.tsx =====
"use client";
import * as React from "react";
import type { Maintenance } from "@/lib/admin/maintenance/types";
import { TextInput, NumberInput, DateInput, SelectInput } from "@/components/common/forms/Inputs";

const BRAND = "#7a0019";

export function MaintForm({
  initial, onCancel, onSubmit
}: {
  initial?: Partial<Maintenance>;
  onCancel: () => void;
  onSubmit: (data: Omit<Maintenance,"id"|"createdAt"|"updatedAt">) => void;
}) {
  const [form, setForm] = React.useState<Omit<Maintenance,"id"|"createdAt"|"updatedAt">>(() => ({
    vehicleId: initial?.vehicleId ?? "",
    vehicleCode: initial?.vehicleCode ?? "",
    plateNo: initial?.plateNo ?? "",
    type: (initial?.type as any) ?? "Preventive",
    description: initial?.description ?? "",
    odometerKm: initial?.odometerKm ?? 0,
    requestDate: initial?.requestDate ?? new Date().toISOString().slice(0,10),
    serviceDate: initial?.serviceDate ?? "",
    status: (initial?.status as any) ?? "draft",
    photoUrl: initial?.photoUrl ?? null,
    remarks: initial?.remarks ?? "",
  }));

  return (
    <form onSubmit={(e)=>{ e.preventDefault(); onSubmit(form); }} className="grid gap-3">
      <div className="grid sm:grid-cols-2 gap-3">
        <TextInput label="Vehicle Code" value={form.vehicleCode} onChange={v=>setForm(f=>({...f, vehicleCode:v}))}/>
        <TextInput label="Plate No." value={form.plateNo} onChange={v=>setForm(f=>({...f, plateNo:v}))}/>
      </div>

      <div className="grid sm:grid-cols-2 gap-3">
        <SelectInput label="Type" value={form.type} options={["Preventive","Repair","Inspection"]} onChange={v=>setForm(f=>({...f, type:v as any}))}/>
        <SelectInput label="Status" value={form.status} options={["draft","submitted","acknowledged","in-progress","completed","rejected"]} onChange={v=>setForm(f=>({...f, status:v as any}))}/>
      </div>

      <TextInput label="Description" value={form.description} onChange={v=>setForm(f=>({...f, description:v}))}/>
      <NumberInput label="Odometer (km)" value={form.odometerKm} min={0} onChange={v=>setForm(f=>({...f, odometerKm:v}))}/>

      <div className="grid sm:grid-cols-2 gap-3">
        <DateInput label="Request Date" value={form.requestDate} onChange={v=>setForm(f=>({...f, requestDate:v}))}/>
        <DateInput label="Service Date" value={form.serviceDate ?? ""} onChange={v=>setForm(f=>({...f, serviceDate:v}))}/>
      </div>

      <TextInput label="Remarks" value={form.remarks ?? ""} onChange={v=>setForm(f=>({...f, remarks:v}))}/>

      <div className="flex justify-end gap-2 pt-2">
        <button type="button" onClick={onCancel} className="px-3 py-1.5 rounded-md border bg-white">Cancel</button>
        <button type="submit" className="px-3 py-1.5 rounded-md text-white" style={{ background: BRAND }}>
          Save
        </button>
      </div>
    </form>
  );
}


===== components\admin\maintenance\MaintTable.ui.tsx =====
"use client";
import * as React from "react";
import { Edit, Trash2 } from "lucide-react";
import type { Maintenance } from "@/lib/admin/maintenance/types";

export function MaintTable({
  rows, selection, setSelection, onEdit, onDelete
}: {
  rows: Maintenance[];
  selection: string[];
  setSelection: (ids: string[]) => void;
  onEdit: (id: string) => void;
  onDelete: (id: string) => void;
}) {
  const all = rows.length > 0 && selection.length === rows.length;
  const toggleAll = () => setSelection(all ? [] : rows.map(r => r.id));
  const toggleOne = (id: string) =>
    setSelection(selection.includes(id) ? selection.filter(x => x !== id) : [...selection, id]);

  return (
    <div className="overflow-x-auto rounded-lg border bg-white">
      <table className="min-w-[980px] w-full text-sm">
        <thead className="bg-gray-50 text-gray-600">
          <tr>
            <th className="w-10 p-2 text-left">
              <input type="checkbox" checked={all} onChange={toggleAll} />
            </th>
            <th className="p-2 text-left">Vehicle</th>
            <th className="p-2 text-left">Plate</th>
            <th className="p-2 text-left">Type</th>
            <th className="p-2 text-left">Description</th>
            <th className="p-2 text-right">Odometer</th>
            <th className="p-2 text-left">Request</th>
            <th className="p-2 text-left">Service</th>
            <th className="p-2 text-left">Status</th>
            <th className="p-2"></th>
          </tr>
        </thead>
        <tbody>
          {rows.map(m => (
            <tr key={m.id} className="border-top">
              <td className="p-2">
                <input
                  type="checkbox"
                  checked={selection.includes(m.id)}
                  onChange={() => toggleOne(m.id)}
                />
              </td>
              <td className="p-2">{m.vehicleCode}</td>
              <td className="p-2">{m.plateNo}</td>
              <td className="p-2">{m.type}</td>
              <td className="p-2">{m.description}</td>
              <td className="p-2 text-right">{m.odometerKm.toLocaleString()} km</td>
              <td className="p-2">{m.requestDate}</td>
              <td className="p-2">{m.serviceDate ?? "-"}</td>
              <td className="p-2">
                <span className="px-2 py-0.5 rounded-full bg-gray-100">{m.status}</span>
              </td>
              <td className="p-2">
                <div className="flex justify-end gap-1.5">
                  <button
                    onClick={() => onEdit(m.id)}
                    className="p-1.5 border rounded-md hover:bg-gray-50"
                  >
                    <Edit size={16} />
                  </button>
                  <button
                    onClick={() => onDelete(m.id)}
                    className="p-1.5 border rounded-md hover:bg-gray-50"
                  >
                    <Trash2 size={16} />
                  </button>
                </div>
              </td>
            </tr>
          ))}
          {rows.length === 0 && (
            <tr>
              <td colSpan={10} className="p-6 text-center text-gray-500">
                No records
              </td>
            </tr>
          )}
        </tbody>
      </table>
    </div>
  );
}


===== components\admin\modals\MaintenanceModal.tsx =====
"use client";

import { useEffect } from "react";

export default function MaintenanceModal({
  open,
  onClose,
}: {
  open: boolean;
  onClose: () => void;
}) {
  useEffect(() => {
    const onEsc = (e: KeyboardEvent) => e.key === "Escape" && onClose();
    document.addEventListener("keydown", onEsc);
    return () => document.removeEventListener("keydown", onEsc);
  }, [onClose]);

  if (!open) return null;

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
      <div className="absolute inset-0 bg-black/40" onClick={onClose} />
      <div className="relative w-full max-w-xl rounded-xl bg-white p-4 shadow-2xl">
        <div className="mb-3 flex items-center justify-between">
          <h3 className="text-base font-semibold">New Maintenance Log</h3>
          <button onClick={onClose} className="rounded-md p-1 hover:bg-neutral-100">✕</button>
        </div>

        <div className="grid grid-cols-1 gap-3 sm:grid-cols-2">
          <label className="flex flex-col gap-1">
            <span className="text-xs text-neutral-600">Vehicle</span>
            <input className="rounded-md border px-2 py-1.5 text-sm" placeholder="e.g., VAN-12" />
          </label>
          <label className="flex flex-col gap-1">
            <span className="text-xs text-neutral-600">Type</span>
            <select className="rounded-md border px-2 py-1.5 text-sm">
              <option>Corrective</option>
              <option>Preventive</option>
            </select>
          </label>
          <label className="flex flex-col gap-1">
            <span className="text-xs text-neutral-600">Odometer</span>
            <input type="number" className="rounded-md border px-2 py-1.5 text-sm" placeholder="km" />
          </label>
          <label className="flex flex-col gap-1">
            <span className="text-xs text-neutral-600">Date</span>
            <input type="date" className="rounded-md border px-2 py-1.5 text-sm" />
          </label>
          <label className="col-span-full flex flex-col gap-1">
            <span className="text-xs text-neutral-600">Notes</span>
            <textarea className="min-h-[80px] rounded-md border px-2 py-1.5 text-sm" placeholder="Work performed, parts used…" />
          </label>
        </div>

        <div className="mt-4 flex items-center justify-end gap-2">
          <button onClick={onClose} className="rounded-md border px-3 py-1.5 text-sm hover:bg-neutral-50">
            Cancel
          </button>
          <button className="rounded-md bg-[#7A0010] px-3 py-1.5 text-sm font-medium text-white hover:bg-[#60000C]">
            Save
          </button>
        </div>
      </div>
    </div>
  );
}


===== components\admin\modals\ScheduleModal.tsx =====
"use client";

import { useEffect, useRef } from "react";

export default function ScheduleModal({
  open,
  onClose,
}: {
  open: boolean;
  onClose: () => void;
}) {
  const dialogRef = useRef<HTMLDivElement>(null);
  useEffect(() => {
    const onEsc = (e: KeyboardEvent) => e.key === "Escape" && onClose();
    document.addEventListener("keydown", onEsc);
    return () => document.removeEventListener("keydown", onEsc);
  }, [onClose]);

  if (!open) return null;

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
      <div className="absolute inset-0 bg-black/40" onClick={onClose} />
      <div
        ref={dialogRef}
        role="dialog"
        aria-modal="true"
        className="relative w-full max-w-xl rounded-xl bg-white p-4 shadow-2xl"
      >
        <div className="mb-3 flex items-center justify-between">
          <h3 className="text-base font-semibold">Create Schedule</h3>
          <button onClick={onClose} className="rounded-md p-1 hover:bg-neutral-100">
            ✕
          </button>
        </div>

        <div className="grid grid-cols-1 gap-3 sm:grid-cols-2">
          <label className="flex flex-col gap-1">
            <span className="text-xs text-neutral-600">Vehicle</span>
            <input className="rounded-md border px-2 py-1.5 text-sm" placeholder="e.g., VAN-12" />
          </label>
          <label className="flex flex-col gap-1">
            <span className="text-xs text-neutral-600">Driver</span>
            <input className="rounded-md border px-2 py-1.5 text-sm" placeholder="Driver name" />
          </label>
          <label className="flex flex-col gap-1">
            <span className="text-xs text-neutral-600">Start date</span>
            <input type="date" className="rounded-md border px-2 py-1.5 text-sm" />
          </label>
          <label className="flex flex-col gap-1">
            <span className="text-xs text-neutral-600">End date</span>
            <input type="date" className="rounded-md border px-2 py-1.5 text-sm" />
          </label>
          <label className="col-span-full flex items-center gap-2">
            <input type="checkbox" className="h-4 w-4" />
            <span className="text-sm">Recurring (weekly)</span>
          </label>
        </div>

        <div className="mt-4 flex items-center justify-end gap-2">
          <button onClick={onClose} className="rounded-md border px-3 py-1.5 text-sm hover:bg-neutral-50">
            Cancel
          </button>
          <button className="rounded-md bg-[#7A0010] px-3 py-1.5 text-sm font-medium text-white hover:bg-[#60000C]">
            Save
          </button>
        </div>
      </div>
    </div>
  );
}


===== components\admin\nav\ActionsGroup.tsx =====
"use client";

import { useEffect, useRef, useState } from "react";
import Link from "next/link";
import ScheduleModal from "../modals/ScheduleModal";
import MaintenanceModal from "../modals/MaintenanceModal";

const BRAND = "#7A0010";
const BRAND_HOVER = "#60000C";

export default function ActionsGroup() {
  const [openSched, setOpenSched] = useState(false);
  const [openMaint, setOpenMaint] = useState(false);

  return (
    <div className="flex items-center gap-3">
      {/* New Request (route) */}
      <Link
        href="/admin/requests/new"
        className="inline-flex items-center rounded-full px-4 py-2 text-sm font-semibold text-white shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50"
        style={{ background: BRAND }}
        onMouseOver={(e) => (e.currentTarget.style.background = BRAND_HOVER)}
        onMouseOut={(e) => (e.currentTarget.style.background = BRAND)}
      >
        + New Request
      </Link>

      {/* Schedule split */}
      <SplitDropdown
        label="+ Schedule"
        onPrimary={() => setOpenSched(true)}
        items={[
          { label: "Create schedule", href: "/admin/schedules/new" },
          { label: "Recurring template", href: "/admin/schedules/recurring/new" },
          { label: "Import from CSV", href: "/admin/schedules/import" },
        ]}
      />

      {/* Maintenance split */}
      <SplitDropdown
        label="+ Maintenance"
        onPrimary={() => setOpenMaint(true)}
        items={[
          { label: "New maintenance log", href: "/admin/maintenance/new" },
          { label: "Preventive schedule", href: "/admin/maintenance/preventive" },
          { label: "Parts inventory", href: "/admin/maintenance/inventory" },
        ]}
      />

      {/* Modals */}
      <ScheduleModal open={openSched} onClose={() => setOpenSched(false)} />
      <MaintenanceModal open={openMaint} onClose={() => setOpenMaint(false)} />
    </div>
  );
}

function SplitDropdown({
  label,
  onPrimary,
  items,
}: {
  label: string;
  onPrimary: () => void;
  items: { label: string; href: string }[];
}) {
  const [open, setOpen] = useState(false);
  const ref = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const clickAway = (e: MouseEvent) => {
      if (!ref.current) return;
      if (open && !ref.current.contains(e.target as Node)) setOpen(false);
    };
    const onEsc = (e: KeyboardEvent) => e.key === "Escape" && setOpen(false);
    document.addEventListener("click", clickAway);
    document.addEventListener("keydown", onEsc);
    return () => {
      document.removeEventListener("click", clickAway);
      document.removeEventListener("keydown", onEsc);
    };
  }, [open]);

  return (
    <div ref={ref} className="relative">
      <div className="flex overflow-hidden rounded-full shadow-sm ring-1 ring-white/20">
        <button
          className="bg-white/14 px-4 py-2 text-sm font-medium text-white hover:bg-white/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50"
          onClick={onPrimary}
        >
          {label}
        </button>
        <button
          className="bg-white/10 px-2 text-white hover:bg-white/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50"
          aria-haspopup="menu"
          aria-expanded={open}
          onClick={() => setOpen((v) => !v)}
        >
          <svg className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
            <path d="M5.5 7 10 11.5 14.5 7l1 1L10 14 4.5 8l1-1Z" />
          </svg>
        </button>
      </div>

      {open && (
        <div className="absolute right-0 z-50 mt-2 min-w-[220px] rounded-lg bg-white p-1 text-neutral-900 shadow-2xl ring-1 ring-black/10">
          {items.map((it) => (
            <Link
              key={it.label}
              href={it.href}
              className="block rounded-md px-3 py-2 text-sm hover:bg-neutral-50"
              onClick={() => setOpen(false)}
            >
              {it.label}
            </Link>
          ))}
        </div>
      )}
    </div>
  );
}


===== components\admin\nav\AdminLeftNav.tsx =====
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import * as React from "react";
import {
  LayoutDashboard,
  FileText,
  CalendarDays,
  Users,
  Truck,
  Wrench,
  MapPin,
  History,
  FileBarChart,
  Settings,
  ChevronLeft,
  ChevronRight,
  Search,
} from "lucide-react";

/* ---------- constants ---------- */

const BRAND = "#7a1f2a";
const NAV_W_OPEN = 256;
const NAV_W_COLLAPSED = 64;

type Item = { href: string; label: string; Icon: React.ComponentType<any> };

const NAV: Item[] = [
  { href: "/admin", label: "Dashboard", Icon: LayoutDashboard },
  { href: "/admin/requests", label: "Requests", Icon: FileText },
  { href: "/admin/schedule", label: "Schedule", Icon: CalendarDays },
  { href: "/admin/drivers", label: "Drivers", Icon: Users },
  { href: "/admin/vehicles", label: "Vehicles", Icon: Truck },
  { href: "/admin/maintenance", label: "Maintenance", Icon: Wrench },
  { href: "/admin/track", label: "Track / Live", Icon: MapPin },
  { href: "/admin/history", label: "History / Logs", Icon: History },
  { href: "/admin/reports", label: "Reports / Exports", Icon: FileBarChart },
  { href: "/admin/settings", label: "Settings", Icon: Settings },
];

/* ---------- component ---------- */

export default function AdminLeftNav() {
  const pathname = usePathname();
  const [collapsed, setCollapsed] = React.useState(false);

  // Persist collapse state
  React.useEffect(() => {
    const raw = localStorage.getItem("tl.nav.collapsed");
    if (raw) setCollapsed(raw === "1");
  }, []);
  React.useEffect(() => {
    localStorage.setItem("tl.nav.collapsed", collapsed ? "1" : "0");
  }, [collapsed]);

  // Hotkey: Ctrl+B or [
  React.useEffect(() => {
    function onKey(e: KeyboardEvent) {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "b") {
        e.preventDefault();
        setCollapsed((v) => !v);
      }
      if (!e.ctrlKey && !e.metaKey && e.key === "[") {
        setCollapsed((v) => !v);
      }
    }
    window.addEventListener("keydown", onKey);
    return () => window.removeEventListener("keydown", onKey);
  }, []);

  // When collapsed, clicking anywhere on the rail (except the icon/links/toggle) expands
  function onRootClick(e: React.MouseEvent) {
    if (!collapsed) return;
    const el = e.target as HTMLElement;
    const hitInteractive =
      el.closest("[data-nav-link='true']") ||
      el.closest("[data-nav-toggle='true']");
    if (!hitInteractive) setCollapsed(false);
  }

  return (
    <div
      onClick={onRootClick}
      style={
        {
          width: collapsed ? NAV_W_COLLAPSED : NAV_W_OPEN,
          background: collapsed ? BRAND : "white",
        } as React.CSSProperties
      }
      className={[
        "relative h-full select-none border-r border-neutral-200",
        "overflow-y-auto no-scrollbar",
        collapsed ? "text-white" : "text-neutral-800",
      ].join(" ")}
    >
      {/* ---------- Top row: Search + Toggle (HCI-friendly) ---------- */}
      <div className={collapsed ? "px-2 pt-2 pb-1" : "px-3 pt-3 pb-2"}>
        <div className="flex items-center gap-2">
          {!collapsed && (
            <div className="flex-1">
              <label className="sr-only">Search</label>
              <div className="flex items-center rounded-lg border border-neutral-300 bg-white px-2 py-1.5 shadow-sm">
                <Search className="mr-2 h-4 w-4 text-neutral-400" />
                <input
                  placeholder="Search…"
                  className="w-full bg-transparent text-sm outline-none placeholder:text-neutral-400"
                />
              </div>
            </div>
          )}

          {/* Top-right toggle (small, easy target) */}
          <button
            type="button"
            data-nav-toggle="true"
            onClick={(e) => {
              e.stopPropagation();
              setCollapsed((v) => !v);
            }}
            title={collapsed ? "Expand sidebar (Ctrl+B)" : "Collapse sidebar (Ctrl+B)"}
            aria-label={collapsed ? "Expand sidebar" : "Collapse sidebar"}
            className={[
              "shrink-0 rounded-full border",
              collapsed
                ? "border-white/25 bg-white/15 text-white hover:bg-white/25"
                : "border-neutral-200 bg-white text-neutral-600 hover:bg-neutral-50",
              "shadow-sm p-1.5 transition",
            ].join(" ")}
          >
            {collapsed ? (
              <ChevronRight className="h-4 w-4" />
            ) : (
              <ChevronLeft className="h-4 w-4" />
            )}
          </button>
        </div>

        {/* Section label when expanded */}
        {!collapsed && (
          <div className="mt-3 px-1 text-[11px] font-semibold tracking-wider text-neutral-500">
            TRAVILINK
          </div>
        )}
      </div>

      {/* ---------- Nav list ---------- */}
      <ul className="space-y-1 px-2">
        {NAV.map(({ href, label, Icon }) => {
          const active =
            pathname === href || (href !== "/admin" && (pathname ?? "").startsWith(href));

          const itemBase = collapsed
            ? "flex items-center justify-center"
            : "flex items-center gap-3";

          const activeBg = collapsed ? "bg-white/12" : "bg-neutral-100";
          const hoverBg = collapsed ? "hover:bg-white/10" : "hover:bg-neutral-50";

          return (
            <li key={href}>
              <Link
                href={href}
                data-nav-link="true"
                title={collapsed ? label : undefined}
                onClick={(e) => {
                  if (collapsed) e.stopPropagation();
                }}
                className={[
                  "group relative rounded-lg px-3 py-2 text-sm transition",
                  itemBase,
                  active ? activeBg : hoverBg,
                ].join(" ")}
                style={{ ["--brand" as any]: BRAND }}
              >
                {/* Thin active indicator (left) – only when expanded */}
                {!collapsed && (
                  <span
                    className={[
                      "pointer-events-none absolute left-0 top-1/2 -translate-y-1/2",
                      "h-5 w-0.5 rounded",
                      active ? "bg-[var(--brand)]" : "bg-transparent group-hover:bg-neutral-300",
                    ].join(" ")}
                  />
                )}

                {/* Icon (maroon), no border */}
                <Icon
                  className={[
                    "h-5 w-5 transition-colors",
                    collapsed
                      ? "text-white"
                      : active
                      ? "text-[var(--brand)]"
                      : "text-[var(--brand)]",
                    !collapsed ? "group-hover:text-[#5e1620]" : "",
                  ].join(" ")}
                />

                {/* Label (hidden when collapsed) */}
                {!collapsed && <span className="truncate">{label}</span>}
              </Link>
            </li>
          );
        })}
      </ul>

      {/* Bottom spacer so last item isn’t clipped */}
      <div className="h-6" />
    </div>
  );
}


===== components\admin\nav\Breadcrumbs.tsx =====
"use client";
import { usePathname } from "next/navigation";

export default function Breadcrumbs({ className = "" }: { className?: string }) {
  const path = (usePathname() || "/admin").replace(/^\/+/, "");
  const parts = path.split("/").filter(Boolean);
  const segs = parts[0] === "admin" ? parts.slice(1) : parts;
  const crumbs = ["Admin", ...segs.map(seg => seg.replace(/-/g, " ").replace(/\b\w/g, s => s.toUpperCase()))];

  return (
    <div className={`text-sm text-neutral-600 ${className}`}>
      {crumbs.map((c, i) => (
        <span key={i} className="after:content-['›'] last:after:content-[''] after:mx-2">{c}</span>
      ))}
    </div>
  );
}


===== components\admin\nav\ProfileMenu.tsx =====
"use client";

import Link from "next/link";
import { useEffect, useRef, useState } from "react";
import { useRouter } from "next/navigation";
import { supabase } from "@/lib/supabaseClient";

export default function ProfileMenu() {
  const [open, setOpen] = useState(false);
  const ref = useRef<HTMLDivElement>(null);
  const router = useRouter();

  useEffect(() => {
    const clickAway = (e: MouseEvent) => {
      if (!ref.current) return;
      if (open && !ref.current.contains(e.target as Node)) setOpen(false);
    };
    const onEsc = (e: KeyboardEvent) => e.key === "Escape" && setOpen(false);
    document.addEventListener("click", clickAway);
    document.addEventListener("keydown", onEsc);
    return () => {
      document.removeEventListener("click", clickAway);
      document.removeEventListener("keydown", onEsc);
    };
  }, [open]);

  const logout = async () => {
    await supabase.auth.signOut();
    router.push("/login");
  };

  return (
    <div ref={ref} className="relative">
      <button
        onClick={() => setOpen((v) => !v)}
        aria-haspopup="menu"
        aria-expanded={open}
        className="ml-1 flex items-center gap-2 rounded-full bg-white/12 px-2.5 py-1.5 text-sm hover:bg-white/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50"
      >
        <span className="inline-flex h-6 w-6 items-center justify-center rounded-full bg-white/30 text-[13px] font-semibold">
          A
        </span>
        <span className="hidden sm:block">Admin</span>
        <svg className="h-4 w-4 opacity-80" viewBox="0 0 20 20" fill="currentColor">
          <path d="M5.5 7 10 11.5 14.5 7l1 1L10 14 4.5 8l1-1Z" />
        </svg>
      </button>

      {open && (
        <div
          role="menu"
          className="absolute right-0 mt-2 w-80 max-w-[92vw] rounded-xl bg-neutral-900/95 p-2 text-white shadow-2xl ring-1 ring-white/10 backdrop-blur"
        >
          <Link
            href="/admin/profile"
            className="flex items-center gap-3 rounded-lg p-2 hover:bg-white/10"
            role="menuitem"
            onClick={() => setOpen(false)}
          >
            <span className="inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/20 text-base font-semibold">
              A
            </span>
            <div className="flex flex-col">
              <span className="text-sm font-semibold">Admin</span>
              <span className="text-xs text-white/70">View profile</span>
            </div>
          </Link>

          <Link
            href="/admin/org/ccms"
            className="mt-1 flex items-center gap-3 rounded-lg p-2 hover:bg-white/10"
            role="menuitem"
            onClick={() => setOpen(false)}
          >
            <span className="inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/20 text-sm font-semibold">
              TL
            </span>
            <div className="flex flex-col">
              <span className="text-sm font-semibold">TraviLink – CCMS</span>
              <span className="text-xs text-white/70">Organization profile</span>
            </div>
          </Link>

          <div className="my-2 h-px w-full bg-white/10" />

          <Link
            href="/admin/settings"
            className="flex items-center gap-3 rounded-lg p-2 hover:bg-white/10"
            role="menuitem"
            onClick={() => setOpen(false)}
          >
            <GearIcon />
            <div className="flex-1">
              <div className="text-sm font-medium">Settings & privacy</div>
              <div className="text-xs text-white/70">Account, permissions, RLS, security</div>
            </div>
          </Link>

          <Link
            href="/admin/help"
            className="flex items-center gap-3 rounded-lg p-2 hover:bg-white/10"
            role="menuitem"
            onClick={() => setOpen(false)}
          >
            <HelpIcon />
            <div className="flex-1">
              <div className="text-sm font-medium">Help & support</div>
              <div className="text-xs text-white/70">Docs, contact support</div>
            </div>
          </Link>

          <button
            className="w-full flex items-center gap-3 rounded-lg p-2 hover:bg-white/10"
            role="menuitem"
            onClick={() => setOpen(false)}
          >
            <DisplayIcon />
            <div className="flex-1 text-left">
              <div className="text-sm font-medium">Display & accessibility</div>
              <div className="text-xs text-white/70">Theme, density</div>
            </div>
          </button>

          <button
            className="w-full flex items-center gap-3 rounded-lg p-2 hover:bg-white/10"
            role="menuitem"
            onClick={() => setOpen(false)}
          >
            <FeedbackIcon />
            <div className="flex-1 text-left">
              <div className="text-sm font-medium">Give feedback</div>
              <div className="text-xs text-white/70">Tell us what’s working</div>
            </div>
          </button>

          <div className="my-2 h-px w-full bg-white/10" />

          <button
            onClick={logout}
            className="w-full flex items-center gap-3 rounded-lg p-2 text-red-200 hover:bg-white/10"
            role="menuitem"
          >
            <LogoutIcon />
            <span className="text-sm font-semibold">Log Out</span>
          </button>
        </div>
      )}
    </div>
  );
}

/* tiny inline icons */
function GearIcon() { return <svg className="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="currentColor"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7ZM3 13h2.1a7 7 0 0 0 .6 1.5L4.2 16l1.8 3.1 1.5-1.1a7 7 0 0 0 1.5.6V21h3v-2.1a7 7 0 0 0 1.5-.6l1.5 1.1 1.8-3.1-1.5-1.1a7 7 0 0 0 .6-1.5H21v-3h-2.1a7 7 0 0 0-.6-1.5l1.5-1.1L18 3.3l-1.5 1.1a7 7 0 0 0-1.5-.6V2h-3v1.9a7 7 0 0 0-1.5.6L7.9 3.3 6 6.4l1.5 1.1a7 7 0 0 0-.6 1.5H3v3Z"/></svg>; }
function HelpIcon() { return <svg className="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20Zm0 15.25a1.25 1.25 0 1 1 0-2.5 1.25 1.25 0 0 1 0 2.5Zm1.2-4.95v.2h-2.1v-.4c0-1 .6-1.6 1.5-2.1.7-.4 1-.7 1-1.2 0-.7-.6-1.2-1.5-1.2s-1.6.4-2.2 1l-1.3-1.5A4.66 4.66 0 0 1 12 5c2 0 3.6 1.2 3.6 3 0 1.2-.6 1.9-1.7 2.3-.7.4-1 .6-1 .97Z"/></svg>; }
function DisplayIcon() { return <svg className="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="currentColor"><path d="M3 5h18v12H3V5Zm0 14h18v2H3v-2Z"/></svg>; }
function FeedbackIcon() { return <svg className="h-5 w-5 text-white/80" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h16v12H6l-2 2V4Zm4 4h8v2H8V8Zm0 4h6v2H8v-2Z"/></svg>; }
function LogoutIcon() { return <svg className="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M10 17v2h-6V5h6v2H6v10h4Zm9-5-4-4v3h-5v2h5v3l4-4Z"/></svg>; }


===== components\admin\nav\TopBar.tsx =====
"use client";

import Link from "next/link";
import { useEffect, useRef, useState } from "react";
import ProfileMenu from "./ProfileMenu";

const BRAND = "#7A0010";
const BRAND_DARK = "#60000C";

export default function TopBar() {
  const [q, setQ] = useState("");
  const searchRef = useRef<HTMLInputElement>(null);



  return (
    <header className="sticky top-0 z-40">
      <div
        className="h-14 w-full border-b border-white/10 text-white"
        style={{ background: `linear-gradient(180deg, ${BRAND} 0%, ${BRAND} 60%, ${BRAND_DARK} 100%)` }}
      >
        {/* Equal gutters; center column is minmax(720px, 1120px) so it's LONGER */}
        <div className="mx-auto grid h-full max-w-[1600px] grid-cols-[1fr_minmax(720px,700px)_1fr] items-center gap-3 px-3 sm:px-4">
          {/* LEFT: brand */}
          <div className="justify-self-start">
            <Link href="/admin" className="flex items-center gap-2">
              <div className="flex h-7 w-7 items-center justify-center rounded-md bg-white/15 ring-1 ring-white/30 text-xs font-bold">TL</div>
              <span className="hidden sm:block text-[15px] font-semibold tracking-tight">TraviLink Admin</span>
            </Link>
          </div>

          {/* CENTER: search (same height, longer width) */}
          <div className="justify-self-center w-full">
            <div className="relative mx-auto w-full">
              <input
                ref={searchRef}
                value={q}
                onChange={(e) => setQ(e.target.value)}
                placeholder="Search schedules, vehicles, drivers…  (Ctrl/⌘+K)"
                className="h-10 w-full rounded-lg bg-white/95 pl-9 pr-3 text-sm text-neutral-900 placeholder-neutral-500 ring-1 ring-black/10 outline-none transition focus:ring-2 focus:ring-white/70"
              />
              <svg
                className="pointer-events-none absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-500"
                viewBox="0 0 20 20" fill="currentColor"
              >
                <path fillRule="evenodd" d="M13 14a6 6 0 1 1 1-1l3 3-1 1-3-3Zm-5 0a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z" clipRule="evenodd" />
              </svg>
            </div>
          </div>

          {/* RIGHT: utils */}
          <div className="justify-self-end">
            <div className="flex items-center gap-3">
              

              <button
                title="Notifications"
                className="relative h-9 rounded-md px-2 text-white/90 transition hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50"
              >
                <svg className="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 22a2 2 0 0 0 2-2h-4a2 2 0 0 0 2 2ZM19 17h-14l2-2v-4a5 5 0 1 1 10 0v4l2 2Z" />
                </svg>
                <span className="absolute -right-1 -top-1 flex h-4 min-w-[16px] items-center justify-center rounded-full bg-white px-1 text-[10px] font-semibold text-[var(--admin-brand,#7A0010)]">
                  3
                </span>
              </button>

              <ProfileMenu />
            </div>
          </div>
        </div>
      </div>
    </header>
  );
}


===== components\admin\requests\containers\BulkBar.container.tsx =====
"use client";
import React, { forwardRef, useImperativeHandle, useMemo, useState } from "react";
import { RequestRow } from "@/lib/admin/types";
import BulkBarUI from "@/components/admin/requests/ui/BulkBar.ui";
import ConfirmUI from "@/components/admin/requests/ui/Confirm.ui";

type Props = {
  allRows: RequestRow[];
  selectedIds: Set<string>;
  clearSelection: () => void;

  onApproveSelected: (ids: string[]) => Promise<void> | void;
  onRejectSelected: (ids: string[]) => Promise<void> | void;
  onDeleteSelected: (ids: string[]) => Promise<void> | void;
  onExportSelected: (rows: RequestRow[]) => void;
};

export type BulkBarHandle = {
  approveSelected: () => void;
  rejectSelected: () => void;
  deleteSelected: () => void;
  exportSelected: () => void;
  clear: () => void;
};

type BusyKind = "approve" | "reject" | "delete" | null;

function BulkBarContainerInner(
  { allRows, selectedIds, clearSelection, onApproveSelected, onRejectSelected, onDeleteSelected, onExportSelected }: Props,
  ref: React.Ref<BulkBarHandle>
) {
  const ids = useMemo(() => [...selectedIds], [selectedIds]);
  const selectedRows = useMemo(() => allRows.filter((r) => selectedIds.has(r.id)), [allRows, selectedIds]);
  const selectedCount = ids.length;

  const breakdown: Record<string, number> = useMemo(() => {
    const b: Record<string, number> = {};
    selectedRows.forEach((r) => (b[r.status] = (b[r.status] ?? 0) + 1));
    return b;
  }, [selectedRows]);

  const [confirm, setConfirm] = useState<{ open: boolean; kind?: "reject" | "delete" }>({ open: false });
  const [busy, setBusy] = useState<BusyKind>(null);

  async function doApprove() {
    if (!ids.length || busy) return;
    try {
      setBusy("approve");
      await onApproveSelected(ids);
      clearSelection();
    } finally {
      setBusy(null);
    }
  }

  async function doConfirm(kind: "reject" | "delete") {
    if (!ids.length || busy) return;
    try {
      setBusy(kind);
      if (kind === "reject") await onRejectSelected(ids);
      if (kind === "delete") await onDeleteSelected(ids);
      clearSelection();
    } finally {
      setBusy(null);
      setConfirm({ open: false });
    }
  }

  useImperativeHandle(ref, () => ({
    approveSelected: doApprove,
    rejectSelected: () => setConfirm({ open: true, kind: "reject" }),
    deleteSelected: () => setConfirm({ open: true, kind: "delete" }),
    exportSelected: () => onExportSelected(selectedRows),
    clear: clearSelection,
  }));

  return (
    <>
      <BulkBarUI
        selectedCount={selectedCount}
        breakdown={breakdown}
        onApprove={doApprove}
        onReject={() => setConfirm({ open: true, kind: "reject" })}
        onDelete={() => setConfirm({ open: true, kind: "delete" })}
        onExport={() => onExportSelected(selectedRows)}
        onClear={clearSelection}
        busy={busy}
      />

      <ConfirmUI
        open={confirm.open}
        title={confirm.kind === "delete" ? "Delete selected requests?" : "Reject selected requests?"}
        message={
          confirm.kind === "delete"
            ? `This will permanently remove ${selectedCount} ${selectedCount === 1 ? "request" : "requests"}.`
            : `This will mark ${selectedCount} ${selectedCount === 1 ? "request" : "requests"} as Rejected.`
        }
        confirmText={confirm.kind === "delete" ? "Delete" : "Reject"}
        confirmClass="bg-red-600 text-white"
        onCancel={() => setConfirm({ open: false })}
        onConfirm={() => doConfirm(confirm.kind!)}
      />
    </>
  );
}

const BulkBarContainer = forwardRef<BulkBarHandle, Props>(BulkBarContainerInner);
export default BulkBarContainer;


===== components\admin\requests\containers\FiltersBar.container.tsx =====
// src/components/admin/requests/containers/FiltersBar.container.tsx
"use client";

import { useEffect, useMemo, useRef, useState } from "react";
import type { FilterState, RequestRow } from "@/lib/admin/types";

/** Default filter values */
const DEFAULTS: FilterState = {
  status: "All",
  dept: "All",
  search: "",
  from: "",
  to: "",
  mode: "auto",
};

function parseParams(sp: URLSearchParams): FilterState {
  return {
    status: (sp.get("status") as FilterState["status"]) || "All",
    dept: (sp.get("dept") as FilterState["dept"]) || "All",
    from: sp.get("from") || "",
    to: sp.get("to") || "",
    search: sp.get("search") || "",
    mode: (sp.get("mode") as FilterState["mode"]) || "auto",
  };
}

export type FiltersControls = {
  draft: FilterState;
  onDraftChange: (next: Partial<FilterState>) => void;
  onApply: () => void;
  onClearAll: () => void;
  resultCount: number;
};

export default function FiltersBarContainer({
  rows,
  onFiltered,
  children,
}: {
  rows: RequestRow[];
  onFiltered: (filtered: RequestRow[]) => void;
  /** Optional render-prop so we can place the Filter button wherever we like (e.g. next to Search) */
  children?: (controls: FiltersControls) => React.ReactNode;
}) {
  const searchParams =
    typeof window !== "undefined"
      ? new URLSearchParams(window.location.search)
      : (new URLSearchParams() as any);

  const mounted = useRef(false);

  // init from URL (or defaults)
  const [applied, setApplied] = useState<FilterState>(() => parseParams(searchParams) || DEFAULTS);
  const [draft, setDraft] = useState<FilterState>(() => parseParams(searchParams) || DEFAULTS);

  // compute filtered rows
  const filtered = useMemo(() => filterRows(rows ?? [], applied), [rows, applied]);

  // push to parent on change
  useEffect(() => {
    if (!mounted.current) return;
    onFiltered(filtered);
  }, [filtered, onFiltered]);

  // initial mount: notify parent and mark mounted
  useEffect(() => {
    onFiltered(filtered);
    mounted.current = true;
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  // Saved Views events (headless; UI handled where button is rendered)
  useEffect(() => {
    function saveView() {
      try {
        const views: Array<{ name: string; state: FilterState }> = JSON.parse(localStorage.getItem("tl.requests.views") || "[]");
        const name = window.prompt("Save filters as…", "My Dept Pending");
        if (!name) return;
        const next = [...views.filter((v) => v.name !== name), { name, state: applied }];
        localStorage.setItem("tl.requests.views", JSON.stringify(next));
        window.dispatchEvent(new StorageEvent("storage", { key: "tl.requests.views", newValue: JSON.stringify(next) }));
      } catch {
        // ignore
      }
    }
    function applyView(e: Event) {
      try {
        const name = (e as CustomEvent<string>).detail;
        const views: Array<{ name: string; state: FilterState }> = JSON.parse(localStorage.getItem("tl.requests.views") || "[]");
        const found = views.find((v) => v.name === name);
        if (found) {
          setDraft(found.state);
          setApplied(found.state);
        }
      } catch {
        // ignore
      }
    }
    window.addEventListener("requests.saveView", saveView as any);
    window.addEventListener("requests.applyView", applyView as any);
    return () => {
      window.removeEventListener("requests.saveView", saveView as any);
      window.removeEventListener("requests.applyView", applyView as any);
    };
  }, [applied]);

  function onDraftChange(next: Partial<FilterState>) {
    const nextDraft = { ...draft, ...next };
    setDraft(nextDraft);
    if (nextDraft.mode === "auto") setApplied(nextDraft); // realtime apply
  }
  function onApply() {
    setApplied(draft);
  }
  function onClearAll() {
    setDraft(DEFAULTS);
    setApplied(DEFAULTS);
  }

  if (children) {
    return <>{children({ draft, onDraftChange, onApply, onClearAll, resultCount: filterRows(rows ?? [], draft).length })}</>;
  }
  // Headless by default (no UI). We place the button next to Search in the table toolbar.
  return null;
}

function filterRows(rows: RequestRow[], f: FilterState): RequestRow[] {
  return (rows ?? []).filter((r) => {
    const okStatus = f.status === "All" || r.status === f.status;
    const okDept = f.dept === "All" || r.dept === f.dept;
    const q = (f.search ?? "").trim().toLowerCase();
    const okSearch =
      !q ||
      r.id.toLowerCase().includes(q) ||
      r.purpose.toLowerCase().includes(q) ||
      r.dept.toLowerCase().includes(q) ||
      (r.requester ?? "").toLowerCase().includes(q) ||
      (r.driver ?? "").toLowerCase().includes(q) ||
      (r.vehicle ?? "").toLowerCase().includes(q);
    const okFrom = !f.from || r.date >= f.from;
    const okTo = !f.to || r.date <= f.to;
    return okStatus && okDept && okSearch && okFrom && okTo;
  });
}


===== components\admin\requests\filters\FilterDropdown.ui.tsx =====
// src/components/admin/requests/filters/FilterDropdown.ui.tsx
"use client";
import * as React from "react";
import type { FilterState } from "@/lib/admin/types";
import useOutsideClick from "../hooks/useOutsideClick";
import { Filter as FilterIcon, ChevronDown } from "lucide-react";

const statuses: Array<FilterState["status"]> = [
  "All",
  "Pending",
  "Approved",
  "Completed",
  "Rejected",
];
const depts: Array<FilterState["dept"]> = ["All", "CCMS", "HR", "Registrar", "Finance"];

export default function FilterDropdownUI({
  draft,
  onDraftChange,
  onApply,
  onClearAll,
}: {
  draft: FilterState;
  onDraftChange: (n: Partial<FilterState>) => void;
  onApply: () => void;
  onClearAll: () => void;
}) {
  const [open, setOpen] = React.useState(false);
  const ref = React.useRef<HTMLDivElement>(null);

  useOutsideClick(ref, () => setOpen(false));

  const set = <K extends keyof FilterState>(k: K, v: FilterState[K]) =>
    onDraftChange({ [k]: v } as Pick<FilterState, K>);

  // highlight icon if any filter is active
  const hasActive =
    draft.status !== "All" ||
    draft.dept !== "All" ||
    !!draft.from ||
    !!draft.to ||
    !!(draft.search && draft.search.trim());

  return (
    <div className="relative" ref={ref}>
      <button
        type="button"
        onClick={(e) => {
          e.stopPropagation();
          setOpen((v) => !v);
        }}
        aria-haspopup="menu"
        aria-expanded={open}
        className="inline-flex items-center gap-2 rounded-full border border-neutral-300 bg-white px-3 py-1.5 text-sm text-neutral-700 shadow-sm hover:bg-neutral-50"
      >
        {/* 🔎 Filter icon */}
        <FilterIcon className={`h-4 w-4 ${hasActive ? "text-[#7a1f2a]" : "text-neutral-500"}`} />
        <span>Filter</span>
        <ChevronDown className="h-4 w-4 text-neutral-500" />
      </button>

      {open && (
        <div
          className="absolute left-0 z-30 mt-2 w-[320px] rounded-xl border border-neutral-200 bg-white p-3 text-sm shadow-xl"
          onClick={(e) => e.stopPropagation()}
        >
          <Field label="Status">
            <select
              className="w-full rounded-lg border px-2 py-2"
              value={draft.status}
              onChange={(e) => set("status", e.target.value as FilterState["status"])}
            >
              {statuses.map((s) => (
                <option key={s} value={s}>
                  {s}
                </option>
              ))}
            </select>
          </Field>

          <Field label="Department">
            <select
              className="w-full rounded-lg border px-2 py-2"
              value={draft.dept}
              onChange={(e) => set("dept", e.target.value as FilterState["dept"])}
            >
              {depts.map((d) => (
                <option key={d} value={d}>
                  {d}
                </option>
              ))}
            </select>
          </Field>

          <div className="grid grid-cols-2 gap-2">
            <Field label="From">
              <input
                type="date"
                className="w-full rounded-lg border px-2 py-2"
                value={draft.from || ""}
                onChange={(e) => set("from", e.target.value || "")}
              />
            </Field>
            <Field label="To">
              <input
                type="date"
                className="w-full rounded-lg border px-2 py-2"
                value={draft.to || ""}
                onChange={(e) => set("to", e.target.value || "")}
              />
            </Field>
          </div>

          <Field label="Mode">
            <select
              className="w-full rounded-lg border px-2 py-2"
              value={draft.mode}
              onChange={(e) => set("mode", e.target.value as FilterState["mode"])}
            >
              <option value="auto">Auto (instant)</option>
              <option value="apply">Apply (manual)</option>
            </select>
          </Field>

          <div className="grid grid-cols-2 gap-2 pt-1">
            <button
              className="rounded-lg border px-3 py-2 text-sm"
              onClick={() => {
                onClearAll();
                setOpen(false);
              }}
            >
              Clear All
            </button>
            <button
              className="rounded-lg bg-[#7a1f2a] px-3 py-2 text-sm font-medium text-white"
              onClick={() => {
                if (draft.mode === "apply") onApply();
                setOpen(false);
              }}
            >
              Apply
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

function Field({ label, children }: { label: string; children: React.ReactNode }) {
  return (
    <div className="space-y-1 mb-3">
      <div className="text-xs font-medium text-neutral-600">{label}</div>
      {children}
    </div>
  );
}


===== components\admin\requests\filters\SavedViews.button.tsx =====
"use client";
import * as React from "react";
import type { FilterState } from "@/lib/admin/types";

const LS_KEY = "travilink.requests.savedViews.v1";

type SavedView = { id: string; name: string; filters: FilterState; createdAt: number };

function loadViews(): SavedView[] {
  try {
    const raw = localStorage.getItem(LS_KEY);
    return raw ? (JSON.parse(raw) as SavedView[]) : [];
  } catch { return []; }
}
function saveViews(list: SavedView[]) {
  localStorage.setItem(LS_KEY, JSON.stringify(list));
}

export default function SavedViewsButton({
  current,
  onApply,
}: {
  current: FilterState;
  onApply: (f: FilterState) => void;
}) {
  const [open, setOpen] = React.useState(false);
  const [views, setViews] = React.useState<SavedView[]>([]);
  const [name, setName] = React.useState("");

  React.useEffect(() => { setViews(loadViews()); }, []);

  function add() {
    const n = name.trim() || defaultName(current);
    const v: SavedView = { id: crypto.randomUUID(), name: n, filters: current, createdAt: Date.now() };
    const next = [v, ...views];
    setViews(next); saveViews(next); setName(""); setOpen(false);
  }
  function del(id: string) {
    const next = views.filter(v => v.id !== id);
    setViews(next); saveViews(next);
  }
  function apply(v: SavedView) {
    onApply(v.filters);
    setOpen(false);
  }

  return (
    <div className="relative">
      <button
        className="rounded border px-3 py-1 text-sm"
        onClick={() => setOpen(o => !o)}
        title="Saved filter presets"
      >
        Saved Views
      </button>

      {open && (
        <div className="absolute right-0 z-30 mt-2 w-[320px] rounded border bg-white p-3 shadow-lg">
          <div className="mb-2 text-sm font-medium">Saved Views</div>

          {views.length === 0 && (
            <div className="mb-2 text-xs text-neutral-500">No views yet. Save your current filters below.</div>
          )}

          <ul className="mb-3 max-h-56 space-y-1 overflow-auto pr-1">
            {views.map(v => (
              <li key={v.id} className="flex items-center justify-between gap-2 rounded border px-2 py-1">
                <button
                  className="truncate text-left text-sm text-blue-600 hover:underline"
                  onClick={() => apply(v)}
                  title="Apply this view"
                >
                  {v.name}
                </button>
                <button
                  className="text-xs text-red-600"
                  onClick={() => del(v.id)}
                  title="Delete view"
                >
                  Delete
                </button>
              </li>
            ))}
          </ul>

          <div className="flex items-center gap-2">
            <input
              className="w-full rounded border px-2 py-1 text-sm"
              placeholder="Name this view (optional)"
              value={name}
              onChange={(e) => setName(e.target.value)}
              onKeyDown={(e) => e.key === "Enter" && add()}
            />
            <button className="rounded bg-neutral-800 px-3 py-1 text-sm text-white" onClick={add}>
              Save current
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

function defaultName(f: FilterState) {
  const parts: string[] = [];
  if (f.status !== "All") parts.push(f.status);
  if (f.dept !== "All") parts.push(f.dept);
  if (f.from || f.to) parts.push(`${f.from || "…"}→${f.to || "…"}`);
  if (f.search) parts.push(`"${f.search}"`);
  return parts.join(" · ") || "My view";
}


===== components\admin\requests\hooks\useFilterState.ts =====
"use client";
import { useEffect, useMemo, useState } from "react";
import type { FilterState, RequestRow } from "@/lib/admin/types";

export const DEFAULT_FILTERS: FilterState = {
  status: "All",
  dept: "All",
  from: "",
  to: "",
  search: "",
  mode: "auto",
};

export function useFilterState(initial: FilterState = DEFAULT_FILTERS) {
  const [applied, setApplied] = useState<FilterState>(initial);
  const [draft, setDraft] = useState<FilterState>(initial);

  function apply() { setApplied(draft); }
  function clearAll() { setDraft(DEFAULT_FILTERS); setApplied(DEFAULT_FILTERS); }
  function update(next: Partial<FilterState>) {
    const n = { ...draft, ...next };
    setDraft(n);
    if (n.mode === "auto") setApplied(n);
  }
  return { draft, applied, update, apply, clearAll, setDraft };
}

export function filterRows(rows: RequestRow[], f: FilterState) {
  const q = (f.search ?? "").toLowerCase().trim();
  return rows.filter(r => {
    const okStatus = f.status === "All" || r.status === f.status;
    const okDept = f.dept === "All" || r.dept === f.dept;
    const okSearch = !q || r.id.toLowerCase().includes(q) ||
      r.purpose.toLowerCase().includes(q) || r.dept.toLowerCase().includes(q);
    const okFrom = !f.from || r.date >= f.from!;
    const okTo = !f.to || r.date <= f.to!;
    return okStatus && okDept && okSearch && okFrom && okTo;
  });
}

export const useFilteredRows = (rows: RequestRow[], f: FilterState) =>
  useMemo(() => filterRows(rows, f), [rows, f]);

export const isFiltered = (f: FilterState) =>
  f.status !== "All" || f.dept !== "All" || !!f.from || !!f.to;


===== components\admin\requests\hooks\useOutsideClick.ts =====
// hooks/useOutsideClick.ts
"use client";
import * as React from "react";

export default function useOutsideClick<T extends HTMLElement>(
  ref: React.RefObject<T | null>,                     // <-- accept `null` here
  onOutside: (ev: MouseEvent | TouchEvent) => void
) {
  React.useEffect(() => {
    function handler(ev: MouseEvent | TouchEvent) {
      const el = ref.current;
      if (!el) return;
      if (el.contains(ev.target as Node)) return;
      onOutside(ev);
    }
    document.addEventListener("mousedown", handler);
    document.addEventListener("touchstart", handler, { passive: true });
    return () => {
      document.removeEventListener("mousedown", handler);
      document.removeEventListener("touchstart", handler);
    };
  }, [ref, onOutside]);
}


===== components\admin\requests\toolbar\RequestsToolbar.ui.tsx =====
// src/components/admin/requests/toolbar/RequestsToolbar.ui.tsx
"use client";

import * as React from "react";
import { SortAsc, SortDesc, Plus, Filter } from "lucide-react";
import type { FilterState } from "@/lib/admin/types";
import FilterDropdownUI from "../filters/FilterDropdown.ui";

type Sort = "newest" | "oldest";

type Props = {
  // search
  q: string;
  onQChange: (v: string) => void;

  // sort
  sort: Sort; // "newest" | "oldest"
  onSortChange: (s: Sort) => void;

  // actions
  onAddNew: () => void;

  // filters (flat, modern)
  draft: FilterState;
  onDraftChange: (n: Partial<FilterState>) => void;
  onApply: () => void;
  onClearAll: () => void;
};

export default function RequestsToolbar({
  q,
  onQChange,
  sort,
  onSortChange,
  onAddNew,
  draft,
  onDraftChange,
  onApply,
  onClearAll,
}: Props) {
  return (
    <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      {/* left: search + filter */}
      <div className="flex items-center gap-2">
        <div className="relative">
          <input
            value={q}
            onChange={(e) => onQChange(e.target.value)}
            placeholder="Search requests…"
            className="h-9 w-[240px] rounded-md border border-neutral-300 bg-white pl-3 pr-9 text-sm outline-none focus:ring-2 focus:ring-[#7a1f2a]/40"
          />
          <Filter
            size={16}
            className="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-neutral-400"
          />
        </div>

        <FilterDropdownUI
          draft={draft}
          onDraftChange={onDraftChange}
          onApply={onApply}
          onClearAll={onClearAll}
        />
      </div>

      {/* right: sort + add */}
      <div className="flex items-center gap-2">
        <button
          type="button"
          onClick={() => onSortChange(sort === "newest" ? "oldest" : "newest")}
          className="inline-flex items-center gap-1 rounded-full border border-neutral-300 bg-white px-3 py-1.5 text-sm text-neutral-700 shadow-sm hover:bg-neutral-50"
          aria-label="Toggle sort"
        >
          {sort === "newest" ? <SortDesc size={16} /> : <SortAsc size={16} />}
          {sort === "newest" ? "Newest first" : "Oldest first"}
        </button>

        <button
          type="button"
          onClick={onAddNew}
          className="inline-flex items-center gap-2 rounded-md bg-[#7a1f2a] px-3 py-2 text-sm font-medium text-white hover:opacity-95"
        >
          <Plus size={16} />
          Add New
        </button>
      </div>
    </div>
  );
}


===== components\admin\requests\ui\BulkBar.ui.tsx =====
"use client";

import * as React from "react";
import { CheckCircle2, XCircle, Trash2, FileDown, HelpCircle } from "lucide-react";

type BusyKind = "approve" | "reject" | "delete" | null;

type Props = {
  selectedCount: number;
  breakdown: Record<string, number>;
  onApprove: () => void;
  onReject: () => void; // opens confirm
  onDelete: () => void; // opens confirm
  onExport: () => void;
  onClear: () => void;
  busy?: BusyKind;
};

export default function BulkBarUI({
  selectedCount,
  breakdown,
  onApprove,
  onReject,
  onDelete,
  onExport,
  onClear,
  busy = null,
}: Props) {
  const disabled = selectedCount === 0 || busy !== null;

  const summary =
    selectedCount > 0
      ? `${selectedCount} selected` +
        Object.entries(breakdown)
          .map(([status, n]) => ` · ${n} ${status}`)
          .join("")
      : "No selection";

  return (
    <div className="admin-bulkbar z-[29] flex items-center gap-3 rounded-xl border border-neutral-200 bg-white px-3 py-2 shadow-sm">
      <div className="text-sm font-medium text-neutral-700">{summary}</div>

      <div className="ml-auto flex flex-wrap items-center gap-2">
        <ActionButton
          label="Approve"
          icon={<CheckCircle2 className="h-4 w-4" />}
          onClick={onApprove}
          disabled={disabled}
          busy={busy === "approve"}
          variant="success"
          title="Approve selected (Ctrl+Enter)"
        />
        <ActionButton
          label="Reject"
          icon={<XCircle className="h-4 w-4" />}
          onClick={onReject}
          disabled={disabled}
          busy={busy === "reject"}
          variant="danger"
          title="Reject selected"
        />
        <ActionButton
          label="Delete"
          icon={<Trash2 className="h-4 w-4" />}
          onClick={onDelete}
          disabled={disabled}
          busy={busy === "delete"}
          variant="neutral"
          title="Delete selected"
        />
        <GhostButton
          label="Export"
          icon={<FileDown className="h-4 w-4" />}
          onClick={onExport}
          disabled={disabled}
          title="Export selected to CSV"
        />
        <GhostButton label="Clear" onClick={onClear} disabled={disabled} title="Clear selection" />

        {/* Hotkeys helper */}
        <div className="relative group ml-2">
          <button
            type="button"
            className="flex items-center gap-1 rounded-lg border border-neutral-200 bg-white px-2 py-1 text-xs text-neutral-600 shadow-sm hover:bg-neutral-50"
            title="Keyboard shortcuts"
          >
            <HelpCircle className="h-4 w-4" />
            Shortcuts
          </button>
          <div className="admin-popover pointer-events-none absolute right-0 top-full mt-2 hidden w-64 rounded-lg border border-neutral-200 bg-white p-3 text-xs text-neutral-700 shadow-lg group-hover:block">
            <p className="mb-1 flex items-center justify-between">
              <span>Select all on page</span>
              <kbd className="kbd">A</kbd>
            </p>
            <p className="mb-1 flex items-center justify-between">
              <span>Clear selection</span>
              <kbd className="kbd">X</kbd>
            </p>
            <p className="mb-1 flex items-center justify-between">
              <span>Prev / Next page</span>
              <span className="flex items-center gap-1">
                <kbd className="kbd">←</kbd>
                <kbd className="kbd">→</kbd>
              </span>
            </p>
            <p className="flex items-center justify-between">
              <span>Approve selected</span>
              <span className="flex items-center gap-1">
                <kbd className="kbd">Ctrl</kbd>
                <kbd className="kbd">Enter</kbd>
              </span>
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

/* ---------- Buttons ---------- */

function ActionButton({
  label,
  icon,
  onClick,
  disabled,
  busy,
  variant = "neutral",
  title,
}: {
  label: string;
  icon: React.ReactNode;
  onClick: () => void;
  disabled?: boolean;
  busy?: boolean;
  variant?: "success" | "danger" | "neutral";
  title?: string;
}) {
  const base =
    "inline-flex items-center gap-1 rounded-lg px-3 py-1.5 text-xs font-medium shadow-sm disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-offset-1";
  const look =
    variant === "success"
      ? "bg-emerald-600 text-white hover:bg-emerald-700 focus:ring-emerald-300"
      : variant === "danger"
      ? "bg-rose-600 text-white hover:bg-rose-700 focus:ring-rose-300"
      : "border border-neutral-200 bg-white text-neutral-700 hover:bg-neutral-50 focus:ring-neutral-300";

  return (
    <button className={`${base} ${look}`} onClick={onClick} disabled={disabled || busy} title={title}>
      {busy ? <Spinner /> : icon}
      {label}
    </button>
  );
}

function GhostButton({
  label,
  icon,
  onClick,
  disabled,
  title,
}: {
  label: string;
  icon?: React.ReactNode;
  onClick: () => void;
  disabled?: boolean;
  title?: string;
}) {
  return (
    <button
      className="inline-flex items-center gap-1 rounded-lg border border-neutral-200 bg-white px-3 py-1.5 text-xs font-medium text-neutral-700 shadow-sm hover:bg-neutral-50 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-neutral-300 focus:ring-offset-1"
      onClick={onClick}
      disabled={disabled}
      title={title}
    >
      {icon}
      {label}
    </button>
  );
}

function Spinner() {
  return (
    <svg className="h-4 w-4 animate-spin" viewBox="0 0 24 24" aria-hidden="true">
      <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" className="opacity-25" />
      <path d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4z" fill="currentColor" className="opacity-75" />
    </svg>
  );
}

/* Tailwind “kbd” utility (no styled-jsx) */
declare module "react" {
  interface HTMLAttributes<T> {
    // allow className "kbd" without TS complaining
  }
}


===== components\admin\requests\ui\Confirm.ui.tsx =====
"use client";
type Props = {
  open: boolean;
  title: string;
  message: string;
  confirmText?: string;
  confirmClass?: string;
  onConfirm: () => void;
  onCancel: () => void;
};
export default function ConfirmUI({
  open,
  title,
  message,
  confirmText = "Confirm",
  confirmClass = "bg-red-600 text-white",
  onConfirm,
  onCancel,
}: Props) {
  if (!open) return null;
  return (
    <div className="fixed inset-0 z-50">
      <div className="absolute inset-0 bg-black/40" onClick={onCancel} />
      <div className="absolute left-1/2 top-1/2 w-[420px] -translate-x-1/2 -translate-y-1/2 rounded-xl border bg-white p-4 shadow-xl">
        <h3 className="mb-2 text-lg font-semibold">{title}</h3>
        <p className="mb-4 text-sm text-neutral-700">{message}</p>
        <div className="flex justify-end gap-2">
          <button className="rounded border px-3 py-1.5 text-sm" onClick={onCancel}>
            Cancel
          </button>
          <button
            className={`rounded px-3 py-1.5 text-sm ${confirmClass}`}
            onClick={onConfirm}
          >
            {confirmText}
          </button>
        </div>
      </div>
    </div>
  );
}


===== components\admin\requests\ui\Pagination.tsx =====
"use client";
export default function Pagination({
  page, pageSize, total, onPage, onSize,
}: {
  page: number; pageSize: number; total: number;
  onPage: (p: number) => void;
  onSize: (s: number) => void;
}) {
  const max = Math.max(1, Math.ceil(total / pageSize));
  return (
    <div className="flex items-center gap-2">
      <button
        disabled={page <= 1}
        onClick={() => onPage(page - 1)}
        className="rounded-lg border border-neutral-300 bg-white px-2 py-1 text-sm text-neutral-700 shadow-sm disabled:opacity-50"
      >Prev</button>
      <button
        disabled={page >= max}
        onClick={() => onPage(page + 1)}
        className="rounded-lg border border-neutral-300 bg-white px-2 py-1 text-sm text-neutral-700 shadow-sm disabled:opacity-50"
      >Next</button>
      <select
        className="ml-2 rounded-lg border border-neutral-300 bg-white px-2 py-1 text-sm text-neutral-700 shadow-sm"
        value={pageSize}
        onChange={(e) => onSize(parseInt(e.target.value, 10))}
      >
        {[15, 20, 50].map(n => <option key={n} value={n}>{n} / page</option>)}
      </select>
    </div>
  );
}


===== components\admin\requests\ui\RequestDetails.ui.tsx =====
"use client";
import { RequestRow } from "@/lib/admin/types";

type Props = {
  open: boolean;
  onClose: () => void;
  request: RequestRow | null;
  onApprove?: (id: string) => void;
  onReject?: (id: string) => void;
};

export default function RequestDetailsUI({ open, onClose, request, onApprove, onReject }: Props) {
  if (!open || !request) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40">
      <div className="w-full max-w-xl rounded-xl bg-white p-6 shadow-xl">
        {/* header */}
        <div className="mb-3 flex items-center justify-between">
          <h2 className="text-lg font-semibold">Request {request.id}</h2>
          <button
            onClick={onClose}
            className="rounded px-2 py-1 text-neutral-500 hover:bg-neutral-100 hover:text-neutral-800"
            aria-label="Close"
          >
            ✕
          </button>
        </div>

        {/* body */}
        <div className="grid grid-cols-2 gap-x-6 gap-y-2 text-sm">
          <Label>Department</Label><Value>{request.dept}</Value>
          <Label>Date</Label><Value className="tabular-nums">{request.date}</Value>
          <Label>Status</Label><Value>{statusTag(request.status)}</Value>
          <Label>Requester</Label><Value>{request.requester ?? "—"}</Value>
          <Label>Vehicle</Label><Value>{request.vehicle ?? "—"}</Value>
          <Label>Driver</Label><Value>{request.driver ?? "—"}</Value>

          <div className="col-span-2 mt-3">
            <div className="text-sm font-medium text-neutral-600 mb-1">Purpose</div>
            <div className="rounded border bg-neutral-50 px-3 py-2">{request.purpose}</div>
          </div>
        </div>

        {/* footer */}
        <div className="mt-6 flex justify-end gap-2">
          {request.status === "Pending" && (
            <>
              <button
                onClick={() => onApprove?.(request.id)}
                className="rounded bg-green-600 px-3 py-1.5 text-sm text-white"
              >
                Approve
              </button>
              <button
                onClick={() => onReject?.(request.id)}
                className="rounded bg-red-600 px-3 py-1.5 text-sm text-white"
              >
                Reject
              </button>
            </>
          )}
          <button onClick={onClose} className="rounded bg-neutral-200 px-3 py-1.5 text-sm">
            Close
          </button>
        </div>
      </div>
    </div>
  );
}

function Label({ children }: { children: React.ReactNode }) {
  return <div className="text-neutral-500">{children}</div>;
}
function Value({ children, className = "" }: { children: React.ReactNode; className?: string }) {
  return <div className={`font-medium ${className}`}>{children}</div>;
}

function statusTag(s: RequestRow["status"]) {
  const c: Record<string, string> = {
    Pending: "bg-yellow-100 text-yellow-800",
    Approved: "bg-green-100 text-green-800",
    Completed: "bg-blue-100 text-blue-800",
    Rejected: "bg-red-100 text-red-800",
  };
  return <span className={`rounded px-2 py-1 text-xs font-medium ${c[s]}`}>{s}</span>;
}


===== components\admin\requests\ui\RequestDetailsModal.ui.tsx =====
"use client";
import * as React from "react";
import { RequestRow } from "@/lib/admin/types";

type Props = {
  open: boolean;
  onClose: () => void;
  row?: RequestRow;
  onApprove?: () => void;
  onReject?: () => void;
};

export default function RequestDetailsModalUI({
  open,
  onClose,
  row,
  onApprove,
  onReject,
}: Props) {
  React.useEffect(() => {
    function onEsc(e: KeyboardEvent) { if (e.key === "Escape") onClose(); }
    if (open) window.addEventListener("keydown", onEsc);
    return () => window.removeEventListener("keydown", onEsc);
  }, [open, onClose]);

  if (!open || !row) return null;
  const canAct = row.status === "Pending";

  return (
    <div
      className="fixed inset-0 z-50 flex items-start justify-center p-4 md:p-6"
      role="dialog"
      aria-modal="true"
      aria-labelledby="req-modal-title"
    >
      <div className="absolute inset-0 bg-black/40 backdrop-blur-[1px]" onClick={onClose} />

      <div className="relative w-[680px] max-w-[95vw] rounded-2xl bg-white shadow-2xl ring-1 ring-black/5">
        {/* Header */}
        <div className="flex items-center justify-between border-b px-5 py-3.5 md:px-6">
          <div className="flex items-center gap-3">
            <div className="grid h-9 w-9 place-items-center rounded-xl bg-neutral-100 text-neutral-700 text-sm font-semibold">
              TL
            </div>
            <div>
              <h2 id="req-modal-title" className="text-base md:text-lg font-semibold text-neutral-900">
                Request {row.id}
              </h2>
              <div className="mt-0.5 text-xs text-neutral-500">Details overview</div>
            </div>
          </div>

          <div className="flex items-center gap-3">
            <StatusBadge status={row.status} />
            <button
              aria-label="Close"
              onClick={onClose}
              className="rounded-lg border bg-white px-2.5 py-1.5 text-sm text-neutral-700 hover:bg-neutral-50 active:scale-[0.98]"
            >
              Close
            </button>
          </div>
        </div>

        {/* Body */}
        <div className="max-h-[70vh] overflow-auto px-5 py-5 md:px-6 md:py-6">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-3.5">
            <Field label="Department" value={row.dept} />
            <Field label="Date" value={row.date} />
            <Field label="Requester" value={row.requester ?? "—"} />
            <Field label="Driver" value={row.driver ?? "—"} />
            <Field label="Vehicle" value={row.vehicle ?? "—"} />
            <Field label="Purpose" value={row.purpose} className="md:col-span-2" tall />
          </div>
        </div>

        {/* Footer */}
        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3 border-t px-5 py-3.5 md:px-6">
          <div className="text-xs text-neutral-500">
            Updated just now • Read-only view
          </div>

          {canAct ? (
            <div className="flex items-center gap-2">
              <button
                onClick={onReject}
                className="rounded-lg bg-red-600 px-3.5 py-2 text-sm font-medium text-white hover:bg-red-700 active:scale-[0.98]"
              >
                Reject
              </button>
              <button
                onClick={onApprove}
                className="rounded-lg bg-green-600 px-3.5 py-2 text-sm font-medium text-white hover:bg-green-700 active:scale-[0.98]"
              >
                Approve
              </button>
            </div>
          ) : (
            <span className="text-sm text-neutral-500">No actions available</span>
          )}
        </div>
      </div>
    </div>
  );
}

/* ---- small pieces ---- */

function Field({
  label,
  value,
  className = "",
  tall = false,
}: {
  label: string;
  value: React.ReactNode;
  className?: string;
  tall?: boolean;
}) {
  return (
    <div className={className}>
      <div className="mb-1 text-[11px] font-semibold tracking-wide text-neutral-500">
        {label.toUpperCase()}
      </div>
      <div
        className={
          "w-full rounded-xl border border-neutral-200 bg-neutral-50 px-3 py-2 text-[14px] text-neutral-900 " +
          (tall ? "min-h-[56px]" : "h-10 flex items-center")
        }
      >
        {value}
      </div>
    </div>
  );
}

function StatusBadge({ status }: { status: RequestRow["status"] }) {
  const map: Record<RequestRow["status"], string> = {
    Pending: "bg-amber-100 text-amber-800 ring-amber-200",
    Approved: "bg-emerald-100 text-emerald-800 ring-emerald-200",
    Completed: "bg-blue-100 text-blue-800 ring-blue-200",
    Rejected: "bg-rose-100 text-rose-800 ring-rose-200",
  };
  return (
    <span className={`inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs font-medium ring-1 ${map[status]}`}>
      {status}
    </span>
  );
}


===== components\admin\requests\ui\RequestsCardGrid.ui.tsx =====
"use client";

import * as React from "react";
import {
  CalendarDays,
  Clock,
  User,
  Truck,
  Building2,
  UserCircle2,
} from "lucide-react";
import type { RequestRow, Pagination } from "@/lib/admin/types";

type Props = {
  rows?: RequestRow[];
  pagination: Pagination;
  onPageChange: (page: number) => void;

  /** Selection for bulk actions */
  selectedIds?: Set<string>;
  onToggleOne?: (id: string) => void;

  /** Row UX */
  onRowClick?: (row: RequestRow) => void;
  onApproveRow?: (id: string) => Promise<void>;
  onRejectRow?: (id: string) => Promise<void>;
};

export default function RequestsCardGridUI({
  rows,
  pagination,
  onPageChange,
  selectedIds,
  onToggleOne,
  onRowClick,
  onApproveRow,
  onRejectRow,
}: Props) {
  const safeRows = Array.isArray(rows) ? rows : [];
  const sel = selectedIds instanceof Set ? selectedIds : new Set<string>();

  return (
    <div className="rounded-2xl bg-transparent">
      {/* Responsive auto-fit grid */}
      <div className="grid gap-5 [grid-template-columns:repeat(auto-fit,minmax(320px,1fr))]">
        {safeRows.map((r) => (
          <Card
            key={r.id}
            row={r}
            selected={sel.has(r.id)}
            onToggle={() => onToggleOne?.(r.id)}
            onOpen={() => onRowClick?.(r)}
            onApprove={onApproveRow ? () => onApproveRow(r.id) : undefined}
            onReject={onRejectRow ? () => onRejectRow(r.id) : undefined}
          />
        ))}

        {safeRows.length === 0 && (
          <div className="col-span-full py-10 text-center text-sm text-neutral-500">
            No requests to show.
          </div>
        )}
      </div>

      {/* Pagination */}
      <div className="mt-6 flex items-center justify-end gap-2">
        <button
          disabled={pagination.page <= 1}
          onClick={() => onPageChange(pagination.page - 1)}
          className="rounded-lg border border-neutral-200 bg-white px-3 py-1.5 text-sm text-neutral-700 shadow-sm hover:bg-neutral-50 disabled:opacity-50"
        >
          Prev
        </button>
        <button
          disabled={
            pagination.page >=
            Math.ceil(pagination.total / Math.max(1, pagination.pageSize))
          }
          onClick={() => onPageChange(pagination.page + 1)}
          className="rounded-lg border border-neutral-200 bg-white px-3 py-1.5 text-sm text-neutral-700 shadow-sm hover:bg-neutral-50 disabled:opacity-50"
        >
          Next
        </button>
        <div className="ml-2 text-xs text-neutral-500">
          Page {pagination.page} of{" "}
          {Math.max(
            1,
            Math.ceil(pagination.total / Math.max(1, pagination.pageSize))
          )}
        </div>
      </div>
    </div>
  );
}

/* ---------- Subcomponents ---------- */

function Card({
  row,
  selected,
  onToggle,
  onOpen,
  onApprove,
  onReject,
}: {
  row: RequestRow;
  selected?: boolean;
  onToggle?: () => void;
  onOpen?: () => void;
  onApprove?: () => void;
  onReject?: () => void;
}) {
  const received =
    (row as any).receivedAt ??
    (row as any).createdAt ??
    (row as any).submittedAt ??
    "—";

  const canAct = row.status === "Pending";

  return (
    <div
      className={[
        "group relative rounded-xl bg-white shadow-md transition-all hover:shadow-lg",
        // BLUE OUTLINE WHEN SELECTED
        selected ? "ring-2 ring-blue-500 ring-offset-2" : "ring-0",
      ].join(" ")}
    >
      {/* Full-card click opens details (kept behind controls via z-index) */}
      <button
        type="button"
        onClick={onOpen}
        className="absolute inset-0 z-0 rounded-xl"
        aria-label={`Open ${row.id} details`}
      />

      {/* Header */}
      <div className="relative z-10 flex items-center justify-between border-b border-neutral-100 px-4 py-3">
        <div className="flex items-center gap-3">
          {/* Selection checkbox triggers bulk actions */}
          <input
            type="checkbox"
            aria-label={`Select ${row.id}`}
            checked={!!selected}
            onChange={(e) => {
              e.stopPropagation();
              onToggle?.();
            }}
            onClick={(e) => e.stopPropagation()}
            className="h-4 w-4 cursor-pointer accent-blue-600"
          />
          <button
            type="button"
            onClick={(e) => {
              e.stopPropagation();
              onOpen?.();
            }}
            className="text-[14px] font-semibold text-[#7a1f2a] hover:underline"
            title="Open details"
          >
            {row.id}
          </button>
        </div>
        <StatusBadge status={row.status} />
      </div>

      {/* Body */}
      <div className="relative z-10 space-y-3 px-4 py-3 text-[13px] text-neutral-800">
        <div className="font-medium text-neutral-700">{row.purpose}</div>

        <Field
          icon={<Clock className="h-4 w-4 text-[#7a1f2a]" />}
          label="Received"
          value={received}
        />
        <Field
          icon={<CalendarDays className="h-4 w-4 text-[#7a1f2a]" />}
          label="Date"
          value={row.date}
        />
        <Field
          icon={<Building2 className="h-4 w-4 text-[#7a1f2a]" />}
          label="Department"
          value={row.dept}
        />
        <Field
          icon={<User className="h-4 w-4 text-[#7a1f2a]" />}
          label="Driver"
          value={row.driver ?? "—"}
        />
        <Field
          icon={<UserCircle2 className="h-4 w-4 text-[#7a1f2a]" />}
          label="Requester"
          value={row.requester ?? "—"}
        />
        <Field
          icon={<Truck className="h-4 w-4 text-[#7a1f2a]" />}
          label="Vehicle"
          value={row.vehicle ?? "—"}
        />
      </div>

      {/* Footer (actions won’t open details) */}
      <div className="relative z-10 flex items-center justify-end gap-2 border-t border-neutral-100 px-4 py-3">
        {canAct ? (
          <>
            <button
              className="rounded-lg bg-rose-600 px-3 py-1.5 text-xs font-medium text-white shadow-sm hover:bg-rose-700"
              onClick={(e) => {
                e.stopPropagation();
                onReject?.();
              }}
            >
              Reject
            </button>
            <button
              className="rounded-lg bg-emerald-600 px-3 py-1.5 text-xs font-medium text-white shadow-sm hover:bg-emerald-700"
              onClick={(e) => {
                e.stopPropagation();
                onApprove?.();
              }}
            >
              Approve
            </button>
          </>
        ) : (
          <span className="text-xs text-neutral-400">No actions available</span>
        )}
      </div>
    </div>
  );
}

function Field({
  icon,
  label,
  value,
}: {
  icon: React.ReactNode;
  label: string;
  value: string;
}) {
  return (
    <div className="flex items-center gap-2">
      {icon}
      <div>
        <div className="text-[11px] uppercase text-neutral-500">{label}</div>
        <div className="text-[13px] text-neutral-800">{value}</div>
      </div>
    </div>
  );
}

function StatusBadge({ status }: { status: RequestRow["status"] }) {
  const c: Record<RequestRow["status"], string> = {
    Pending: "bg-amber-100 text-amber-800",
    Approved: "bg-emerald-100 text-emerald-800",
    Completed: "bg-blue-100 text-blue-800",
    Rejected: "bg-rose-100 text-rose-800",
  };
  return (
    <span className={`rounded-full px-2 py-0.5 text-xs font-medium ${c[status]}`}>
      {status}
    </span>
  );
}


===== components\admin\requests\ui\RequestsSummary.ui.tsx =====
import { RequestsSummary } from "@/lib/admin/types";
import { Clock, CheckCircle2, Flag, XCircle } from "lucide-react";

export default function RequestsSummaryUI({ summary }: { summary: RequestsSummary }) {
  return (
    <div className="grid grid-cols-2 gap-4 md:grid-cols-4">
      <Card
        label="Pending"
        value={summary.pending}
        icon={<Clock className="h-5 w-5 text-amber-600" />}
        barColor="bg-amber-500"
        pillColor="bg-amber-100 text-amber-700"
      />
      <Card
        label="Approved"
        value={summary.approved}
        icon={<CheckCircle2 className="h-5 w-5 text-emerald-600" />}
        barColor="bg-emerald-500"
        pillColor="bg-emerald-100 text-emerald-700"
      />
      <Card
        label="Completed"
        value={summary.completed}
        icon={<Flag className="h-5 w-5 text-blue-600" />}
        barColor="bg-blue-500"
        pillColor="bg-blue-100 text-blue-700"
      />
      <Card
        label="Rejected"
        value={summary.rejected}
        icon={<XCircle className="h-5 w-5 text-rose-600" />}
        barColor="bg-rose-500"
        pillColor="bg-rose-100 text-rose-700"
      />
    </div>
  );
}

function Card({
  label,
  value,
  icon,
  barColor,
  pillColor,
}: {
  label: string;
  value: number;
  icon: React.ReactNode;
  barColor: string;
  pillColor: string;
}) {
  return (
    <div className="flex flex-col rounded-xl border border-neutral-200 bg-white p-4 shadow-sm transition hover:shadow-md">
      <div className="flex items-center justify-between">
        <span className={`rounded-full px-2 py-0.5 text-xs font-medium ${pillColor}`}>
          {label}
        </span>
        {icon}
      </div>

      <div className="mt-3 text-3xl font-semibold text-neutral-800">{value}</div>

      <div className="mt-3 h-1.5 w-full overflow-hidden rounded-full bg-neutral-100">
        <div
          className={`h-full ${barColor}`}
          style={{ width: `${Math.min(100, value * 20)}%` }} // mock width (adjust as needed)
        />
      </div>
    </div>
  );
}


===== components\admin\requests\ui\RequestsTable.ui.tsx =====
// src/components/admin/requests/ui/RequestsTable.ui.tsx
"use client";

import * as React from "react";
import type { RequestRow, Pagination, FilterState } from "@/lib/admin/types";
import StatusBadge from "./StatusBadge";
import PaginationUI from "./Pagination";
import RequestsToolbar from "@/components/admin/requests/toolbar/RequestsToolbar.ui";

type Props = {
  rows: RequestRow[];
  pagination: Pagination;

  tableSearch: string;
  onTableSearch?: (q: string) => void;
  sortDir?: "asc" | "desc";
  onSortDirChange?: (d: "asc" | "desc") => void;
  onAddNew?: () => void;

  filterControls: {
    draft: FilterState;
    onDraftChange: (n: Partial<FilterState>) => void;
    onApply: () => void;
    onClearAll: () => void;
  };

  selectedIds?: Set<string>;
  onToggleOne: (id: string) => void;
  onToggleAllOnPage: (checked: boolean, idsOnPage: string[]) => void;

  onRowClick?: (row: RequestRow) => void;
  onRowViewDetails?: (row: RequestRow) => void;

  onPageChange: (page: number) => void;
  onPageSizeChange: (size: number) => void;

  onApproveRow?: (id: string) => Promise<void>;
  onRejectRow?: (id: string) => Promise<void>;
};

export default function RequestsTable(props: Props) {
  const {
    rows, pagination,
    tableSearch, onTableSearch,
    sortDir = "desc", onSortDirChange, onAddNew,
    filterControls, selectedIds,
    onToggleOne, onToggleAllOnPage,
    onRowClick, onRowViewDetails,
    onPageChange, onPageSizeChange,
    onApproveRow, onRejectRow
  } = props;

  const set = selectedIds ?? new Set<string>();
  const idsOnPage = rows.map(r => r.id);
  const allChecked = idsOnPage.length > 0 && idsOnPage.every(id => set.has(id));
  const indeterminate = !allChecked && idsOnPage.some(id => set.has(id));

  return (
    <div className="rounded-2xl border border-neutral-200 bg-white shadow-sm">
      {/* Sticky toolbar — sits under KPI */}
      <div className="admin-sticky-toolbar px-3 py-2">
        <RequestsToolbar
          q={tableSearch}
          onQChange={onTableSearch ?? (() => {})}
          sort={sortDir === "desc" ? "newest" : "oldest"}
          onSortChange={(s) => onSortDirChange?.(s === "newest" ? "desc" : "asc")}
          onAddNew={onAddNew ?? (() => {})}
          draft={filterControls.draft}
          onDraftChange={filterControls.onDraftChange}
          onApply={filterControls.onApply}
          onClearAll={filterControls.onClearAll}
        />
      </div>

      <div className="overflow-x-auto">
        {/* border-separate + spacing:0 keeps columns aligned with sticky thead */}
        <table className="w-full table-fixed text-sm border-separate [border-spacing:0]">
          <colgroup>
            {[44,110,140,null,170,120,120,150].map((w,i) => (
              <col key={i} style={w ? { width: w } : undefined} />
            ))}
          </colgroup>

          {/* ✅ sticky THEAD (inline top for reliability) */}
          <thead
            className="admin-thead-sticky sticky bg-white/90 backdrop-blur"
            style={{ top: "var(--stack-offset)" }}
          >
            <tr className="text-neutral-600">
              <Th>
                <input
                  aria-label="Select all on page"
                  type="checkbox"
                  checked={allChecked}
                  ref={(el) => { if (el) el.indeterminate = indeterminate; }}
                  onChange={(e) => onToggleAllOnPage(e.currentTarget.checked, idsOnPage)}
                />
              </Th>
              <Th>ID</Th>
              <Th>Department</Th>
              <Th className="truncate">Purpose</Th>
              <Th>Received</Th>
              <Th>Date</Th>
              <Th>Status</Th>
              <Th className="text-right">Actions</Th>
            </tr>
          </thead>

          <tbody className="[&_tr:nth-child(even)]:bg-neutral-50/40">
            {rows.map((r) => (
              <tr
                key={r.id}
                className="border-t border-neutral-200 hover:bg-neutral-50/80"
                onClick={() => onRowClick?.(r)}
              >
                <Td onClick={(e) => e.stopPropagation()}>
                  <input
                    aria-label={`Select ${r.id}`}
                    type="checkbox"
                    checked={set.has(r.id)}
                    onChange={() => onToggleOne(r.id)}
                  />
                </Td>

                <Td onClick={(e) => e.stopPropagation()}>
                  <button
                    className="text-[13px] font-semibold text-[#7a1f2a] underline-offset-2 hover:underline"
                    onClick={() => onRowViewDetails?.(r)}
                  >
                    {r.id}
                  </button>
                </Td>

                <Td>{r.dept}</Td>
                <Td className="truncate" title={r.purpose}>{r.purpose}</Td>
                <Td className="tabular-nums whitespace-nowrap">
                  {(r as any).receivedAt ?? (r as any).createdAt ?? "—"}
                </Td>
                <Td className="tabular-nums whitespace-nowrap">{r.date}</Td>
                <Td><StatusBadge status={r.status} /></Td>

                <Td className="text-right" onClick={(e) => e.stopPropagation()}>
                  {r.status === "Pending" ? (
                    <div className="inline-flex gap-2">
                      <button
                        className="rounded-lg bg-emerald-600 px-2.5 py-1 text-xs text-white"
                        onClick={() => onApproveRow?.(r.id)}
                      >
                        Approve
                      </button>
                      <button
                        className="rounded-lg bg-rose-600 px-2.5 py-1 text-xs text-white"
                        onClick={() => onRejectRow?.(r.id)}
                      >
                        Reject
                      </button>
                    </div>
                  ) : (
                    <span className="text-neutral-400">—</span>
                  )}
                </Td>
              </tr>
            ))}

            {rows.length === 0 && (
              <tr>
                <Td className="py-12 text-center text-neutral-500" colSpan={8}>
                  No requests to show.
                </Td>
              </tr>
            )}
          </tbody>
        </table>
      </div>

      <div className="flex flex-wrap items-center justify-between gap-3 px-3 py-2">
        <div className="text-xs text-neutral-500">
          Page {pagination.page} of {Math.max(1, Math.ceil(pagination.total / pagination.pageSize))}
          · Showing {Math.min(pagination.pageSize, rows.length)} of {pagination.total}
        </div>
        <PaginationUI
          page={pagination.page}
          pageSize={pagination.pageSize}
          total={pagination.total}
          onPage={onPageChange}
          onSize={onPageSizeChange}
        />
      </div>
    </div>
  );
}

/* cells */
function Th({ children, className = "" }: { children: React.ReactNode; className?: string }) {
  return <th className={`px-4 py-3 text-left text-xs font-semibold ${className}`}>{children}</th>;
}
function Td({
  children,
  className = "",
  colSpan,
  ...rest
}: {
  children: React.ReactNode;
  className?: string;
  colSpan?: number;
} & React.HTMLAttributes<HTMLTableCellElement>) {
  return (
    <td className={`px-4 py-3 align-middle text-[13px] text-neutral-800 ${className}`} colSpan={colSpan} {...rest}>
      {children}
    </td>
  );
}


===== components\admin\requests\ui\SavedViewsMenu.ui.tsx =====
"use client";
import * as React from "react";
import type { FilterState } from "@/lib/admin/types";

type SavedView = { name: string; filters: FilterState };

export default function SavedViewsMenu({
  views,
  onApplyView,
  onSaveCurrent,
  onDeleteView,
}: {
  views: SavedView[];
  onApplyView: (v: SavedView) => void;
  onSaveCurrent: () => void;
  onDeleteView: (name: string) => void;
}) {
  const [open, setOpen] = React.useState(false);

  return (
    <div className="relative">
      <button className="rounded border px-3 py-1 text-sm" onClick={() => setOpen((o) => !o)}>
        Saved Views
      </button>
      {open && (
        <div className="absolute z-30 mt-2 w-64 rounded border bg-white p-2 shadow">
          <div className="flex items-center justify-between">
            <div className="text-sm font-medium">Presets</div>
            <button className="text-xs text-blue-600" onClick={onSaveCurrent}>Save current</button>
          </div>
          <div className="mt-2 space-y-1">
            {views.length === 0 && <div className="text-xs text-neutral-500">No presets yet.</div>}
            {views.map((v) => (
              <div key={v.name} className="flex items-center justify-between rounded px-2 py-1 hover:bg-neutral-50">
                <button className="text-sm text-blue-700" onClick={() => onApplyView(v)}>
                  {v.name}
                </button>
                <button className="text-xs text-red-600" onClick={() => onDeleteView(v.name)}>
                  Delete
                </button>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}


===== components\admin\requests\ui\StatusBadge.tsx =====
"use client";
import type { RequestRow } from "@/lib/admin/types";

export default function StatusBadge({ status }: { status: RequestRow["status"] }) {
  const c: Record<RequestRow["status"], string> = {
    Pending: "bg-amber-100 text-amber-800",
    Approved: "bg-emerald-100 text-emerald-800",
    Completed: "bg-blue-100 text-blue-800",
    Rejected: "bg-rose-100 text-rose-800",
  };
  return <span className={`rounded-full px-2 py-0.5 text-xs font-medium ${c[status]}`}>{status}</span>;
}


===== components\admin\requests\ui\ViewToggle.ui.tsx =====
"use client";

import { LayoutList, LayoutGrid } from "lucide-react";

export default function ViewToggleUI({
  view,
  onChange,
  className = "",
}: {
  view: "table" | "card";
  onChange: (v: "table" | "card") => void;
  className?: string;
}) {
  return (
    <div className={`flex items-center justify-end gap-2 ${className}`}>
      <button
        onClick={() => onChange("table")}
        title="Table view (T)"
        className={`rounded-lg p-2 shadow-sm transition-colors outline-none focus:ring-2 focus:ring-[#7a1f2a]/30 ${
          view === "table"
            ? "bg-[#7a1f2a] text-white"
            : "bg-white text-neutral-600 hover:bg-neutral-50 border border-neutral-200"
        }`}
      >
        <LayoutList className="h-4 w-4" />
      </button>
      <button
        onClick={() => onChange("card")}
        title="Card view (C)"
        className={`rounded-lg p-2 shadow-sm transition-colors outline-none focus:ring-2 focus:ring-[#7a1f2a]/30 ${
          view === "card"
            ? "bg-[#7a1f2a] text-white"
            : "bg-white text-neutral-600 hover:bg-neutral-50 border border-neutral-200"
        }`}
      >
        <LayoutGrid className="h-4 w-4" />
      </button>
    </div>
  );
}


===== components\admin\schedule\filters\ScheduleFilterDropdown.ui.tsx =====
"use client";
import * as React from "react";
import { Filter as FilterIcon, ChevronDown } from "lucide-react";
import type { ScheduleFilterState } from "@/lib/admin/schedule/filters";
import { ScheduleRepo } from "@/lib/admin/schedule/store";

const statuses: Array<ScheduleFilterState["status"]> = [
  "All",
  "PLANNED",
  "ONGOING",
  "COMPLETED",
  "CANCELLED",
];

// Local, tiny outside-click hook (so no missing import errors)
function useOutsideClick(
  ref: React.RefObject<HTMLElement | null>,
  onClickOutside: () => void
) {
  React.useEffect(() => {
    function onDocClick(e: MouseEvent) {
      const el = ref.current;
      if (!el) return;
      if (!el.contains(e.target as Node)) onClickOutside();
    }
    document.addEventListener("mousedown", onDocClick);
    return () => document.removeEventListener("mousedown", onDocClick);
  }, [ref, onClickOutside]);
}

export default function ScheduleFilterDropdownUI({
  draft,
  onDraftChange,
  onApply,
  onClearAll,
}: {
  draft: ScheduleFilterState;
  onDraftChange: (n: Partial<ScheduleFilterState>) => void;
  onApply: () => void;
  onClearAll: () => void;
}) {
  const [open, setOpen] = React.useState(false);
  const ref = React.useRef<HTMLDivElement | null>(null);
  useOutsideClick(ref, () => setOpen(false));

  const drivers = ScheduleRepo.constants.drivers;
  const vehicles = ScheduleRepo.constants.vehicles;

  // ✅ define as a normal function so TSX doesn’t think it’s JSX
  function set<K extends keyof ScheduleFilterState>(
    k: K,
    v: ScheduleFilterState[K]
  ) {
    onDraftChange({ [k]: v } as Pick<ScheduleFilterState, K>);
  }

  const hasActive =
    draft.status !== "All" ||
    draft.driver !== "All" ||
    draft.vehicle !== "All" ||
    !!draft.from ||
    !!draft.to ||
    !!(draft.search && draft.search.trim());

  return (
    <div className="relative" ref={ref}>
      <button
        type="button"
        onClick={(e) => {
          e.stopPropagation();
          setOpen((v) => !v);
        }}
        aria-haspopup="menu"
        aria-expanded={open}
        className="inline-flex items-center gap-2 rounded-full border border-neutral-300 bg-white px-3 py-1.5 text-sm text-neutral-700 shadow-sm hover:bg-neutral-50"
      >
        <FilterIcon
          className={`h-4 w-4 ${
            hasActive ? "text-[#7a1f2a]" : "text-neutral-500"
          }`}
        />
        <span>Filter</span>
        <ChevronDown className="h-4 w-4 text-neutral-500" />
      </button>

      {open && (
        <div
          className="absolute left-0 z-30 mt-2 w-[340px] rounded-xl border border-neutral-200 bg-white p-3 text-sm shadow-xl"
          onClick={(e) => e.stopPropagation()}
        >
          <Field label="Status">
            <select
              className="w-full rounded-lg border px-2 py-2"
              value={draft.status}
              onChange={(e) => set("status", e.target.value as any)}
            >
              {statuses.map((s) => (
                <option key={s} value={s}>
                  {s}
                </option>
              ))}
            </select>
          </Field>

          <Field label="Driver">
            <select
              className="w-full rounded-lg border px-2 py-2"
              value={draft.driver}
              onChange={(e) => set("driver", (e.target.value as any) || "All")}
            >
              <option value="All">All</option>
              {drivers.map((d) => (
                <option key={d.id} value={d.id}>
                  {d.name}
                </option>
              ))}
            </select>
          </Field>

          <Field label="Vehicle">
            <select
              className="w-full rounded-lg border px-2 py-2"
              value={draft.vehicle}
              onChange={(e) =>
                set("vehicle", (e.target.value as any) || "All")
              }
            >
              <option value="All">All</option>
              {vehicles.map((v) => (
                <option key={v.id} value={v.id}>
                  {v.label} ({v.plateNo})
                </option>
              ))}
            </select>
          </Field>

          <div className="grid grid-cols-2 gap-2">
            <Field label="From">
              <input
                type="date"
                className="w-full rounded-lg border px-2 py-2"
                value={draft.from || ""}
                onChange={(e) => set("from", (e.target.value as any) || "")}
              />
            </Field>
            <Field label="To">
              <input
                type="date"
                className="w-full rounded-lg border px-2 py-2"
                value={draft.to || ""}
                onChange={(e) => set("to", (e.target.value as any) || "")}
              />
            </Field>
          </div>

          <Field label="Mode">
            <select
              className="w-full rounded-lg border px-2 py-2"
              value={draft.mode}
              onChange={(e) => set("mode", e.target.value as any)}
            >
              <option value="auto">Auto (instant)</option>
              <option value="apply">Apply (manual)</option>
            </select>
          </Field>

          <div className="grid grid-cols-2 gap-2 pt-1">
            <button
              className="rounded-lg border px-3 py-2 text-sm"
              onClick={() => {
                onClearAll();
                setOpen(false);
              }}
            >
              Clear All
            </button>
            <button
              className="rounded-lg bg-[#7a1f2a] px-3 py-2 text-sm font-medium text-white"
              onClick={() => {
                if (draft.mode === "apply") onApply();
                setOpen(false);
              }}
            >
              Apply
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

function Field({
  label,
  children,
}: {
  label: string;
  children: React.ReactNode;
}) {
  return (
    <div className="mb-3 space-y-1">
      <div className="text-xs font-medium text-neutral-600">{label}</div>
      {children}
    </div>
  );
}


===== components\admin\schedule\forms\CreateScheduleDialog.ui.tsx =====
"use client";
import * as React from "react";
import MapPicker, { PickedPlace } from "@/components/common/MapPicker.ui";

// ---- types the container will import ----
export type CreateForm = {
  requestId: string | null;
  title: string;
  origin: string;
  destination: string;
  date: string;         // yyyy-mm-dd
  startTime: string;    // HH:mm
  endTime: string;      // HH:mm
  driverId: string;
  vehicleId: string;
  status: "PLANNED" | "ONGOING" | "COMPLETED" | "CANCELLED";
  notes: string;
  // optional structured places (saved by container if you want)
  originPlace?: PickedPlace | null;
  destinationPlace?: PickedPlace | null;
};

export type DriverOption = { id: string; name: string; busy?: boolean };
export type VehicleOption = { id: string; label: string; plateNo: string; busy?: boolean };

type Props = {
  open: boolean;
  tripIdPreview: string;
  form: CreateForm;
  drivers: DriverOption[];
  vehicles: VehicleOption[];
  driverConflicts: Array<{ id: string; title: string; date: string; startTime: string; endTime: string }>;
  vehicleConflicts: Array<{ id: string; title: string; date: string; startTime: string; endTime: string }>;
  disableSave: boolean;

  onChange: (patch: Partial<CreateForm>) => void;
  onClose: () => void;
  onSave: () => void;
};

export default function CreateScheduleDialogUI({
  open,
  tripIdPreview,
  form,
  drivers,
  vehicles,
  driverConflicts,
  vehicleConflicts,
  disableSave,
  onChange,
  onClose,
  onSave,
}: Props) {
  const [openOriginMap, setOpenOriginMap] = React.useState(false);
  const [openDestMap, setOpenDestMap] = React.useState(false);

  if (!open) return null;

  return (
    <div className="fixed inset-0 z-50 grid place-items-center bg-black/40 p-4" onClick={onClose}>
      <div
        className="w-full max-w-2xl rounded-2xl bg-white shadow-xl"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Header */}
        <div className="flex items-center justify-between border-b px-5 py-4">
          <h3 className="text-lg font-semibold">
            {form?.requestId ? "Edit schedule" : "Create schedule"}
          </h3>
          <div className="text-xs text-neutral-500">
            Trip ID (auto):{" "}
            <code className="rounded bg-neutral-50 px-1.5 py-0.5">{tripIdPreview || "—"}</code>
          </div>
        </div>

        {/* Body */}
        <div className="grid grid-cols-2 gap-3 px-5 py-4">
          {/* Title */}
          <div className="col-span-2">
            <label className="mb-1 block text-xs font-medium text-neutral-600">Title</label>
            <input
              className="h-11 w-full rounded-lg border px-3"
              placeholder="e.g., Campus shuttle"
              value={form.title}
              onChange={(e) => onChange({ title: e.target.value })}
            />
          </div>

          {/* Origin */}
          <div>
            <label className="mb-1 block text-xs font-medium text-neutral-600">Origin</label>
            <div className="flex">
              <input
                className="h-11 w-full rounded-l-lg border border-r-0 px-3"
                placeholder="Pick-up point"
                value={form.origin}
                onChange={(e) => onChange({ origin: e.target.value })}
              />
              <button
                type="button"
                onClick={() => setOpenOriginMap(true)}
                className="h-11 rounded-r-lg border border-l-0 px-3 text-sm text-[#7A0010] hover:bg-neutral-50"
                title="Pick on map"
              >
                Pick on map
              </button>
            </div>
          </div>

          {/* Destination */}
          <div>
            <label className="mb-1 block text-xs font-medium text-neutral-600">Destination</label>
            <div className="flex">
              <input
                className="h-11 w-full rounded-l-lg border border-r-0 px-3"
                placeholder="Drop-off point"
                value={form.destination}
                onChange={(e) => onChange({ destination: e.target.value })}
              />
              <button
                type="button"
                onClick={() => setOpenDestMap(true)}
                className="h-11 rounded-r-lg border border-l-0 px-3 text-sm text-[#7A0010] hover:bg-neutral-50"
                title="Pick on map"
              >
                Pick on map
              </button>
            </div>
          </div>

          {/* Date */}
          <div>
            <label className="mb-1 block text-xs font-medium text-neutral-600">Date</label>
            <input
              type="date"
              className="h-11 w-full rounded-lg border px-3"
              value={form.date}
              onChange={(e) => onChange({ date: e.target.value })}
            />
          </div>

          {/* Time */}
          <div className="flex gap-2">
            <div className="flex-1">
              <label className="mb-1 block text-xs font-medium text-neutral-600">Start</label>
              <input
                type="time"
                className="h-11 w-full rounded-lg border px-3"
                value={form.startTime}
                onChange={(e) => onChange({ startTime: e.target.value })}
              />
            </div>
            <div className="flex-1">
              <label className="mb-1 block text-xs font-medium text-neutral-600">End</label>
              <input
                type="time"
                className="h-11 w-full rounded-lg border px-3"
                value={form.endTime}
                onChange={(e) => onChange({ endTime: e.target.value })}
              />
            </div>
          </div>

          {/* Driver */}
          <div>
            <label className="mb-1 block text-xs font-medium text-neutral-600">Driver</label>
            <select
              className="h-11 w-full rounded-lg border px-3"
              value={form.driverId}
              onChange={(e) => onChange({ driverId: e.target.value })}
            >
              {!drivers.length && <option value="">No drivers configured</option>}
              {drivers.map((d) => (
                <option key={d.id} value={d.id} disabled={d.busy}>
                  {d.name} {d.busy ? " • busy" : ""}
                </option>
              ))}
            </select>
          </div>

          {/* Vehicle */}
          <div>
            <label className="mb-1 block text-xs font-medium text-neutral-600">Vehicle</label>
            <select
              className="h-11 w-full rounded-lg border px-3"
              value={form.vehicleId}
              onChange={(e) => onChange({ vehicleId: e.target.value })}
            >
              {!vehicles.length && <option value="">No vehicles configured</option>}
              {vehicles.map((v) => (
                <option key={v.id} value={v.id} disabled={v.busy}>
                  {v.label} ({v.plateNo}) {v.busy ? " • busy" : ""}
                </option>
              ))}
            </select>
          </div>

          {/* Status */}
          <div>
            <label className="mb-1 block text-xs font-medium text-neutral-600">Status</label>
            <select
              className="h-11 w-full rounded-lg border px-3"
              value={form.status}
              onChange={(e) => onChange({ status: e.target.value as CreateForm["status"] })}
            >
              <option value="PLANNED">PLANNED</option>
              <option value="ONGOING">ONGOING</option>
              <option value="COMPLETED">COMPLETED</option>
              <option value="CANCELLED">CANCELLED</option>
            </select>
          </div>

          {/* Notes */}
          <div className="col-span-2">
            <label className="mb-1 block text-xs font-medium text-neutral-600">
              Notes (optional)
            </label>
            <textarea
              className="min-h-[90px] w-full rounded-lg border px-3 py-2"
              placeholder="Anything the driver needs to know…"
              value={form.notes}
              onChange={(e) => onChange({ notes: e.target.value })}
            />
          </div>

          {/* Warnings */}
          {(driverConflicts.length || vehicleConflicts.length) > 0 && (
            <div className="col-span-2 rounded-lg border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-900">
              <div className="mb-1 font-medium">Conflicts</div>
              {driverConflicts.length > 0 && (
                <div className="mb-1">
                  <span className="font-medium">Driver</span> is busy:
                  {driverConflicts.map((c) => (
                    <div key={c.id}>• {c.title} — {c.date} {c.startTime}-{c.endTime}</div>
                  ))}
                </div>
              )}
              {vehicleConflicts.length > 0 && (
                <div>
                  <span className="font-medium">Vehicle</span> is busy:
                  {vehicleConflicts.map((c) => (
                    <div key={c.id}>• {c.title} — {c.date} {c.startTime}-{c.endTime}</div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>

        {/* Footer */}
        <div className="flex items-center justify-end gap-2 border-t px-5 py-3">
          <button onClick={onClose} className="h-10 rounded-lg border px-4">
            Cancel
          </button>
          <button
            onClick={onSave}
            disabled={disableSave}
            className="h-10 rounded-lg bg-[#7A0010] px-4 text-white disabled:opacity-50"
          >
            Save
          </button>
        </div>

        {/* Map pickers */}
        <MapPicker
          open={openOriginMap}
          initial={form.originPlace ?? null}
          onClose={() => setOpenOriginMap(false)}
          onPick={(p) => {
            // update both plain text and structured place
            onChange({ origin: p.address, originPlace: p });
            setOpenOriginMap(false);
          }}
        />
        <MapPicker
          open={openDestMap}
          initial={form.destinationPlace ?? null}
          onClose={() => setOpenDestMap(false)}
          onPick={(p) => {
            onChange({ destination: p.address, destinationPlace: p });
            setOpenDestMap(false);
          }}
        />
      </div>
    </div>
  );
}


===== components\admin\schedule\forms\CreateScheduleDialogs.container.tsx =====
"use client";
import * as React from "react";
import CreateScheduleDialogUI, {
  CreateForm,
  DriverOption,
  VehicleOption,
} from "./CreateScheduleDialog.ui";

import { ScheduleRepo } from "@/lib/admin/schedule/store";
import type { Schedule } from "@/lib/admin/schedule/types";
import {
  isDriverAvailable,
  isVehicleAvailable,
  conflictsForDriver,
  conflictsForVehicle,
} from "@/lib/admin/schedule/utils";

type Props = {
  open: boolean;
  initial?: Partial<Schedule>;
  onClose: () => void;
  onSubmit: (data: Omit<Schedule, "id" | "createdAt" | "tripId">) => void;
};

const makeInit = (initial?: Partial<Schedule>): CreateForm => {
  const { drivers, vehicles } = ScheduleRepo.constants;
  return {
    requestId: initial?.requestId ?? null,
    title: initial?.title ?? "",
    origin: initial?.origin ?? "",
    destination: initial?.destination ?? "",
    date: initial?.date ?? new Date().toISOString().slice(0, 10),
    startTime: initial?.startTime ?? "08:00",
    endTime: initial?.endTime ?? "09:00",
    driverId: initial?.driverId ?? drivers[0].id,
    vehicleId: initial?.vehicleId ?? vehicles[0].id,
    status: (initial?.status as Schedule["status"]) ?? "PLANNED",
    notes: initial?.notes ?? "",
    // fields that CreateForm carries for the map picker
    originPlace: null,
    destinationPlace: null,
  };
};

export default function CreateScheduleDialog({ open, initial, onClose, onSubmit }: Props) {
  const [form, setForm] = React.useState<CreateForm>(makeInit(initial));

  React.useEffect(() => {
    if (open) setForm(makeInit(initial));
  }, [open, initial]);

  const snapshot = ScheduleRepo.list();
  const editingId = (initial?.id as string | undefined) ?? undefined;

  const probe: Schedule = {
    id: editingId || "new",
    createdAt: new Date().toISOString(),
    tripId: "PREVIEW",
    ...form,
  };

  // options with busy flags
  const drivers: DriverOption[] = ScheduleRepo.constants.drivers.map((d) => ({
    id: d.id,
    name: d.name,
    busy: !isDriverAvailable(snapshot, d.id, probe, editingId),
  }));

  const vehicles: VehicleOption[] = ScheduleRepo.constants.vehicles.map((v) => ({
    id: v.id,
    label: v.label,
    plateNo: v.plateNo,
    busy: !isVehicleAvailable(snapshot, v.id, probe, editingId),
  }));

  const driverConflicts = conflictsForDriver(snapshot, form.driverId, probe, editingId);
  const vehicleConflicts = conflictsForVehicle(snapshot, form.vehicleId, probe, editingId);
  const disableSave = driverConflicts.length > 0 || vehicleConflicts.length > 0;

  const tripIdPreview = ScheduleRepo.peekTripId(form.date);

  return (
    <CreateScheduleDialogUI
      open={open}
      tripIdPreview={tripIdPreview}
      form={form}
      drivers={drivers}
      vehicles={vehicles}
      driverConflicts={driverConflicts}
      vehicleConflicts={vehicleConflicts}
      disableSave={disableSave}
      onChange={(patch) => setForm((p) => ({ ...p, ...patch }))}
      onClose={onClose}
      onSave={() => {
        if (disableSave) return;
        // Submit only the Schedule fields expected by onSubmit
        const { originPlace, destinationPlace, ...rest } = form;
        onSubmit(rest);
      }}
    />
  );
}


===== components\admin\schedule\hooks\useScheduleFilters.ts =====
"use client";
import * as React from "react";
import {
  DEFAULT_SCH_FILTERS,
  type ScheduleFilterState,
} from "@/lib/admin/schedule/filters";

export function useScheduleFilters(
  initial: ScheduleFilterState = DEFAULT_SCH_FILTERS
) {
  const [applied, setApplied] =
    React.useState<ScheduleFilterState>(initial);
  const [draft, setDraft] =
    React.useState<ScheduleFilterState>(initial);

  const update = React.useCallback(
    (next: Partial<ScheduleFilterState>) => {
      const n = { ...draft, ...next };
      setDraft(n);
      if (n.mode === "auto") setApplied(n);
    },
    [draft]
  );

  const apply = React.useCallback(() => setApplied(draft), [draft]);
  const clearAll = React.useCallback(() => {
    setDraft(DEFAULT_SCH_FILTERS);
    setApplied(DEFAULT_SCH_FILTERS);
  }, []);

  return { draft, applied, update, apply, clearAll, setDraft };
}


===== components\admin\schedule\kpi\useScheduleKpis.ts =====
"use client";
import * as React from "react";
import { ScheduleRepo } from "@/lib/admin/schedule/store";
import type { Schedule } from "@/lib/admin/schedule/types";

function startOfWeek(d = new Date()) {
  const x = new Date(d); const day = (x.getDay() + 6) % 7; // Mon=0
  x.setHours(0,0,0,0); x.setDate(x.getDate() - day); return x;
}
function endOfWeek(d = new Date()) {
  const s = startOfWeek(d); const e = new Date(s); e.setDate(s.getDate()+6); e.setHours(23,59,59,999); return e;
}
function within(dateStr: string, a: Date, b: Date) {
  const d = new Date(dateStr + "T00:00:00"); return d >= a && d <= b;
}
function inNextDays(dateStr: string, days: number) {
  const today = new Date(); today.setHours(0,0,0,0);
  const end = new Date(today); end.setDate(end.getDate()+days);
  return within(dateStr, today, end);
}
function inPrevDays(dateStr: string, days: number) {
  const end = new Date(); end.setHours(23,59,59,999);
  const start = new Date(end); start.setDate(end.getDate()-days);
  return within(dateStr, start, end);
}

export function useScheduleKpis() {
  const [rows, setRows] = React.useState<Schedule[]>(() => ScheduleRepo.list());

  const refresh = React.useCallback(() => setRows(ScheduleRepo.list()), []);
  // Let callers trigger refresh after mutations
  const kpis = React.useMemo(() => {
    const weekStart = startOfWeek();
    const weekEnd = endOfWeek();

    const thisWeek = rows.filter(r => within(r.date, weekStart, weekEnd)).length;

    const todayStr = new Date().toISOString().slice(0,10);
    const today = rows.filter(r => r.date === todayStr).length;
    const ongoingNow = 0; // simplified; status badge already shows ongoing

    const last7Total = rows.filter(r => inPrevDays(r.date, 7)).length;
    const last7Done = rows.filter(r => inPrevDays(r.date, 7) && r.status === "COMPLETED").length;
    const completionRate = last7Total ? Math.round((last7Done / last7Total) * 100) : 0;

    const upcoming7 = rows.filter(r => inNextDays(r.date, 7) && (r.status === "PLANNED" || r.status === "ONGOING")).length;

    const drivers = ScheduleRepo.constants.drivers;
    const usedDrivers = new Set(
      rows.filter(r => inPrevDays(r.date, 7) || inNextDays(r.date, 7))
          .map(r => r.driverId)
    ).size;
    const driverUtilPct = drivers.length ? Math.round((usedDrivers / drivers.length) * 100) : 0;

    return {
      thisWeek,
      today,
      ongoingNow,
      completionRate,
      last7Done,
      last7Total,
      upcoming7,
      driverUtilPct,
      usedDrivers,
      totalDrivers: drivers.length,
    };
  }, [rows]);

  return { kpis, refresh };
}


===== components\admin\schedule\toolbar\ScheduleToolbar.ui.tsx =====
"use client";
import * as React from "react";
import { SortAsc, SortDesc, Plus, Filter } from "lucide-react";
import type { ScheduleFilterState } from "@/lib/admin/schedule/filters";
import ScheduleFilterDropdownUI from "../filters/ScheduleFilterDropdown.ui";

type Sort = "newest" | "oldest";

export default function ScheduleToolbar({
  q, onQChange,
  sort, onSortChange,
  onAddNew,
  draft, onDraftChange, onApply, onClearAll,
}: {
  q: string; onQChange: (v: string)=>void;
  sort: Sort; onSortChange: (s: Sort)=>void;
  onAddNew: () => void;
  draft: ScheduleFilterState;
  onDraftChange: (n: Partial<ScheduleFilterState>) => void;
  onApply: () => void;
  onClearAll: () => void;
}) {
  return (
    <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <div className="flex items-center gap-2">
        <div className="relative">
          <input
            value={q}
            onChange={(e) => onQChange(e.target.value)}
            placeholder="Search schedules (Trip ID, title, origin, destination)…"
            className="h-9 w-[320px] rounded-md border border-neutral-300 bg-white pl-3 pr-9 text-sm outline-none focus:ring-2 focus:ring-[#7a1f2a]/40"
          />
          <Filter size={16} className="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-neutral-400" />
        </div>

        <ScheduleFilterDropdownUI
          draft={draft}
          onDraftChange={onDraftChange}
          onApply={onApply}
          onClearAll={onClearAll}
        />
      </div>

      <div className="flex items-center gap-2">
        <button
          type="button"
          onClick={() => onSortChange(sort === "newest" ? "oldest" : "newest")}
          className="inline-flex items-center gap-1 rounded-full border border-neutral-300 bg-white px-3 py-1.5 text-sm text-neutral-700 shadow-sm hover:bg-neutral-50"
        >
          {sort === "newest" ? <SortDesc size={16} /> : <SortAsc size={16} />}
          {sort === "newest" ? "Newest first" : "Oldest first"}
        </button>

        <button
          type="button"
          onClick={onAddNew}
          className="inline-flex items-center gap-2 rounded-md bg-[#7a1f2a] px-3 py-2 text-sm font-medium text-white hover:opacity-95"
        >
          <Plus size={16} />
          Add schedule
        </button>
      </div>
    </div>
  );
}


===== components\admin\schedule\ui\KpiGrid.ui.tsx =====
"use client";
import * as React from "react";

export default function KpiGrid({
  kpis,
}: {
  kpis: {
    thisWeek: number;
    today: number;
    ongoingNow: number;
    completionRate: number;
    last7Done: number;
    last7Total: number;
    upcoming7: number;
    driverUtilPct: number;
    usedDrivers: number;
    totalDrivers: number;
  };
}) {
  const Card = ({
    title,
    value,
    sub,
  }: {
    title: string;
    value: React.ReactNode;
    sub?: React.ReactNode;
  }) => (
    <div className="rounded-xl border border-neutral-200 bg-white px-4 py-3">
      <div className="text-xs font-medium text-neutral-500">{title}</div>
      <div className="mt-1 text-2xl font-semibold">{value}</div>
      {sub ? <div className="mt-1 text-xs text-neutral-500">{sub}</div> : null}
    </div>
  );

  return (
    <div className="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
      <Card title="This Week (total)" value={kpis.thisWeek} />
      <Card title="Today" value={kpis.today} sub={`${kpis.ongoingNow} ongoing now`} />
      <Card
        title="Completion Rate (7d)"
        value={`${kpis.completionRate}%`}
        sub={`${kpis.last7Done}/${kpis.last7Total} done`}
      />
      <Card title="Upcoming (7d)" value={kpis.upcoming7} />
      <Card
        title="Driver Utilization (7d)"
        value={`${kpis.driverUtilPct}%`}
        sub={`${kpis.usedDrivers}/${kpis.totalDrivers} drivers`}
      />
    </div>
  );
}


===== components\admin\schedule\ui\ScheduleDetailsModal.ui.tsx =====
"use client";
import React from "react";
import type { Schedule } from "@/lib/admin/schedule/types";
import { ScheduleRepo } from "@/lib/admin/schedule/store";
import StatusBadge from "./StatusBadge";

type Props = {
  open: boolean;
  data?: Schedule | null;
  onClose: () => void;
};

export default function ScheduleDetailsModal({ open, data, onClose }: Props) {
  const drivers = ScheduleRepo.constants.drivers;
  const vehicles = ScheduleRepo.constants.vehicles;

  // keep hooks order stable
  const driverName =
    drivers.find((d) => d.id === data?.driverId)?.name ?? "—";
  const vehicle =
    vehicles.find((v) => v.id === data?.vehicleId)?.label ?? "—";
  const plate =
    vehicles.find((v) => v.id === data?.vehicleId)?.plateNo ?? "—";

  if (!open || !data) return null;

  return (
    <div
      className="fixed inset-0 z-50 grid place-items-center bg-black/40 p-4"
      onKeyDown={(e) => e.key === "Escape" && onClose()}
    >
      <div
        className="w-full max-w-2xl rounded-xl bg-white shadow"
        role="dialog"
        aria-modal="true"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="flex items-start justify-between border-b px-5 py-4">
          <div>
            <h3 className="text-lg font-semibold">{data.title}</h3>
            <div className="mt-1 text-xs text-gray-500">
              Created {new Date(data.createdAt).toLocaleString()}
              {data.requestId ? ` • Request #${data.requestId}` : ""}
            </div>
          </div>
          <StatusBadge status={data.status} />
        </div>

        <div className="grid gap-4 px-5 py-4 sm:grid-cols-2">
          <Field label="Date">
            {data.date} ({data.startTime}–{data.endTime})
          </Field>
          <Field label="Driver">{driverName}</Field>

          <Field label="Origin">{data.origin}</Field>
          <Field label="Vehicle">
            {vehicle} <span className="text-gray-500">({plate})</span>
          </Field>

          <Field label="Destination" className="sm:col-span-2">
            {data.destination}
          </Field>

          <Field label="Notes" className="sm:col-span-2">
            {data.notes?.trim() ? data.notes : <span className="text-gray-400">—</span>}
          </Field>
        </div>
        <div className="mt-1 text-xs text-gray-500 flex items-center gap-2">
  <span>Trip ID:</span>
  <code className="rounded bg-gray-50 px-1.5 py-0.5">{data.tripId}</code>
  <button
    onClick={() => navigator.clipboard?.writeText(data.tripId)}
    className="rounded border px-1.5 py-0.5 text-xs"
    title="Copy Trip ID"
  >
    Copy
  </button>
  <span className="ml-2">Created {new Date(data.createdAt).toLocaleString()}</span>
  {data.requestId ? <span> • Request #{data.requestId}</span> : null}
</div>


        <div className="flex justify-end gap-2 border-t px-5 py-3">
          <button
            onClick={onClose}
            className="h-10 rounded-md border px-4"
            aria-label="Close details"
          >
            Close
          </button>
        </div>
      </div>
      

      {/* click outside to close */}
      <button
        className="fixed inset-0 cursor-default"
        aria-hidden
        onClick={onClose}
      />
    </div>
  );
}

function Field({
  label,
  children,
  className = "",
}: {
  label: string;
  children: React.ReactNode;
  className?: string;
}) {
  return (
    <div className={className}>
      <div className="text-xs font-semibold text-gray-500">{label}</div>
      <div className="mt-1 text-sm text-gray-900">{children}</div>
    </div>
  );
}


===== components\admin\schedule\ui\ScheduleTable.ui.tsx =====
// src/components/admin/schedule/ui/ScheduleTable.ui.tsx
"use client";
import React from "react";
import type { Pagination, Schedule } from "@/lib/admin/schedule/types";
import StatusBadge from "./StatusBadge";
import { ScheduleRepo } from "@/lib/admin/schedule/store";
import { canStart, canComplete, canCancel, canReopen } from "@/lib/admin/schedule/utils";

type Props = {
  rows: Schedule[];
  pagination: Pagination;
  selected: Set<string>;
  onToggleOne: (id: string, checked: boolean) => void;
  onToggleAll: (checked: boolean) => void;
  onEdit: (row: Schedule) => void;
  onDeleteMany: (ids: string[]) => void;
  onSetStatus: (id: string, s: Schedule["status"]) => void;
  onPageChange: (p: number) => void;
  onView: (row: Schedule) => void;
  toolbar: React.ReactNode;
};

export default function ScheduleTable({
  rows,
  pagination,
  selected,
  onToggleOne,
  onToggleAll,
  onEdit,
  onDeleteMany,
  onSetStatus,
  onPageChange,
  onView,
  toolbar,
}: Props) {
  const allOnPage = rows.map((r) => r.id);
  const allChecked =
    allOnPage.length > 0 && allOnPage.every((id) => selected.has(id));

  return (
    <div className="rounded-2xl border border-neutral-200 bg-white shadow-sm">
      {/* sticky toolbar area */}
      <div className="admin-sticky-toolbar px-3 py-2">{toolbar}</div>

      {/* bulk + count */}
      <div className="flex items-center justify-between px-3 py-2">
        <div className="text-sm text-gray-600">{pagination.total} total</div>
        {selected.size > 0 && (
          <div className="flex items-center gap-2">
            <button
              onClick={() => onDeleteMany(Array.from(selected))}
              className="h-9 rounded-md border px-3"
            >
              Delete
            </button>
          </div>
        )}
      </div>

      <table className="w-full text-sm">
        <thead className="bg-gray-50">
          <tr className="text-left">
            <th className="px-3 py-2">
              <input
                type="checkbox"
                checked={allChecked}
                onChange={(e) => onToggleAll(e.target.checked)}
              />
            </th>
            <th className="px-3 py-2">Trip ID</th>
            <th className="px-3 py-2">Title</th>
            <th className="px-3 py-2">When</th>
            <th className="px-3 py-2">Driver</th>
            <th className="px-3 py-2">Vehicle</th>
            <th className="px-3 py-2">Status</th>
            <th className="px-3 py-2" />
          </tr>
        </thead>

        <tbody>
          {rows.map((r) => {
            const driver =
              ScheduleRepo.constants.drivers.find((d) => d.id === r.driverId)
                ?.name ?? "—";
            const vehicle =
              ScheduleRepo.constants.vehicles.find((v) => v.id === r.vehicleId)
                ?.label ?? "—";

            const sStart = canStart(r);
            const sComplete = canComplete(r);
            const sCancel = canCancel(r);
            const sReopen = canReopen(r);

            return (
              <tr key={r.id} className="border-t">
                <td className="px-3 py-2">
                  <input
                    type="checkbox"
                    checked={selected.has(r.id)}
                    onChange={(e) => onToggleOne(r.id, e.target.checked)}
                  />
                </td>

                <td className="px-3 py-2">
                  <code className="rounded bg-gray-50 px-1.5 py-0.5">
                    {r.tripId}
                  </code>
                </td>

                <td className="px-3 py-2 font-medium">
                  <span
                    role="button"
                    tabIndex={0}
                    className="cursor-pointer underline-offset-2 hover:underline"
                    onClick={() => onView(r)}
                    onKeyDown={(e) => {
                      if (e.key === "Enter" || e.key === " ") onView(r);
                    }}
                    title="View details"
                  >
                    {r.title}
                  </span>
                </td>

                <td className="px-3 py-2">
                  {r.date} {r.startTime}-{r.endTime}
                </td>

                <td className="px-3 py-2">{driver}</td>
                <td className="px-3 py-2">{vehicle}</td>

                <td className="px-3 py-2">
                  <StatusBadge status={r.status} />
                </td>

                <td className="px-3 py-2">
                  <div className="flex flex-wrap gap-2">
                    <button
                      onClick={() => onView(r)}
                      className="rounded border px-2 py-1"
                    >
                      View
                    </button>

                    <button
                      disabled={!sStart}
                      onClick={() => onSetStatus(r.id, "ONGOING")}
                      className="rounded border px-2 py-1 disabled:opacity-50"
                    >
                      Start
                    </button>

                    <button
                      disabled={!sComplete}
                      onClick={() => onSetStatus(r.id, "COMPLETED")}
                      className="rounded border px-2 py-1 disabled:opacity-50"
                    >
                      Complete
                    </button>

                    <button
                      disabled={r.status !== "ONGOING"}
                      onClick={() => onSetStatus(r.id, "PLANNED" as any)}
                      className="rounded border px-2 py-1 disabled:opacity-50"
                    >
                      Stop
                    </button>

                    <button
                      disabled={!sCancel}
                      onClick={() => onSetStatus(r.id, "CANCELLED")}
                      className="rounded border px-2 py-1 disabled:opacity-50"
                    >
                      Cancel
                    </button>

                    <button
                      disabled={!sReopen}
                      onClick={() => onSetStatus(r.id, "PLANNED" as any)}
                      className="rounded border px-2 py-1 disabled:opacity-50"
                    >
                      Reopen
                    </button>

                    <button
                      onClick={() => onEdit(r)}
                      className="rounded border px-2 py-1"
                    >
                      Edit
                    </button>
                  </div>
                </td>
              </tr>
            );
          })}

          {rows.length === 0 && (
            <tr>
              <td
                colSpan={8}
                className="px-3 py-8 text-center text-gray-500"
              >
                No schedules
              </td>
            </tr>
          )}
        </tbody>
      </table>

      <div className="flex items-center justify-between px-3 py-2">
        <div className="text-sm">
          Page {pagination.page} of{" "}
          {Math.ceil(pagination.total / pagination.pageSize)}
        </div>
        <div className="flex gap-2">
          <button
            disabled={pagination.page <= 1}
            onClick={() => onPageChange(pagination.page - 1)}
            className="h-9 rounded-md border px-3 disabled:opacity-50"
          >
            Prev
          </button>
          <button
            disabled={
              pagination.page * pagination.pageSize >= pagination.total
            }
            onClick={() => onPageChange(pagination.page + 1)}
            className="h-9 rounded-md border px-3 disabled:opacity-50"
          >
            Next
          </button>
        </div>
      </div>
    </div>
  );
}


===== components\admin\schedule\ui\StatusBadge.tsx =====
// src/components/admin/schedule/ui/StatusBadge.tsx
"use client";
import React from "react";
import type { ScheduleStatus } from "@/lib/admin/schedule/types";

export default function StatusBadge({ status }: { status: ScheduleStatus }) {
  const fmt: Record<ScheduleStatus, string> = {
    PLANNED: "bg-amber-50 text-amber-700 border-amber-200",
    ONGOING: "bg-blue-50 text-blue-700 border-blue-200",
    COMPLETED: "bg-green-50 text-green-700 border-green-200",
    CANCELLED: "bg-rose-50 text-rose-700 border-rose-200",
  };
  return (
    <span className={`inline-flex items-center gap-1 rounded-full border px-2.5 py-1 text-xs font-medium ${fmt[status]}`}>
      {status}
    </span>
  );
}


===== components\admin\vehicles\index.ts =====
export { default as VehiclesPageClient } from "./containers/VehiclesPage.client";
export { VehiclesFilterBar } from "./filters/VehiclesFilterBar.ui";
export { VehiclesHeader } from "./filters/VehiclesHeader.ui";
export { VehiclesBulkBar } from "./toolbar/VehiclesBulkBar.ui";
export { VehiclesTable } from "./ui/VehiclesTable.ui";
export { VehiclesGrid } from "./ui/VehiclesGrid.ui";
export { VehicleCard } from "./ui/VehicleCard.ui";
export { VehicleFormModal } from "./forms/VehicleFormModal.ui";
export { VehicleDetailsModal } from "./ui/VehicleDetailsModal.ui";
export { KpiStrip } from "./kpi/KpiStrip.ui";
export * as VehicleInputs from "./ui/inputs/TinyInputs";
export { Brand, VEHICLE_TABS } from "./ui/constants";


===== components\admin\vehicles\containers\VehiclesPage.client.tsx =====
"use client";
import * as React from "react";
import { VehiclesFilterBar } from "../filters/VehiclesFilterBar.ui";
import { VehiclesBulkBar } from "../toolbar/VehiclesBulkBar.ui";
import { VehiclesTable } from "../ui/VehiclesTable.ui";
import { VehiclesGrid } from "../ui/VehiclesGrid.ui";
import { VehicleFormModal } from "../forms/VehicleFormModal.ui";
import { VehiclesHeader } from "../filters/VehiclesHeader.ui";
import { VehicleDetailsModal } from "../ui/VehicleDetailsModal.ui";
import { useVehiclesScreen } from "../hooks/useVehiclesScreen";
import { VehiclesRepo } from "@/lib/admin/vehicles/store";
import { toCSV } from "@/lib/admin/vehicles/utils";
import { useConfirm } from "@/components/common/hooks/useConfirm";

export default function VehiclesPageClient() {
  const {
    filters, setFilters,
    rows, selection, setSelection,
    form, setForm,
    view, setView,
    tab, setTab,
    refresh,
  } = useVehiclesScreen();

  const [openDetails, setOpenDetails] = React.useState<string | null>(null);

  // hydrate from localStorage after mount so SSR/CSR match
  React.useEffect(() => {
    if (VehiclesRepo.hydrateFromStorage?.()) {
      refresh();
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  const { ask, ui: confirmUI } = useConfirm();

  const onClear = () => setFilters({});
  const onEdit = (id: string) => setForm({ mode: "edit", id });

  const onDelete = async (id: string) => {
    const v = VehiclesRepo.get(id);
    const ok = await ask(
      "Delete vehicle?",
      `Are you sure you want to delete ${v?.plateNo ?? "this vehicle"}? This action cannot be undone.`,
      "Delete"
    );
    if (!ok) return;
    VehiclesRepo.remove(id);
    refresh();
  };

  const onDeleteSelected = async () => {
    if (selection.length === 0) return;
    const ok = await ask(
      "Delete selected vehicles?",
      `This will delete ${selection.length} vehicle(s). This action cannot be undone.`,
      "Delete"
    );
    if (!ok) return;
    selection.forEach(VehiclesRepo.remove);
    setSelection([]);
    refresh();
  };

  const onExportCSV = () => {
    const blob = new Blob([toCSV(rows)], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "vehicles.csv";
    a.click();
    URL.revokeObjectURL(url);
  };

  // counts for tabs
  const counts = React.useMemo(() => {
    return {
      all: VehiclesRepo.list({}).length,
      assigned: VehiclesRepo.list({}).filter((v) => (v as any).assignedDriver).length,
      out_of_order: VehiclesRepo.list({}).filter((v) => v.status === "inactive").length,
      available: VehiclesRepo.list({}).filter((v) => v.status === "active" && !(v as any).assignedDriver).length,
      service_needed: VehiclesRepo.list({}).filter((v) => {
        const due = (v as any).nextServiceISO as string | undefined;
        return due && new Date(due) <= new Date();
      }).length,
    };
  }, [rows]);

  const current = openDetails ? (VehiclesRepo.get(openDetails) as any) : null;

  // Reset sample handler (DEV only)
  const handleResetSample = () => {
    VehiclesRepo.resetToSample();
    setSelection([]);
    setFilters({});
    refresh();
  };

  return (
    <div className="space-y-4 p-4">
      {/* global confirm dialog mount point */}
      {confirmUI}

      <VehiclesHeader
        counts={counts as any}
        tab={tab}
        onTab={(t) => {
          setTab(t);
        }}
        view={view}
        onView={setView}
        onCreate={() => setForm({ mode: "create" })}
        onReset={handleResetSample}
      />

      <VehiclesFilterBar value={filters} onChange={setFilters} onClear={onClear} />

      <div className="flex flex-col gap-3">
        {view === "table" ? (
          <>
            <VehiclesBulkBar
              selection={selection}
              rows={rows}
              onDeleteSelected={onDeleteSelected}
              onExportCSV={onExportCSV}
            />
            <VehiclesTable
              rows={rows}
              selection={selection}
              setSelection={setSelection}
              onEdit={onEdit}
              onDelete={onDelete}
            />
          </>
        ) : (
          <VehiclesGrid
            rows={rows as any}
            onEdit={onEdit}
            onDelete={onDelete}
            onOpenDetails={(id) => setOpenDetails(id)}
          />
        )}
      </div>

      {/* Create/Edit modal */}
      {form && (
        <VehicleFormModal
          open={!!form}
          initial={form.mode === "edit" ? VehiclesRepo.get(form.id) ?? undefined : undefined}
          onCancel={() => setForm(null)}
          onSubmit={(data) => {
            if (form.mode === "create") VehiclesRepo.create(data);
            else VehiclesRepo.update(form.id, data);
            setForm(null);
            refresh();
          }}
        />
      )}

      {/* Details modal */}
      <VehicleDetailsModal open={!!openDetails} onClose={() => setOpenDetails(null)} v={current as any} />
    </div>
  );
}


===== components\admin\vehicles\filters\VehiclesFilterBar.ui.tsx =====
// File: src/components/admin/vehicles/filters/VehiclesFilterBar.ui.tsx
"use client";
import * as React from "react";
import { Search, X } from "lucide-react";
import type { VehicleFilters } from "@/lib/admin/vehicles/types";
import { VehiclesRepo } from "@/lib/admin/vehicles/store";

export function VehiclesFilterBar({
  value,
  onChange,
  onClear,
}: {
  value: VehicleFilters;
  onChange: (v: VehicleFilters) => void;
  onClear: () => void;
}) {
  const hasFilters = !!(value.search || value.type || value.status);

  // keep typing smooth without flashy focus styles
  const [search, setSearch] = React.useState(value.search ?? "");
  React.useEffect(() => setSearch(value.search ?? ""), [value.search]);
  React.useEffect(() => {
    const t = setTimeout(() => {
      if ((value.search ?? "") !== search) onChange({ ...value, search });
    }, 250);
    return () => clearTimeout(t);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [search]);

  const selectCls =
    "rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 " +
    "hover:bg-gray-50 focus:outline-none focus:ring-0 focus:border-gray-400";

  return (
    <div className="flex flex-wrap items-center gap-2 rounded-xl bg-white/90 p-2 ring-1 ring-gray-200 shadow-sm">
      {/* Search pill */}
      <label className="flex items-center gap-2 rounded-full border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700">
        <Search size={16} className="opacity-60" />
        <input
          value={search}
          onChange={(e) => setSearch(e.target.value)}
          placeholder="Search plate, code, brand, model…"
          className="w-56 sm:w-72 bg-transparent outline-none"
        />
        {search ? (
          <button
            type="button"
            onClick={() => setSearch("")}
            className="rounded-full p-0.5 text-gray-500 hover:bg-gray-100"
            title="Clear search"
          >
            <X size={14} />
          </button>
        ) : null}
      </label>

      {/* Type */}
      <select
        className={selectCls}
        value={value.type ?? ""}
        onChange={(e) => onChange({ ...value, type: e.target.value as any })}
      >
        <option value="">All Types</option>
        {VehiclesRepo.constants.types.map((t) => (
          <option key={t} value={t}>
            {t}
          </option>
        ))}
      </select>

      {/* Status */}
      <select
        className={selectCls}
      value={value.status ?? ""}
        onChange={(e) => onChange({ ...value, status: e.target.value as any })}
      >
        <option value="">All Status</option>
        {VehiclesRepo.constants.statuses.map((s) => (
          <option key={s} value={s}>
            {s}
          </option>
        ))}
      </select>

      <div className="ms-auto" />

      {/* Clear link (ghost) */}
      <button
        type="button"
        onClick={onClear}
        disabled={!hasFilters}
        className="rounded-lg px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 disabled:opacity-40 disabled:hover:bg-transparent"
        title="Clear filters"
      >
        Clear
      </button>
    </div>
  );
}


===== components\admin\vehicles\filters\VehiclesHeader.ui.tsx =====
"use client";
import * as React from "react";
import { LayoutGrid, List, Plus, RotateCw } from "lucide-react";
import { VEHICLE_TABS, type VehiclePrimaryTab } from "../ui/constants";

export function VehiclesHeader({
  counts, tab, onTab, view, onView, onCreate, onReset,
}: {
  counts: Partial<Record<VehiclePrimaryTab, number>>;
  tab: VehiclePrimaryTab;
  onTab: (t: VehiclePrimaryTab) => void;
  view: "grid" | "table";
  onView: (v: "grid" | "table") => void;
  onCreate: () => void;
  onReset?: () => void; // DEV only
}) {
  const showSeed = typeof process !== "undefined" && process.env.NEXT_PUBLIC_SHOW_SEED === "1";

  return (
    <div className="flex flex-wrap items-center gap-3">
      <div className="min-w-0 flex-1">
        <div className="text-lg font-semibold">Vehicles</div>
        <div className="text-sm text-gray-500">Manage assets, availability, and service status</div>
      </div>

      <div className="flex items-center gap-2">
        {showSeed && onReset && (
          <button
            onClick={onReset}
            className="inline-flex items-center gap-1.5 rounded-md border px-3 py-1.5 text-sm hover:bg-gray-50"
            title="Reset sample data"
          >
            <RotateCw size={16} /> Reset sample
          </button>
        )}
        <button
          onClick={onCreate}
          className="inline-flex items-center gap-2 rounded-md px-3 py-1.5 text-white"
          style={{ background: "#7a0019" }}
        >
          <Plus size={16} /> Add vehicle
        </button>
        <div className="inline-flex rounded-md border bg-white">
          <button onClick={() => onView("grid")} className={`px-2.5 py-1.5 ${view === "grid" ? "bg-gray-100" : ""}`} title="Grid">
            <LayoutGrid size={16} />
          </button>
          <button onClick={() => onView("table")} className={`px-2.5 py-1.5 ${view === "table" ? "bg-gray-100" : ""}`} title="Table">
            <List size={16} />
          </button>
        </div>
      </div>

      <div className="w-full overflow-x-auto">
        <div className="mt-2 flex min-w-max items-center gap-1 border-b">
          {VEHICLE_TABS.map(t => {
            const selected = tab === t.key;
            const n = counts[t.key] ?? 0;
            return (
              <button
                key={t.key}
                onClick={() => onTab(t.key)}
                className={`px-3 py-2 text-sm ${selected ? "border-b-2 border-gray-900 font-medium" : "text-gray-600"}`}
              >
                {t.label} {n ? <span className="ml-1 rounded-full bg-gray-100 px-1.5 py-0.5 text-xs">{n}</span> : null}
              </button>
            );
          })}
        </div>
      </div>
    </div>
  );
}


===== components\admin\vehicles\forms\VehicleFormModal.ui.tsx =====
// File: src/components/admin/vehicles/forms/VehicleFormModal.ui.tsx
"use client";
import * as React from "react";
import type { Vehicle } from "@/lib/admin/vehicles/types";
import { VehiclesRepo } from "@/lib/admin/vehicles/store";
import { validate } from "@/lib/admin/vehicles/utils";

import { Modal } from "@/components/common/Modal.ui";
import { FormSection } from "@/components/common/forms/FormSection.ui";
import { FormActions } from "@/components/common/forms/FormActions.ui";
import { TextInput } from "@/components/common/inputs/TextInput.ui";
import { NumberInput } from "@/components/common/inputs/NumberInput.ui";
import { DateInput } from "@/components/common/inputs/DateInput.ui";
import { Select } from "@/components/common/inputs/Select.ui";
import { FileUpload } from "@/components/common/file_upload/FileUpload.ui";

type FormShape = Omit<Vehicle, "id" | "createdAt" | "updatedAt"> & {
  photoUrl?: string;
};

export function VehicleFormModal({
  open,
  initial,
  onCancel,
  onSubmit,
}: {
  open: boolean;
  initial?: Partial<Vehicle>;
  onCancel: () => void;
  onSubmit: (data: FormShape) => void;
}) {
  const [form, setForm] = React.useState<FormShape>(() => ({
    plateNo: initial?.plateNo ?? "",
    code: initial?.code ?? "",
    brand: initial?.brand ?? "",
    model: initial?.model ?? "",
    type: (initial?.type as any) ?? VehiclesRepo.constants.types[0],
    capacity: initial?.capacity ?? 1,
    status: (initial?.status as any) ?? VehiclesRepo.constants.statuses[0],
    odometerKm: initial?.odometerKm ?? 0,
    lastServiceISO:
      initial?.lastServiceISO ?? new Date().toISOString().slice(0, 10),
    notes: initial?.notes ?? "",
    photoUrl: (initial as any)?.photoUrl ?? "",
  }));
  const [err, setErr] = React.useState<string | null>(null);
  const [preview, setPreview] = React.useState<string | undefined>(
    (initial as any)?.photoUrl
  );

  React.useEffect(() => {
    if (!open) return;
    setForm({
      plateNo: initial?.plateNo ?? "",
      code: initial?.code ?? "",
      brand: initial?.brand ?? "",
      model: initial?.model ?? "",
      type: (initial?.type as any) ?? VehiclesRepo.constants.types[0],
      capacity: initial?.capacity ?? 1,
      status: (initial?.status as any) ?? VehiclesRepo.constants.statuses[0],
      odometerKm: initial?.odometerKm ?? 0,
      lastServiceISO:
        initial?.lastServiceISO ?? new Date().toISOString().slice(0, 10),
      notes: initial?.notes ?? "",
      photoUrl: (initial as any)?.photoUrl ?? "",
    });
    setPreview((initial as any)?.photoUrl || undefined);
    setErr(null);
  }, [open, initial]);

  const submit = (e: React.FormEvent) => {
    e.preventDefault();
    const msg = validate(form as any);
    if (msg) {
      setErr(msg);
      return;
    }
    onSubmit(form);
  };

  // FileUpload callback
  const handleFile = (file: File | null, url?: string) => {
    if (!file) {
      setPreview(undefined);
      setForm((f) => ({ ...f, photoUrl: "" }));
      return;
    }
    setPreview(url);
    setForm((f) => ({ ...f, photoUrl: url || "" }));
  };

  return (
    <Modal
      open={open}
      title={initial ? "Edit Vehicle" : "Add Vehicle"}
      onClose={onCancel}
      maxWidth="max-w-3xl"
    >
      <form onSubmit={submit} className="grid gap-4">
        {err && (
          <div className="rounded-md bg-rose-50 px-3 py-2 text-sm text-rose-700">
            {err}
          </div>
        )}

        {/* Photo */}
        <FormSection title="Photo">
          <FileUpload label="Upload a photo" onChange={handleFile} />
          {preview && (
            // eslint-disable-next-line @next/next/no-img-element
            <img
              src={preview}
              alt="Preview"
              className="h-40 w-full rounded-lg object-cover"
            />
          )}
        </FormSection>

        {/* Basics */}
        <FormSection title="Vehicle information">
          <div className="grid gap-3 sm:grid-cols-2">
            <TextInput
              label="Plate No."
              value={form.plateNo}
              onChange={(v) => setForm((f) => ({ ...f, plateNo: v }))}
            />
            <TextInput
              label="Vehicle Code"
              value={form.code}
              onChange={(v) => setForm((f) => ({ ...f, code: v }))}
            />
          </div>

          <div className="grid gap-3 sm:grid-cols-2">
            <TextInput
              label="Brand"
              value={form.brand}
              onChange={(v) => setForm((f) => ({ ...f, brand: v }))}
            />
            <TextInput
              label="Model"
              value={form.model}
              onChange={(v) => setForm((f) => ({ ...f, model: v }))}
            />
          </div>

          <div className="grid gap-3 sm:grid-cols-3">
            <Select
              label="Type"
              value={form.type as any}
              options={VehiclesRepo.constants.types as any}
              onChange={(v) => setForm((f) => ({ ...f, type: v as any }))}
            />
            <NumberInput
              label="Capacity"
              value={form.capacity}
              min={1}
              onChange={(v) => setForm((f) => ({ ...f, capacity: v }))}
            />
            <Select
              label="Status"
              value={form.status as any}
              options={VehiclesRepo.constants.statuses as any}
              onChange={(v) => setForm((f) => ({ ...f, status: v as any }))}
            />
          </div>

          <div className="grid gap-3 sm:grid-cols-3">
            <NumberInput
              label="Odometer (km)"
              value={form.odometerKm}
              min={0}
              onChange={(v) => setForm((f) => ({ ...f, odometerKm: v }))}
            />
            <DateInput
              label="Last Service"
              value={form.lastServiceISO}
              onChange={(v) => setForm((f) => ({ ...f, lastServiceISO: v }))}
            />
            <TextInput
              label="Notes (optional)"
              value={form.notes ?? ""}
              onChange={(v) => setForm((f) => ({ ...f, notes: v }))}
            />
          </div>
        </FormSection>

        <FormActions onCancel={onCancel} submitLabel="Save" brand="#7a0019" />
      </form>
    </Modal>
  );
}


===== components\admin\vehicles\hooks\useVehiclesScreen.ts =====
import * as React from "react";
import type { Vehicle, VehicleFilters } from "@/lib/admin/vehicles/types";
import { VehiclesRepo } from "@/lib/admin/vehicles/store";
import type { VehiclePrimaryTab } from "../ui/constants";

export function useVehiclesScreen() {
  const [filters, setFilters] = React.useState<VehicleFilters>({});
  const [rows, setRows] = React.useState<Vehicle[]>([]);
  const [selection, setSelection] = React.useState<string[]>([]);
  const [form, setForm] = React.useState<null | { mode: "create" } | { mode: "edit"; id: string }>(null);

  // new: grid/list, active tab, query
  const [view, setView] = React.useState<"grid" | "table">("grid");
  const [tab, setTab] = React.useState<VehiclePrimaryTab>("all");

  const refresh = React.useCallback(() => {
    let list = VehiclesRepo.list(filters);
    // apply tab logic without leaking into filters UI
    if (tab === "assigned") list = list.filter(v => (v as any).assignedDriver);
    if (tab === "out_of_order") list = list.filter(v => v.status === "inactive");
    if (tab === "available") list = list.filter(v => v.status === "active" && !(v as any).assignedDriver);
    if (tab === "service_needed") {
      list = list.filter(v => {
        const due = (v as any).nextServiceISO as string | undefined;
        if (!due) return false;
        return new Date(due) <= new Date();
      });
    }
    setRows(list);
  }, [filters, tab]);

  React.useEffect(() => { refresh(); }, [refresh]);

  return {
    filters, setFilters,
    rows, setRows,
    selection, setSelection,
    form, setForm,
    view, setView,
    tab, setTab,
    refresh,
  } as const;
}


===== components\admin\vehicles\kpi\KpiStrip.ui.tsx =====
"use client";
import * as React from "react";
import type { Vehicle } from "@/lib/admin/vehicles/types";

function KpiBox({ label, value }: { label: string; value: string | number }) {
  return (
    <div className="rounded-xl border bg-white px-4 py-3">
      <div className="text-xs text-gray-500">{label}</div>
      <div className="text-xl font-semibold">{value}</div>
    </div>
  );
}

export function KpiStrip({ rows }: { rows: Vehicle[] }) {
  const total = rows.length;
  const active = rows.filter(v => v.status === "active").length;
  const maint = rows.filter(v => v.status === "maintenance").length;
  const inactive = rows.filter(v => v.status === "inactive").length;

  // optional derived
  const assigned = rows.filter(v => (v as any).assignedDriver).length;
  const serviceNeeded = rows.filter(v => {
    const due = (v as any).nextServiceISO as string | undefined;
    return due && new Date(due) <= new Date();
  }).length;

  return (
    <div className="grid gap-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5">
      <KpiBox label="Total vehicles" value={total} />
      <KpiBox label="Active" value={active} />
      <KpiBox label="Assigned" value={assigned} />
      <KpiBox label="Service needed" value={serviceNeeded} />
      <KpiBox label="Inactive / Out of order" value={inactive} />
    </div>
  );
}


===== components\admin\vehicles\toolbar\VehiclesBulkBar.ui.tsx =====
"use client";
import * as React from "react";
import { Download, Trash2 } from "lucide-react";
import type { Vehicle } from "@/lib/admin/vehicles/types";

export function VehiclesBulkBar({
  selection,
  rows,
  onDeleteSelected,
  onExportCSV,
}: {
  selection: string[];
  rows: Vehicle[];
  onDeleteSelected: () => void;
  onExportCSV: () => void;
}) {
  const any = selection.length > 0;

  return (
    <div className="flex items-center justify-between rounded-lg border bg-gray-50 px-4 py-2 shadow-sm">
      <div className="flex items-center gap-2">
        <button
          disabled={!any}
          onClick={onDeleteSelected}
          className="inline-flex items-center gap-1.5 rounded-md bg-red-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm transition hover:bg-red-700 disabled:cursor-not-allowed disabled:bg-red-300"
          title="Delete selected"
        >
          <Trash2 size={16} /> Delete
        </button>

        <button
          onClick={onExportCSV}
          className="inline-flex items-center gap-1.5 rounded-md bg-white px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-100 border"
        >
          <Download size={16} /> Export CSV
        </button>
      </div>

      <span className="text-sm text-gray-600">
        Showing <b>{rows.length}</b> item{rows.length !== 1 && "s"}
        {any && (
          <span className="ml-2 text-gray-700">
            • <b>{selection.length}</b> selected
          </span>
        )}
      </span>
    </div>
  );
}


===== components\admin\vehicles\ui\VehicleCard.ui.tsx =====
"use client";
import * as React from "react";
import type { Vehicle } from "@/lib/admin/vehicles/types";
import {
  Edit,
  Trash2,
  ChevronRight,
  Clock3,
  User,
  Users,
  Scale,
} from "lucide-react";

const BRAND = "#7a0019";

export function VehicleCard({
  v,
  onEdit,
  onDelete,
  onOpenDetails,
}: {
  v: Vehicle & {
    photoUrl?: string;
    lastCheckIn?: string;
    maxLoadKg?: number;
    assignedDriver?: string;
    nextServiceISO?: string;
  };
  onEdit: (id: string) => void;
  onDelete: (id: string) => void;
  onOpenDetails: (id: string) => void;
}) {
  const badge =
    v.status === "active"
      ? "bg-green-100 text-green-700"
      : v.status === "maintenance"
      ? "bg-amber-100 text-amber-700"
      : "bg-gray-200 text-gray-700";

  return (
    <div className="group rounded-2xl bg-white ring-1 ring-gray-200 shadow-sm transition hover:shadow-md hover:ring-gray-300">
      {/* Media */}
      <div className="relative overflow-hidden rounded-t-2xl">
        <div className="aspect-[16/7] bg-gray-50">
          {v.photoUrl ? (
            // eslint-disable-next-line @next/next/no-img-element
            <img
              src={v.photoUrl}
              alt={v.model}
              className="h-full w-full object-cover transition-transform duration-300 group-hover:scale-[1.02]"
            />
          ) : (
            <div className="flex h-full w-full items-center justify-center text-sm text-gray-400">
              Vehicle photo
            </div>
          )}
        </div>

        {/* Top-left status */}
        <span className={`absolute left-3 top-3 rounded-full px-2.5 py-1 text-xs font-medium backdrop-blur-md ${badge}`}>
          {v.status}
        </span>

        {/* Top-right pill: capacity (users icon) */}
        <span className="absolute right-3 top-3 hidden items-center gap-1 rounded-full bg-white/90 px-2.5 py-1 text-xs text-gray-700 shadow-sm backdrop-blur md:inline-flex">
          <Users size={14} /> {v.capacity}
        </span>
      </div>

      {/* Header */}
      <div className="px-3 pt-3">
        <div className="flex items-start justify-between gap-2">
          <div className="min-w-0">
            <div className="truncate text-[13px] text-gray-500">
              {v.brand} {v.model}
            </div>
            <div className="truncate text-base font-semibold tracking-tight">
              {v.plateNo}
            </div>
          </div>
        </div>
      </div>

      {/* Meta */}
      <div className="px-3 pt-2">
        <div className="grid gap-1.5 text-sm text-gray-700">
          <MetaRow
            icon={<Clock3 size={16} className="opacity-70" />}
            label="Last check-in/out"
            value={v.lastCheckIn ?? "—"}
          />
          <MetaRow
            icon={<Scale size={16} className="opacity-70" />}
            label="Max. load"
            value={v.maxLoadKg ? `${v.maxLoadKg.toLocaleString()} kg` : "—"}
          />
          <MetaRow
            icon={<User size={16} className="opacity-70" />}
            label="Assigned driver"
            value={v.assignedDriver ?? "—"}
          />
        </div>
      </div>

      {/* Actions */}
      <div className="mt-3 flex items-center justify-between px-3 pb-3">
        <button
          onClick={() => onOpenDetails(v.id)}
          className="inline-flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-sm text-white shadow-sm transition"
          style={{ background: BRAND }}
        >
          View details <ChevronRight size={16} />
        </button>

        <div className="flex items-center gap-1.5">
          <IconBtn title="Edit" onClick={() => onEdit(v.id)} icon={<Edit size={16} />} />
          <IconBtn title="Delete" onClick={() => onDelete(v.id)} icon={<Trash2 size={16} />} />
        </div>
      </div>
    </div>
  );
}

function MetaRow({
  icon,
  label,
  value,
}: {
  icon: React.ReactNode;
  label: string;
  value: React.ReactNode;
}) {
  return (
    <div className="flex items-center justify-between gap-2">
      <div className="flex min-w-0 items-center gap-2 text-gray-600">
        {icon}
        <span className="truncate">{label}</span>
      </div>
      <span className="truncate text-gray-900">{value}</span>
    </div>
  );
}

function IconBtn({
  title,
  onClick,
  icon,
}: {
  title: string;
  onClick: () => void;
  icon: React.ReactNode;
}) {
  return (
    <button
      title={title}
      onClick={onClick}
      className="rounded-xl border border-gray-200 bg-white p-1.5 text-gray-700 shadow-sm transition hover:bg-gray-50"
    >
      {icon}
    </button>
  );
}


===== components\admin\vehicles\ui\VehicleDetailsModal.ui.tsx =====
"use client";
import * as React from "react";
import type { Vehicle } from "@/lib/admin/vehicles/types";

const BRAND = "#7a0019";

type RichVehicle = Vehicle & {
  photoUrl?: string;
  assignedDriver?: string;
  driverDocs?: { label: string; url?: string }[];
  routePreviewUrl?: string;
  nextServiceISO?: string;
  maxLoadKg?: number;
  lastCheckIn?: string;
  notes?: string;
};

export function VehicleDetailsModal({
  open,
  onClose,
  v,
}: {
  open: boolean;
  onClose: () => void;
  v: RichVehicle | null;
}) {
  // lock background scroll
  React.useEffect(() => {
    if (!open) return;
    const prev = document.body.style.overflow;
    document.body.style.overflow = "hidden";
    return () => { document.body.style.overflow = prev; };
  }, [open]);

  const contentRef = React.useRef<HTMLDivElement | null>(null);
  const [active, setActive] = React.useState<string>("vehicle");

  const sections = [
    { id: "vehicle", label: "Vehicle details" },
    { id: "status", label: "Status" },
    { id: "personnel", label: "Assigned personnel" },
    { id: "tools", label: "Tools & Equipments" },
    { id: "notes", label: "Comments/Notes" },
    { id: "route", label: "Route preview" },
  ];

  // observe sections to highlight tab
  React.useEffect(() => {
    if (!open) return;
    const root = contentRef.current;
    if (!root) return;

    const obs = new IntersectionObserver(
      (entries) => {
        const visible = entries
          .filter(e => e.isIntersecting)
          .sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top)[0];
        if (visible?.target) setActive((visible.target as HTMLElement).id);
      },
      { root, rootMargin: "0px 0px -60% 0px", threshold: [0, 0.2, 0.5] }
    );

    sections.forEach(s => {
      const node = root.querySelector<HTMLElement>(`#${s.id}`);
      if (node) obs.observe(node);
    });

    return () => obs.disconnect();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [open, v]);

  const goTo = (id: string) => {
    const root = contentRef.current;
    const el = root?.querySelector<HTMLElement>(`#${id}`);
    el?.scrollIntoView({ behavior: "smooth", block: "start" });
  };

  if (!open || !v) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/35 p-4" role="dialog" aria-modal="true">
      <div className="flex max-h-[90vh] w-full max-w-5xl flex-col overflow-hidden rounded-2xl bg-white shadow-2xl">
        {/* Header */}
        <div className="sticky top-0 z-10 flex items-center justify-between bg-white/90 px-5 py-4 backdrop-blur-sm">
          <div className="min-w-0">
            <div className="truncate text-lg font-semibold">{v.brand} {v.model}</div>
            <div className="text-sm text-gray-500">{v.plateNo}</div>
          </div>
          <button
            onClick={onClose}
            className="rounded-lg bg-red-600 px-3 py-1.5 text-sm text-white shadow hover:bg-red-700"
          >
            Close
          </button>
        </div>

        {/* Content */}
        <div ref={contentRef} className="flex-1 overflow-y-auto overscroll-contain">
          <div className="grid gap-5 p-5 lg:grid-cols-[360px,1fr]">
            {/* Left column */}
            <div className="space-y-4">
              <div className="overflow-hidden rounded-xl ring-1 ring-gray-200 shadow-sm">
                {/* eslint-disable-next-line @next/next/no-img-element */}
                {v.photoUrl
                  ? <img src={v.photoUrl} alt="" className="h-60 w-full object-cover" />
                  : <div className="h-60 w-full bg-gray-100" />}
              </div>

              <div className="rounded-xl bg-white p-4 ring-1 ring-gray-200 shadow-sm">
                <div className="text-sm font-medium">Driver documents</div>
                <div className="mt-2 grid gap-2 text-sm">
                  {(v.driverDocs ?? []).map(d => (
                    <div key={d.label} className="flex items-center justify-between">
                      <span className="text-gray-700">{d.label}</span>
                      {d.url
                        ? <a className="text-blue-600 hover:underline" href={d.url} target="_blank" rel="noreferrer">View</a>
                        : <span className="text-gray-400">—</span>}
                    </div>
                  ))}
                  {(v.driverDocs ?? []).length === 0 && (
                    <div className="text-gray-500">No documents.</div>
                  )}
                </div>
              </div>
            </div>

            {/* Right column */}
            <div className="min-w-0">
              {/* Tabs (links) */}
              <nav className="flex gap-3 border-b border-gray-200 px-1">
                {sections.map(s => (
                  <a
                    key={s.id}
                    href={`#${s.id}`}
                    onClick={(e) => { e.preventDefault(); goTo(s.id); }}
                    className={`relative px-2 py-3 text-sm font-medium ${active === s.id ? "text-gray-900" : "text-gray-600 hover:text-gray-900"
                      }`}
                    style={{ cursor: "pointer" }}
                  >
                    {s.label}
                    <span
                      className="absolute inset-x-2 -bottom-px h-0.5 rounded-full transition-all"
                      style={{ background: active === s.id ? BRAND : "transparent" }}
                    />
                  </a>
                ))}
              </nav>

              {/* Sections */}
              <Card id="vehicle" title="Vehicle details">
                <Spec k="Plate" v={<b className="font-semibold">{v.plateNo}</b>} />
                <Spec k="Code" v={v.code} />
                <Spec k="Brand/Model" v={`${v.brand} ${v.model}`} />
                <Spec k="Type" v={v.type} />
                <Spec k="Capacity" v={v.capacity} />
                <Spec k="Odometer" v={`${v.odometerKm.toLocaleString()} km`} />
                <Spec k="Last service" v={v.lastServiceISO} />
                <Spec k="Next service" v={v.nextServiceISO ?? "—"} />
              </Card>

              <Card id="status" title="Status">
                <div className="grid gap-3 sm:grid-cols-2">
                  <SoftPanel>
                    <div className="text-sm font-medium">Load status</div>
                    <div className="mt-1 text-sm text-gray-600">68% loaded / 32% available</div>
                  </SoftPanel>
                  <SoftPanel>
                    <div className="text-sm font-medium">Last check-in/out</div>
                    <div className="mt-1 text-sm text-gray-600">{v.lastCheckIn ?? "—"}</div>
                  </SoftPanel>
                </div>
              </Card>

              <Card id="personnel" title="Assigned personnel">
                <Spec k="Driver" v={v.assignedDriver ?? "—"} />
              </Card>

              <Card id="tools" title="Tools & Equipments">
                <div className="text-sm text-gray-600">List of equipment can go here.</div>
              </Card>

              <Card id="notes" title="Comments/Notes">
                <div className="text-sm whitespace-pre-wrap text-gray-800">{v.notes ?? "—"}</div>
              </Card>

              <Card id="route" title="Route preview" className="mb-2">
                <div className="h-48 rounded-lg bg-gray-100" />
              </Card>
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="sticky bottom-0 bg-white/90 px-5 py-3 backdrop-blur-sm">
          <div className="flex justify-end">

          </div>
        </div>
      </div>
    </div>
  );
}

/* ---------- tiny presentational pieces ---------- */
function Card({
  id, title, children, className = "",
}: { id: string; title: string; children: React.ReactNode; className?: string }) {
  return (
    <section id={id} className={`mt-4 rounded-xl bg-white p-4 ring-1 ring-gray-200 shadow-sm ${className}`}>
      <div className="mb-3 text-sm font-semibold">{title}</div>
      <div className="grid gap-2">{children}</div>
    </section>
  );
}

function Spec({ k, v }: { k: React.ReactNode; v: React.ReactNode }) {
  return (
    <div className="grid grid-cols-[160px,1fr] items-baseline gap-4">
      <div className="text-sm text-gray-600">{k}</div>
      <div className="text-sm text-gray-900">{v}</div>
    </div>
  );
}

function SoftPanel({ children }: { children: React.ReactNode }) {
  return (
    <div className="rounded-lg border border-gray-200 bg-gray-50 p-3 shadow-xs">
      {children}
    </div>
  );
}


===== components\admin\vehicles\ui\VehiclesGrid.ui.tsx =====
"use client";
import * as React from "react";
import type { Vehicle } from "@/lib/admin/vehicles/types";
import { VehicleCard } from "./VehicleCard.ui";

export function VehiclesGrid({
  rows,
  onEdit,
  onDelete,
  onOpenDetails,
}: {
  rows: (Vehicle & {
    photoUrl?: string;
    lastCheckIn?: string;
    maxLoadKg?: number;
    assignedDriver?: string;
    nextServiceISO?: string;
  })[];
  onEdit: (id: string) => void;
  onDelete: (id: string) => void;
  onOpenDetails: (id: string) => void;
}) {
  if (rows.length === 0) {
    return (
      <div className="rounded-lg border bg-white p-6 text-center text-gray-500">
        No vehicles match your filters.
      </div>
    );
  }
  return (
    <div className="grid gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
      {rows.map(v => (
        <VehicleCard key={v.id} v={v} onEdit={onEdit} onDelete={onDelete} onOpenDetails={onOpenDetails} />
      ))}
    </div>
  );
}


===== components\admin\vehicles\ui\VehiclesTable.ui.tsx =====
"use client";
import * as React from "react";
import { Edit, Trash2 } from "lucide-react";
import type { Vehicle } from "@/lib/admin/vehicles/types";
import { StatusBadge } from "@/components/common/StatusBadge.ui";

export function VehiclesTable({
  rows,
  selection,
  setSelection,
  onEdit,
  onDelete,
}: {
  rows: Vehicle[];
  selection: string[];
  setSelection: (ids: string[]) => void;
  onEdit: (id: string) => void;
  onDelete: (id: string) => void;
}) {
  const allChecked = rows.length > 0 && selection.length === rows.length;
  const toggleAll = () => setSelection(allChecked ? [] : rows.map((r) => r.id));
  const toggleOne = (id: string) =>
    setSelection(
      selection.includes(id)
        ? selection.filter((x) => x !== id)
        : [...selection, id]
    );

  return (
    <div className="overflow-x-auto rounded-lg border bg-white">
      <table className="min-w-[800px] w-full text-sm">
        <thead className="bg-gray-50 text-gray-600">
          <tr>
            <th className="w-10 p-2 text-left">
              <input type="checkbox" checked={allChecked} onChange={toggleAll} />
            </th>
            <th className="p-2 text-left">Plate</th>
            <th className="p-2 text-left">Code</th>
            <th className="p-2 text-left">Brand / Model</th>
            <th className="p-2 text-left">Type</th>
            <th className="p-2 text-right">Capacity</th>
            <th className="p-2 text-left">Status</th>
            <th className="p-2 text-right">Odometer</th>
            <th className="p-2 text-left">Last Service</th>
            <th className="p-2"></th>
          </tr>
        </thead>
        <tbody>
          {rows.map((v) => (
            <tr key={v.id} className="border-t">
              <td className="p-2">
                <input
                  type="checkbox"
                  checked={selection.includes(v.id)}
                  onChange={() => toggleOne(v.id)}
                />
              </td>
              <td className="p-2 font-medium">{v.plateNo}</td>
              <td className="p-2">{v.code}</td>
              <td className="p-2">
                {v.brand} <span className="text-gray-500">/ {v.model}</span>
              </td>
              <td className="p-2">{v.type}</td>
              <td className="p-2 text-right">{v.capacity}</td>
              <td className="p-2">
                <StatusBadge value={v.status} />
              </td>
              <td className="p-2 text-right">
                {v.odometerKm.toLocaleString()} km
              </td>
              <td className="p-2">{v.lastServiceISO}</td>
              <td className="p-2">
                <div className="flex justify-end gap-1.5">
                  <button
                    onClick={() => onEdit(v.id)}
                    className="p-1.5 rounded-md border hover:bg-gray-50"
                    title="Edit"
                  >
                    <Edit size={16} />
                  </button>
                  <button
                    onClick={() => onDelete(v.id)}
                    className="p-1.5 rounded-md border hover:bg-gray-50"
                    title="Delete"
                  >
                    <Trash2 size={16} />
                  </button>
                </div>
              </td>
            </tr>
          ))}
          {rows.length === 0 && (
            <tr>
              <td className="p-6 text-center text-gray-500" colSpan={10}>
                No vehicles match your filters.
              </td>
            </tr>
          )}
        </tbody>
      </table>
    </div>
  );
}


===== components\admin\vehicles\ui\constants.ts =====
export const Brand = "#7a0019";

export const VEHICLE_TABS = [
  { key: "all", label: "All vehicles" },
  { key: "assigned", label: "Assigned" },
  { key: "out_of_order", label: "Out of order" },
  { key: "available", label: "Available for assign" },
  { key: "service_needed", label: "Service needed" },
] as const;

export type VehiclePrimaryTab = typeof VEHICLE_TABS[number]["key"];


===== components\admin\vehicles\ui\inputs\TinyInputs.tsx =====
"use client";
import * as React from "react";

export function Input({
  label,
  value,
  onChange,
}: {
  label: string;
  value: string;
  onChange: (v: string) => void;
}) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <input
        className="rounded-md border px-3 py-2"
        value={value}
        onChange={(e) => onChange(e.target.value)}
      />
    </label>
  );
}

export function NumberInput({
  label,
  value,
  onChange,
  min = 0,
}: {
  label: string;
  value: number;
  onChange: (v: number) => void;
  min?: number;
}) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <input
        type="number"
        min={min}
        className="rounded-md border px-3 py-2"
        value={value}
        onChange={(e) => onChange(Number(e.target.value))}
      />
    </label>
  );
}

export function DateInput({
  label,
  value,
  onChange,
}: {
  label: string;
  value: string;
  onChange: (v: string) => void;
}) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <input
        type="date"
        className="rounded-md border px-3 py-2"
        value={value}
        onChange={(e) => onChange(e.target.value)}
      />
    </label>
  );
}

export function Select<T extends string>({
  label,
  value,
  options,
  onChange,
}: {
  label: string;
  value: T;
  options: readonly T[];
  onChange: (v: T) => void;
}) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <select
        className="rounded-md border px-3 py-2 bg-white"
        value={value}
        onChange={(e) => onChange(e.target.value as T)}
      >
        {options.map((o) => (
          <option key={o} value={o}>
            {o}
          </option>
        ))}
      </select>
    </label>
  );
}


===== components\auth\LogoutButton.tsx =====
"use client";

import { useRouter } from "next/navigation";
import { useState } from "react";

export default function LogoutButton() {
  const router = useRouter();
  const [loading, setLoading] = useState(false);

  async function handleLogout() {
    setLoading(true);
    try {
      // Call our API logout endpoint
      await fetch("/api/logout", { method: "POST" });
      // Redirect to login page
      router.push("/login");
    } catch (err) {
      console.error("Logout failed:", err);
    } finally {
      setLoading(false);
    }
  }

  return (
    <button
      onClick={handleLogout}
      disabled={loading}
      className="px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50"
    >
      {loading ? "Logging out..." : "Logout"}
    </button>
  );
}


===== components\common\Card.tsx =====
"use client";

export default function Card({ title, children }: { title: string; children: React.ReactNode }) {
  return (
    <section className="rounded-2xl border border-neutral-200 bg-white p-5 md:p-6 shadow-sm">
      <h2 className="text-[15px] md:text-base font-semibold mb-3 md:mb-4">{title}</h2>
      <div className="min-w-0">{children}</div>
    </section>
  );
}


===== components\common\ConfirmDialog.ui.tsx =====
"use client";
export function ConfirmDialog({
  open,
  title,
  message,
  confirmText = "Confirm",
  cancelText = "Cancel",
  onCancel,
  onConfirm,
}: {
  open: boolean;
  title: string;
  message: string | React.ReactNode;
  confirmText?: string;
  cancelText?: string;
  onCancel: () => void;
  onConfirm: () => void;
}) {
  if (!open) return null;
  return (
    <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/40 p-4">
      <div className="w-full max-w-sm overflow-hidden rounded-2xl bg-white shadow-2xl">
        <div className="border-b px-4 py-3 text-sm font-semibold">{title}</div>
        <div className="px-4 py-4 text-sm text-gray-700">{message}</div>
        <div className="flex justify-end gap-2 border-t px-4 py-3">
          <button
            onClick={onCancel}
            className="rounded-lg border border-gray-200 bg-white px-3 py-1.5 text-sm hover:bg-gray-50"
          >
            {cancelText}
          </button>
          <button
            onClick={onConfirm}
            className="rounded-lg bg-red-600 px-3 py-1.5 text-sm text-white shadow hover:bg-red-700"
          >
            {confirmText}
          </button>
        </div>
      </div>
    </div>
  );
}


===== components\common\Header.tsx =====
"use client";
import React from "react";
import { IconBell, IconSearch } from "@/components/ui/Icons";

export default function Header({
  onToggleNotifs,
  unread,
  notifOpen,
}: {
  onToggleNotifs: () => void;
  unread: number;
  notifOpen: boolean;
}) {
  return (
    <header className="bg-gradient-to-b from-[#7A0010] to-[#4E0009] text-white border-b border-black/10">
      <div className="w-full px-2 sm:px-4 py-2 flex items-center gap-3">
        <h1 className="text-sm sm:text-base font-semibold text-white">
          <span className="text-white">Admin</span> · <span className="text-white">TraviLink</span>
        </h1>

        <div className="ml-auto flex items-center gap-2 sm:gap-3">
          <div className="relative text-neutral-500">
            <IconSearch />
            <input
              placeholder="Search schedules, vehicles, drivers…"
              className="h-9 w-[58vw] md:w-[46vw] 2xl:w-[720px] rounded-md border border-white/20 bg-white/95 pl-8 pr-3 text-sm text-neutral-900 placeholder:text-neutral-500 focus:outline-none focus:ring-2 focus:ring-white transition-shadow hover:shadow-sm"
            />
          </div>
          <button
            aria-label="Notifications"
            aria-expanded={notifOpen}
            onClick={onToggleNotifs}
            className={`relative grid place-items-center h-9 w-9 rounded-md border transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-white/80 focus-visible:ring-offset-2 focus-visible:ring-offset-[#7A0010] ${
              notifOpen ? "border-white/50 bg-white/15" : "border-white/30 bg-white/10 hover:bg-white/15 hover:-translate-y-0.5"
            } text-white`}
          >
            {unread > 0 && (
              <span className="absolute -top-1 -right-1 min-w-[18px] h-[18px] rounded-full bg-rose-600 text-white text-[10px] leading-[18px] grid place-items-center px-1 shadow">
                {unread > 99 ? "99+" : unread}
              </span>
            )}
            <IconBell />
          </button>
        </div>
      </div>
    </header>
  );
}


===== components\common\MapPicker.ui.tsx =====
"use client";

import * as React from "react";
import { createPortal } from "react-dom";
import dynamic from "next/dynamic";
import type { PickedPlace } from "./MapPickerLeafletImpl";

// Dynamically import the Leaflet impl (client only)
const MapPickerLeaflet = dynamic(() => import("./MapPickerLeafletImpl"), {
  ssr: false,
  loading: () => null,
});

export type { PickedPlace };

function usePortalTarget() {
  const [el, setEl] = React.useState<HTMLElement | null>(null);

  React.useEffect(() => {
    let target = document.getElementById("travilink-portal-root") as HTMLElement | null;
    if (!target) {
      target = document.createElement("div");
      target.id = "travilink-portal-root";
      document.body.appendChild(target);
    }
    setEl(target);
    return () => {
      // keep the portal for reuse; don’t remove
    };
  }, []);

  return el;
}

export default function MapPicker(props: {
  open: boolean;
  onClose: () => void;
  onPick: (p: PickedPlace) => void;
  initial?: PickedPlace | null;
}) {
  // Guard SSR
  if (typeof window === "undefined") return null;
  const target = usePortalTarget();
  if (!target || !props.open) return null;

  return createPortal(
    // Backdrop + centered card, isolated from the dialog’s stacking context
    <div
      className="fixed inset-0 z-[9998] flex items-center justify-center bg-black/50"
      onClick={props.onClose}
    >
      <div
        className="mx-3 w-[min(1000px,calc(100vw-1.5rem))] rounded-2xl bg-white shadow-2xl"
        onClick={(e) => e.stopPropagation()}
      >
        <MapPickerLeaflet {...props} />
      </div>
    </div>,
    target
  );
}


===== components\common\MapPickerLeafletImpl.tsx =====
// src/components/common/MapPickerLeafletImpl.tsx
"use client";

import * as React from "react";
import { MapContainer, TileLayer, Marker, useMapEvents } from "react-leaflet";
import L from "leaflet";

//
// Default marker icons — copy these files to:
//   /public/leaflet/marker-icon.png
//   /public/leaflet/marker-icon-2x.png
//   /public/leaflet/marker-shadow.png
//
L.Icon.Default.mergeOptions({
  iconUrl: "/leaflet/marker-icon.png",
  iconRetinaUrl: "/leaflet/marker-icon-2x.png",
  shadowUrl: "/leaflet/marker-shadow.png",
});

export type PickedPlace = {
  lat: number;
  lng: number;
  address: string;
};

type Props = {
  open: boolean;                 // (kept for API symmetry; not used here)
  onClose: () => void;
  onPick: (p: PickedPlace) => void;
  initial?: PickedPlace | null;
};

type NominatimHit = {
  display_name: string;
  lat: string;
  lon: string;
};

// tiny debounce so we don't spam Nominatim when typing
function useDebounced<T extends (...args: any[]) => void>(fn: T, delay = 400) {
  const t = React.useRef<number | null>(null);
  return React.useCallback(
    (...args: Parameters<T>) => {
      if (t.current) window.clearTimeout(t.current);
      t.current = window.setTimeout(() => fn(...args), delay);
    },
    [fn, delay]
  );
}

async function nominatimSearch(q: string) {
  const params = new URLSearchParams({
    q,
    format: "jsonv2",
    limit: "8",
    dedupe: "1",
    addressdetails: "1",
    autocomplete: "1",
    countrycodes: "ph", // bias to PH; remove if you want global
  });
  const url = `https://nominatim.openstreetmap.org/search?${params.toString()}`;
  const res = await fetch(url);
  if (!res.ok) return [];
  return (await res.json()) as NominatimHit[];
}

async function nominatimReverse(lat: number, lon: number) {
  const params = new URLSearchParams({
    format: "jsonv2",
    lat: String(lat),
    lon: String(lon),
    addressdetails: "1",
  });
  const url = `https://nominatim.openstreetmap.org/reverse?${params.toString()}`;
  const res = await fetch(url);
  if (!res.ok) return null;
  return await res.json();
}

function ClickPicker({ onPickPos }: { onPickPos: (lat: number, lng: number) => void }) {
  useMapEvents({
    click(e) {
      onPickPos(e.latlng.lat, e.latlng.lng);
    },
  });
  return null;
}

export default function MapPickerLeafletImpl({ onClose, onPick, initial }: Props) {
  const [query, setQuery] = React.useState("");
  const [results, setResults] = React.useState<NominatimHit[]>([]);
  const [loading, setLoading] = React.useState(false);
  const [chosen, setChosen] = React.useState<PickedPlace | null>(initial ?? null);

  const center = chosen
    ? ([chosen.lat, chosen.lng] as [number, number])
    : ([14.5995, 120.9842] as [number, number]); // Manila default

  const runSearch = useDebounced(async (text: string) => {
    const trimmed = text.trim();
    if (!trimmed) {
      setResults([]);
      return;
    }
    setLoading(true);
    try {
      const hits = await nominatimSearch(trimmed);
      setResults(hits);
    } catch {
      setResults([]);
    } finally {
      setLoading(false);
    }
  }, 450);

  function onQueryChange(v: string) {
    setQuery(v);
    runSearch(v);
  }

  function selectResult(hit: NominatimHit) {
    const lat = parseFloat(hit.lat);
    const lng = parseFloat(hit.lon);
    setChosen({ lat, lng, address: hit.display_name });
    setResults([]);
    setQuery(hit.display_name);
  }

  async function handleMapClick(lat: number, lng: number) {
    try {
      const rev = await nominatimReverse(lat, lng);
      const addr =
        rev?.display_name ?? `lat: ${lat.toFixed(6)}, lng: ${lng.toFixed(6)}`;
      setChosen({ lat, lng, address: addr });
      setQuery(addr);
      setResults([]);
    } catch {
      setChosen({
        lat,
        lng,
        address: `lat: ${lat.toFixed(6)}, lng: ${lng.toFixed(6)}`,
      });
    }
  }

  function useThisLocation() {
    if (!chosen) return;
    onPick(chosen);
  }

  return (
    <div className="flex flex-col gap-0">
      {/* Header */}
      <div className="flex items-center justify-between border-b px-4 py-3">
        <div className="text-base font-semibold">Pick location</div>
        <button
          onClick={onClose}
          className="rounded-lg border px-3 py-1.5 text-sm hover:bg-neutral-50"
        >
          Close
        </button>
      </div>

      {/* Search */}
      <div className="relative p-3">
        <input
          value={query}
          onChange={(e) => onQueryChange(e.target.value)}
          className="h-11 w-full rounded-lg border px-3"
          placeholder="Search address or place (Nominatim)"
        />
        {query && (results.length > 0 || loading) && (
          <div className="absolute left-3 right-3 top-[3.25rem] z-[2] max-h-64 overflow-auto rounded-lg border bg-white shadow-lg">
            {loading && (
              <div className="px-3 py-2 text-sm text-neutral-500">Searching…</div>
            )}
            {results.map((r, i) => (
              <button
                key={`${r.lat}-${r.lon}-${i}`}
                onClick={() => selectResult(r)}
                className="block w-full px-3 py-2 text-left text-sm hover:bg-neutral-50"
              >
                {r.display_name}
              </button>
            ))}
          </div>
        )}
      </div>

      {/* Map */}
      <div className="px-3 pb-3">
        <div className="h-[60vh] w-full overflow-hidden rounded-xl border">
          <MapContainer center={center} zoom={13} style={{ height: "100%", width: "100%" }}>
            <TileLayer
              attribution='&copy; <a href="https://www.openstreetmap.org/">OSM</a> contributors'
              url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
            />
            <ClickPicker onPickPos={handleMapClick} />
            {chosen && <Marker position={[chosen.lat, chosen.lng]} />}
          </MapContainer>
        </div>

        {/* Chosen preview */}
        <div className="mt-2 rounded-md border bg-neutral-50 px-3 py-2 text-xs text-neutral-700">
          <div className="font-medium">Chosen:</div>
          <div className="truncate">{chosen?.address ?? "—"}</div>
          <div>
            lat: {chosen?.lat?.toFixed(6) ?? "—"}, lng: {chosen?.lng?.toFixed(6) ?? "—"}
          </div>
        </div>
      </div>

      {/* Footer */}
      <div className="flex items-center justify-end gap-2 border-t px-4 py-3">
        <button onClick={onClose} className="h-10 rounded-lg border px-4">
          Cancel
        </button>
        <button
          onClick={useThisLocation}
          disabled={!chosen}
          className="h-10 rounded-lg bg-[#7A0010] px-4 text-white disabled:opacity-50"
        >
          Use this location
        </button>
      </div>
    </div>
  );
}


===== components\common\Modal.ui.tsx =====
// components/common/Modal.ui.tsx
"use client";
import * as React from "react";
export function Modal({
  open, title, onClose, children, maxWidth="max-w-2xl",
}: {
  open: boolean; title: string; onClose: ()=>void; children: React.ReactNode; maxWidth?: string;
}) {
  if (!open) return null;
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4">
      <div className={`w-full ${maxWidth} overflow-hidden rounded-2xl bg-white shadow-xl`}>
        <div className="flex items-center justify-between border-b px-4 py-3">
          <h2 className="text-lg font-semibold">{title}</h2>
          <button onClick={onClose} className="rounded-lg bg-red-600 px-3 py-1.5 text-sm text-white shadow hover:bg-red-700">
            Close
          </button>
        </div>
        <div className="max-h-[75vh] overflow-y-auto p-4">{children}</div>
      </div>
    </div>
  );
}


===== components\common\Page.tsx =====
"use client";

import React, { ReactNode } from "react";

/** Root page wrapper */
export function Page({
  children,
  className = "",
}: {
  children: ReactNode;
  className?: string;
}) {
  return (
    <div className={`min-h-screen bg-neutral-50 text-neutral-900 ${className}`}>
      {children}
    </div>
  );
}

/**
 * PageHeader
 * - Defaults to contained layout with a bottom border (like Gab's)
 * - Can mimic the simpler header (your version) by turning off `bordered`
 *   and adjusting outer margins via `className`.
 */
export function PageHeader({
  title,
  description,
  actions,
  bordered = true,
  className = "",
}: {
  title: string;
  description?: string;
  actions?: ReactNode;
  /** show bottom border line under the header */
  bordered?: boolean;
  className?: string;
}) {
  return (
    <div className={`bg-transparent ${className}`}>
      <div className="mx-auto max-w-[1400px] px-4 md:px-6 py-5 flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
        <div>
          <h1 className="text-2xl font-semibold">{title}</h1>
          {description ? (
            <p className="text-sm text-neutral-600">{description}</p>
          ) : null}
        </div>
        {actions ? <div className="flex gap-2">{actions}</div> : null}
      </div>
      {bordered && <div className="border-b" />}
    </div>
  );
}

/**
 * PageBody
 * - Default is contained (max width + paddings) like Gab’s
 * - Set `contained={false}` to use simple stacked spacing (your version)
 */
export function PageBody({
  children,
  contained = true,
  className = "",
}: {
  children: ReactNode;
  /** if false, renders simple vertical spacing instead of container */
  contained?: boolean;
  className?: string;
}) {
  if (!contained) {
    return <div className={`space-y-4 ${className}`}>{children}</div>;
  }
  return (
    <div className={`mx-auto max-w-[1400px] px-4 md:px-6 py-5 ${className}`}>
      {children}
    </div>
  );
}


===== components\common\ReasonModal.ui.tsx =====
// src/components/admin/common/ReasonModal.ui.tsx
"use client";
import React from "react";

export default function ReasonModalUI({
  open, title = "Reject request?", placeholder = "Reason…", onCancel, onConfirm,
}: {
  open: boolean;
  title?: string;
  placeholder?: string;
  onCancel: () => void;
  onConfirm: (reason: string) => void;
}) {
  const [val, setVal] = React.useState("");
  React.useEffect(() => { if (!open) setVal(""); }, [open]);

  if (!open) return null;
  return (
    <div className="fixed inset-0 z-50 grid place-items-center bg-black/40">
      <div className="w-full max-w-sm rounded-lg bg-white p-4 shadow-xl">
        <h3 className="mb-2 text-sm font-semibold">{title}</h3>
        <textarea
          className="mb-3 w-full rounded border p-2 text-sm"
          rows={4}
          value={val}
          placeholder={placeholder}
          onChange={(e) => setVal(e.target.value)}
        />
        <div className="flex justify-end gap-2">
          <button className="rounded border px-3 py-1 text-sm" onClick={onCancel}>Cancel</button>
          <button
            className="rounded bg-red-600 px-3 py-1 text-sm text-white disabled:opacity-50"
            disabled={!val.trim()}
            onClick={() => onConfirm(val.trim())}
          >
            Reject
          </button>
        </div>
      </div>
    </div>
  );
}


===== components\common\StatusBadge.ui.tsx =====
"use client";
export function StatusBadge({ value }: { value: string }) {
  const cls =
    value === "active"
      ? "bg-green-100 text-green-700"
      : value === "maintenance"
      ? "bg-amber-100 text-amber-700"
      : "bg-gray-200 text-gray-700";
  return <span className={`rounded-full px-2 py-0.5 text-xs ${cls}`}>{value}</span>;
}


===== components\common\StatusChip.tsx =====
export default function StatusChip({ status }: { status: string }) {
  const color =
    status === "Available"
      ? "bg-[var(--color-accent)] text-white"
      : status === "Maintenance"
      ? "bg-[var(--color-warning)] text-white"
      : status === "On Trip"
      ? "bg-blue-600 text-white"
      : "bg-neutral-400 text-white";

  return (
    <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${color}`}>
      {status}
    </span>
  );
}


===== components\common\ToastProvider.tsx =====
"use client";
import React from "react";

type Toast = {
  id: string;
  title?: string;
  message: string;
  kind?: "success" | "error" | "info";
  ms?: number;
};

type Ctx = {
  toast: (t: Omit<Toast, "id">) => void;
};

const ToastContext = React.createContext<Ctx | null>(null);

export function useToast() {
  const ctx = React.useContext(ToastContext);
  if (!ctx) throw new Error("useToast must be used within <ToastProvider />");
  return ctx.toast;
}

export default function ToastProvider({ children }: { children: React.ReactNode }) {
  const [toasts, setToasts] = React.useState<Toast[]>([]);

  const toast = React.useCallback((t: Omit<Toast, "id">) => {
    const id = crypto.randomUUID();
    const ms = t.ms ?? 4000;
    const next: Toast = { id, kind: "info", ...t };
    setToasts((prev) => [next, ...prev]);
    window.setTimeout(() => {
      setToasts((prev) => prev.filter((x) => x.id !== id));
    }, ms);
  }, []);

  return (
    <ToastContext.Provider value={{ toast }}>
      {children}
      {/* container */}
      <div className="pointer-events-none fixed right-4 top-4 z-[9999] flex w-[360px] max-w-[90vw] flex-col gap-2">
        {toasts.map((t) => (
          <div
            key={t.id}
            className={`pointer-events-auto rounded-md border p-3 shadow ${
              t.kind === "success"
                ? "border-green-200 bg-green-50 text-green-900"
                : t.kind === "error"
                ? "border-red-200 bg-red-50 text-red-900"
                : "border-neutral-200 bg-white text-neutral-900"
            }`}
          >
            {t.title && <div className="mb-1 text-sm font-medium">{t.title}</div>}
            <div className="text-sm">{t.message}</div>
          </div>
        ))}
      </div>
    </ToastContext.Provider>
  );
}


===== components\common\file_upload\FileUpload.ui.tsx =====
"use client";
import * as React from "react";
import { FileUploadDropzone } from "./FileUploadDropzone.ui";
import { UploadList, UploadItem } from "./UploadList.ui";

export function FileUpload({
  label = "Upload files",
  helper = "Choose a file or drag and drop",
  accept = "*/*",
  multiple = false,
  maxSizeMB = 50,
  accent = "#7a0019",      // maroon
  autoStart = true,
  preview,                  // backward compat (single)
  onChange,                 // single
  onChangeMany,             // multiple
  simulateErrors = false,   // demo only
}: {
  label?: string;
  helper?: string;
  accept?: string;
  multiple?: boolean;
  maxSizeMB?: number;
  accent?: string;
  autoStart?: boolean;
  preview?: string;
  onChange?: (file: File | null, url?: string) => void;
  onChangeMany?: (items: UploadItem[]) => void;
  simulateErrors?: boolean;
}) {
  const [items, setItems] = React.useState<UploadItem[]>([]);
  const timers = React.useRef<Record<string, number>>({});

  // support initial preview for single image
  React.useEffect(() => {
    if (!multiple && preview && items.length === 0) {
      setItems([{
        id: "preview",
        file: new File([], "preview"),
        name: "preview",
        size: 0,
        url: preview,
        progress: 100,
        status: "done",
      } as UploadItem]);
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [preview, multiple]);

  // notify parent
  React.useEffect(() => {
    if (multiple) onChangeMany?.(items);
    else {
      const firstDone = items.find(i => i.status === "done" && i.url);
      onChange?.(firstDone?.file ?? null, firstDone?.url);
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [items]);

  const clearTimer = (id: string) => {
    const t = timers.current[id];
    if (t) { window.clearInterval(t); delete timers.current[id]; }
  };

  const startUpload = (id: string) => {
    setItems(prev => prev.map(i => i.id === id ? { ...i, status: "uploading", progress: 0, error: undefined } : i));
    const t = window.setInterval(() => {
      setItems(prev => {
        const cur = prev.find(i => i.id === id);
        if (!cur) { clearTimer(id); return prev; }
        const next = Math.min(100, cur.progress + Math.floor(10 + Math.random() * 18));
        const fail = simulateErrors && Math.random() < 0.2;
        if (next >= 100) {
          clearTimer(id);
          return prev.map(i => i.id === id ? {
            ...i,
            progress: 100,
            status: fail ? "error" : "done",
            error: fail ? "Network error. Please retry." : undefined,
            url: fail ? i.url : (i.url ?? URL.createObjectURL(i.file)),
          } : i);
        }
        return prev.map(i => i.id === id ? { ...i, progress: next } : i);
      });
    }, 180);
    timers.current[id] = t;
  };

  const addFiles = (files: FileList | File[]) => {
    const max = maxSizeMB * 1024 * 1024;
    const fresh: UploadItem[] = Array.from(files).map((f) => ({
      id: crypto.randomUUID(),
      file: f,
      name: f.name,
      size: f.size,
      url: undefined,
      progress: 0,
      status: f.size > max ? "error" : "idle",
      error: f.size > max ? `Exceeds ${maxSizeMB}MB` : undefined,
    }));
    setItems(prev => {
      const next = multiple ? [...prev.filter(i => i.id !== "preview"), ...fresh] : [fresh[0]];
      if (autoStart) next.forEach(i => { if (i.status === "idle") startUpload(i.id); });
      return next;
    });
  };

  const retry = (id: string) => startUpload(id);
  const remove = (id: string) => { clearTimer(id); setItems(prev => prev.filter(i => i.id !== id)); };
  const cancelAll = () => {
    Object.keys(timers.current).forEach(clearTimer);
    setItems(prev => prev.map(i => (i.status === "uploading" ? { ...i, status: "error", error: "Canceled" } : i)));
  };

  return (
    <div className="grid gap-4">
      {/* Dropzone always visible */}
      <FileUploadDropzone
        label={label}
        helper={helper}
        accept={accept}
        multiple={multiple}
        accent={accent}
        onFiles={addFiles}
      />

      {/* List appears ONLY when there are files */}
      <UploadList
        items={items}
        accent={accent}
        onRetry={retry}
        onRemove={remove}
        onCancelAll={cancelAll}
      />
    </div>
  );
}


===== components\common\file_upload\FileUploadDropzone.ui.tsx =====
"use client";
import * as React from "react";

export function FileUploadDropzone({
  label = "Upload",
  helper = "Choose a file or drag and drop",
  accept = "*/*",
  multiple = false,
  accent = "#7a0019",
  onFiles,
}: {
  label?: string;
  helper?: string;
  accept?: string;
  multiple?: boolean;
  accent?: string;             // maroon
  onFiles: (files: FileList | File[]) => void;
}) {
  const [dragOver, setDragOver] = React.useState(false);

  const onDrop = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setDragOver(false);
    if (e.dataTransfer.files?.length) onFiles(e.dataTransfer.files);
  };

  return (
    <div className="rounded-2xl border bg-white p-4 shadow-sm">
      <div className="text-sm font-medium text-gray-900">{label}</div>
      <div
        onDragOver={(e) => { e.preventDefault(); setDragOver(true); }}
        onDragLeave={() => setDragOver(false)}
        onDrop={onDrop}
        className={`mt-3 flex h-44 items-center justify-center rounded-xl border-2 border-dashed transition`}
        style={{
          borderColor: dragOver ? accent : "#d1d5db",
          backgroundColor: dragOver ? "#f8f0f2" : "white",
        }}
      >
        <div className="text-center">
          <div className="mb-1 text-sm text-gray-600">{helper}</div>
          <label
            className="inline-flex cursor-pointer items-center justify-center rounded-md px-3 py-1.5 text-white"
            style={{ background: accent }}
          >
            Browse file
            <input
              type="file"
              accept={accept}
              multiple={multiple}
              onChange={(e) => {
                if (e.target.files?.length) onFiles(e.target.files);
                e.currentTarget.value = "";
              }}
              className="hidden"
            />
          </label>
        </div>
      </div>
    </div>
  );
}


===== components\common\file_upload\UploadList.ui.tsx =====
"use client";
import * as React from "react";

export type UploadStatus = "idle" | "uploading" | "done" | "error";

export type UploadItem = {
  id: string;
  file: File;
  name: string;
  size: number;
  url?: string;
  progress: number;
  status: UploadStatus;
  error?: string;
};

const fmt = (b: number) =>
  b < 1024 ? `${b}B` : b < 1024 * 1024 ? `${(b / 1024).toFixed(0)}KB` : `${(b / 1048576).toFixed(1)} MB`;

export function UploadList({
  items,
  accent = "#7a0019",
  onRetry,
  onRemove,
  onCancelAll,
}: {
  items: UploadItem[];
  accent?: string; // maroon
  onRetry: (id: string) => void;
  onRemove: (id: string) => void;
  onCancelAll: () => void;
}) {
  if (items.length === 0) return null;

  const uploading = items.some(i => i.status === "uploading");

  return (
    <div className="rounded-2xl border bg-white p-4 shadow-sm">
      <div className="mb-2 flex items-center justify-between">
        <div className="text-sm font-medium text-gray-900">
          {uploading ? "Uploading…" : "Uploads"}
        </div>
        {uploading && (
          <button
            type="button"
            onClick={onCancelAll}
            className="rounded-md border px-3 py-1.5 text-sm hover:bg-gray-50"
          >
            Cancel
          </button>
        )}
      </div>

      <div className="grid gap-2">
        {items.map((it) => (
          <div key={it.id} className="rounded-lg border p-2">
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center overflow-hidden rounded bg-gray-100">
                {it.url && it.file.type.startsWith("image/")
                  ? /* eslint-disable-next-line @next/next/no-img-element */
                    <img src={it.url} alt="" className="h-full w-full object-cover" />
                  : <span className="text-xs text-gray-500">FILE</span>}
              </div>

              <div className="min-w-0 flex-1">
                <div className="flex items-center justify-between gap-2">
                  <div className="truncate text-sm font-medium">{it.name}</div>
                  <div className="whitespace-nowrap text-xs text-gray-500">{fmt(it.size)}</div>
                </div>

                <div className="mt-1 flex items-center gap-2">
                  <div className="h-2 w-full overflow-hidden rounded bg-gray-100">
                    <div
                      className="h-full"
                      style={{
                        width: `${it.status === "done" ? 100 : it.progress}%`,
                        background: it.status === "error" ? "#ef4444" : accent,
                      }}
                    />
                  </div>
                  <div className="w-16 text-right text-xs text-gray-500">
                    {it.status === "done" ? "Completed" : it.status === "error" ? "Error" : `${Math.min(it.progress, 99)}%`}
                  </div>
                </div>

                {it.status === "error" && (
                  <div className="mt-1 text-xs text-rose-600">{it.error ?? "Upload failed."}</div>
                )}
              </div>

              <div className="flex items-center gap-1">
                {it.status === "error" && (
                  <button
                    type="button"
                    onClick={() => onRetry(it.id)}
                    className="rounded-md border px-2 py-1 text-xs hover:bg-gray-50"
                  >
                    Retry
                  </button>
                )}
                <button
                  type="button"
                  onClick={() => onRemove(it.id)}
                  className="rounded-md border px-2 py-1 text-xs hover:bg-gray-50"
                  title="Remove"
                >
                  ✕
                </button>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}


===== components\common\forms\FormActions.ui.tsx =====
// components/common/form/FormActions.ui.tsx
"use client";
export function FormActions({
  onCancel, submitLabel="Save", brand="#7a0019",
}: { onCancel: ()=>void; submitLabel?: string; brand?: string }) {
  return (
    <div className="flex justify-end gap-2 pt-2">
      <button type="button" onClick={onCancel}
        className="rounded-md border bg-white px-3 py-1.5">Cancel</button>
      <button type="submit"
        className="rounded-md px-3 py-1.5 text-white" style={{ background: brand }}>
        {submitLabel}
      </button>
    </div>
  );
}


===== components\common\forms\FormSection.ui.tsx =====
// components/common/form/FormSection.ui.tsx
"use client";
export function FormSection({
  title, children,
}: { title?: string; children: React.ReactNode }) {
  return (
    <section className="rounded-xl bg-white p-4 ring-1 ring-gray-200 shadow-sm">
      {title && <div className="mb-3 text-sm font-semibold">{title}</div>}
      <div className="grid gap-3">{children}</div>
    </section>
  );
}


===== components\common\forms\Inputs.tsx =====
"use client";
import * as React from "react";

export function TextInput({
  label, value, onChange, placeholder
}: {
  label: string; value: string; onChange: (v: string) => void; placeholder?: string;
}) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <input
        className="rounded-md border px-3 py-2"
        value={value}
        onChange={e => onChange(e.target.value)}
        placeholder={placeholder}
      />
    </label>
  );
}

export function NumberInput({
  label, value, onChange, min = 0
}: {
  label: string; value: number; onChange: (v: number) => void; min?: number;
}) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <input
        type="number"
        min={min}
        className="rounded-md border px-3 py-2"
        value={value}
        onChange={e => onChange(Number(e.target.value))}
      />
    </label>
  );
}

export function DateInput({
  label, value, onChange
}: {
  label: string; value: string; onChange: (v: string) => void;
}) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <input
        type="date"
        className="rounded-md border px-3 py-2"
        value={value}
        onChange={e => onChange(e.target.value)}
      />
    </label>
  );
}

export function SelectInput<T extends string>({
  label, value, options, onChange
}: {
  label: string; value: T; options: readonly T[]; onChange: (v: T) => void;
}) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <select
        className="rounded-md border px-3 py-2 bg-white"
        value={value}
        onChange={e => onChange(e.target.value as T)}
      >
        {options.map(o => (
          <option key={o} value={o}>{o}</option>
        ))}
      </select>
    </label>
  );
}


===== components\common\hooks\useConfirm.tsx =====
"use client";
import * as React from "react";
import { ConfirmDialog } from "@/components/common/ConfirmDialog.ui";

export function useConfirm() {
  const [state, setState] = React.useState<null | {
    title: string;
    message: string | React.ReactNode;
    confirmText?: string;
    cancelText?: string;
    resolve: (v: boolean) => void;
  }>(null);

  const ask = (
    title: string,
    message: string | React.ReactNode,
    confirmText = "Confirm",
    cancelText = "Cancel"
  ) =>
    new Promise<boolean>((resolve) =>
      setState({ title, message, confirmText, cancelText, resolve })
    );

  const ui = state ? (
    <ConfirmDialog
      open
      title={state.title}
      message={state.message}
      confirmText={state.confirmText}
      cancelText={state.cancelText}
      onCancel={() => {
        state.resolve(false);
        setState(null);
      }}
      onConfirm={() => {
        state.resolve(true);
        setState(null);
      }}
    />
  ) : null;

  return { ask, ui };
}


===== components\common\inputs\DateInput.ui.tsx =====
// components/common/inputs/DateInput.ui.tsx
"use client";
import * as React from "react";
export function DateInput({
  label, value, onChange,
}: { label: string; value: string; onChange:(v:string)=>void }) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <input
        type="date" className="rounded-md border px-3 py-2"
        value={value} onChange={e=>onChange(e.target.value)}
      />
    </label>
  );
}


===== components\common\inputs\NumberInput.ui.tsx =====
// components/common/inputs/NumberInput.ui.tsx
"use client";
import * as React from "react";
export function NumberInput({
  label, value, onChange, min = 0, step = 1,
}: { label: string; value: number; onChange: (v:number)=>void; min?: number; step?: number; }) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <input
        type="number" min={min} step={step}
        className="rounded-md border px-3 py-2"
        value={value} onChange={e => onChange(Number(e.target.value))}
      />
    </label>
  );
}


===== components\common\inputs\Select.ui.tsx =====
// components/common/inputs/Select.ui.tsx
"use client";
import * as React from "react";
export function Select<T extends string>({
  label, value, options, onChange,
}: {
  label: string; value: T; options: readonly T[]; onChange:(v:T)=>void;
}) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}</span>
      <select
        className="rounded-md border px-3 py-2 bg-white"
        value={value} onChange={e=>onChange(e.target.value as T)}
      >
        {options.map(o => <option key={o} value={o}>{o}</option>)}
      </select>
    </label>
  );
}


===== components\common\inputs\TextInput.ui.tsx =====
// components/common/inputs/TextInput.ui.tsx
"use client";
import * as React from "react";
export function TextInput({
  label, value, onChange, placeholder, required, disabled,
}: {
  label: string; value: string; onChange: (v: string)=>void;
  placeholder?: string; required?: boolean; disabled?: boolean;
}) {
  return (
    <label className="grid gap-1 text-sm">
      <span className="text-gray-700">{label}{required ? " *" : ""}</span>
      <input
        className="rounded-md border px-3 py-2 disabled:opacity-50"
        value={value} onChange={e => onChange(e.target.value)}
        placeholder={placeholder} disabled={disabled}
      />
    </label>
  );
}


===== components\driver\Badge.tsx =====
export default function Badge({ children }: { children: React.ReactNode }) {
  return <span className="inline-flex items-center gap-1 rounded-full bg-brand-cream text-brand-maroon px-2.5 py-0.5 text-xs font-medium">{children}</span>;
}


===== components\driver\Button.tsx =====
type Props = React.ButtonHTMLAttributes<HTMLButtonElement> & {
  variant?: "solid" | "outline" | "ghost";
  size?: "sm" | "md";
};

export default function Button({ variant="solid", size="md", className="", ...rest }: Props) {
  const base = "rounded-full font-medium transition outline-none focus:ring-2 focus:ring-brand-maroon/30 disabled:opacity-50 disabled:cursor-not-allowed";
  const sizes = { sm: "px-3 py-1 text-sm", md: "px-4 py-2" }[size];
  const variants = {
    solid:   "bg-brand-maroon text-white hover:bg-brand-maroon/90",
    outline: "border border-slate-300 text-slate-700 hover:bg-slate-50",
    ghost:   "text-slate-700 hover:bg-slate-100",
  }[variant];
  return <button className={`${base} ${sizes} ${variants} ${className}`} {...rest} />;
}


===== components\driver\Chip.tsx =====
export default function Chip({
  color="gray",
  children,
}: { color?: "green"|"yellow"|"red"|"gray"|"blue"; children: React.ReactNode }) {
  const map: Record<string,string> = {
    green: "bg-green-100 text-green-700",
    yellow:"bg-yellow-100 text-yellow-700",
    red:   "bg-rose-100 text-rose-700",
    blue:  "bg-blue-100 text-blue-700",
    gray:  "bg-slate-100 text-slate-700",
  };
  return <span className={`inline-block rounded-full px-2.5 py-0.5 text-xs font-medium ${map[color]}`}>{children}</span>;
}


===== components\driver\FleetSnapshot.tsx =====
"use client";

import * as React from "react";
import MaintenanceLogsDrawer, { type MaintenanceLog } from "@/components/driver/MaintenanceLogsDrawer";

export type FleetVehicle = {
  id: string;
  name: string;             // "Bus 12"
  plate: string;            // "ABC-1234"
  type: string;             // "Bus" | "Van" | "Truck"
  status: "available" | "offline" | "assigned";
  lastMaintenance?: string; // ISO "YYYY-MM-DD"
  nextDue?: string;         // ISO "YYYY-MM-DD"
  logs?: MaintenanceLog[];  // optional; enables View Logs
};

type Props = {
  title?: string;
  vehicles: FleetVehicle[];
};

// ✅ Named export (no default)
export function FleetSnapshot({ title = "Fleet Snapshot", vehicles }: Props) {
  const [open, setOpen] = React.useState(false);
  const [active, setActive] = React.useState<FleetVehicle | null>(null);

  function openLogs(v: FleetVehicle) {
    setActive(v);
    setOpen(true);
  }
  function closeLogs() {
    setOpen(false);
    setActive(null);
  }

  return (
    <section className="rounded-xl ring-1 ring-neutral-200/70 bg-white shadow-sm">
      <div className="flex items-center justify-between border-b border-neutral-200/80 px-4 py-3">
        <h2 className="font-medium">{title}</h2>
        <div className="text-xs text-neutral-500">{vehicles.length} vehicle(s)</div>
      </div>

      <div className="overflow-x-auto">
        <table className="min-w-full text-sm">
          <thead className="bg-neutral-50 text-neutral-600">
            <tr>
              <Th>Name / Model</Th>
              <Th>Plate</Th>
              <Th>Type</Th>
              <Th>Status</Th>
              <Th>Last Maint.</Th>
              <Th>Next Due</Th>
              <Th className="text-right pr-4">Actions</Th>
            </tr>
          </thead>
          <tbody className="divide-y divide-neutral-200/70">
            {vehicles.map((v) => (
              <tr key={v.id} className="hover:bg-neutral-50/70">
                <Td><div className="font-medium">{v.name}</div></Td>
                <Td><span className="font-mono">{v.plate}</span></Td>
                <Td>{v.type}</Td>
                <Td>
                  <span className={`rounded px-2 py-0.5 text-xs ${tone(v.status)}`}>
                    {labelStatus(v.status)}
                  </span>
                </Td>
                <Td>{fmtDate(v.lastMaintenance)}</Td>
                <Td>{fmtDate(v.nextDue)}</Td>
                <Td className="text-right pr-4">
                  <button
                    className="rounded-md border border-neutral-200 px-2.5 py-1.5 text-xs hover:bg-neutral-50 disabled:opacity-50"
                    onClick={() => openLogs(v)}
                    disabled={!v.logs || v.logs.length === 0}
                    title={(!v.logs || v.logs.length === 0) ? "No logs available" : "View detailed maintenance logs"}
                  >
                    View Logs
                  </button>
                </Td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <MaintenanceLogsDrawer
        open={open}
        onClose={closeLogs}
        vehicle={active ? { id: active.id, name: active.name, plate: active.plate, type: active.type } : null}
        logs={active?.logs ?? []}
      />
    </section>
  );
}

function Th({ children, className="" }: React.PropsWithChildren<{ className?: string }>) {
  return <th className={`px-4 py-2 text-left font-medium ${className}`}>{children}</th>;
}
function Td({ children, className="" }: React.PropsWithChildren<{ className?: string }>) {
  return <td className={`px-4 py-2 align-middle ${className}`}>{children}</td>;
}

function labelStatus(s: FleetVehicle["status"]) {
  if (s === "available") return "Available";
  if (s === "assigned") return "Assigned";
  return "Unavailable";
}
function tone(s: FleetVehicle["status"]) {
  if (s === "available") return "bg-green-100 text-green-700";
  if (s === "assigned") return "bg-blue-100 text-blue-700";
  return "bg-neutral-100 text-neutral-700";
}

function fmtDate(iso?: string) {
  if (!iso) return "—";
  try {
    const d = new Date(iso);
    return d.toLocaleDateString(undefined, { year: "numeric", month: "short", day: "2-digit" });
  } catch {
    return iso;
  }
}


===== components\driver\MaintenanceLogsDrawer.tsx =====
"use client";

import * as React from "react";

export type MaintenanceLog = {
  id: string;
  date: string;           // "YYYY-MM-DD"
  odometer?: number;      // km (optional)
  category: string;       // "Oil Change", "Brake Service", etc.
  description?: string;   // notes
  cost?: number;          // optional
  nextDueDate?: string;   // optional
};

export type VehicleLite = {
  id: string;
  name: string;           // "Bus 12"
  plate: string;          // "ABC-1234"
  type: string;           // "Bus" | "Van"
};

export default function MaintenanceLogsDrawer({
  open,
  onClose,
  vehicle,
  logs,
}: {
  open: boolean;
  onClose: () => void;
  vehicle?: VehicleLite | null;
  logs: MaintenanceLog[];
}) {
  if (!open) return null;

  return (
    <div className="fixed inset-0 z-[70]">
      {/* backdrop */}
      <div
        className="absolute inset-0 bg-black/30"
        onClick={onClose}
        aria-hidden="true"
      />
      {/* drawer */}
      <aside
        className="absolute right-0 top-0 h-full w-full max-w-xl bg-white shadow-2xl ring-1 ring-neutral-200 animate-in slide-in-from-right"
        role="dialog"
        aria-modal="true"
      >
        <header className="sticky top-0 flex items-center justify-between border-b border-neutral-200 bg-white px-4 py-3">
          <div>
            <div className="text-xs text-neutral-500">{vehicle?.type}</div>
            <h2 className="text-lg font-semibold">
              {vehicle?.name} • {vehicle?.plate}
            </h2>
          </div>
          <button
            onClick={onClose}
            className="rounded-md px-3 py-1.5 text-sm border border-neutral-200 hover:bg-neutral-50"
          >
            Close
          </button>
        </header>

        <section className="p-4 space-y-3">
          {logs.length === 0 ? (
            <div className="rounded-lg border border-dashed border-neutral-200 p-6 text-center text-neutral-500">
              No maintenance logs for this vehicle.
            </div>
          ) : (
            logs
              .slice()
              .sort((a, b) => (a.date < b.date ? 1 : -1))
              .map((log) => (
                <article
                  key={log.id}
                  className="rounded-lg border border-neutral-200 p-4 bg-white"
                >
                  <div className="flex items-start justify-between">
                    <div>
                      <div className="text-sm text-neutral-500">
                        {formatDate(log.date)}
                      </div>
                      <div className="font-medium">{log.category}</div>
                    </div>
                    {log.nextDueDate && (
                      <span className="rounded px-2 py-0.5 text-xs bg-amber-50 text-amber-700 border border-amber-200">
                        Next due: {formatDate(log.nextDueDate)}
                      </span>
                    )}
                  </div>

                  {log.description && (
                    <p className="mt-2 text-sm text-neutral-700 whitespace-pre-wrap">
                      {log.description}
                    </p>
                  )}

                  <div className="mt-3 grid grid-cols-2 gap-2 text-xs text-neutral-600 sm:grid-cols-3">
                    {log.odometer !== undefined && (
                      <div className="rounded border border-neutral-200 px-2 py-1">
                        Odometer:{" "}
                        <span className="font-medium">
                          {log.odometer.toLocaleString()} km
                        </span>
                      </div>
                    )}
                    {log.cost !== undefined && (
                      <div className="rounded border border-neutral-200 px-2 py-1">
                        Cost:{" "}
                        <span className="font-medium">
                          {formatMoney(log.cost)}
                        </span>
                      </div>
                    )}
                    <div className="rounded border border-neutral-200 px-2 py-1">
                      Log ID: <span className="font-mono">{log.id}</span>
                    </div>
                  </div>
                </article>
              ))
          )}
        </section>
      </aside>
    </div>
  );
}

function formatDate(iso: string) {
  try {
    return new Date(iso).toLocaleDateString(undefined, {
      year: "numeric",
      month: "short",
      day: "2-digit",
    });
  } catch {
    return iso;
  }
}

function formatMoney(n: number) {
  try {
    return n.toLocaleString(undefined, {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    });
  } catch {
    return String(n);
  }
}


===== components\driver\MiniCalendar.tsx =====
"use client";

import { useEffect, useMemo, useState } from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";

type CalEvent = { date: string; type: "trip"; label?: string };

const TRIPS_KEY = "travilink_trips";

// helpers – local YYYY-MM-DD (no UTC conversion)
const pad2 = (n: number) => String(n).padStart(2, "0");
const ymdLocal = (d: Date) =>
  `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;

export default function MiniCalendar() {
  const today = new Date();
  const [view, setView] = useState({ y: today.getFullYear(), m: today.getMonth() });
  const [events, setEvents] = useState<CalEvent[]>([]);

  function loadEvents() {
    const all: CalEvent[] = [];
    try {
      const rawT = localStorage.getItem(TRIPS_KEY);
      if (rawT) {
        const trips = JSON.parse(rawT) as { date: string; label?: string }[];
        all.push(
          ...trips.map((t) => ({
            date: t.date.slice(0, 10), // normalize
            type: "trip" as const,
            label: t.label || "Trip",
          }))
        );
      }
    } catch {}
    setEvents(all);
  }

  useEffect(() => {
    loadEvents();
    const onStorage = (e: StorageEvent) => {
      if (e.key === TRIPS_KEY) loadEvents();
    };
    window.addEventListener("storage", onStorage);
    return () => window.removeEventListener("storage", onStorage);
  }, []);

  const first = new Date(view.y, view.m, 1);
  const start = new Date(first);
  start.setDate(first.getDate() - first.getDay());

  const days = useMemo(() => {
    const arr: Date[] = [];
    for (let i = 0; i < 42; i++) {
      const d = new Date(start);
      d.setDate(start.getDate() + i);
      arr.push(d);
    }
    return arr;
  }, [view.y, view.m]);

  function prevMonth() {
    setView((v) => (v.m === 0 ? { y: v.y - 1, m: 11 } : { y: v.y, m: v.m - 1 }));
  }
  function nextMonth() {
    setView((v) => (v.m === 11 ? { y: v.y + 1, m: 0 } : { y: v.y, m: v.m + 1 }));
  }

  function eventsFor(d: Date) {
    const key = ymdLocal(d);
    return events.filter((e) => e.date === key);
  }

  const todayKey = ymdLocal(new Date());

  return (
    <section className="rounded-xl ring-1 ring-neutral-200/70 bg-white shadow-sm">
      <div className="flex items-center justify-between px-3 py-2 border-b border-neutral-200/80">
        <button onClick={prevMonth} className="p-1 rounded hover:bg-neutral-100" aria-label="Previous month">
          <ChevronLeft className="h-4 w-4" />
        </button>
        <div className="text-sm font-medium">
          {new Date(view.y, view.m, 1).toLocaleString(undefined, { month: "long", year: "numeric" })}
        </div>
        <button onClick={nextMonth} className="p-1 rounded hover:bg-neutral-100" aria-label="Next month">
          <ChevronRight className="h-4 w-4" />
        </button>
      </div>

      <div className="grid grid-cols-7 text-center text-[11px] text-neutral-600 px-3 pt-2 pb-1">
        {["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((d) => (<div key={d}>{d}</div>))}
      </div>

      <div className="grid grid-cols-7 gap-1 p-3 pt-0">
        {days.map((d, i) => {
          const inMonth = d.getMonth() === view.m;
          const isToday = ymdLocal(d) === todayKey;
          const evts = eventsFor(d);
          const title = evts.map((e) => e.label || "Trip").join("\n");

          return (
            <div
              key={i}
              title={title || undefined}
              className={[
                "relative h-12 rounded-lg border text-xs p-1.5 text-right",
                inMonth ? "bg-white border-neutral-200/80 text-neutral-800" : "bg-neutral-50 border-neutral-100 text-neutral-400",
                isToday ? "ring-1 ring-[#7a0019]" : "",
              ].join(" ")}
            >
              {d.getDate()}
              <div className="absolute left-1.5 bottom-1.5 flex gap-1">
                {evts.some((e) => e.type === "trip") && <span className="h-2 w-2 rounded-full bg-green-600" />}
              </div>
            </div>
          );
        })}
      </div>

      <div className="flex items-center justify-between px-3 py-2 border-t border-neutral-200/80 text-[11px]">
        <div className="flex items-center gap-3">
          <span className="inline-flex items-center gap-1"><span className="h-2 w-2 rounded-full bg-green-600" /> Trips</span>
        </div>
        <a href="/driver/schedule" className="text-[#7a0019] hover:underline">full calendar</a>
      </div>
    </section>
  );
}


===== components\driver\ProfilePanel.tsx =====
"use client";
import React from "react";

type ProfilePanelProps = {
  role?: "DRIVER" | "ADMIN" | "FACULTY" | string;
  name: string;
  code: string;
  faculty?: string;
  campus?: string;
  watermarkSrc?: string; // e.g. "/euwhite.png" in /public
};

function initials(full: string) {
  return full
    .split(" ")
    .filter(Boolean)
    .slice(0, 2)
    .map((s) => s[0]?.toUpperCase())
    .join("");
}

export default function ProfilePanel({
  role = "DRIVER",
  name,
  code,
  faculty = "Faculty",
  campus = "Lucena Campus",
  watermarkSrc = "/euwhite.png",
}: ProfilePanelProps) {
  return (
    <section className="relative overflow-hidden rounded-2xl bg-[#7A0E20] text-white">
      {/* subtle watermark */}
      <img
        src={watermarkSrc}
        alt=""
        className="pointer-events-none select-none absolute right-[-24px] top-[-24px] h-40 w-40 opacity-15"
      />

      <div className="p-5 sm:p-6 flex items-start gap-4">
        {/* avatar */}
        <div className="flex h-11 w-11 items-center justify-center rounded-full bg-white/15 ring-1 ring-white/20 text-white font-semibold">
          {initials(name)}
        </div>

        {/* identity */}
        <div className="min-w-0">
          <div className="text-xs uppercase tracking-wide opacity-90">Profile • {role}</div>
          <div className="mt-0.5 text-lg font-semibold leading-tight truncate">{name}</div>
          <div className="text-sm opacity-90">Code: {code}</div>

          {/* chips */}
          <div className="mt-3 flex flex-wrap gap-2">
            <span className="rounded-full bg-white/15 px-2.5 py-1 text-xs font-medium ring-1 ring-white/25">
              {faculty}
            </span>
            <span className="rounded-full bg-white/15 px-2.5 py-1 text-xs font-medium ring-1 ring-white/25">
              {campus}
            </span>
          </div>
        </div>
      </div>
    </section>
  );
}


===== components\driver\RightRail.tsx =====
"use client";

import ProfilePanel from "@/components/driver/ProfilePanel";
import type { ComponentProps } from "react";
import MiniCalendar from "@/components/driver/MiniCalendar";

/** Import the prop type from ProfilePanel for safety */
type ProfilePanelProps = ComponentProps<typeof ProfilePanel>;

type RightRailProps = {
  /** Optional profile override; we’ll fill sane defaults */
  profile?: Partial<ProfilePanelProps>;
  /** KPIs shown above the calendar */
  kpis?: {
    requests: number;
    online: number;
    pending: number;
  };
  /** NOTE: tripsForCalendar is no longer used; MiniCalendar reads from localStorage */
};

function KPI({ label, value }: { label: string; value: number }) {
  return (
    <div className="rounded-2xl bg-white ring-1 ring-neutral-200/70 shadow-sm p-4 text-center">
      <div className="text-2xl font-semibold leading-tight">{value}</div>
      <div className="mt-1 text-sm text-neutral-600">{label}</div>
    </div>
  );
}

export default function RightRail({
  profile,
  kpis = { requests: 5, online: 3, pending: 4 },
}: RightRailProps) {
  // Build a definite profile object for ProfilePanel
  const p: ProfilePanelProps = {
    role: profile?.role ?? "DRIVER",
    name: profile?.name ?? "Driver",
    code: profile?.code ?? "—",
    faculty: profile?.faculty ?? "Driver",
    campus: profile?.campus ?? "Lucena Campus",
    watermarkSrc: profile?.watermarkSrc ?? "/euwhite.png",
  };

  return (
    <aside className="w-full xl:w-[320px] shrink-0 space-y-4 xl:sticky xl:top-20">
      <ProfilePanel {...p} />

      {/* KPIs */}
      <div className="grid grid-cols-3 gap-3">
        <KPI label="Active Requests" value={kpis.requests} />
        <KPI label="Vehicles Online" value={kpis.online} />
        <KPI label="Pending Approvals" value={kpis.pending} />
      </div>

      {/* Mini calendar — no props */}
      <MiniCalendar />
    </aside>
  );
}


===== components\driver\ScheduleTable.tsx =====
import { UPCOMING } from "@/app/lib/mock";

export default function ScheduleTable() {
  return (
    <div className="card p-0 overflow-hidden">
      <div className="px-5 py-4 font-semibold">Upcoming Schedules</div>
      <div className="border-t border-tl-line">
        <table className="w-full text-sm">
          <thead className="bg-gray-50">
            <tr className="text-left text-tl.gray3">
              <th className="px-5 py-3">Date</th>
              <th className="px-5 py-3">Location</th>
              <th className="px-5 py-3">Vehicle</th>
              <th className="px-5 py-3">Driver</th>
              <th className="px-5 py-3">Status</th>
              <th className="px-5 py-3">Actions</th>
            </tr>
          </thead>
          <tbody>
            {UPCOMING.map((r) => (
              <tr key={r.id} className="border-t border-tl-line">
                <td className="px-5 py-3 whitespace-nowrap">
                  <div>{r.date}</div>
                  <div className="text-xs text-tl.gray3">{r.time}</div>
                </td>
                <td className="px-5 py-3">{r.location}</td>
                <td className="px-5 py-3">{r.vehicle}</td>
                <td className="px-5 py-3">{r.driver ?? "—"}</td>
                <td className="px-5 py-3">
                  <span
                    className={`pill ${
                      r.status === "Approved"
                        ? "bg-green-50 text-green-700 border-green-200"
                        : r.status === "Assigned"
                        ? "bg-blue-50 text-blue-700 border-blue-200"
                        : "bg-amber-50 text-amber-700 border-amber-200"
                    }`}
                  >
                    {r.status}
                  </span>
                </td>
                <td className="px-5 py-3">
                  <div className="flex gap-2">
                    <button className="btn">View</button>
                    <button className="btn btn-solid">Update</button>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}


===== components\driver\Sidebar.tsx =====
"use client";

import { useMemo } from "react";
import { usePathname } from "next/navigation";
import { CalendarDays, LayoutGrid, User2, Settings as Cog } from "lucide-react";
import SidebarView, { type NavItem, type NavLink } from "@/components/driver/SidebarView";

function scoreMatch(pathname: string, href: string) {
  const a = (pathname || "/").replace(/\/+$/, "");
  const b = href.replace(/\/+$/, "");
  if (a === b) return b.length;
  if (a.startsWith(b + "/")) return b.length;
  return -1;
}

export default function Sidebar() {
  const pathname = usePathname() || "/";

  const topLinks: NavLink[] = [
    { kind: "link", href: "/driver",          label: "Dashboard", icon: <LayoutGrid className="h-4 w-4" /> },
    { kind: "link", href: "/driver/schedule", label: "Schedule",  icon: <CalendarDays className="h-4 w-4" /> },
    { kind: "link", href: "/driver/profile",  label: "Profile",   icon: <User2 className="h-4 w-4" /> },
    { kind: "link", href: "/driver/settings", label: "Settings",  icon: <Cog className="h-4 w-4" /> },
  ];

  const activeHref = useMemo(
    () =>
      topLinks.reduce(
        (best, it) => {
          const s = scoreMatch(pathname, it.href);
          return s > best.score ? { href: it.href, score: s } : best;
        },
        { href: "", score: -1 }
      ).href,
    [pathname]
  );

  const items: NavItem[] = topLinks.map((l) => ({ ...l, active: l.href === activeHref }));

  return <SidebarView items={items} />;
}


===== components\driver\SidebarView.tsx =====
"use client";

import Link from "next/link";
import * as React from "react";

export type NavLink = {
  kind: "link";
  href: string;
  label: string;
  icon?: React.ReactNode;
  active?: boolean;
};

export type NavItem = NavLink;

export default function SidebarView({ items }: { items: NavItem[] }) {
  return (
    <aside className="w-full h-full p-3">
      <nav className="space-y-1">
        {items.map((it) => (
          <Link
            key={it.href}
            href={it.href}
            className={[
              "flex items-center gap-2 rounded-lg px-3 py-2 text-sm",
              it.active
                ? "bg-[var(--brand,#7a0019)]/10 text-[var(--brand,#7a0019)] ring-1 ring-[var(--brand,#7a0019)]/20"
                : "text-neutral-700 hover:bg-neutral-100",
            ].join(" ")}
          >
            {it.icon && <span className="shrink-0">{it.icon}</span>}
            <span className="truncate">{it.label}</span>
          </Link>
        ))}
      </nav>
    </aside>
  );
}


===== components\driver\Topbar.tsx =====
"use client";

import Link from "next/link";
import { Search, Bell } from "lucide-react";

export default function Topbar({ title }: { title?: string }) {
  return (
    <header className="sticky top-0 z-40 w-full bg-[var(--brand)] text-white border-b border-white/10">
      <div className="flex items-center justify-between px-4 sm:px-6 py-2">
        {/* Brand — now clickable to /driver with small gray “| Driver” */}
        <Link href="/driver" className="flex items-center gap-2 group">
          <span className="inline-flex h-7 w-7 items-center justify-center rounded-md bg-white/15 font-semibold">
            TL
          </span>
          <span className="hidden sm:flex items-baseline gap-2 font-semibold tracking-wide">
            <span>TraviLink</span>
            <span className="text-white/70 text-xs font-normal align-baseline">
              | Driver
            </span>
          </span>
        </Link>

        {/* Right side: search + bell */}
        <div className="flex items-center gap-3">
          <div className="relative w-[220px] sm:w-[280px] md:w-[340px]">
            <input
              placeholder="Search schedules, vehicles, drivers…"
              className="w-full rounded-full bg-white pl-9 pr-3 py-2 text-sm text-[var(--ink-900)] placeholder:text-[var(--ink-500)] outline-none border border-white/30 focus:border-[var(--brand)] focus:ring-2 focus:ring-[var(--brand)]/20"
            />
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-[var(--ink-500)]" />
          </div>
          <button
            aria-label="Notifications"
            className="inline-grid h-9 w-9 place-items-center rounded-full bg-white/15 hover:bg-white/20"
          >
            <Bell className="h-4 w-4 text-white" />
          </button>
        </div>
      </div>
    </header>
  );
}


===== components\driver\VehicleCard.tsx =====
"use client";
import { ClipboardList, Info } from "lucide-react";

/** Local minimal types so we don't depend on '@/app/lib/mock' */
type VehicleStatus = "available" | "offline" | "maintenance";
type Vehicle = { id: string; name: string; type: string; status: VehicleStatus };

function StatusPill({ s }: { s: VehicleStatus }) {
  const map: Record<VehicleStatus, string> = {
    available: "bg-green-50 text-green-700 border-green-200",
    maintenance: "bg-gray-100 text-gray-700 border-gray-200",
    offline: "bg-gray-100 text-gray-700 border-gray-200",
  };
  const label = s === "available" ? "Available" : "Unavailable";
  return <span className={`pill ${map[s]}`}>{label}</span>;
}

export default function VehicleCard({ v }: { v: Vehicle }) {
  return (
    <div className="card p-4">
      <div className="flex items-start justify-between">
        <div>
          <div className="text-sm text-tl.gray3">{v.type}</div>
          <div className="text-lg font-semibold">{v.name}</div>
        </div>
        <StatusPill s={v.status} />
      </div>

      <div className="h-24 my-4 grid place-items-center rounded-xl border border-dashed border-tl-line bg-gray-50 text-tl.gray4 text-sm">
        Vehicle image
      </div>

      <div className="flex gap-2">
        <button className="btn">
          <ClipboardList size={16} /> Schedule
        </button>
        <button className="btn">
          <Info size={16} /> Details
        </button>
      </div>
    </div>
  );
}


===== components\driver\dashboard\DashboardView.tsx =====
"use client";

import Link from "next/link";
import { ArrowRight, CalendarDays, Users, Clock } from "lucide-react";
import { FleetSnapshot, type FleetVehicle } from "@/components/driver/FleetSnapshot"; // ✅ named import

export type Status = "Pending" | "Approved" | "Assigned";

export type UpcomingRow = {
  id: string;
  date: string;      // "YYYY-MM-DD HH:mm"
  location: string;
  vehicle: string;
  status: Status;
};

export type Metrics = { trips: number; online: number; pending: number };

const tone = (s: Status) =>
  s === "Approved" ? "bg-green-100 text-green-700"
  : s === "Pending" ? "bg-amber-100 text-amber-700"
  : "bg-blue-100 text-blue-700";

function ActionCard({ icon, title, desc, href }:{
  icon: React.ReactNode; title: string; desc: string; href: string;
}) {
  return (
    <Link
      href={href}
      className="group relative block overflow-hidden rounded-xl border border-neutral-200 bg-white p-5 shadow-sm transition hover:border-[#7a0019] hover:shadow-md"
    >
      <span className="pointer-events-none absolute inset-x-0 top-0 h-[3px] origin-left scale-x-0 bg-[#7a0019] transition-transform duration-300 group-hover:scale-x-100" />
      <div className="mb-3 grid h-12 w-12 place-items-center rounded-lg bg-[#7a0019]">
        <div className="text-white">{icon}</div>
      </div>
      <div className="font-semibold">{title}</div>
      <p className="mt-1 text-sm text-neutral-600">{desc}</p>
      <div className="mt-3 flex items-center gap-1 text-[#7a0019]">
        <span className="text-sm">More</span>
        <ArrowRight className="h-4 w-4 transition-transform duration-200 group-hover:translate-x-1" />
      </div>
    </Link>
  );
}

function MetricCard({ icon, label, value }:{
  icon: React.ReactNode; label: string; value: number | string;
}) {
  return (
    <div className="rounded-xl bg-white p-4 shadow-sm ring-1 ring-neutral-200/70">
      <div className="flex items-center gap-3">
        <div className="grid h-10 w-10 place-items-center rounded-lg bg-[#7a0019]/10 text-[#7a0019]">
          {icon}
        </div>
        <div>
          <div className="text-xs uppercase tracking-wide text-neutral-500">{label}</div>
          <div className="text-lg font-semibold">{value}</div>
        </div>
      </div>
    </div>
  );
}

const SHOW_SNAPSHOT = true;

export default function DashboardView({
  metrics, upcoming, actions, fleet,
}:{
  metrics: Metrics;
  upcoming: UpcomingRow[];
  actions: Array<{ icon: React.ReactNode; title: string; desc: string; href: string }>;
  fleet?: FleetVehicle[];
}) {
  const cleanActions = actions.filter((a) => {
    const t = a.title?.toLowerCase?.() ?? "";
    return !(a.href?.startsWith?.("/driver/maintenance")) && !t.includes("maintenance");
  });

  return (
    <div className="px-4 py-6 sm:px-6 lg:px-8">
      {/* Header */}
      <div className="mb-6 flex flex-wrap items-center justify-between gap-3">
        <div>
          <h1 className="text-2xl font-semibold">Driver Transport Portal</h1>
          <p className="text-sm text-neutral-600">See upcoming trips and update your status.</p>
        </div>
        <div className="flex gap-2">
          <Link href="/driver/status" className="btn btn-primary">Update Status</Link>
          <Link href="/driver/schedule" className="btn btn-outline">View Schedule</Link>
        </div>
      </div>

      {/* Metrics */}
      <div className="grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3">
        <MetricCard icon={<CalendarDays className="h-5 w-5" />} label="Trips"   value={metrics.trips} />
        <MetricCard icon={<Users className="h-5 w-5" />}       label="Online"  value={metrics.online} />
        <MetricCard icon={<Clock className="h-5 w-5" />}       label="Pending" value={metrics.pending} />
      </div>

      {/* Actions */}
      <div className="mt-6 grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3">
        {cleanActions.map((a) => (
          <ActionCard key={`${a.title}-${a.href}`} {...a} />
        ))}
      </div>

      {/* Fleet Snapshot */}
      {SHOW_SNAPSHOT && fleet && fleet.length > 0 && (
        <div className="mt-6">
          <FleetSnapshot title="Fleet Snapshot (Read Only)" vehicles={fleet} />
        </div>
      )}

      {/* Upcoming + Quick note */}
      <div className="mt-6 grid grid-cols-1 gap-6 xl:grid-cols-2">
        {/* ... unchanged ... */}
      </div>
    </div>
  );
}


===== components\driver\profile\ProfileView.tsx =====
import { PageHeader, PageBody } from "@/components/common/Page";
import type { DriverProfile } from "@/app/types/driverProfile";
import { useMemo } from "react";

const card = "rounded-2xl bg-white ring-1 ring-neutral-200/70 shadow-sm";
const section = `${card} p-5`;
const fieldLabel = "text-sm font-medium text-neutral-700";
const fieldInput =
  "w-full rounded-lg border border-neutral-200 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-[#7a0019]/20 focus:border-[#7a0019]/50";
const help = "text-xs text-neutral-500";

export type PasswordState = { new: string; confirm: string };

type Props = {
  formId?: string;
  profile: DriverProfile;
  errors: Record<string, string>;
  password: PasswordState;
  saving: boolean;
  savedAt: string | null;
  fileInputRef: React.RefObject<HTMLInputElement | null>;

  onSubmit: (e: React.FormEvent) => void;
  onChange: <K extends keyof DriverProfile>(key: K, value: DriverProfile[K]) => void;
  onToggleCanDrive: (vehicle: string) => void;
  onPasswordChange: (patch: Partial<PasswordState>) => void;
  onAvatarFile: (file?: File) => void;
};

export default function ProfileView({
  formId = "driverProfileForm",
  profile, errors, password, saving, savedAt,
  fileInputRef, onSubmit, onChange, onToggleCanDrive, onPasswordChange, onAvatarFile,
}: Props) {

  const initials = useMemo(() => {
    const f = profile.firstName?.[0] ?? "";
    const l = profile.lastName?.[0] ?? "";
    return (f + l).toUpperCase() || "D";
  }, [profile.firstName, profile.lastName]);

  return (
    <>
      <PageHeader
        title="Profile"
        description="Manage your driver details and preferences."
        actions={
          <button type="submit" form={formId} disabled={saving} className="btn btn-primary">
            {saving ? "Saving…" : "Save Changes"}
          </button>
        }
      />

      <PageBody>
        <div className="grid grid-cols-1 xl:grid-cols-[1fr_360px] gap-5">
          {/* LEFT: FORM */}
          <form id={formId} onSubmit={onSubmit} className="space-y-5 min-w-0">
            {/* Personal */}
            <section className={section}>
              <h2 className="mb-3 font-medium">Personal Information</h2>

              <div className="flex items-center gap-4 mb-4">
                <div className="relative">
                  {profile.avatar ? (
                    <img src={profile.avatar} alt="Avatar preview"
                      className="h-16 w-16 rounded-full object-cover ring-1 ring-neutral-200/70" />
                  ) : (
                    <div className="h-16 w-16 rounded-full bg-neutral-100 text-neutral-700 grid place-items-center text-lg font-semibold ring-1 ring-neutral-200/70">
                      {initials}
                    </div>
                  )}
                </div>
                <div className="space-y-1.5">
                  <button type="button"
                    onClick={() => fileInputRef.current?.click()}
                    className="rounded-lg border border-neutral-200 px-3 py-1.5 text-sm hover:bg-neutral-50">
                    Change photo
                  </button>
                  <input
                    ref={fileInputRef}
                    type="file"
                    accept="image/*"
                    className="hidden"
                    onChange={(e) => onAvatarFile(e.target.files?.[0])}
                  />
                  <div className={help}>JPG/PNG, up to ~2MB.</div>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                  <label className={fieldLabel}>First name *</label>
                  <input className={fieldInput} value={profile.firstName}
                    onChange={(e) => onChange("firstName", e.target.value)} />
                  {errors.firstName && <p className="mt-1 text-xs text-red-600">{errors.firstName}</p>}
                </div>
                <div>
                  <label className={fieldLabel}>Last name *</label>
                  <input className={fieldInput} value={profile.lastName}
                    onChange={(e) => onChange("lastName", e.target.value)} />
                  {errors.lastName && <p className="mt-1 text-xs text-red-600">{errors.lastName}</p>}
                </div>
                <div className="md:col-span-2">
                  <label className={fieldLabel}>Email</label>
                  <input className={fieldInput} placeholder="you@example.com" value={profile.email ?? ""}
                    onChange={(e) => onChange("email", e.target.value)} />
                  {errors.email && <p className="mt-1 text-xs text-red-600">{errors.email}</p>}
                </div>
              </div>
            </section>

            {/* Organization */}
            <section className={section}>
              <h2 className="mb-3 font-medium">Organization</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                  <label className={fieldLabel}>Campus *</label>
                  <input className={fieldInput} value={profile.campus}
                    onChange={(e) => onChange("campus", e.target.value)} placeholder="e.g., Lucena" />
                  {errors.campus && <p className="mt-1 text-xs text-red-600">{errors.campus}</p>}
                </div>
                <div>
                  <label className={fieldLabel}>Department</label>
                  <input className={fieldInput} value={profile.dept ?? ""}
                    onChange={(e) => onChange("dept", e.target.value)} placeholder="e.g., Transport" />
                </div>
                <div className="md:col-span-2">
                  <label className={fieldLabel}>Phone</label>
                  <input className={fieldInput} value={profile.phone ?? ""}
                    onChange={(e) => onChange("phone", e.target.value)} placeholder="09XX XXX XXXX" />
                </div>
              </div>
            </section>

            {/* License & Capability */}
            <section className={section}>
              <h2 className="mb-3 font-medium">License & Capability</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                  <label className={fieldLabel}>License number *</label>
                  <input className={fieldInput} value={profile.license}
                    onChange={(e) => onChange("license", e.target.value)} placeholder="e.g., DL-1234-5678" />
                  {errors.license && <p className="mt-1 text-xs text-red-600">{errors.license}</p>}
                </div>
                <div>
                  <label className={fieldLabel}>Can drive</label>
                  <div className="flex flex-wrap gap-2 mt-1">
                    {["Bus", "Van", "Car", "Truck"].map((v) => {
                      const active = profile.canDrive.includes(v);
                      return (
                        <button key={v} type="button"
                          onClick={() => onToggleCanDrive(v)}
                          className={active
                            ? "rounded-full bg-[#7a0019] text-white text-xs px-3 py-1 shadow-sm"
                            : "rounded-full bg-neutral-100 text-neutral-800 text-xs px-3 py-1 ring-1 ring-neutral-200/70"}>
                          {v}
                        </button>
                      );
                    })}
                  </div>
                  <div className={`${help} mt-1`}>Click to toggle. Saved as a list.</div>
                </div>
              </div>
            </section>

            {/* Preferences */}
            <section className={section}>
              <h2 className="mb-3 font-medium">Preferences</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                <label className="flex items-center gap-2 text-sm">
                  <input type="checkbox" checked={profile.notifyEmail}
                    onChange={(e) => onChange("notifyEmail", e.target.checked)} />
                  Email notifications
                </label>
                <label className="flex items-center gap-2 text-sm">
                  <input type="checkbox" checked={profile.notifyPush}
                    onChange={(e) => onChange("notifyPush", e.target.checked)} />
                  Push notifications
                </label>
              </div>
              <p className={`${help} mt-2`}>
                You’ll receive updates about request approvals, schedule changes, and reminders.
              </p>
            </section>

            {/* Security */}
            <section className={section}>
              <h2 className="mb-3 font-medium">Security</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                  <label className={fieldLabel}>New password</label>
                  <input type="password" className={fieldInput} value={password.new}
                    onChange={(e) => onPasswordChange({ new: e.target.value })}
                    placeholder="Min 8 characters" />
                  {errors.passwordNew && <p className="mt-1 text-xs text-red-600">{errors.passwordNew}</p>}
                </div>
                <div>
                  <label className={fieldLabel}>Confirm new password</label>
                  <input type="password" className={fieldInput} value={password.confirm}
                    onChange={(e) => onPasswordChange({ confirm: e.target.value })} />
                  {errors.passwordConfirm && <p className="mt-1 text-xs text-red-600">{errors.passwordConfirm}</p>}
                </div>
              </div>
              <p className={`${help} mt-2`}>Leave blank to keep your current password.</p>
            </section>
          </form>

          {/* RIGHT: summary card */}
          <aside className="space-y-5">
            <section className="rounded-2xl bg-[#7A0E20] text-white relative overflow-hidden p-5">
              <img src="/euwhite.png" alt="" className="pointer-events-none select-none absolute right-[-24px] top-[-24px] h-40 w-40 opacity-15" />
              <div className="flex items-center gap-3">
                {profile.avatar ? (
                  <img src={profile.avatar} alt="Avatar" className="h-10 w-10 rounded-full object-cover border border-white/20" />
                ) : (
                  <div className="h-10 w-10 rounded-full bg-white/10 grid place-items-center font-semibold">
                    {initials}
                  </div>
                )}
                <div>
                  <div className="text-lg font-semibold">
                    {profile.firstName || profile.lastName
                      ? `${profile.firstName} ${profile.lastName}`.trim()
                      : "Driver"}
                  </div>
                  <div className="text-xs opacity-90">Driver • {profile.campus || "—"}</div>
                </div>
              </div>
              {savedAt && <div className="mt-3 text-xs opacity-90">Last saved: {savedAt}</div>}
            </section>

            <section className={section}>
              <h3 className="font-medium mb-2">Account tips</h3>
              <ul className="list-disc pl-5 text-sm text-neutral-700 space-y-1">
                <li>Keep your license number updated for dispatch validation.</li>
                <li>Use “Can drive” so schedulers assign the right vehicle.</li>
                <li>Enable notifications so you don’t miss trip updates.</li>
              </ul>
            </section>
          </aside>
        </div>
      </PageBody>
    </>
  );
}


===== components\driver\schedule\ScheduleView.tsx =====
import Link from "next/link";
import { CalendarDays, MapPin, BusFront, User2, BadgeCheck, Clock, Edit3 } from "lucide-react";
import { PageHeader, PageBody } from "@/components/common/Page";
import { statusTone } from "@/lib/data/statusTone";
import type { DriverScheduleRow } from "@/app/types/schedule";

type Props = {
  rows: DriverScheduleRow[];
  // optional overrides so you can wire custom handlers later (e.g., modals)
  makeViewHref?: (row: DriverScheduleRow) => string;
  makeUpdateHref?: (row: DriverScheduleRow) => string;
  title?: string;
  description?: string;
};

export default function ScheduleView({
  rows,
  makeViewHref = (r) => `/driver/schedule/${r.id}`,
  makeUpdateHref = (r) => `/driver/status?trip=${r.id}`,
  title = "My Schedule",
  description = "See upcoming assignments, check details, and keep your status up to date.",
}: Props) {
  return (
    <>
      <PageHeader
        title={title}
        description={description}
        actions={
          <div className="flex gap-2">
            <Link href="/driver/status" className="btn btn-primary">Update Status</Link>
            <Link href="/driver/history" className="btn btn-outline">Trip History</Link>
          </div>
        }
      />

      <PageBody>
        <section className="rounded-2xl ring-1 ring-neutral-200/70 bg-white shadow-sm overflow-hidden">
          <div className="flex items-center justify-between px-4 sm:px-5 py-3 border-b border-neutral-200/80">
            <div className="flex items-center gap-2">
              <CalendarDays className="h-5 w-5 text-[var(--brand,#7a0019)]" />
              <h2 className="font-semibold">Upcoming Schedules</h2>
            </div>
            <div className="hidden md:flex items-center gap-3 text-xs text-neutral-500">
              <span className="inline-flex items-center gap-1"><span className="h-2 w-2 rounded-full bg-green-600/80" /> Approved</span>
              <span className="inline-flex items-center gap-1"><span className="h-2 w-2 rounded-full bg-amber-600/80" /> Pending</span>
              <span className="inline-flex items-center gap-1"><span className="h-2 w-2 rounded-full bg-blue-600/80" /> Assigned</span>
            </div>
          </div>

          <div className="overflow-x-auto">
            <table className="w-full text-sm">
              <thead className="bg-neutral-50/70 text-neutral-600">
                <tr className="border-b border-neutral-200/70">
                  <th className="px-4 sm:px-5 py-3 text-left font-medium">Date</th>
                  <th className="px-4 sm:px-5 py-3 text-left font-medium">Location</th>
                  <th className="px-4 sm:px-5 py-3 text-left font-medium">Vehicle</th>
                  <th className="px-4 sm:px-5 py-3 text-left font-medium">Driver</th>
                  <th className="px-4 sm:px-5 py-3 text-left font-medium">Status</th>
                  <th className="px-4 sm:px-5 py-3 text-left font-medium">Actions</th>
                </tr>
              </thead>

              <tbody className="divide-y divide-neutral-200/70">
                {rows.map((r) => {
                  const [d, t] = r.date.split(" ");
                  return (
                    <tr key={r.id} className="hover:bg-neutral-50/70 transition-colors">
                      <td className="px-4 sm:px-5 py-3 min-w-[140px]">
                        <div className="font-medium">{d}</div>
                        <div className="text-xs text-neutral-500">{t}</div>
                      </td>

                      <td className="px-4 sm:px-5 py-3 min-w-[180px]">
                        <div className="flex items-center gap-2">
                          <span className="inline-grid h-8 w-8 place-items-center rounded-lg bg-neutral-100">
                            <MapPin className="h-4 w-4 text-neutral-700" />
                          </span>
                          <div className="font-medium">{r.location}</div>
                        </div>
                      </td>

                      <td className="px-4 sm:px-5 py-3">
                        <div className="flex items-center gap-2">
                          <span className="inline-grid h-8 w-8 place-items-center rounded-lg bg-neutral-100">
                            <BusFront className="h-4 w-4 text-neutral-700" />
                          </span>
                          <span>{r.vehicle}</span>
                        </div>
                      </td>

                      <td className="px-4 sm:px-5 py-3">
                        <div className="flex items-center gap-2 text-neutral-800">
                          <User2 className="h-4 w-4 text-neutral-500" />
                          {r.driver ? r.driver : <span className="text-neutral-400">—</span>}
                        </div>
                      </td>

                      <td className="px-4 sm:px-5 py-3">
                        <span className={`inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs font-medium ${statusTone(r.status)}`}>
                          {r.status === "Approved" && <BadgeCheck className="h-3.5 w-3.5" />}
                          {r.status === "Pending" && <Clock className="h-3.5 w-3.5" />}
                          {r.status === "Assigned" && <BusFront className="h-3.5 w-3.5" />}
                          {r.status}
                        </span>
                      </td>

                      <td className="px-4 sm:px-5 py-3">
                        <div className="flex items-center gap-2">
                          <Link href={makeViewHref(r)} className="inline-flex items-center gap-1 rounded-full border border-neutral-300 bg-white px-3 py-1.5 text-xs font-medium text-neutral-700 hover:bg-neutral-50">
                            View
                          </Link>
                          <Link href={makeUpdateHref(r)} className="inline-flex items-center gap-1 rounded-full border border-[#7a0019]/20 bg-[#7a0019]/10 px-3 py-1.5 text-xs font-medium text-[#7a0019] hover:bg-[#7a0019]/15">
                            <Edit3 className="h-3.5 w-3.5" />
                            Update
                          </Link>
                        </div>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </section>
      </PageBody>
    </>
  );
}


===== components\driver\settings\SettingsView.tsx =====
"use client";

import { PageHeader, PageBody } from "@/components/common/Page";
import type { DriverSettings } from "@/app/(protected)/driver/settings/page";

const card = "rounded-2xl bg-white ring-1 ring-neutral-200/70 shadow-sm";
const section = `${card} p-5`;
const label = "text-sm font-medium text-neutral-700";
const input =
  "w-full rounded-lg border border-neutral-200 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-[#7a0019]/20 focus:border-[#7a0019]/50";
const help = "text-xs text-neutral-500";

export default function SettingsView({
  formId = "driverSettingsForm",
  settings,
  saving,
  savedAt,
  onChange,
  onSubmit,
}: {
  formId?: string;
  settings: DriverSettings;
  saving: boolean;
  savedAt: string | null;
  onChange: <K extends keyof DriverSettings>(k: K, v: DriverSettings[K]) => void;
  onSubmit: (e: React.FormEvent) => void;
}) {
  return (
    <>
      <PageHeader
        title="Settings"
        description="Tune how the app behaves for your day-to-day driving."
        actions={
          <button type="submit" form={formId} className="btn btn-primary" disabled={saving}>
            {saving ? "Saving…" : "Save Settings"}
          </button>
        }
      />

      <PageBody>
        <form id={formId} onSubmit={onSubmit} className="space-y-5 max-w-3xl">
          {/* Notifications */}
          <section className={section}>
            <h2 className="mb-3 font-medium">Notifications</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
              <label className="flex items-center gap-2 text-sm">
                <input
                  type="checkbox"
                  checked={settings.notifyAssignments}
                  onChange={(e) => onChange("notifyAssignments", e.target.checked)}
                />
                New assignments
              </label>
              <label className="flex items-center gap-2 text-sm">
                <input
                  type="checkbox"
                  checked={settings.notifyChanges}
                  onChange={(e) => onChange("notifyChanges", e.target.checked)}
                />
                Changes & cancellations
              </label>
              <div>
                <div className={label}>Reminder lead time</div>
                <select
                  className={input}
                  value={settings.reminderMinutes}
                  onChange={(e) => onChange("reminderMinutes", Number(e.target.value) as DriverSettings["reminderMinutes"])}
                >
                  {[5, 10, 15, 30].map((m) => (
                    <option key={m} value={m}>
                      {m} minutes before
                    </option>
                  ))}
                </select>
              </div>
            </div>
          </section>

          {/* Status & Workday */}
          <section className={section}>
            <h2 className="mb-3 font-medium">Status & Workday</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <div className={label}>Default status on app open</div>
                <select
                  className={input}
                  value={settings.defaultStatusOnOpen}
                  onChange={(e) => onChange("defaultStatusOnOpen", e.target.value as DriverSettings["defaultStatusOnOpen"])}
                >
                  <option value="Available">Available</option>
                  <option value="Off Duty">Off Duty</option>
                </select>
              </div>
              <label className="flex items-center gap-2 text-sm">
                <input
                  type="checkbox"
                  checked={settings.autoOnTripOnBegin}
                  onChange={(e) => onChange("autoOnTripOnBegin", e.target.checked)}
                />
                Auto-set status to “On Trip” when I tap Begin Trip
              </label>
              <label className="flex items-center gap-2 text-sm">
                <input
                  type="checkbox"
                  checked={settings.promptOffDutyEOD}
                  onChange={(e) => onChange("promptOffDutyEOD", e.target.checked)}
                />
                End-of-day prompt to switch to Off Duty
              </label>
            </div>
          </section>

          {/* Location & Privacy */}
          <section className={section}>
            <h2 className="mb-3 font-medium">Location & Privacy</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
              <label className="flex items-center gap-2 text-sm">
                <input
                  type="checkbox"
                  checked={settings.shareLiveLocation}
                  onChange={(e) => onChange("shareLiveLocation", e.target.checked)}
                />
                Share live location during active trips
              </label>
              <label className="flex items-center gap-2 text-sm">
                <input
                  type="checkbox"
                  checked={settings.bgLocationWhileOnTrip}
                  onChange={(e) => onChange("bgLocationWhileOnTrip", e.target.checked)}
                />
                Allow background location while “On Trip”
              </label>
              <div className="md:col-span-2">
                <div className={label}>Who can see my live location</div>
                <select
                  className={input}
                  value={settings.locationVisibility}
                  onChange={(e) =>
                    onChange("locationVisibility", e.target.value as DriverSettings["locationVisibility"])
                  }
                >
                  <option value="dispatcher">Dispatcher only</option>
                  <option value="dispatcher_requester">Dispatcher & Requester</option>
                </select>
                <p className={`${help} mt-1`}>You can change this anytime.</p>
              </div>
            </div>
          </section>

          {/* Display */}
          <section className={section}>
            <h2 className="mb-3 font-medium">App Display</h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
              <div>
                <div className={label}>Language</div>
                <select
                  className={input}
                  value={settings.language}
                  onChange={(e) => onChange("language", e.target.value as DriverSettings["language"])}
                >
                  <option value="ph">Filipino</option>
                  <option value="en">English</option>
                </select>
              </div>
              <div>
                <div className={label}>Theme</div>
                <select
                  className={input}
                  value={settings.theme}
                  onChange={(e) => onChange("theme", e.target.value as DriverSettings["theme"])}
                >
                  <option value="system">System</option>
                  <option value="light">Light</option>
                  <option value="dark">Dark</option>
                </select>
              </div>
              <div>
                <div className={label}>Time format</div>
                <select
                  className={input}
                  value={settings.timeFormat}
                  onChange={(e) => onChange("timeFormat", e.target.value as DriverSettings["timeFormat"])}
                >
                  <option value="24h">24-hour</option>
                  <option value="12h">12-hour</option>
                </select>
              </div>
            </div>
            <p className={`${help} mt-2`}>Dates use local timezone by default.</p>
          </section>

          {/* Footer note */}
          <div className="text-xs text-neutral-500 px-1">
            {savedAt ? <>Last saved: {savedAt}</> : <>Not saved yet</>}
          </div>
        </form>
      </PageBody>
    </>
  );
}


===== components\driver\status\StatusView.tsx =====
import Link from "next/link";
import { PageHeader, PageBody } from "@/components/common/Page";
import { DRIVER_STATUSES, DriverStatus } from "@/app/types/driver";
import { StatusIcon, tone } from "@/lib/data/driverStatus";

type Props = {
  status: DriverStatus;
  onChange: (s: DriverStatus) => void;
  onSave?: () => void;
  onViewHistoryHref?: string;     // or use onViewHistory?: () => void
};

export default function StatusView({ status, onChange, onSave, onViewHistoryHref="/driver/history" }: Props) {
  return (
    <>
      <PageHeader
        title="Update Driver Status"
        description="Select your current availability for trips."
        actions={
          <div className="flex gap-2">
            <button className="btn btn-primary" onClick={onSave}>Save</button>
            <Link className="btn btn-outline" href={onViewHistoryHref}>View History</Link>
          </div>
        }
      />

      <PageBody>
        <section className="rounded-xl ring-1 ring-neutral-200/70 bg-white shadow-sm">
          <div className="border-b border-neutral-200/80 px-4 py-3">
            <h2 className="font-medium">Current Status</h2>
            <p className="text-sm text-neutral-600">
              You are currently marked as:
              <span className={`ml-2 rounded px-2 py-0.5 text-xs ${tone(status)}`}>{status}</span>
            </p>
          </div>

          <div className="grid grid-cols-2 gap-3 p-4 sm:grid-cols-3 md:grid-cols-5">
            {DRIVER_STATUSES.map((s) => (
              <button
                key={s}
                onClick={() => onChange(s)}
                className={`flex flex-col items-center justify-center gap-2 rounded-lg border px-3 py-4 text-sm transition 
                  ${status === s ? "border-[#7a0019] bg-neutral-50 font-semibold" : "border-neutral-200 hover:bg-neutral-50"}`}
              >
                <StatusIcon s={s} />
                {s}
              </button>
            ))}
          </div>
        </section>

        <section className="mt-6 rounded-xl ring-1 ring-neutral-200/70 bg-white shadow-sm">
          <div className="border-b border-neutral-200/80 px-4 py-3">
            <h2 className="font-medium">Quick Actions</h2>
          </div>
          <div className="grid gap-3 p-4 sm:grid-cols-2 lg:grid-cols-3">
            <button className="rounded-lg border border-neutral-200 bg-white p-4 text-left hover:border-[#7a0019] hover:bg-neutral-50" onClick={() => onChange("Available")}>
              <p className="font-medium">Start Shift</p>
              <p className="text-sm text-neutral-600">Set as Available</p>
            </button>
            <button className="rounded-lg border border-neutral-200 bg-white p-4 text-left hover:border-[#7a0019] hover:bg-neutral-50" onClick={() => onChange("On Trip")}>
              <p className="font-medium">Begin Trip</p>
              <p className="text-sm text-neutral-600">Mark as On Trip</p>
            </button>
            <button className="rounded-lg border border-neutral-200 bg-white p-4 text-left hover:border-[#7a0019] hover:bg-neutral-50" onClick={() => onChange("Off Duty")}>
              <p className="font-medium">Take Break</p>
              <p className="text-sm text-neutral-600">Switch to Off Duty</p>
            </button>
          </div>
        </section>
      </PageBody>
    </>
  );
}


===== components\faculty\DashboardView.tsx =====
"use client";

import Link from "next/link";
import {
  ArrowRight,
  BusFront,
  CalendarDays,
  Megaphone,
  Timer,
  CheckCircle2,
  MapPin,
  IdCard,
} from "lucide-react";

/* ---------- Types ---------- */
export type Status = "Pending" | "Approved" | "Assigned" | "Rejected";

export type UpcomingItem = {
  id: string;
  date: string;       // "YYYY-MM-DD HH:mm"
  location: string;
  vehicle: string;    // Bus / Van / Car …
  status: Status;
};

export type NotificationItem = { id: string; text: string; time: string };

export type Metrics = { upcoming: number; pending: number; approved: number };

export type Profile = {
  name: string;
  code: string;
  role: "Faculty" | "Driver" | "Admin";
  campus: string;
  avatar?: string;
};

const badgeTone = (s: Status) =>
  s === "Approved"
    ? "bg-green-100 text-green-700"
    : s === "Pending"
    ? "bg-amber-100 text-amber-700"
    : s === "Assigned"
    ? "bg-blue-100 text-blue-700"
    : "bg-neutral-100 text-neutral-700";

/* ---------- Small UI blocks ---------- */
function MetricCard({
  icon,
  label,
  value,
}: {
  icon: React.ReactNode;
  label: string;
  value: number | string;
}) {
  return (
    <div className="rounded-xl bg-white p-4 shadow-sm ring-1 ring-neutral-200/70">
      <div className="flex items-center gap-3">
        <div className="grid h-10 w-10 place-items-center rounded-lg bg-[#7a0019]/10 text-[#7a0019]">
          {icon}
        </div>
        <div>
          <div className="text-xs uppercase tracking-wide text-neutral-500">{label}</div>
          <div className="text-lg font-semibold">{value}</div>
        </div>
      </div>
    </div>
  );
}

function ActionCard({
  icon,
  title,
  desc,
  href,
}: {
  icon: React.ReactNode;
  title: string;
  desc: string;
  href: string;
}) {
  return (
    <Link
      href={href}
      className="group relative block h-full overflow-hidden rounded-xl border border-neutral-200 bg-white p-5 shadow-sm transition hover:border-[#7a0019] hover:shadow-md"
    >
      {/* top accent line */}
      <span className="pointer-events-none absolute inset-x-0 top-0 h-[3px] origin-left scale-x-0 bg-[#7a0019] transition-transform duration-300 group-hover:scale-x-100" />
      <div className="mb-3 grid h-12 w-12 place-items-center rounded-lg bg-[#7a0019]">
        <div className="text-white">{icon}</div>
      </div>
      <div className="font-semibold">{title}</div>
      <p className="mt-1 text-sm text-neutral-600">{desc}</p>
      <div className="mt-3 flex items-center gap-1 text-[#7a0019]">
        <span className="text-sm">More</span>
        <ArrowRight className="h-4 w-4 transition-transform duration-200 group-hover:translate-x-1" />
      </div>
    </Link>
  );
}

/* kept for other pages if you reuse it */
function ProfileCard({ profile }: { profile: Profile }) {
  return (
    <section className="rounded-xl bg-[#7a0019] text-white p-4 shadow-sm">
      <div className="flex items-center gap-3">
        {profile.avatar ? (
          <img
            src={profile.avatar}
            alt={profile.name}
            className="h-12 w-12 rounded-full object-cover ring-2 ring-white/60"
          />
        ) : (
          <div className="grid h-12 w-12 place-items-center rounded-full bg-white/10">
            <IdCard className="h-6 w-6" />
          </div>
        )}
        <div>
          <div className="text-sm/none opacity-80">PROFILE • {profile.role.toUpperCase()}</div>
          <div className="font-semibold text-lg">{profile.name}</div>
          <div className="text-xs opacity-90">Code: {profile.code}</div>
        </div>
      </div>
      <div className="mt-3 inline-flex items-center rounded-full bg-white/10 px-2 py-1 text-xs">
        {profile.campus}
      </div>
    </section>
  );
}

/* ---------- Page View (center column only) ---------- */
export default function DashboardView({
  metrics,
  upcoming,
  notifications,
}: {
  metrics: Metrics;
  upcoming: UpcomingItem[];
  notifications: NotificationItem[];
  profile: Profile; // kept in types for convenience; not rendered here
  rightStats: { label: string; value: number }[]; // rendered by ProfileRail on the right
}) {
  return (
    <div className="space-y-6">
      {/* Header row */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-semibold">Faculty Transport Portal</h1>
          <p className="text-sm text-neutral-600">
            See upcoming trips, submit requests, and track approvals.
          </p>
        </div>
        <div className="flex gap-2">
          <Link href="/faculty/request" className="btn btn-primary">New Request</Link>
          <Link href="/faculty/schedule" className="btn btn-outline">View Schedule</Link>
        </div>
      </div>

      {/* Metrics */}
      <div className="grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3">
        <MetricCard icon={<CalendarDays className="h-5 w-5" />} label="Upcoming Trips" value={metrics.upcoming} />
        <MetricCard icon={<Timer className="h-5 w-5" />}         label="Pending Requests" value={metrics.pending} />
        <MetricCard icon={<CheckCircle2 className="h-5 w-5" />}  label="Approved"         value={metrics.approved} />
      </div>

      {/* Primary actions (equal height) */}
      <div className="grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3 items-stretch">
        <ActionCard
          icon={<CalendarDays className="h-5 w-5" />}
          title="Upcoming Schedules"
          desc="Preview your next trips with dates, time, and locations."
          href="/faculty/schedule"
        />
        <ActionCard
          icon={<BusFront className="h-5 w-5" />}
          title="Request a Trip"
          desc="Create a request with pickup, destination and passenger count."
          href="/faculty/request"
        />
        <ActionCard
          icon={<Megaphone className="h-5 w-5" />}
          title="Announcements"
          desc="See approvals and schedule changes as they happen."
          href="/faculty/notifications"
        />
      </div>

      {/* Upcoming & Notifications */}
      <div className="grid grid-cols-1 gap-6 xl:grid-cols-2">
        <section className="rounded-xl bg-white shadow-sm ring-1 ring-neutral-200/70">
          <div className="flex items-center justify-between border-b border-neutral-200/80 px-4 py-3">
            <h2 className="font-medium">Upcoming</h2>
            <Link href="/faculty/schedule" className="text-sm text-[#7a0019]">See all</Link>
          </div>
          <div className="divide-y divide-neutral-200/70">
            {upcoming.map((s) => (
              <div
                key={s.id}
                className="flex items-center justify-between px-4 py-3 hover:bg-neutral-50/70 transition-colors"
              >
                <div className="flex items-center gap-3">
                  <div className="grid h-10 w-10 place-items-center rounded-lg bg-neutral-100">
                    <MapPin className="h-5 w-5 text-neutral-700" />
                  </div>
                  <div>
                    <div className="text-sm text-neutral-500">{s.vehicle}</div>
                    <div className="font-medium">{s.location}</div>
                    <div className="text-sm text-neutral-600">{s.date}</div>
                  </div>
                </div>
                <span className={`rounded px-2 py-1 text-xs ${badgeTone(s.status)}`}>{s.status}</span>
              </div>
            ))}
          </div>
        </section>

        <section className="rounded-xl bg-white shadow-sm ring-1 ring-neutral-200/70">
          <div className="flex items-center justify-between border-b border-neutral-200/80 px-4 py-3">
            <h2 className="font-medium">Notifications</h2>
            <Link href="/faculty/notifications" className="text-sm text-[#7a0019]">View all</Link>
          </div>
          <div className="divide-y divide-neutral-200/70">
            {notifications.map((n) => (
              <div key={n.id} className="px-4 py-3">
                <div className="text-sm">{n.text}</div>
                <div className="text-xs text-neutral-500">{n.time}</div>
              </div>
            ))}
          </div>
        </section>
      </div>
    </div>
  );
}


===== components\faculty\Nav.tsx =====
// src/components/faculty/Nav.tsx
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import {
  LayoutGrid,
  CalendarDays,
  PlusSquare,
  UserRound,
  MessageSquareText,
} from "lucide-react";

const items = [
  { href: "/faculty",          label: "Dashboard", Icon: LayoutGrid, exact: true },
  { href: "/faculty/schedule", label: "Schedule",  Icon: CalendarDays },
  { href: "/faculty/request",  label: "Request",   Icon: PlusSquare },
  { href: "/faculty/profile",  label: "Profile",   Icon: UserRound },
  { href: "/faculty/feedback", label: "Feedback",  Icon: MessageSquareText },
];

export default function FacultyNav() {
  const pathname = usePathname();
  const isActive = (href: string, exact?: boolean) =>
    exact ? pathname === href : (pathname === href || pathname.startsWith(href + "/"));

  return (
    <nav aria-label="Faculty menu" className="space-y-3">
      {items.map(({ href, label, Icon, exact }) => {
        const active = isActive(href, exact);
        return (
          <Link
            key={href}
            href={href}
            className={[
              "relative flex items-center gap-3 rounded-lg px-3 py-2 text-sm transition-colors",
              active
                ? "bg-neutral-100 text-[#7a0019]"
                : "bg-white text-neutral-700 hover:bg-neutral-50",
            ].join(" ")}
          >
            {/* left accent line */}
            <span
              aria-hidden="true"
              className={[
                "absolute left-1 top-1/2 -translate-y-1/2 h-6 w-[3px] rounded-full bg-[#7a0019]",
                active ? "opacity-100" : "opacity-0",
              ].join(" ")}
            />
            <Icon className={`h-4 w-4 ${active ? "text-[#7a0019]" : "text-neutral-500"}`} />
            <span className="font-medium">{label}</span>
          </Link>
        );
      })}
    </nav>
  );
}


===== components\faculty\ProfileRail.tsx =====
"use client";

type StatProps = { value: number | string; label: string };

function Stat({ value, label }: StatProps) {
  return (
    <div className="rounded-xl border bg-white px-4 py-3 text-center">
      <div className="text-2xl font-semibold">{value}</div>
      <div className="text-xs text-neutral-500">{label}</div>
    </div>
  );
}

export default function ProfileRail() {
  // static demo values — palitan mo kung may real data na
  const name = "Jolo Rosales";
  const code = "FAC-11234";
  const campus = "Lucena Campus";

  return (
    <div className="space-y-4">
      {/* maroon profile header */}
      <section className="rounded-2xl bg-[#7a0019] text-white p-4 shadow">
        <div className="text-xs opacity-90">PROFILE • FACULTY</div>
        <div className="mt-1 text-xl font-bold leading-tight">{name}</div>
        <div className="text-sm opacity-90">Code: {code}</div>
        <div className="mt-2 inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-sm">
          {campus}
        </div>
      </section>

      {/* quick stats */}
      <div className="grid grid-cols-3 gap-3">
        <Stat value={5} label="Active Requests" />
        <Stat value={3} label="Vehicles Online" />
        <Stat value={4} label="Pending" />
      </div>
    </div>
  );
}


===== components\faculty\feedback\FeedbackView.tsx =====
"use client";

import Stars from "./Stars";

const sectionCls = "rounded-lg border bg-white p-4";
const inputCls =
  "w-full rounded-md border border-neutral-300 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-neutral-300";
const labelCls = "text-sm font-medium text-neutral-700";
const hintCls = "text-xs text-neutral-500";

type Props = {
  /* values */
  category: string;
  rating: number;
  subject: string;
  message: string;
  anonymous: boolean;
  contact: string;
  attachmentName?: string;
  /* errors */
  errors?: Partial<Record<
    "category" | "rating" | "subject" | "message" | "anonymous" | "contact" | "attachment",
    string
  >>;
  /* flags */
  submitting?: boolean;
  successId?: string | null;
  /* handlers */
  onChangeCategory: (v: string) => void;
  onChangeRating: (v: number) => void;
  onChangeSubject: (v: string) => void;
  onChangeMessage: (v: string) => void;
  onToggleAnonymous: (v: boolean) => void;
  onChangeContact: (v: string) => void;
  onFile: (file?: File) => void;
  onSubmit: (e: React.FormEvent) => void;
  onReset: () => void;
};

export default function FeedbackView({
  /* values */
  category,
  rating,
  subject,
  message,
  anonymous,
  contact,
  attachmentName,
  /* errors */
  errors = {},
  /* flags */
  submitting = false,
  successId,
  /* handlers */
  onChangeCategory,
  onChangeRating,
  onChangeSubject,
  onChangeMessage,
  onToggleAnonymous,
  onChangeContact,
  onFile,
  onSubmit,
  onReset,
}: Props) {
  return (
    <div className="grid grid-cols-1 lg:grid-cols-[1fr_360px] gap-4">
      {/* LEFT: FORM */}
      <form onSubmit={onSubmit} className="space-y-4 min-w-0">
        <section className={sectionCls}>
          <h2 className="mb-3 font-medium">Tell us more</h2>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
            {/* Category */}
            <div>
              <label className={labelCls}>Category *</label>
              <select
                className={inputCls}
                value={category}
                onChange={(e) => onChangeCategory(e.target.value)}
              >
                <option value="">Select…</option>
                <option>Bug</option>
                <option>Feature Request</option>
                <option>Driver Experience</option>
                <option>Schedule / Booking</option>
                <option>App UI/UX</option>
                <option>Other</option>
              </select>
              {errors.category && <p className="mt-1 text-xs text-red-600">{errors.category}</p>}
            </div>

            {/* Rating */}
            <div>
              <label className={labelCls}>Rating (optional)</label>
              <Stars value={rating} onChange={onChangeRating} />
              <p className={hintCls}>How was your overall experience? 1–5 stars.</p>
            </div>

            {/* Subject */}
            <div className="md:col-span-2">
              <label className={labelCls}>Subject (optional)</label>
              <input
                className={inputCls}
                placeholder="e.g., Request form is confusing"
                value={subject}
                onChange={(e) => onChangeSubject(e.target.value)}
              />
            </div>

            {/* Message */}
            <div className="md:col-span-2">
              <label className={labelCls}>Message *</label>
              <textarea
                rows={6}
                className={inputCls}
                placeholder="Describe the issue or suggestion in detail…"
                value={message}
                onChange={(e) => onChangeMessage(e.target.value)}
              />
              {errors.message && <p className="mt-1 text-xs text-red-600">{errors.message}</p>}
            </div>

            {/* Attachment */}
            <div>
              <label className={labelCls}>Attachment (optional)</label>
              <input
                type="file"
                accept="image/*"
                className="block w-full text-sm"
                onChange={(e) => onFile(e.target.files?.[0])}
              />
              <p className={hintCls}>Add a screenshot/photo (PNG/JPG), max ~2MB.</p>
              {attachmentName ? (
                <p className="mt-1 text-xs text-neutral-600">Selected: {attachmentName}</p>
              ) : null}
            </div>

            {/* Identity */}
            <div className="space-y-1">
              <label className={labelCls}>Identity & contact</label>
              <label className="flex items-center gap-2 text-sm">
                <input
                  type="checkbox"
                  checked={anonymous}
                  onChange={(e) => onToggleAnonymous(e.target.checked)}
                />
                Submit anonymously
              </label>
              {!anonymous && (
                <>
                  <input
                    className={`${inputCls} mt-2`}
                    placeholder="Your email or phone (optional)"
                    value={contact}
                    onChange={(e) => onChangeContact(e.target.value)}
                  />
                  {errors.contact && <p className="mt-1 text-xs text-red-600">{errors.contact}</p>}
                  <p className={hintCls}>We’ll contact you if we need more details.</p>
                </>
              )}
            </div>
          </div>
        </section>

        <section className={sectionCls}>
          <div className="flex flex-wrap items-center gap-2">
            <button
              type="submit"
              disabled={submitting}
              className="rounded-md bg-[#7a0019] px-4 py-2 text-sm text-white hover:opacity-95 disabled:opacity-60"
            >
              {submitting ? "Sending…" : "Send Feedback"}
            </button>
            <button
              type="button"
              className="rounded-md border px-4 py-2 text-sm hover:bg-neutral-50"
              onClick={onReset}
            >
              Reset
            </button>

            {successId && (
              <span className="ml-auto text-sm text-green-700">
                Thanks! Feedback <span className="font-semibold">{successId}</span> submitted.
              </span>
            )}
          </div>
        </section>
      </form>

      {/* RIGHT: Tips */}
      <aside className="space-y-4">
        <section className="rounded-lg bg-[#5c0013] text-white p-4">
          <div className="text-lg font-semibold">We’re listening</div>
          <p className="mt-1 text-sm opacity-90">
            Your feedback helps improve scheduling, notifications, and trip coordination.
          </p>
          <ul className="mt-3 text-sm space-y-1 opacity-90 list-disc pl-5">
            <li>Include dates and request IDs when relevant.</li>
            <li>Attach screenshots for UI problems.</li>
            <li>Suggest how we can make it better.</li>
          </ul>
        </section>

        <section className={sectionCls}>
          <h3 className="font-medium mb-2">What happens next?</h3>
          <ol className="list-decimal pl-5 text-sm text-neutral-700 space-y-1">
            <li>We log your feedback for review.</li>
            <li>Admins may reach out if more info is needed.</li>
            <li>Fixes and improvements appear in release notes.</li>
          </ol>
        </section>
      </aside>
    </div>
  );
}


===== components\faculty\feedback\Stars.tsx =====
"use client";

export default function Stars({
  value,
  onChange,
}: {
  value: number;
  onChange: (v: number) => void;
}) {
  return (
    <div className="flex items-center gap-1">
      {[1, 2, 3, 4, 5].map((i) => (
        <button
          key={i}
          type="button"
          aria-label={`${i} star${i > 1 ? "s" : ""}`}
          onClick={() => onChange(i === value ? 0 : i)}
          className={`h-8 w-8 grid place-items-center rounded hover:bg-neutral-100 ${
            i <= value ? "text-amber-500" : "text-neutral-300"
          }`}
        >
          <svg viewBox="0 0 24 24" fill="currentColor" className="h-5 w-5">
            <path d="M12 .587l3.668 7.431 8.2 1.193-5.934 5.786 1.401 8.163L12 18.897l-7.335 3.863 1.401-8.163L.132 9.211l8.2-1.193z" />
          </svg>
        </button>
      ))}
    </div>
  );
}


===== components\faculty\notification\NotificationsView.tsx =====
"use client";

import Link from "next/link";
import { PageHeader, PageBody } from "@/components/common/Page";

/* ---------- types ---------- */
export type NotificationsTab = "unread" | "all";

export type NotificationItem = {
  id: string;
  text: string;
  time: string;   // e.g. "2h ago"
  read?: boolean; // false = unread
};

type Props = {
  tab: NotificationsTab;
  unreadCount: number;
  allCount: number;
  items?: NotificationItem[]; // combined list; we'll filter by tab in the UI
  onTabChange: (t: NotificationsTab) => void;
  onMarkAllRead: () => void;
  onRefresh: () => void;
};

export default function NotificationsView({
  tab,
  unreadCount,
  allCount,
  items = [],
  onTabChange,
  onMarkAllRead,
  onRefresh,
}: Props) {
  const visible =
    tab === "unread" ? items.filter((n) => !n.read) : items;

  const hasAny = visible.length > 0;

  return (
    <>
      <PageHeader
        title="Notifications"
        description="Your recent updates and alerts."
        actions={
          <div className="flex flex-wrap gap-2">
            <button
              onClick={onMarkAllRead}
              disabled={unreadCount === 0}
              className={`rounded-md border px-3 py-2 text-sm ${
                unreadCount === 0
                  ? "text-neutral-400 cursor-not-allowed"
                  : "hover:bg-neutral-50"
              }`}
              title={
                unreadCount === 0
                  ? "No notifications to mark as read"
                  : "Mark all as read"
              }
            >
              Mark all read
            </button>
            <button
              onClick={onRefresh}
              className="rounded-md border px-3 py-2 text-sm hover:bg-neutral-50"
            >
              Refresh
            </button>
          </div>
        }
      />

      <PageBody>
        {/* Tabs */}
        <div className="rounded-lg border bg-white p-2">
          <div className="flex items-center gap-2">
            <TabButton
              active={tab === "unread"}
              onClick={() => onTabChange("unread")}
              label={`Unread (${unreadCount})`}
            />
            <TabButton
              active={tab === "all"}
              onClick={() => onTabChange("all")}
              label={`All (${allCount})`}
            />
          </div>
        </div>

        {/* Content */}
        {hasAny ? (
          <div className="mt-4 divide-y rounded-lg border bg-white">
            {visible.map((n) => (
              <div
                key={n.id}
                className="flex items-start justify-between gap-4 px-4 py-3"
              >
                <div className="flex items-start gap-3">
                  {!n.read && <UnreadDot />}
                  <div>
                    <div className="text-sm">{n.text}</div>
                    <div className="text-xs text-neutral-500">{n.time}</div>
                  </div>
                </div>
                {/* space for future actions per item */}
              </div>
            ))}
          </div>
        ) : (
          <EmptyState tab={tab} />
        )}

        {/* Tips */}
        <div className="mt-4 grid grid-cols-1 gap-4 lg:grid-cols-2">
          <div className="rounded-lg border bg-white p-4">
            <h3 className="font-medium">What you’ll see here</h3>
            <ul className="mt-2 list-disc space-y-1 pl-5 text-sm text-neutral-700">
              <li>Request status changes (Approved / Rejected / Needs info)</li>
              <li>Assigned vehicle and driver for your trips</li>
              <li>Schedule updates and reminders</li>
            </ul>
          </div>
          <div className="rounded-lg border bg-white p-4">
            <h3 className="font-medium">Manage alerts</h3>
            <p className="mt-2 text-sm text-neutral-700">
              Control email/push notifications in{" "}
              <Link href="/faculty/profile" className="text-[#7a0019] underline">
                Profile &gt; Preferences
              </Link>.
            </p>
          </div>
        </div>
      </PageBody>
    </>
  );
}

/* ---------- small UI bits ---------- */
function TabButton({
  active,
  onClick,
  label,
}: {
  active: boolean;
  onClick: () => void;
  label: string;
}) {
  return (
    <button
      onClick={onClick}
      className={`px-3 py-2 text-sm rounded-md border ${
        active
          ? "bg-[#7a0019] text-white border-[#7a0019]"
          : "hover:bg-neutral-50"
      }`}
    >
      {label}
    </button>
  );
}

function EmptyState({ tab }: { tab: "unread" | "all" }) {
  return (
    <div className="mt-4 rounded-lg border bg-white p-8 text-center">
      <div className="mx-auto mb-3 grid h-12 w-12 place-items-center rounded-full bg-neutral-100">
        <BellEmpty />
      </div>
      <h2 className="text-base font-semibold">You’re all caught up</h2>
      <p className="mt-1 text-sm text-neutral-600">
        No {tab === "unread" ? "unread " : ""}notifications yet. New updates
        about requests, schedules, and approvals will appear here.
      </p>

      <div className="mt-4 flex flex-wrap justify-center gap-2">
        <Link
          href="/faculty/request"
          className="rounded-md border px-3 py-2 text-sm hover:bg-neutral-50"
        >
          Submit a Request
        </Link>
        <Link
          href="/faculty/schedule"
          className="rounded-md bg-[#7a0019] px-3 py-2 text-sm text-white"
        >
          View Schedule
        </Link>
      </div>
    </div>
  );
}

function UnreadDot() {
  return (
    <span
      className="mt-1 inline-block h-2.5 w-2.5 rounded-full bg-[#7a0019]"
      aria-hidden
    />
  );
}

function BellEmpty(props: React.SVGProps<SVGSVGElement>) {
  return (
    <svg viewBox="0 0 24 24" width="22" height="22" stroke="currentColor" fill="none" {...props}>
      <path strokeWidth="2" d="M15 17h5l-1.4-1.4A2 2 0 0 1 18 14.2V11a6 6 0 1 0-12 0v3.2c0 .5-.2 1-.6 1.4L4 17h5" />
      <path strokeWidth="2" d="M9 17a3 3 0 0 0 6 0" />
    </svg>
  );
}


===== components\faculty\profile\ProfileView.tsx =====
"use client";

import { useMemo, useRef } from "react";
import { PageHeader, PageBody } from "@/components/common/Page";

/* ---------- types you can reuse ---------- */
export type ProfileData = {
  firstName: string;
  lastName: string;
  email: string;
  department: string;
  campus: string;
  phone?: string;
  avatar?: string; // data URL (preview) or CDN URL
  notifyEmail: boolean;
  notifyPush: boolean;
};

export type PasswordState = { new: string; confirm: string };

export type ProfileErrors = Partial<{
  firstName: string;
  lastName: string;
  email: string;
  department: string;
  campus: string;
  passwordNew: string;
  passwordConfirm: string;
}>;

type Props = {
  profile: ProfileData;
  password: PasswordState;
  saving: boolean;
  savedAt: string | null;
  errors: ProfileErrors;

  onChangeProfile: <K extends keyof ProfileData>(key: K, value: ProfileData[K]) => void;
  onChangePassword: (patch: Partial<PasswordState>) => void;
  onAvatarChange: (file?: File) => void;
  onSubmit: () => void;
  onReset?: () => void;
};

/* ---------- styles ---------- */
const input =
  "w-full rounded-md border border-neutral-300 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-neutral-300";
const label = "text-sm font-medium text-neutral-700";
const section = "rounded-lg border bg-white p-4";
const help = "text-xs text-neutral-500";

export default function ProfileView({
  profile,
  password,
  saving,
  savedAt,
  errors,
  onChangeProfile,
  onChangePassword,
  onAvatarChange,
  onSubmit,
  onReset,
}: Props) {
  const formId = "facultyProfileForm";
  const fileRef = useRef<HTMLInputElement | null>(null);

  const initials = useMemo(() => {
    const f = profile.firstName?.[0] ?? "";
    const l = profile.lastName?.[0] ?? "";
    return (f + l).toUpperCase() || "F";
  }, [profile.firstName, profile.lastName]);

  const pickAvatar = () => fileRef.current?.click();

  return (
    <>
      <PageHeader
        title="Profile"
        description="Manage your faculty account details and preferences."
        actions={
          <button
            type="submit"
            form={formId}
            disabled={saving}
            className="rounded-md bg-[#7a0019] px-3 py-2 text-sm text-white hover:opacity-95 disabled:opacity-60"
          >
            {saving ? "Saving…" : "Save Changes"}
          </button>
        }
      />

      <PageBody>
        <div className="grid grid-cols-1 gap-4 lg:grid-cols-[1fr_360px]">
          {/* LEFT: FORM */}
          <form
            id={formId}
            className="min-w-0 space-y-4"
            onSubmit={(e) => {
              e.preventDefault();
              onSubmit();
            }}
          >
            {/* Personal */}
            <section className={section}>
              <h2 className="mb-3 font-medium">Personal Information</h2>

              <div className="mb-4 flex items-center gap-4">
                <div>
                  {profile.avatar ? (
                    <img
                      src={profile.avatar}
                      alt="Avatar"
                      className="h-16 w-16 rounded-full border object-cover"
                    />
                  ) : (
                    <div className="grid h-16 w-16 place-items-center rounded-full border bg-neutral-200 text-lg font-semibold text-neutral-700">
                      {initials}
                    </div>
                  )}
                </div>
                <div>
                  <button
                    type="button"
                    onClick={pickAvatar}
                    className="rounded-md border px-3 py-1.5 text-sm hover:bg-neutral-50"
                  >
                    Change photo
                  </button>
                  <input
                    ref={fileRef}
                    type="file"
                    accept="image/*"
                    className="hidden"
                    onChange={(e) => onAvatarChange(e.target.files?.[0])}
                  />
                  <div className={help}>JPG/PNG, up to ~2MB.</div>
                </div>
              </div>

              <div className="grid grid-cols-1 gap-3 md:grid-cols-2">
                <div>
                  <label className={label}>First name *</label>
                  <input
                    className={input}
                    value={profile.firstName}
                    onChange={(e) => onChangeProfile("firstName", e.target.value)}
                  />
                  {errors.firstName && (
                    <p className="mt-1 text-xs text-red-600">{errors.firstName}</p>
                  )}
                </div>
                <div>
                  <label className={label}>Last name *</label>
                  <input
                    className={input}
                    value={profile.lastName}
                    onChange={(e) => onChangeProfile("lastName", e.target.value)}
                  />
                  {errors.lastName && (
                    <p className="mt-1 text-xs text-red-600">{errors.lastName}</p>
                  )}
                </div>
                <div className="md:col-span-2">
                  <label className={label}>Email *</label>
                  <input
                    className={input}
                    value={profile.email}
                    onChange={(e) => onChangeProfile("email", e.target.value)}
                  />
                  {errors.email && (
                    <p className="mt-1 text-xs text-red-600">{errors.email}</p>
                  )}
                </div>
              </div>
            </section>

            {/* Organization */}
            <section className={section}>
              <h2 className="mb-3 font-medium">Organization</h2>
              <div className="grid grid-cols-1 gap-3 md:grid-cols-2">
                <div>
                  <label className={label}>Department *</label>
                  <input
                    className={input}
                    value={profile.department}
                    onChange={(e) => onChangeProfile("department", e.target.value)}
                    placeholder="e.g., CCMS"
                  />
                  {errors.department && (
                    <p className="mt-1 text-xs text-red-600">{errors.department}</p>
                  )}
                </div>
                <div>
                  <label className={label}>Campus *</label>
                  <input
                    className={input}
                    value={profile.campus}
                    onChange={(e) => onChangeProfile("campus", e.target.value)}
                    placeholder="e.g., Lucena"
                  />
                  {errors.campus && (
                    <p className="mt-1 text-xs text-red-600">{errors.campus}</p>
                  )}
                </div>
                <div className="md:col-span-2">
                  <label className={label}>Phone (optional)</label>
                  <input
                    className={input}
                    value={profile.phone ?? ""}
                    onChange={(e) => onChangeProfile("phone", e.target.value)}
                    placeholder="09XX XXX XXXX"
                  />
                </div>
              </div>
            </section>

            {/* Preferences */}
            <section className={section}>
              <h2 className="mb-3 font-medium">Preferences</h2>
              <div className="grid grid-cols-1 gap-3 md:grid-cols-2">
                <label className="flex items-center gap-2 text-sm">
                  <input
                    type="checkbox"
                    checked={profile.notifyEmail}
                    onChange={(e) => onChangeProfile("notifyEmail", e.target.checked)}
                  />
                  Email notifications
                </label>
                <label className="flex items-center gap-2 text-sm">
                  <input
                    type="checkbox"
                    checked={profile.notifyPush}
                    onChange={(e) => onChangeProfile("notifyPush", e.target.checked)}
                  />
                  Push notifications
                </label>
              </div>
              <p className={`${help} mt-2`}>
                You’ll receive updates about request approvals, schedule changes, and reminders.
              </p>
            </section>

            {/* Security */}
            <section className={section}>
              <h2 className="mb-3 font-medium">Security</h2>
              <div className="grid grid-cols-1 gap-3 md:grid-cols-2">
                <div>
                  <label className={label}>New password</label>
                  <input
                    type="password"
                    className={input}
                    value={password.new}
                    onChange={(e) => onChangePassword({ new: e.target.value })}
                    placeholder="Min 8 characters"
                  />
                  {errors.passwordNew && (
                    <p className="mt-1 text-xs text-red-600">{errors.passwordNew}</p>
                  )}
                </div>
                <div>
                  <label className={label}>Confirm new password</label>
                  <input
                    type="password"
                    className={input}
                    value={password.confirm}
                    onChange={(e) => onChangePassword({ confirm: e.target.value })}
                  />
                  {errors.passwordConfirm && (
                    <p className="mt-1 text-xs text-red-600">{errors.passwordConfirm}</p>
                  )}
                </div>
              </div>
              <p className={`${help} mt-2`}>Leave blank to keep your current password.</p>
            </section>

            {onReset && (
              <div className="flex gap-2">
                <button
                  type="button"
                  className="rounded-md border px-3 py-2 text-sm hover:bg-neutral-50"
                  onClick={onReset}
                >
                  Reset
                </button>
              </div>
            )}
          </form>

          {/* RIGHT: SUMMARY / HELP */}
          <aside className="space-y-4">
            <section className="rounded-lg bg-[#5c0013] p-4 text-white">
              <div className="flex items-center gap-3">
                {profile.avatar ? (
                  <img
                    src={profile.avatar}
                    alt="Avatar"
                    className="h-10 w-10 rounded-full border border-white/20 object-cover"
                  />
                ) : (
                  <div className="grid h-10 w-10 place-items-center rounded-full bg-white/10 font-semibold">
                    {initials}
                  </div>
                )}
                <div>
                  <div className="text-lg font-semibold">
                    {profile.firstName} {profile.lastName}
                  </div>
                  <div className="text-xs opacity-80">Faculty • {profile.campus}</div>
                </div>
              </div>
              {savedAt && <div className="mt-3 text-xs opacity-90">Last saved: {savedAt}</div>}
            </section>

            <section className={section}>
              <h3 className="mb-2 font-medium">Account tips</h3>
              <ul className="list-disc space-y-1 pl-5 text-sm text-neutral-700">
                <li>Use a school email for faster approval.</li>
                <li>Keep your contact number updated for urgent notices.</li>
                <li>Enable notifications so you don’t miss schedule changes.</li>
              </ul>
            </section>
          </aside>
        </div>
      </PageBody>
    </>
  );
}


===== components\faculty\request\Form.tsx =====
// src/components/faculty/request/Form.tsx
"use client";

export type RequestForm = {
  purpose: string;
  origin: string;
  destination: string;
  schedule: string;                 // datetime-local
  passengers: string | number;
  notes: string;
};

type Props = {
  form: RequestForm;
  errors: Partial<Record<keyof RequestForm, string>>;
  submitting?: boolean;
  onChange: <K extends keyof RequestForm>(key: K, value: RequestForm[K]) => void;
  onSubmit: (e: React.FormEvent) => void;
  onReset: () => void;
};

const inputCls =
  "w-full rounded-md border border-neutral-300 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-neutral-300";
const labelCls = "text-sm font-medium text-neutral-700";
const sectionCls = "rounded-lg border bg-white p-4";

export default function FacultyRequestForm({
  form,
  errors,
  submitting,
  onChange,
  onSubmit,
  onReset,
}: Props) {
  return (
    <form onSubmit={onSubmit} className="space-y-4 min-w-0">
      <section className={sectionCls}>
        <h2 className="mb-3 font-medium">Trip Information</h2>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <label className={labelCls}>Purpose *</label>
            <input
              className={inputCls}
              placeholder="e.g., Faculty meeting"
              value={form.purpose}
              onChange={(e) => onChange("purpose", e.target.value)}
            />
            {errors.purpose && <p className="mt-1 text-xs text-red-600">{errors.purpose}</p>}
          </div>

          <div>
            <label className={labelCls}>Passengers</label>
            <input
              type="number"
              min={1}
              className={inputCls}
              placeholder="e.g., 12"
              value={form.passengers}
              onChange={(e) =>
                onChange("passengers", e.target.value === "" ? "" : Number(e.target.value))
              }
            />
            {errors.passengers && <p className="mt-1 text-xs text-red-600">{errors.passengers}</p>}
          </div>

          <div>
            <label className={labelCls}>Schedule *</label>
            <input
              type="datetime-local"
              className={inputCls}
              value={form.schedule}
              onChange={(e) => onChange("schedule", e.target.value)}
            />
            {errors.schedule && <p className="mt-1 text-xs text-red-600">{errors.schedule}</p>}
          </div>

          <div>
            <label className={labelCls}>Origin *</label>
            <input
              className={inputCls}
              placeholder="e.g., CCMS Building"
              value={form.origin}
              onChange={(e) => onChange("origin", e.target.value)}
            />
            {errors.origin && <p className="mt-1 text-xs text-red-600">{errors.origin}</p>}
          </div>

          <div className="md:col-span-2">
            <label className={labelCls}>Destination *</label>
            <input
              className={inputCls}
              placeholder="e.g., City Hall"
              value={form.destination}
              onChange={(e) => onChange("destination", e.target.value)}
            />
            {errors.destination && <p className="mt-1 text-xs text-red-600">{errors.destination}</p>}
          </div>

          <div className="md:col-span-2">
            <label className={labelCls}>Notes (optional)</label>
            <textarea
              rows={4}
              className={inputCls}
              placeholder="Anything the dispatcher should know?"
              value={form.notes}
              onChange={(e) => onChange("notes", e.target.value)}
            />
          </div>
        </div>
      </section>

      <section className={sectionCls}>
        <div className="flex flex-wrap items-center gap-2">
          <button
            type="submit"
            disabled={submitting}
            className="rounded-md bg-[#7a0019] px-4 py-2 text-sm text-white hover:opacity-95 disabled:opacity-60"
          >
            {submitting ? "Submitting…" : "Submit Request"}
          </button>
          <button
            type="button"
            className="rounded-md border px-4 py-2 text-sm hover:bg-neutral-50"
            onClick={onReset}
          >
            Reset
          </button>
        </div>
      </section>
    </form>
  );
}


===== components\faculty\request\Summary.tsx =====
// src/components/faculty/request/Summary.tsx
"use client";
import type { RequestForm } from "./Form";

function Row({ label, value }: { label: string; value: string }) {
  return (
    <div className="flex justify-between gap-3">
      <dt className="text-neutral-600">{label}</dt>
      <dd className="text-right">{value || "—"}</dd>
    </div>
  );
}

export default function RequestSummary({ form }: { form: RequestForm }) {
  return (
    <section className="rounded-lg border bg-white p-4">
      <h3 className="font-medium mb-3">Summary</h3>
      <dl className="text-sm space-y-2">
        <Row label="Purpose" value={form.purpose} />
        <Row label="Schedule" value={form.schedule} />
        <Row label="Origin" value={form.origin} />
        <Row label="Destination" value={form.destination} />
        <Row
          label="Passengers"
          value={form.passengers === "" ? "" : String(form.passengers)}
        />
      </dl>
    </section>
  );
}


===== components\faculty\schedule\ScheduleView.tsx =====
"use client";

import Link from "next/link";
import { PageHeader, PageBody } from "@/components/common/Page";
import type { Trip, Vehicle, Status } from "@/components/faculty/schedule/types";

export type Filters = {
  q: string;
  veh: "" | Vehicle;
  stat: "" | Status;
  from: string; // yyyy-mm-dd
  to: string;   // yyyy-mm-dd
};

type Props = {
  tab: "upcoming" | "history";
  onTabChange: (t: "upcoming" | "history") => void;

  filters: Filters;
  onFiltersChange: (patch: Partial<Filters>) => void;
  onResetFilters: () => void;
  onExportCsv: () => void;

  trips: Trip[]; // already filtered & sorted from container
};

const badge = (s: Status) =>
  s === "Approved" || s === "Assigned"
    ? "bg-green-100 text-green-700"
    : s === "Pending"
    ? "bg-amber-100 text-amber-700"
    : s === "Completed"
    ? "bg-neutral-200 text-neutral-700"
    : "bg-rose-100 text-rose-700";

const fmtDate = (iso: string) =>
  new Date(iso).toLocaleString([], {
    year: "numeric",
    month: "short",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
  });

export default function ScheduleView({
  tab,
  onTabChange,
  filters,
  onFiltersChange,
  onResetFilters,
  onExportCsv,
  trips,
}: Props) {
  return (
    <>
      <PageHeader
        title="Schedule"
        description="Your upcoming and past trips."
        actions={
          <div className="flex flex-wrap gap-2">
            <button
              onClick={() => onTabChange("upcoming")}
              className={`px-3 py-2 text-sm rounded-md border ${
                tab === "upcoming" ? "bg-[#7a0019] text-white border-[#7a0019]" : "hover:bg-neutral-50"
              }`}
            >
              Upcoming
            </button>
            <button
              onClick={() => onTabChange("history")}
              className={`px-3 py-2 text-sm rounded-md border ${
                tab === "history" ? "bg-[#7a0019] text-white border-[#7a0019]" : "hover:bg-neutral-50"
              }`}
            >
              History
            </button>
            <Link href="/faculty/request" className="rounded-md bg-[#7a0019] text-white px-3 py-2 text-sm">
              New Request
            </Link>
          </div>
        }
      />

      <PageBody>
        {/* Filters */}
        <div className="rounded-lg border bg-white p-3">
          <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-6 gap-3">
            <div className="xl:col-span-2">
              <input
                value={filters.q}
                onChange={(e) => onFiltersChange({ q: e.target.value })}
                className="w-full rounded-md border px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-neutral-300"
                placeholder="Search destination, ID, vehicle…"
              />
            </div>
            <div>
              <select
                value={filters.veh}
                onChange={(e) => onFiltersChange({ veh: e.target.value as Filters["veh"] })}
                className="w-full rounded-md border px-3 py-2 text-sm"
              >
                <option value="">All vehicles</option>
                <option value="Car">Car</option>
                <option value="Van">Van</option>
                <option value="Bus">Bus</option>
              </select>
            </div>
            <div>
              <select
                value={filters.stat}
                onChange={(e) => onFiltersChange({ stat: e.target.value as Filters["stat"] })}
                className="w-full rounded-md border px-3 py-2 text-sm"
              >
                <option value="">All statuses</option>
                <option value="Pending">Pending</option>
                <option value="Approved">Approved</option>
                <option value="Assigned">Assigned</option>
                <option value="Completed">Completed</option>
                <option value="Rejected">Rejected</option>
              </select>
            </div>
            <div>
              <input
                type="date"
                value={filters.from}
                onChange={(e) => onFiltersChange({ from: e.target.value })}
                className="w-full rounded-md border px-3 py-2 text-sm"
              />
            </div>
            <div>
              <input
                type="date"
                value={filters.to}
                onChange={(e) => onFiltersChange({ to: e.target.value })}
                className="w-full rounded-md border px-3 py-2 text-sm"
              />
            </div>
          </div>

          <div className="mt-3 flex items-center justify-between text-sm">
            <div className="text-neutral-600">
              Showing <span className="font-medium">{trips.length}</span> result{trips.length !== 1 ? "s" : ""}
            </div>
            <div className="flex gap-2">
              <button onClick={onExportCsv} className="rounded-md border px-3 py-1.5 hover:bg-neutral-50">
                Export CSV
              </button>
              <button onClick={onResetFilters} className="rounded-md border px-3 py-1.5 hover:bg-neutral-50">
                Reset
              </button>
            </div>
          </div>
        </div>

        {/* Results: mobile cards */}
        <div className="md:hidden grid gap-3 mt-4">
          {trips.map((t) => (
            <div key={t.id} className="rounded-lg border bg-white p-3">
              <div className="flex items-center justify-between">
                <div className="font-medium">{t.destination}</div>
                <span className={`text-xs px-2 py-1 rounded ${badge(t.status)}`}>{t.status}</span>
              </div>
              <div className="mt-1 text-sm text-neutral-600">{t.vehicle}</div>
              <div className="mt-1 text-sm text-neutral-600">
                {fmtDate(t.start)} → {fmtDate(t.end)}
              </div>
              <div className="mt-3 flex gap-2">
                <Link href={`/faculty/request`} className="text-xs border rounded px-2 py-1 hover:bg-neutral-50">
                  Details
                </Link>
              </div>
            </div>
          ))}
          {trips.length === 0 && (
            <div className="rounded-lg border bg-white p-4 text-sm text-neutral-600">No results.</div>
          )}
        </div>

        {/* Results: desktop table */}
        <div className="hidden md:block mt-4 overflow-x-auto">
          <table className="min-w-full text-sm bg-white border rounded-lg overflow-hidden">
            <thead className="bg-neutral-50">
              <tr className="text-neutral-700">
                <th className="text-left font-medium px-4 py-2">ID</th>
                <th className="text-left font-medium px-4 py-2">Start</th>
                <th className="text-left font-medium px-4 py-2">End</th>
                <th className="text-left font-medium px-4 py-2">Vehicle</th>
                <th className="text-left font-medium px-4 py-2">Destination</th>
                <th className="text-left font-medium px-4 py-2">Status</th>
                <th className="text-left font-medium px-4 py-2">Action</th>
              </tr>
            </thead>
            <tbody className="divide-y">
              {trips.map((t) => (
                <tr key={t.id} className="bg-white">
                  <td className="px-4 py-2">{t.id}</td>
                  <td className="px-4 py-2">{fmtDate(t.start)}</td>
                  <td className="px-4 py-2">{fmtDate(t.end)}</td>
                  <td className="px-4 py-2">{t.vehicle}</td>
                  <td className="px-4 py-2">{t.destination}</td>
                  <td className="px-4 py-2">
                    <span className={`text-xs px-2 py-1 rounded ${badge(t.status)}`}>{t.status}</span>
                  </td>
                  <td className="px-4 py-2">
                    <Link href={`/faculty/request`} className="text-xs border rounded px-2 py-1 hover:bg-neutral-50">
                      View
                    </Link>
                  </td>
                </tr>
              ))}
              {trips.length === 0 && (
                <tr>
                  <td colSpan={7} className="px-4 py-6 text-center text-neutral-500">
                    No results.
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </PageBody>
    </>
  );
}


===== components\faculty\schedule\types.ts =====
// Shared types for faculty screens

export type Vehicle = "Car" | "Van" | "Bus";
export type Status = "Pending" | "Approved" | "Assigned" | "Completed" | "Rejected";

export type Trip = {
  id: string;
  start: string;     // ISO
  end: string;       // ISO
  vehicle: Vehicle;
  destination: string;
  note?: string;
  status: Status;
};


===== components\ui\Badge.tsx =====
"use client";
import React from "react";

export default function Badge({
  color = "gray",
  children,
}: {
  color?: "green" | "red" | "amber" | "blue" | "gray";
  children: React.ReactNode;
}) {
  const map: Record<string, string> = {
    green: "bg-emerald-100 text-emerald-700 ring-1 ring-emerald-200",
    red: "bg-rose-100 text-rose-700 ring-1 ring-rose-200",
    amber: "bg-amber-100 text-amber-700 ring-1 ring-amber-200",
    blue: "bg-sky-100 text-sky-700 ring-1 ring-sky-200",
    gray: "bg-neutral-100 text-neutral-700 ring-1 ring-neutral-200",
  };
  return (
    <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium transition-colors duration-150 ${map[color]}`}>
      {children}
    </span>
  );
}


===== components\ui\Button.tsx =====
"use client";
import React from "react";

export default function CTA({
  tone = "primary",
  className = "",
  children,
  ...rest
}: React.ButtonHTMLAttributes<HTMLButtonElement> & {
  tone?: "primary" | "ghost" | "success" | "danger";
}) {
  const base =
    "inline-flex items-center justify-center rounded-full px-3 py-[7px] text-[13px] sm:text-sm font-semibold whitespace-nowrap transition-all duration-150 active:translate-y-[1px] focus:outline-none focus:ring-2 focus:ring-offset-2";
  const tones: Record<string, string> = {
    primary:
      "bg-[#7A0010] text-white shadow-sm shadow-[#7A0010]/20 hover:shadow-md hover:shadow-[#7A0010]/25 hover:-translate-y-0.5 hover:bg-[#66000D] focus:ring-[#7A0010]",
    ghost:
      "bg-white/70 text-neutral-800 ring-1 ring-neutral-200 hover:bg-neutral-100/80 hover:-translate-y-0.5 focus:ring-neutral-300",
    success:
      "bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200 hover:bg-emerald-100 hover:-translate-y-0.5 focus:ring-emerald-300",
    danger:
      "bg-rose-50 text-rose-700 ring-1 ring-rose-200 hover:bg-rose-100 hover:-translate-y-0.5 focus:ring-rose-300",
  };
  return (
    <button className={`${base} ${tones[tone]} ${className}`} {...rest}>
      {children}
    </button>
  );
}


===== components\ui\Icons.tsx =====
"use client";

import React from "react";
import type { VehicleType } from "@/lib/travilink";

export const IconBell = () => (
  <svg viewBox="0 0 24 24" className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="1.75">
    <path d="M15 17h5l-1.4-1.4A2 2 0 0 1 18 14.2V11a6 6 0 10-12 0v3.2c0 .5-.2 1-.6 1.4L4 17h5" />
    <path d="M9 18a3 3 0 0 0 6 0" />
  </svg>
);

export const IconSearch = () => (
  <svg viewBox="0 0 24 24" className="w-4 h-4 absolute left-2.5 top-2.5 pointer-events-none" fill="none" stroke="currentColor" strokeWidth="1.75">
    <circle cx="11" cy="11" r="7" />
    <path d="m20 20-3.5-3.5" />
  </svg>
);

const IconBus = () => (
  <svg viewBox="0 0 24 24" className="w-10 h-10" fill="none" stroke="currentColor" strokeWidth="1.75">
    <rect x="3" y="6" width="18" height="9" rx="2" />
    <circle cx="7" cy="17" r="1.5" />
    <circle cx="17" cy="17" r="1.5" />
  </svg>
);

const IconVan = () => (
  <svg viewBox="0 0 24 24" className="w-10 h-10" fill="none" stroke="currentColor" strokeWidth="1.75">
    <path d="M3 14V9a2 2 0 0 1 2-2h7l5 4v3" />
    <circle cx="7" cy="17" r="1.5" />
    <circle cx="17" cy="17" r="1.5" />
  </svg>
);

const IconCar = () => (
  <svg viewBox="0 0 24 24" className="w-10 h-10" fill="none" stroke="currentColor" strokeWidth="1.75">
    <path d="M4 13l2-5h12l2 5v4H4z" />
    <circle cx="7" cy="17" r="1.5" />
    <circle cx="17" cy="17" r="1.5" />
  </svg>
);

export const VehicleIcon = ({ type }: { type: VehicleType }) =>
  type === "Bus" ? <IconBus /> : type === "Van" ? <IconVan /> : <IconCar />;

export const IconFile = () => (
  <svg viewBox="0 0 24 24" className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="1.75">
    <path d="M14 3H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9z" />
    <path d="M14 3v6h6" />
  </svg>
);

export const IconWrench = () => (
  <svg viewBox="0 0 24 24" className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="1.75">
    <path d="M14.7 6.3a4 4 0 1 0-5.66 5.66l9.9 9.9 2.83-2.83-9.9-9.9z" />
    <circle cx="5" cy="5" r="2" />
  </svg>
);

export const IconUser = () => (
  <svg viewBox="0 0 24 24" className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="1.75">
    <circle cx="12" cy="7" r="4" />
    <path d="M5.5 21a8.38 8.38 0 0 1 13 0" />
  </svg>
);

export const IconInfo = () => (
  <svg viewBox="0 0 24 24" className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="1.75">
    <circle cx="12" cy="12" r="10" />
    <path d="M12 8h.01M11 12h2v5h-2z" />
  </svg>
);

export const IconTrash = () => (
  <svg viewBox="0 0 24 24" className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2">
    <path d="M3 6h18" />
    <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
    <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
    <path d="M10 11v6M14 11v6" />
  </svg>
);


===== components\ui\Page.tsx =====
"use client";
import React from "react";

export function Page({ children }: { children: React.ReactNode }) {
  return <div className="min-h-screen bg-neutral-50">{children}</div>;
}

export function PageHeader({
  title,
  description,
  actions,
}: { title: string; description?: string; actions?: React.ReactNode }) {
  return (
    <div className="sticky top-0 z-20 bg-white border-b px-4 md:px-6 py-4 flex items-center justify-between">
      <div>
        <h1 className="text-xl md:text-2xl font-semibold">{title}</h1>
        {description && <p className="text-sm text-neutral-500">{description}</p>}
      </div>
      {actions}
    </div>
  );
}

export function PageBody({ children }: { children: React.ReactNode }) {
  return <div className="p-4 md:p-6">{children}</div>;
}


===== lib\api.ts =====
// src/lib/api.ts
type TripRequestCreate = {
  purpose: string;
  origin: string;
  destination: string;
  schedule: string | null;
  start_time?: string | null;    // optional mirror
  end_time?: string | null;      // keep null if not used
  passengers?: number | null;
  notes?: string | null;
  status?: "pending" | "approved" | "rejected" | "cancelled";
};

export async function createTripRequest(input: TripRequestCreate) {
  const r = await fetch("/api/faculty/requests", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(input),
  });
  const j = await r.json().catch(() => ({}));
  if (!r.ok || j?.ok === false) {
    // If backend accidentally returns HTML (Unexpected token '<'), throw generic error
    const msg = typeof j?.error === "string" ? j.error : `Request failed (HTTP ${r.status})`;
    throw new Error(msg);
  }
  return { id: j?.id ?? j?.data?.id };
}


===== lib\auth.ts =====
export const INSTITUTION_DOMAIN = "mseuf.edu.ph";

export function isInstitutionEmail(email: string) {
  const at = email.split("@")[1]?.toLowerCase().trim();
  return at === INSTITUTION_DOMAIN;
}

export function normalizePhone(ph: string) {
  const raw = ph.replace(/\D/g, "");
  if (raw.startsWith("09")) return "+63" + raw.slice(1);
  if (raw.startsWith("9") && raw.length === 10) return "+63" + raw;
  if (raw.startsWith("63")) return "+" + raw;
  if (ph.startsWith("+")) return ph;
  return ph;
}


===== lib\env.ts =====


===== lib\history.ts =====
// src/lib/history.ts
export type HistoryType =
  | "Trip Request"
  | "Approval"
  | "Assignment"
  | "Trip Update"
  | "Maintenance"
  | "Login";

export type HistoryStatus = "Pending" | "Approved" | "Rejected" | "Completed" | "Cancelled" | "Info";

export type HistoryItem = {
  id: string;
  ts: string; // ISO string
  type: HistoryType;
  status: HistoryStatus;
  actor: string;      // e.g., "Mara Santos (Admin)"
  department?: string;
  title: string;      // short headline
  details: string;    // longer text
  ref?: { kind: "trip" | "vehicle" | "user"; id: string };
};

export type HistoryQuery = {
  search?: string;
  types?: HistoryType[];
  statuses?: HistoryStatus[];
  from?: string; // ISO date (inclusive)
  to?: string;   // ISO date (inclusive)
};

export const HISTORY_TYPES: HistoryType[] = [
  "Trip Request",
  "Approval",
  "Assignment",
  "Trip Update",
  "Maintenance",
  "Login",
];

export const HISTORY_STATUSES: HistoryStatus[] = [
  "Pending",
  "Approved",
  "Rejected",
  "Completed",
  "Cancelled",
  "Info",
];

function rand(seed: number) {
  let s = seed;
  return () => {
    s ^= s << 13; s ^= s >> 17; s ^= s << 5;
    return (s >>> 0) / 4294967296;
  };
}

export function seedHistory(count = 120, seedVal = 42): HistoryItem[] {
  const r = rand(seedVal);
  const names = ["Jolo Rosales", "Mara Santos", "Ben Cruz", "Ana Dela Peña", "Rafi Gomez", "Lea Ramos"];
  const depts = ["CCMS", "CBA", "COE", "CAS"];

  const pick = <T,>(arr: T[]) => arr[Math.floor(r() * arr.length)];
  const now = Date.now();

  const items: HistoryItem[] = Array.from({ length: count }).map((_, i) => {
    const type = pick(HISTORY_TYPES);
    const statusPool: HistoryStatus[] =
      type === "Trip Request" ? ["Pending", "Approved", "Rejected"] :
      type === "Approval" ? ["Approved", "Rejected"] :
      type === "Assignment" ? ["Info"] :
      type === "Trip Update" ? ["Completed", "Cancelled", "Info"] :
      type === "Maintenance" ? ["Info"] :
      ["Info"];

    const status = pick(statusPool);
    const when = new Date(now - Math.floor(r() * 1000 * 60 * 60 * 24 * 60)); // ~past 60 days

    const refKind = pick(["trip", "vehicle", "user"] as const);
    const refId = refKind === "trip" ? `TR-${1000 + i}` : refKind === "vehicle" ? `VH-${100 + i % 20}` : `USR-${i % 50}`;

    const title =
      type === "Trip Request" ? `Trip requested by ${pick(names)}` :
      type === "Approval" ? `Request ${status.toLowerCase()} by ${pick(names)}` :
      type === "Assignment" ? `Driver assigned to trip ${refId}` :
      type === "Trip Update" ? `Trip ${status.toLowerCase()} (${refId})` :
      type === "Maintenance" ? `Vehicle ${refId} flagged for maintenance` :
      `Successful login`;

    const details =
      type === "Trip Request"
        ? "Faculty submitted a new trip request with tentative date and passenger count."
        : type === "Approval"
        ? "Admin reviewed the request and made a decision."
        : type === "Assignment"
        ? "System matched available driver and vehicle to the approved request."
        : type === "Trip Update"
        ? "Trip status changed after driver report."
        : type === "Maintenance"
        ? "Periodic inspection shows vehicle needs attention."
        : "User authenticated via email and 2FA.";

    return {
      id: cryptoRandomId(i),
      ts: when.toISOString(),
      type,
      status,
      actor: `${pick(names)} (Admin)`,
      department: pick(depts),
      title,
      details,
      ref: { kind: refKind, id: refId },
    };
  });

  // newest first
  return items.sort((a, b) => +new Date(b.ts) - +new Date(a.ts));
}

export function filterHistory(data: HistoryItem[], q: HistoryQuery): HistoryItem[] {
  return data.filter((it) => {
    if (q.search) {
      const s = q.search.toLowerCase();
      const hay = `${it.title} ${it.details} ${it.actor} ${it.department ?? ""} ${it.ref?.id ?? ""}`.toLowerCase();
      if (!hay.includes(s)) return false;
    }
    if (q.types && q.types.length && !q.types.includes(it.type)) return false;
    if (q.statuses && q.statuses.length && !q.statuses.includes(it.status)) return false;
    if (q.from && new Date(it.ts) < new Date(q.from)) return false;
    if (q.to) {
      const end = new Date(q.to);
      end.setHours(23, 59, 59, 999);
      if (new Date(it.ts) > end) return false;
    }
    return true;
  });
}

export function exportHistoryCSV(rows: HistoryItem[]): string {
  const esc = (v: string) => `"${(v ?? "").replace(/"/g, '""')}"`;
  const head = [
    "ID","Timestamp","Type","Status","Actor","Department","Title","Details","RefKind","RefId"
  ];
  const body = rows.map(r =>
    [
      r.id,
      new Date(r.ts).toISOString(),
      r.type,
      r.status,
      r.actor,
      r.department ?? "",
      r.title,
      r.details,
      r.ref?.kind ?? "",
      r.ref?.id ?? ""
    ].map(esc).join(",")
  );
  return [head.join(","), ...body].join("\n");
}

function cryptoRandomId(i: number): string {
  // short, deterministic-ish fallback id
  return `hist_${(i + 1).toString(36)}_${Math.random().toString(36).slice(2, 8)}`;
}


===== lib\logger.ts =====


===== lib\maintenance.ts =====
// Client-side maintenance store (timezone-safe date math, ID-safe updates)

export type VehicleId = "bus-1" | "bus-2" | "van-1";
export type MaintenanceType = string;

export type MaintenanceRecord = {
  id: string;
  vehicle: VehicleId;
  type: MaintenanceType;      // e.g., "Change Oil" or "My Special Check"
  date: string;               // ISO "YYYY-MM-DD"
  notes?: string;
  /**
   * Optional repeating interval (months). If present and > 0, overrides defaults.
   * <= 0 or undefined => treated as one-time.
   */
  intervalMonths?: number;
};

const KEY = "travilink_maintenance";

/** Built-in types & default intervals (months) */
export const DEFAULT_INTERVALS = {
  "Change Oil": 3,
  "Tire Airing/Rotation": 1,
  "Brake Inspection": 6,
  "Coolant Check": 6,
} as const;

export const BUILTIN_TYPES = Object.keys(DEFAULT_INTERVALS) as Array<
  keyof typeof DEFAULT_INTERVALS
>;

function isBrowser(): boolean {
  return typeof window !== "undefined" && !!window.localStorage;
}

function pad2(n: number) {
  return n < 10 ? `0${n}` : String(n);
}

/** Pure string-based month addition: no Date/timezone surprises */
function addMonthsISO(iso: string, months: number): string {
  const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(iso);
  if (!m) throw new Error(`Invalid ISO date: ${iso}`);
  const y = parseInt(m[1], 10);
  const mo = parseInt(m[2], 10);
  const d = parseInt(m[3], 10);

  let nmo = mo + months;
  let ny = y + Math.floor((nmo - 1) / 12);
  nmo = ((nmo - 1) % 12) + 1;

  // Clamp day to the last valid day of the target month
  const lastDay = new Date(ny, nmo, 0).getDate();
  const nd = Math.min(d, lastDay);

  return `${ny}-${pad2(nmo)}-${pad2(nd)}`;
}

export function readAll(): MaintenanceRecord[] {
  if (!isBrowser()) return [];
  try {
    const raw = localStorage.getItem(KEY);
    const data = raw ? (JSON.parse(raw) as MaintenanceRecord[]) : [];
    // Light sanity filter
    return Array.isArray(data)
      ? data.filter(
          (r) =>
            r &&
            typeof r.id === "string" &&
            typeof r.vehicle === "string" &&
            typeof r.type === "string" &&
            typeof r.date === "string"
        )
      : [];
  } catch {
    return [];
  }
}

export function writeAll(list: MaintenanceRecord[]) {
  if (!isBrowser()) return;
  localStorage.setItem(KEY, JSON.stringify(list));
}

/** CRUD */
export function addRecord(rec: MaintenanceRecord) {
  const list = readAll();
  list.push(rec);
  writeAll(list);
}

export function updateRecord(id: string, patch: Partial<MaintenanceRecord>) {
  const list = readAll();
  const idx = list.findIndex((r) => r.id === id);
  if (idx >= 0) {
    // Never allow ID to be changed through patch
    const { id: _ignore, ...safePatch } = patch;
    list[idx] = { ...list[idx], ...safePatch };
    writeAll(list);
  }
}

export function removeRecord(id: string) {
  const list = readAll().filter((r) => r.id !== id);
  writeAll(list);
}

export function getById(id: string) {
  return readAll().find((r) => r.id === id);
}

export function byVehicle(vehicle: VehicleId) {
  return readAll().filter((r) => r.vehicle === vehicle);
}

export function lastOf(vehicle: VehicleId, type: MaintenanceType) {
  const list = byVehicle(vehicle)
    .filter((r) => r.type === type)
    .slice()
    .sort((a, b) => a.date.localeCompare(b.date));
  return list[list.length - 1];
}

/**
 * Compute next due from last record for a vehicle/type.
 * Priority:
 *  1) lastRecord.intervalMonths if provided and > 0
 *  2) DEFAULT_INTERVALS[type] if built-in
 *  3) undefined if no interval info
 */
export function nextDueFrom(
  vehicle: VehicleId,
  type: MaintenanceType
): string | undefined {
  const last = lastOf(vehicle, type);
  if (!last) return undefined;

  const custom = (last.intervalMonths ?? 0) > 0 ? last.intervalMonths! : 0;
  const builtin = (DEFAULT_INTERVALS as Record<string, number>)[type] ?? 0;
  const months = custom || builtin;
  if (months <= 0) return undefined;

  try {
    return addMonthsISO(last.date, months);
  } catch {
    return undefined;
  }
}

export function formatHuman(dateISO?: string) {
  if (!dateISO) return "—";
  // Use noon local time to dodge DST / midnight parsing quirks
  const d = new Date(`${dateISO}T12:00:00`);
  return d.toLocaleDateString(undefined, {
    month: "short",
    day: "numeric",
    year: "numeric",
  });
}


===== lib\maintenanceDomain.ts =====
// src/lib/maintenanceDomain.ts
export type MaintVehicleType = "Bus" | "Van" | "Car";
export type ServiceState = "In Service" | "Out of Service";

export type MaintVehicle = {
  id: string;
  name: string;
  type: MaintVehicleType;
  campus: string;
  plate: string;
  mileageKm: number;
  serviceState: ServiceState;
};

export type MaintSeverity = "Low" | "Medium" | "High" | "Critical";
export type MaintStatus = "Reported" | "Diagnosing" | "In Progress" | "Waiting Parts" | "Completed";

export const CAMPUSES = ["Lucena", "Candelaria", "Saman"];
export const VEHICLE_TYPES: MaintVehicleType[] = ["Bus", "Van", "Car"];
export const MAINT_STATUSES: MaintStatus[] = ["Reported", "Diagnosing", "In Progress", "Waiting Parts", "Completed"];
export const SEVERITIES: MaintSeverity[] = ["Low", "Medium", "High", "Critical"];

export type MaintenanceTicket = {
  id: string;
  createdAt: string; // ISO
  updatedAt: string; // ISO
  campus: string;
  vehicleId: string;
  title: string;
  description: string;
  severity: MaintSeverity;
  status: MaintStatus;
  reporter: string;
  assignee?: string;      // e.g., "Mec. Cruz"
  dueDate?: string;       // ISO
  cost?: number;          // PHP
  parts?: string;
  photos?: string[];      // data URLs or URLs
  markOutOfService?: boolean;
};

export type MaintenanceQuery = {
  search?: string;
  campus?: string; // All | campus name
  types?: MaintVehicleType[];
  severities?: MaintSeverity[];
  statuses?: MaintStatus[];
  from?: string; // ISO inclusive
  to?: string;   // ISO inclusive
};

function rng(seed: number) {
  let s = seed >>> 0;
  return () => (s = (s * 1664525 + 1013904223) >>> 0) / 4294967296;
}

export function seedMaintVehicles(n = 16, seed = 105): MaintVehicle[] {
  const r = rng(seed);
  const arr: MaintVehicle[] = Array.from({ length: n }).map((_, i) => {
    const type = VEHICLE_TYPES[Math.floor(r() * VEHICLE_TYPES.length)];
    const campus = CAMPUSES[Math.floor(r() * CAMPUSES.length)];
    const plate = `${String.fromCharCode(65 + Math.floor(r() * 26))}${String.fromCharCode(65 + Math.floor(r() * 26))}-${1000 + Math.floor(r() * 9000)}`;
    const mileage = 5_000 + Math.floor(r() * 95_000);
    const serviceState: ServiceState = r() < 0.88 ? "In Service" : "Out of Service";
    return {
      id: `VH-${110 + i}`,
      name: `${type} ${i + 1}`,
      type,
      campus,
      plate,
      mileageKm: mileage,
      serviceState
    };
  });
  return arr.sort((a, b) => a.id.localeCompare(b.id));
}

const SAMPLE_ISSUES = [
  "Brake pads grinding",
  "Aircon not cooling",
  "Engine overheating at idle",
  "Battery drops overnight",
  "Tire sidewall damage",
  "Check engine light",
  "Power steering noise",
  "Wiper motor intermittent",
  "Door lock jammed",
];

export function seedMaintenanceTickets(vehicles: MaintVehicle[], n = 36, seed = 205): MaintenanceTicket[] {
  const r = rng(seed);
  const names = ["Jolo Rosales", "Mara Santos", "Ben Cruz", "Lea Ramos", "Ana Dela Peña", "Rafi Gomez"];
  const assignees = ["Mec. Cruz", "Mec. Uy", "Mec. Dima", "Mec. Santos", "Mec. Lee"];
  const now = Date.now();

  const list: MaintenanceTicket[] = Array.from({ length: n }).map((_, i) => {
    const v = vehicles[Math.floor(r() * vehicles.length)];
    const created = new Date(now - Math.floor(r() * 1000 * 60 * 60 * 24 * 25)); // last 25 days
    const sev: MaintSeverity = r() < 0.15 ? "Low" : r() < 0.5 ? "Medium" : r() < 0.8 ? "High" : "Critical";
    const status: MaintStatus = r() < 0.3 ? "Reported" : r() < 0.55 ? "Diagnosing" : r() < 0.75 ? "In Progress" : r() < 0.9 ? "Waiting Parts" : "Completed";
    const due = new Date(created.getTime() + (3 + Math.floor(r() * 7)) * 86400000);

    return {
      id: `MT-${1400 + i}`,
      createdAt: created.toISOString(),
      updatedAt: created.toISOString(),
      campus: v.campus,
      vehicleId: v.id,
      title: SAMPLE_ISSUES[Math.floor(r() * SAMPLE_ISSUES.length)],
      description: "Auto-reported by driver app and confirmed by admin. Needs inspection.",
      severity: sev,
      status,
      reporter: names[Math.floor(r() * names.length)],
      assignee: r() < 0.7 ? assignees[Math.floor(r() * assignees.length)] : undefined,
      dueDate: r() < 0.7 ? due.toISOString() : undefined,
      cost: r() < 0.5 ? Math.floor(1000 + r() * 15000) : undefined,
      parts: r() < 0.4 ? "Brake pads; Cabin filter" : undefined,
      markOutOfService: sev === "Critical" ? true : r() < 0.2 ? true : false,
    };
  });

  // newest first by updatedAt
  return list.sort((a, b) => +new Date(b.updatedAt) - +new Date(a.updatedAt));
}

export function filterMaintenanceTickets(data: MaintenanceTicket[], q: MaintenanceQuery, vehicles: MaintVehicle[]): MaintenanceTicket[] {
  const byVehicle = new Map(vehicles.map(v => [v.id, v]));
  return data.filter((t) => {
    if (q.search) {
      const s = q.search.toLowerCase();
      const v = byVehicle.get(t.vehicleId);
      const hay = `${t.id} ${t.title} ${t.description} ${t.reporter} ${v?.name ?? ""} ${v?.plate ?? ""}`.toLowerCase();
      if (!hay.includes(s)) return false;
    }
    if (q.campus && q.campus !== "All" && t.campus !== q.campus) return false;
    if (q.statuses?.length && !q.statuses.includes(t.status)) return false;
    if (q.severities?.length && !q.severities.includes(t.severity)) return false;

    if (q.types?.length) {
      const v = byVehicle.get(t.vehicleId);
      if (!v || !q.types.includes(v.type)) return false;
    }
    if (q.from && new Date(t.createdAt) < new Date(q.from)) return false;
    if (q.to) {
      const end = new Date(q.to);
      end.setHours(23, 59, 59, 999);
      if (new Date(t.createdAt) > end) return false;
    }
    return true;
  });
}

export function exportMaintenanceCSV(rows: MaintenanceTicket[], vehicles: MaintVehicle[]): string {
  const byVehicle = new Map(vehicles.map(v => [v.id, v]));
  const esc = (v: string | number | undefined | null) => `"${String(v ?? "").replace(/"/g, '""')}"`;
  const head = [
    "TicketID","CreatedAt","UpdatedAt","Campus","VehicleID","VehicleName","Type","Plate","MileageKm","ServiceState","Severity","Status","Reporter","Assignee","DueDate","Cost","Parts","Title","Description","OOS"
  ];
  const body = rows.map(r => {
    const v = byVehicle.get(r.vehicleId);
    return [
      r.id,
      new Date(r.createdAt).toISOString(),
      new Date(r.updatedAt).toISOString(),
      r.campus,
      r.vehicleId,
      v?.name ?? "",
      v?.type ?? "",
      v?.plate ?? "",
      v?.mileageKm ?? "",
      v?.serviceState ?? "",
      r.severity,
      r.status,
      r.reporter,
      r.assignee ?? "",
      r.dueDate ? new Date(r.dueDate).toISOString() : "",
      r.cost ?? "",
      r.parts ?? "",
      r.title,
      r.description,
      r.markOutOfService ? "Yes" : "No",
    ].map(esc).join(",");
  });
  return [head.join(","), ...body].join("\n");
}

// helpers
export function updateVehicleServiceState(vehicles: MaintVehicle[], vehicleId: string, state: ServiceState) {
  return vehicles.map(v => v.id === vehicleId ? { ...v, serviceState: state } : v);
}

export function advanceMaintStatus(s: MaintStatus): MaintStatus {
  const order: MaintStatus[] = ["Reported","Diagnosing","In Progress","Waiting Parts","Completed"];
  const idx = order.indexOf(s);
  return order[Math.min(order.length - 1, Math.max(0, idx + 1))];
}


===== lib\mock.ts =====
export type VehicleStatus = "available" | "maintenance" | "offline";
export type DriverBadge = "Available" | "On Trip" | "Off Duty" | "Sick" | "Leave";

export type Vehicle = {
  id: string;
  name: string;
  type: "Bus" | "Van" | "Car";
  status: VehicleStatus;
};

export type Schedule = {
  id: string;
  date: string;       // ISO
  time: string;       // HH:MM
  location: string;
  vehicle: "Bus" | "Van" | "Car";
  status: "Approved" | "Pending" | "Assigned";
  requester: string;
  driver?: string;
};

export const DRIVER = {
  id: "D22-11451",
  name: "Jolo Rosales",
  campus: "Lucena Campus",
  dept: "CCMS",
  badges: ["Faculty", "Lucena Campus"],
  availability: "Available" as DriverBadge,
  phone: "090x-xxx-xxxx",
  license: "Professional",
  canDrive: ["Bus", "Van", "Car"],
};

export const VEHICLES: Vehicle[] = [
  { id: "v1", name: "Bus 1", type: "Bus", status: "available" },
  { id: "v2", name: "Van 1", type: "Van", status: "maintenance" },
  { id: "v3", name: "Bus 2", type: "Bus", status: "available" },
];

export const UPCOMING: Schedule[] = [
  {
    id: "sch-24012",
    date: "2025-12-25",
    time: "08:00",
    location: "Tagaytay",
    vehicle: "Bus",
    status: "Approved",
    requester: "Hans / CCMS",
    driver: "Jolo Rosales",
  },
  {
    id: "sch-24013",
    date: "2025-12-28",
    time: "09:30",
    location: "MSEUF Lucena",
    vehicle: "Van",
    status: "Pending",
    requester: "Hans / CCMS",
  },
  {
    id: "sch-24014",
    date: "2026-01-10",
    time: "06:30",
    location: "Batangas",
    vehicle: "Bus",
    status: "Assigned",
    requester: "Hans / CCMS",
  },
];


===== lib\profile.ts =====
export const BRAND_MAROON = "#7A0010";

export function wait(ms: number) {
  return new Promise((r) => setTimeout(r, ms));
}

type PasswordScore = 0 | 1 | 2 | 3;
type PasswordStrength = {
  score: PasswordScore;
  label: "weak" | "fair" | "medium" | "strong";
  hint?: string;
};

export function getPasswordStrength(pw: string): PasswordStrength {
  if (!pw) return { score: 0, label: "weak", hint: "Add a password." };

  let s = 0; // plain number while computing
  if (pw.length >= 8) s += 1;
  if (/[A-Z]/.test(pw) && /[a-z]/.test(pw)) s += 1;
  if (/\d/.test(pw) || /[^A-Za-z0-9]/.test(pw)) s += 1;

  const score = (s > 3 ? 3 : s) as PasswordScore; // narrow to 0|1|2|3
  const labels = ["weak", "fair", "medium", "strong"] as const;
  const label = labels[score];
  const hint = score < 3 ? "Use 8+ chars, mix upper/lower, numbers or symbols." : undefined;

  return { score, label, hint };
}


===== lib\requests.ts =====
// src/lib/requests.ts
export type RequestStatus = "Pending" | "Approved" | "Rejected";
export type Priority = "Normal" | "Urgent";

export type RequestItem = {
  id: string;
  createdAt: string;          // ISO timestamp
  neededOn: string;           // ISO date/time of requested trip
  requester: string;          // faculty/staff name
  department: string;         // e.g., CCMS
  campus: string;             // e.g., Lucena
  origin: string;
  destination: string;
  passengers: number;
  purpose: string;
  priority: Priority;
  status: RequestStatus;
  notes?: string;
};

export type RequestsQuery = {
  search?: string;
  statuses?: RequestStatus[];
  campus?: string;
  from?: string; // ISO date inclusive
  to?: string;   // ISO date inclusive
  urgentOnly?: boolean;
};

export const REQUEST_STATUSES: RequestStatus[] = ["Pending", "Approved", "Rejected"];

const CAMPUSES = ["Lucena", "Candelaria", "Saman"];
const DEPTS = ["CCMS", "CBA", "COE", "CAS"];
const NAMES = ["Jolo Rosales", "Mara Santos", "Ana Dela Peña", "Ben Cruz", "Lea Ramos", "Rafi Gomez"];
const PLACES = ["Main Gate", "IT Building", "COE Hall", "City Hall", "Provincial Capitol", "Sports Complex", "Terminal"];

function rng(seed: number) {
  let s = seed >>> 0;
  return () => (s = (s * 1664525 + 1013904223) >>> 0) / 4294967296;
}

export function seedRequests(n = 80, seed = 7): RequestItem[] {
  const r = rng(seed);
  const now = Date.now();
  const list: RequestItem[] = Array.from({ length: n }).map((_, i) => {
    const created = new Date(now - Math.floor(r() * 1000 * 60 * 60 * 24 * 45)); // last 45 days
    const when = new Date(created.getTime() + Math.floor(r() * 1000 * 60 * 60 * 24 * 20));
    const status: RequestStatus =
      r() < 0.6 ? "Pending" : r() < 0.8 ? "Approved" : "Rejected";
    const priority: Priority = r() < 0.2 ? "Urgent" : "Normal";

    return {
      id: `REQ-${1000 + i}`,
      createdAt: created.toISOString(),
      neededOn: when.toISOString(),
      requester: NAMES[Math.floor(r() * NAMES.length)],
      department: DEPTS[Math.floor(r() * DEPTS.length)],
      campus: CAMPUSES[Math.floor(r() * CAMPUSES.length)],
      origin: PLACES[Math.floor(r() * PLACES.length)],
      destination: PLACES[Math.floor(r() * PLACES.length)],
      passengers: 4 + Math.floor(r() * 36),
      purpose: r() < 0.5 ? "Department activity" : "Official errand",
      priority,
      status,
    };
  });

  // newest first by createdAt
  return list.sort((a, b) => +new Date(b.createdAt) - +new Date(a.createdAt));
}

export function filterRequests(data: RequestItem[], q: RequestsQuery): RequestItem[] {
  return data.filter((it) => {
    if (q.search) {
      const s = q.search.toLowerCase();
      const hay = `${it.id} ${it.requester} ${it.department} ${it.campus} ${it.origin} ${it.destination} ${it.purpose}`.toLowerCase();
      if (!hay.includes(s)) return false;
    }
    if (q.statuses?.length && !q.statuses.includes(it.status)) return false;
    if (q.campus && q.campus !== "All" && it.campus !== q.campus) return false;
    if (q.urgentOnly && it.priority !== "Urgent") return false;
    if (q.from && new Date(it.createdAt) < new Date(q.from)) return false;
    if (q.to) {
      const d = new Date(q.to);
      d.setHours(23, 59, 59, 999);
      if (new Date(it.createdAt) > d) return false;
    }
    return true;
  });
}

export function exportRequestsCSV(rows: RequestItem[]): string {
  const esc = (v: string | number) => `"${String(v ?? "").replace(/"/g, '""')}"`;
  const head = [
    "ID","CreatedAt","NeededOn","Status","Priority","Requester","Department","Campus",
    "Origin","Destination","Passengers","Purpose","Notes"
  ];
  const body = rows.map(r => [
    r.id,
    new Date(r.createdAt).toISOString(),
    new Date(r.neededOn).toISOString(),
    r.status,
    r.priority,
    r.requester,
    r.department,
    r.campus,
    r.origin,
    r.destination,
    r.passengers,
    r.purpose,
    r.notes ?? ""
  ].map(esc).join(","));
  return [head.join(","), ...body].join("\n");
}


===== lib\schedule.ts =====
// src/lib/schedule.ts
export type VehicleType = "Bus" | "Van" | "Car";
export type VehicleStatus = "Available" | "Maintenance" | "Offline";

export type Vehicle = {
  id: string;
  name: string;
  type: VehicleType;
  campus: string;
  status: VehicleStatus;
};

export type Driver = {
  id: string;
  name: string;
  campus: string;
  online: boolean;
};

export type ScheduleStatus = "Scheduled" | "Approved" | "En Route" | "Completed" | "Cancelled";

export type ScheduleEvent = {
  id: string;
  title: string;
  tripId?: string;
  campus: string;
  start: string; // ISO
  end: string;   // ISO
  passengers?: number;
  status: ScheduleStatus;
  vehicleId?: string;
  driverId?: string;
  notes?: string;
};

export type ScheduleQuery = {
  search?: string;
  campus?: string;        // All | campus name
  statuses?: ScheduleStatus[];
  vehicleType?: VehicleType | "All";
  from?: string; // ISO
  to?: string;   // ISO
};

export const CAMPUSES = ["Lucena", "Candelaria", "Saman"];
export const SCHEDULE_STATUSES: ScheduleStatus[] = ["Scheduled", "Approved", "En Route", "Completed", "Cancelled"];
export const VEHICLE_TYPES: VehicleType[] = ["Bus", "Van", "Car"];

function rng(seed: number) {
  let s = seed >>> 0;
  return () => (s = (s * 1664525 + 1013904223) >>> 0) / 4294967296;
}

export function seedVehicles(n = 14, seed = 21): Vehicle[] {
  const r = rng(seed);
  const arr: Vehicle[] = Array.from({ length: n }).map((_, i) => {
    const t = VEHICLE_TYPES[Math.floor(r() * VEHICLE_TYPES.length)];
    const c = CAMPUSES[Math.floor(r() * CAMPUSES.length)];
    const status: VehicleStatus = r() < 0.82 ? "Available" : r() < 0.92 ? "Maintenance" : "Offline";
    return { id: `VH-${100 + i}`, name: `${t} ${i + 1}`, type: t, campus: c, status };
  });
  return arr;
}

export function seedDrivers(n = 18, seed = 31): Driver[] {
  const r = rng(seed);
  const names = ["Leo Cruz", "Mara Santos", "Ben Ramos", "Ana Dela Peña", "Rafi Gomez", "Nina Reyes", "Paolo Tan", "Jolo Rosales", "Iris Yu", "Gio Lim", "Carlo Uy", "Luna Dee", "Kian Ong", "Ella Quinto", "Mina Park", "Omar dela Cruz", "Tori Vega", "Rhea Yu"];
  return Array.from({ length: n }).map((_, i) => {
    return {
      id: `DR-${200 + i}`,
      name: names[i % names.length],
      campus: CAMPUSES[Math.floor(r() * CAMPUSES.length)],
      online: r() < 0.7
    };
  });
}

export function seedSchedule(vehicles: Vehicle[], drivers: Driver[], n = 36, seed = 77): ScheduleEvent[] {
  const r = rng(seed);
  const now = new Date();
  const startWeek = startOfWeek(now);
  const endWeek = addDays(startWeek, 6);

  const titles = ["Campus Shuttle", "Field Activity", "Official Errand", "Department Trip", "Athletics Shuttle"];
  const list: ScheduleEvent[] = [];

  for (let i = 0; i < n; i++) {
    const day = addDays(startWeek, Math.floor(r() * 7));
    const hour = 7 + Math.floor(r() * 10); // between 7:00 and 17:00
    const dur = 60 + Math.floor(r() * 180); // 1–4hrs
    const start = new Date(day); start.setHours(hour, Math.floor(r() * 2) * 30, 0, 0);
    const end = addMinutes(start, dur);
    const campus = CAMPUSES[Math.floor(r() * CAMPUSES.length)];
    const title = titles[Math.floor(r() * titles.length)];
    const status: ScheduleStatus = r() < 0.15 ? "Scheduled" : r() < 0.55 ? "Approved" : r() < 0.7 ? "En Route" : r() < 0.9 ? "Completed" : "Cancelled";

    // Prefill some assignments
    const veh = vehicles.filter(v => v.campus === campus && v.status === "Available")[Math.floor(r() * 3)];
    const drv = drivers.filter(d => d.campus === campus)[Math.floor(r() * 3)];

    list.push({
      id: `EV-${1000 + i}`,
      title,
      tripId: r() < 0.7 ? `TR-${1200 + i}` : undefined,
      campus,
      start: start.toISOString(),
      end: end.toISOString(),
      passengers: 4 + Math.floor(r() * 30),
      status,
      vehicleId: veh?.id,
      driverId: drv?.id,
      notes: r() < 0.2 ? "Bring faculty IDs." : undefined
    });
  }

  return list
    .filter(e => new Date(e.start) >= startWeek && new Date(e.start) <= endWeek)
    .sort((a, b) => +new Date(a.start) - +new Date(b.start));
}

export function filterSchedule(events: ScheduleEvent[], q: ScheduleQuery, vehicles: Vehicle[], drivers: Driver[]): ScheduleEvent[] {
  const byIdVehicle = new Map(vehicles.map(v => [v.id, v]));
  const byIdDriver = new Map(drivers.map(d => [d.id, d]));

  return events.filter(e => {
    if (q.search) {
      const s = q.search.toLowerCase();
      const veh = e.vehicleId ? byIdVehicle.get(e.vehicleId)?.name ?? "" : "";
      const drv = e.driverId ? byIdDriver.get(e.driverId)?.name ?? "" : "";
      const hay = `${e.title} ${e.tripId ?? ""} ${veh} ${drv} ${e.campus}`.toLowerCase();
      if (!hay.includes(s)) return false;
    }
    if (q.campus && q.campus !== "All" && e.campus !== q.campus) return false;
    if (q.statuses?.length && !q.statuses.includes(e.status)) return false;
    if (q.vehicleType && q.vehicleType !== "All") {
      if (!e.vehicleId) return false;
      const v = byIdVehicle.get(e.vehicleId);
      if (!v || v.type !== q.vehicleType) return false;
    }
    if (q.from && new Date(e.end) < new Date(q.from)) return false;
    if (q.to && new Date(e.start) > new Date(q.to)) return false;
    return true;
  });
}

export function overlaps(aStart: Date, aEnd: Date, bStart: Date, bEnd: Date) {
  return aStart < bEnd && bStart < aEnd;
}

export function findConflicts(events: ScheduleEvent[], target: ScheduleEvent): { vehicle: ScheduleEvent[]; driver: ScheduleEvent[] } {
  const ts = new Date(target.start), te = new Date(target.end);
  const vehicle = target.vehicleId
    ? events.filter(e => e.id !== target.id && e.vehicleId === target.vehicleId && overlaps(new Date(e.start), new Date(e.end), ts, te))
    : [];
  const driver = target.driverId
    ? events.filter(e => e.id !== target.id && e.driverId === target.driverId && overlaps(new Date(e.start), new Date(e.end), ts, te))
    : [];
  return { vehicle, driver };
}

export function autoAssignForEvent(event: ScheduleEvent, vehicles: Vehicle[], drivers: Driver[], events: ScheduleEvent[]): { vehicleId?: string; driverId?: string } {
  const start = new Date(event.start), end = new Date(event.end);
  const veh = vehicles
    .filter(v => v.campus === event.campus && v.status === "Available")
    .find(v => events.every(e => !(e.vehicleId === v.id && overlaps(new Date(e.start), new Date(e.end), start, end))));
  const drv = drivers
    .filter(d => d.campus === event.campus && d.online)
    .find(d => events.every(e => !(e.driverId === d.id && overlaps(new Date(e.start), new Date(e.end), start, end))));
  return { vehicleId: veh?.id, driverId: drv?.id };
}

export function startOfWeek(d: Date) {
  const x = new Date(d);
  const day = (x.getDay() + 6) % 7; // Mon=0
  x.setHours(0,0,0,0);
  x.setDate(x.getDate() - day);
  return x;
}
export function endOfWeek(d: Date) {
  const x = startOfWeek(d);
  x.setDate(x.getDate() + 6);
  x.setHours(23,59,59,999);
  return x;
}
export function addDays(d: Date, n: number) {
  const x = new Date(d);
  x.setDate(x.getDate() + n);
  return x;
}
export function addMinutes(d: Date, n: number) {
  const x = new Date(d);
  x.setMinutes(x.getMinutes() + n);
  return x;
}
export function formatDayKey(d: Date) {
  return d.toISOString().slice(0,10);
}


===== lib\supabaseClient.ts =====
                // src/lib/supabaseClient.ts
import { createClient } from "@supabase/supabase-js";

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL as string;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY as string;

// create client
export const supabase = createClient(supabaseUrl, supabaseKey);


===== lib\supabaseServer.ts =====
import { cookies } from "next/headers";
import { createServerClient, type CookieOptions } from "@supabase/ssr";

export async function getSupabaseServer() {
  const cookieStore = await cookies(); // Next 15: dynamic API must be awaited

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        // Must return string | undefined
        get(name: string) {
          return cookieStore.get(name)?.value;
        },
        // Must accept CookieOptions
        set(name: string, value: string, options: CookieOptions) {
          // In some server contexts cookies() can be read-only; ignore errors
          try {
            cookieStore.set({ name, value, ...options });
          } catch {}
        },
        remove(name: string, options: CookieOptions) {
          try {
            cookieStore.set({ name, value: "", ...options, maxAge: 0 });
          } catch {}
        },
      },
    }
  );
}


===== lib\travilink.ts =====
/* ---------- Domain Types ---------- */
export type VehicleType = "Bus" | "Van" | "Car";
export type VehicleStatus = "available" | "maintenance" | "offline";

export type Vehicle = {
  id: string;
  name: string;
  type: VehicleType;
  status: VehicleStatus;
  note?: string;
};

export type Schedule = {
  id: string;
  dept: string;
  purpose: string;
  date: string;
  location: string;
  vehicle: string;
  driver?: string;
  status: "Approved" | "Pending" | "Assigned";
};

export type DriverStatus = "available" | "on_trip" | "off_duty" | "sick" | "leave";
export type Driver = {
  id: string;
  name: string;
  license: string;
  vehicleTypes: VehicleType[];
  status: DriverStatus;
  phone?: string;
  color?: string;
};

export type NotifType = "request" | "maintenance" | "driver" | "system";
export type Notif = {
  id: string;
  type: NotifType;
  title: string;
  body?: string;
  time: string;
  unread: boolean;
  severity?: "info" | "warning" | "danger";
};


===== lib\types.ts =====
export type TripRequestStatus = "pending" | "approved" | "rejected" | "cancelled";
export type TripRequest = {
  id: string;
  user_id: string;
  purpose: string;
  origin: string;
  destination: string;
  schedule: string; // timestamptz ISO
  passengers?: number | null;
  notes?: string | null;
  status: TripRequestStatus;
  created_at: string;
  start_time?: string | null;
  end_time?: string | null;
  updated_at?: string | null;
};


===== lib\utils.ts =====
import { clsx } from "clsx";
import { twMerge } from "tailwind-merge";
export function cn(...i: any[]) { return twMerge(clsx(i)); }


===== lib\validation.ts =====
import { z } from "zod";

export const RequestSchema = z.object({
  user_id: z.string().uuid(),
  purpose: z.string().min(1, "Purpose is required."),
  pickup: z.string().min(1, "Pickup is required."),
  destination: z.string().min(1, "Destination is required."),
  schedule: z.string().datetime().optional(),
  start: z.string().datetime().optional(),
  end: z.string().datetime().optional(),
  passengers: z.union([z.number().int().min(1), z.null(), z.literal("")]).optional(),
  notes: z.string().optional().or(z.null()).or(z.literal("")),
});


===== lib\admin\export.ts =====
import type { RequestRow } from "@/lib/admin/types";

// converts rows to CSV string
export function rowsToCsv(rows: RequestRow[]): string {
  const header = ["ID","Department","Purpose","Date","Status","Requester","Vehicle","Driver"];
  const escape = (v: any) => {
    if (v === undefined || v === null) return "";
    const s = String(v);
    return /[",\n]/.test(s) ? `"${s.replace(/"/g, '""')}"` : s;
  };
  const lines = rows.map(r => [
    r.id, r.dept, r.purpose, r.date, r.status, r.requester ?? "", r.vehicle ?? "", r.driver ?? ""
  ].map(escape).join(","));
  return [header.join(","), ...lines].join("\n");
}

// triggers a download on client
export function triggerDownload(filename: string, content: string, mime = "text/csv;charset=utf-8") {
  if (typeof window === "undefined") return;
  const blob = new Blob([content], { type: mime });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}


// import { RequestRow } from "../types";

export function exportRequestsCsv(rows: RequestRow[], filename = "requests.csv") {
  const headers = ["ID","Department","Purpose","Date","Status","Requester","Vehicle","Driver"];
  const body = rows.map(r => [
    r.id, r.dept, quote(r.purpose), r.date, r.status,
    r.requester ?? "", r.vehicle ?? "", r.driver ?? ""
  ].join(","));
  const blob = new Blob(
    [headers.join(","), "\n", body.join("\n")],
    { type: "text/csv;charset=utf-8;" }
  );
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}
function quote(s: string) {
  const needs = /[",\n]/.test(s);
  return needs ? `"${s.replace(/"/g,'""')}"` : s;
}


===== lib\admin\repo.ts =====
"use server";

import type { DashboardData, RequestRow } from "./types";
import * as mock from "./adapters/mock";
import * as real from "./adapters/real";

// Flip to REAL by setting NEXT_PUBLIC_TRAVILINK_USE_MOCK=false in .env.local
const USE_MOCK = process.env.NEXT_PUBLIC_TRAVILINK_USE_MOCK !== "false";
const dash = USE_MOCK ? mock : real;
const reqs = USE_MOCK ? mock : real;

/* ---------------- Types ---------------- */
export type ListRequestsQuery = {
  status?: string;
  dept?: string;
  search?: string;
  from?: string;   // ISO date (inclusive)
  to?: string;     // ISO date (inclusive)
  page?: number;   // 1-based
  pageSize?: number;
};

/* --------------- Dashboard -------------- */
export async function getDashboardData(): Promise<DashboardData> {
  return dash.getDashboardData();
}

/* ---------------- Requests -------------- */
export async function listRequests(
  query: ListRequestsQuery
): Promise<{ rows: RequestRow[]; total: number }> {
  return reqs.listRequests(query);
}

export async function getRequest(id: string): Promise<RequestRow> {
  return reqs.getRequest(id);
}

export async function updateRequest(
  id: string,
  patch: Partial<RequestRow>
): Promise<RequestRow> {
  return reqs.updateRequest(id, patch);
}

export async function bulkUpdate(
  ids: string[],
  patch: Partial<RequestRow>
): Promise<void> {
  return reqs.bulkUpdate(ids, patch);
}


===== lib\admin\types.ts =====
// ---- Basic KPIs & chart points ----
export type KPI = { label: string; value: number | string; caption?: string };

export type TrendPoint = { date: string; count: number };

export type StatusPoint = {
  status: "Pending" | "Approved" | "Completed" | "Rejected";
  count: number;
};

// ---- Utilization / Trip logs ----
export type UtilizationPoint = { label: string; percent: number }; // e.g., per vehicle/dept

export type TripLogRow = {
  id: string;
  vehicle: string;
  driver: string;
  department: string;
  date: string;        // YYYY-MM-DD
  distanceKm: number;  // mock for now
};

// ---- Requests ----
export type RequestStatus = "Pending" | "Approved" | "Completed" | "Rejected";

export type RequestRow = {
  id: string;
  dept: "CCMS" | "HR" | "Registrar" | "Finance";
  purpose: string;
  date: string;                // YYYY-MM-DD (scheduled date)
  status: RequestStatus;
  requester?: string;
  vehicle?: string;
  driver?: string;

  // When the request was submitted/received (optional)
  receivedAt?: string;         // e.g., "2025-09-04 10:15 AM"
  createdAt?: string;          // ISO (used by mocks for sorting)
  updatedAt?: string;          // ISO
};

export type RequestsSummary = {
  pending: number;
  approved: number;
  completed: number;
  rejected: number;
};

// ---- Filters / Paging ----
export type FilterState = {
  status: "All" | RequestStatus;
  dept: "All" | "CCMS" | "HR" | "Registrar" | "Finance";
  from?: string;
  to?: string;
  search: string;
  mode: "auto" | "apply";
};

export type Pagination = {
  page: number;      // 1-based
  pageSize: number;  // rows per page
  total: number;     // total filtered rows
};

// ---- Dashboard aggregates ----
export type DeptUsage = { dept: string; count: number };

export type DashboardData = {
  kpis: KPI[];
  requestsByDay: TrendPoint[];
  statusBreakdown: StatusPoint[];
  utilization: UtilizationPoint[];
  deptUsage: DeptUsage[];
  recentRequests: RequestRow[];
  recentTrips: TripLogRow[];
  receivedAt?: string;
};


===== lib\admin\adapters\mock.ts =====
import type {
  DashboardData,
  RequestRow,
  TripLogRow,
  StatusPoint,
  KPI,
  UtilizationPoint,
  DeptUsage,
} from "../types";
import type { ListRequestsQuery } from "../repo";

/* ---------------- Mock dataset ---------------- */

let REQUESTS: RequestRow[] = [
  {
    id: "REQ-1001",
    dept: "CCMS",
    purpose: "Seminar",
    date: "2025-09-10",
    status: "Pending",
    requester: "Prof. Santos",
    createdAt: "2025-09-05T08:30:00Z",
    updatedAt: "2025-09-05T08:30:00Z",
  },
  {
    id: "REQ-1002",
    dept: "HR",
    purpose: "Orientation",
    date: "2025-09-12",
    status: "Approved",
    requester: "HR Office",
    createdAt: "2025-09-06T09:00:00Z",
    updatedAt: "2025-09-07T12:10:00Z",
  },
  {
    id: "REQ-1003",
    dept: "Finance",
    purpose: "Field Audit",
    date: "2025-09-14",
    status: "Rejected",
    requester: "Finance Team",
    createdAt: "2025-09-07T07:45:00Z",
    updatedAt: "2025-09-08T10:22:00Z",
  },
];

const RECENT_TRIPS: TripLogRow[] = [
  {
    id: "TRP-2001",
    vehicle: "VAN-12",
    driver: "Dizon",
    department: "CCMS",
    date: "2025-09-09",
    distanceKm: 12.6,
  },
  {
    id: "TRP-2002",
    vehicle: "VAN-03",
    driver: "Reyes",
    department: "HR",
    date: "2025-09-10",
    distanceKm: 7.8,
  },
];

/* ---------------- Helpers ---------------- */

function contains(hay: string, needle: string) {
  return hay.toLowerCase().includes(needle.toLowerCase());
}

function inDateRange(d: string, from?: string, to?: string) {
  const t = new Date(d).getTime();
  if (from && t < new Date(from).setHours(0, 0, 0, 0)) return false;
  if (to && t > new Date(to).setHours(23, 59, 59, 999)) return false;
  return true;
}

/* --------------- Dashboard --------------- */

export async function getDashboardData(): Promise<DashboardData> {
  const kpis: KPI[] = [
    { label: "Total Trips (Month)", value: 42 },
    { label: "Active Vehicles", value: 12 },
    { label: "Pending Requests", value: 5 },
    { label: "KM This Month", value: 1873 },
  ];

  const requestsByDay = [
    { date: "2025-09-08", count: 6 },
    { date: "2025-09-09", count: 8 },
    { date: "2025-09-10", count: 5 },
    { date: "2025-09-11", count: 10 },
    { date: "2025-09-12", count: 7 },
  ];

  const statusBreakdown: StatusPoint[] = [
    { status: "Pending", count: REQUESTS.filter(r => r.status === "Pending").length },
    { status: "Approved", count: REQUESTS.filter(r => r.status === "Approved").length },
    { status: "Completed", count: REQUESTS.filter(r => r.status === "Completed").length },
    { status: "Rejected", count: REQUESTS.filter(r => r.status === "Rejected").length },
  ];

  const utilization: UtilizationPoint[] = [
    { label: "VAN-12", percent: 76 },
    { label: "VAN-03", percent: 58 },
    { label: "BUS-01", percent: 42 },
  ];

  const deptUsage: DeptUsage[] = [
    { dept: "CCMS", count: 11 },
    { dept: "HR", count: 7 },
    { dept: "Registrar", count: 4 },
    { dept: "Finance", count: 5 },
  ];

  const recentRequests = REQUESTS.slice(0, 5);
  const recentTrips = RECENT_TRIPS;

  return {
    kpis,
    requestsByDay,
    statusBreakdown,
    utilization,
    deptUsage,
    recentRequests,
    recentTrips,
    receivedAt: new Date().toISOString(),
  };
}

/* ---------------- Requests ---------------- */

export async function listRequests(
  query: ListRequestsQuery
): Promise<{ rows: RequestRow[]; total: number }> {
  const { status, dept, search, from, to, page = 1, pageSize = 10 } = query ?? {};

  let rows = REQUESTS.slice();

  if (status && status !== "All") rows = rows.filter((r) => r.status === status);
  if (dept && dept !== "All") rows = rows.filter((r) => r.dept === dept);
  if (from || to) rows = rows.filter((r) => inDateRange(r.date, from, to));
  if (search && search.trim()) {
    rows = rows.filter(
      (r) =>
        contains(r.id, search) ||
        contains(r.purpose, search) ||
        contains(r.dept, search) ||
        contains(r.requester ?? "", search)
    );
  }

  // newest first by scheduled 'date', fallback to createdAt
  rows.sort((a, b) => {
    const A = new Date(a.date ?? a.createdAt ?? 0).getTime();
    const B = new Date(b.date ?? b.createdAt ?? 0).getTime();
    return B - A;
  });

  const total = rows.length;
  const start = (page - 1) * pageSize;
  const paged = rows.slice(start, start + pageSize);

  return { rows: paged, total };
}

export async function getRequest(id: string): Promise<RequestRow> {
  const row = REQUESTS.find((r) => r.id === id);
  if (!row) throw new Error(`Request ${id} not found`);
  return row;
}

export async function updateRequest(
  id: string,
  patch: Partial<RequestRow>
): Promise<RequestRow> {
  const idx = REQUESTS.findIndex((r) => r.id === id);
  if (idx === -1) throw new Error(`Request ${id} not found`);
  REQUESTS[idx] = { ...REQUESTS[idx], ...patch, updatedAt: new Date().toISOString() };
  return REQUESTS[idx];
}

export async function bulkUpdate(ids: string[], patch: Partial<RequestRow>): Promise<void> {
  const now = new Date().toISOString();
  REQUESTS = REQUESTS.map((r) => (ids.includes(r.id) ? { ...r, ...patch, updatedAt: now } : r));
}


===== lib\admin\adapters\real.ts =====
import type { DashboardData, RequestRow } from "../types";
import type { ListRequestsQuery } from "../repo";
// import { supabase } from "@/lib/supabaseClient"; // when ready

export async function getDashboardData(): Promise<DashboardData> {
  // TODO: Replace with real queries/aggregations
  return {
    kpis: [],
    requestsByDay: [],
    statusBreakdown: [],
    utilization: [],
    deptUsage: [],
    recentRequests: [],
    recentTrips: [],
    receivedAt: new Date().toISOString(),
  };
}

export async function listRequests(
  _query: ListRequestsQuery
): Promise<{ rows: RequestRow[]; total: number }> {
  // TODO: Translate filters to DB query; return exact shape
  return { rows: [], total: 0 };
}

export async function getRequest(_id: string): Promise<RequestRow> {
  // TODO
  throw new Error("Not implemented");
}

export async function updateRequest(
  _id: string,
  _patch: Partial<RequestRow>
): Promise<RequestRow> {
  // TODO
  throw new Error("Not implemented");
}

export async function bulkUpdate(_ids: string[], _patch: Partial<RequestRow>): Promise<void> {
  // TODO
  throw new Error("Not implemented");
}


===== lib\admin\drivers\actions.ts =====
// Extendable imperative helpers (kept tiny for now)
export const resetAccess = async (email: string) => {
  // later: call backend to send reset/invite
  console.info("Reset access for:", email);
};


===== lib\admin\drivers\index.ts =====
export * from "./types";
export * from "./store";
export * from "./validators";
export * from "./utils";
export * from "./actions";


===== lib\admin\drivers\store.ts =====
"use client";
import type { Driver, DriverCreate, DriverUpdate } from "./types";
import { validateDriver } from "./validators";
import { todayISO } from "./utils";

const KEY = "tl::drivers";

const now = () => new Date().toISOString();

const safeLoad = (): Driver[] => {
  if (typeof window === "undefined") return [];
  try { return JSON.parse(window.localStorage.getItem(KEY) || "[]"); }
  catch { return []; }
};
const safeSave = (rows: Driver[]) => { if (typeof window !== "undefined") window.localStorage.setItem(KEY, JSON.stringify(rows)); };

function seedIfEmpty() {
  const rows = safeLoad();
  if (rows.length) return;
  const demo: Driver[] = [
    {
      id: crypto.randomUUID(),
      employeeNo: "DRV-0001",
      firstName: "Mario",
      lastName: "Santos",
      email: "mario.santos@mseuf.edu.ph",
      phone: "09171234567",
      status: "active",
      hiredAt: todayISO(),
      photoUrl: "",
      license: { number: "ABC12345", category: "B", expiry: todayISO() },
      requirements: {},
      primaryVehicleId: null,
      allowedVehicleTypes: ["van", "bus", "car"],
      notes: "",
      createdAt: now(),
      updatedAt: now(),
    },
  ];
  safeSave(demo);
}
seedIfEmpty();

export const DriversRepo = {
  list(query?: { search?: string; status?: string; compliant?: "ok"|"warn"|"bad"|"" }) {
    let rows = safeLoad();
    if (query?.search) {
      const q = query.search.toLowerCase();
      rows = rows.filter(r =>
        `${r.firstName} ${r.lastName}`.toLowerCase().includes(q) ||
        r.employeeNo.toLowerCase().includes(q) ||
        r.license.number.toLowerCase().includes(q)
      );
    }
    if (query?.status) rows = rows.filter(r => r.status === query.status);
    if (query?.compliant) {
      const { complianceState } = require("./utils");
      rows = rows.filter(r => complianceState(r) === query.compliant);
    }
    return rows.sort((a,b)=>a.lastName.localeCompare(b.lastName));
  },

  create(input: DriverCreate): Driver {
    validateDriver(input);
    const rows = safeLoad();
    const d: Driver = {
      ...input,
      id: crypto.randomUUID(),
      createdAt: now(),
      updatedAt: now(),
    };
    rows.push(d);
    safeSave(rows);
    return d;
  },

  update(patch: DriverUpdate): Driver {
    const rows = safeLoad();
    const i = rows.findIndex(r => r.id === patch.id);
    if (i < 0) throw new Error("Driver not found");
    const next = { ...rows[i], ...patch, updatedAt: now() };
    rows[i] = next;
    safeSave(rows);
    return next;
  },

  remove(id: string) {
    const rows = safeLoad().filter(r => r.id !== id);
    safeSave(rows);
  },

  bulkUpdate(ids: string[], patch: Partial<Driver>) {
    const rows = safeLoad().map(r => ids.includes(r.id) ? { ...r, ...patch, updatedAt: now() } : r);
    safeSave(rows);
  },

  exportCsv(rows: Driver[]) {
    const header = ["employeeNo","firstName","lastName","email","phone","status","licenseNumber","licenseCategory","licenseExpiry"];
    const lines = rows.map(r => [
      r.employeeNo, r.firstName, r.lastName, r.email, r.phone, r.status,
      r.license.number, r.license.category, r.license.expiry
    ].map(v => `"${(v ?? "").toString().replace(/"/g,'""')}"`).join(","));
    const csv = [header.join(","), ...lines].join("\n");
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = `drivers-${new Date().toISOString().slice(0,10)}.csv`;
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
};


===== lib\admin\drivers\types.ts =====
export type DriverStatus = "active" | "suspended" | "archived" | "pending_verification";

export type LicenseInfo = {
  number: string;
  category: string; // e.g. "A","B","C"
  expiry: string;   // ISO date
};

export type Requirements = {
  medicalClearanceExpiry?: string;
  drugTestExpiry?: string;
  safetyTrainingExpiry?: string;
};

export type Driver = {
  id: string;
  employeeNo: string;
  firstName: string;
  lastName: string;
  email: string;
  phone: string;
  status: DriverStatus;
  photoUrl?: string;
  hiredAt: string;
  license: LicenseInfo;
  requirements?: Requirements;
  primaryVehicleId?: string | null;
  allowedVehicleTypes?: string[];
  notes?: string;
  createdAt: string;
  updatedAt: string;
  lastEditedBy?: string;
};

export type DriverCreate = Omit<Driver, "id" | "createdAt" | "updatedAt" | "lastEditedBy">;
export type DriverUpdate = Partial<Omit<Driver, "id" | "createdAt">> & { id: string };


===== lib\admin\drivers\utils.ts =====
import type { Driver } from "./types";

export const todayISO = () => new Date().toISOString().slice(0, 10);

export const isExpired = (iso: string) => {
  if (!iso) return true;
  const d = new Date(iso + "T00:00:00");
  const t = new Date(todayISO() + "T00:00:00");
  return d.getTime() < t.getTime();
};

export const daysUntil = (iso: string) => {
  const t = new Date(todayISO() + "T00:00:00").getTime();
  const d = new Date(iso + "T00:00:00").getTime();
  return Math.ceil((d - t) / (1000 * 60 * 60 * 24));
};

export const complianceState = (d: Driver): "ok" | "warn" | "bad" => {
  const licenseDays = daysUntil(d.license.expiry);
  if (licenseDays < 0) return "bad";
  if (licenseDays <= 30) return "warn";
  return "ok";
};

export const complianceInfo = (d: import("./types").Driver) => {
  const state = complianceState(d); // "ok" | "warn" | "bad"
  const className =
    state === "ok"
      ? "bg-green-100 text-green-700"
      : state === "warn"
      ? "bg-yellow-100 text-yellow-700"
      : "bg-red-100 text-red-700";
  const label = state === "ok" ? "Compliant" : state === "warn" ? "Expiring soon" : "Expired";
  return { state, className, label };
};

===== lib\admin\drivers\validators.ts =====
import type { DriverCreate } from "./types";

export function validateDriver(input: DriverCreate) {
  if (!input.employeeNo.trim()) throw new Error("Employee # is required");
  if (!input.firstName.trim()) throw new Error("First name is required");
  if (!input.lastName.trim()) throw new Error("Last name is required");
  if (!/^\S+@\S+\.\S+$/.test(input.email)) throw new Error("Invalid email");
  if (!input.license.number.trim()) throw new Error("License number is required");
}


===== lib\admin\drivers\hooks\useDriverFilters.ts =====
import * as React from "react";

export function useDriverFilters() {
  const [filters, setFilters] = React.useState<{ search?: string; status?: string; compliant?: "ok"|"warn"|"bad"|"" }>({});
  return { filters, setFilters };
}


===== lib\admin\drivers\hooks\useDriverTableColumns.ts =====
// Placeholder if you want to centralize column configs (kept simple for now)
export const useDriverTableColumns = () => {
  return ["driver","employeeNo","status","license","compliance","primaryVehicle"];
};


===== lib\admin\logs\analytics.ts =====
import type { LogEntry } from "./types";

export function countBySeverity(rows: LogEntry[]) {
  const m = { info:0, warning:0, error:0 } as Record<"info"|"warning"|"error", number>;
  rows.forEach(r => (m[r.severity] = (m[r.severity] ?? 0) + 1));
  return m;
}

export function countByAction(rows: LogEntry[]) {
  const map = new Map<string, number>();
  rows.forEach(r => map.set(r.action, (map.get(r.action) ?? 0) + 1));
  // return top 5 actions
  return Array.from(map.entries()).sort((a,b)=>b[1]-a[1]).slice(0,5);
}

export function trendLast7Days(rows: LogEntry[]) {
  // returns [{day:"YYYY-MM-DD", count:number}]
  const today = new Date();
  const days: { day: string; count: number }[] = [];
  for (let i=6;i>=0;i--) {
    const d = new Date(today);
    d.setDate(today.getDate()-i);
    const key = d.toISOString().slice(0,10);
    const count = rows.filter(r => r.timestampISO.slice(0,10) === key).length;
    days.push({ day: key, count });
  }
  return days;
}


===== lib\admin\logs\csv.ts =====
import type { LogEntry } from "./types";

export function toCSV(rows: LogEntry[]): string {
  const head = [
    "ID","TimestampISO","ActorType","ActorName","Action","EntityType","EntityId","EntityLabel","Severity","IP","Details"
  ];
  const lines = rows.map(r => [
    r.id, r.timestampISO, r.actorType, r.actorName, r.action, r.entityType, r.entityId ?? "", r.entityLabel ?? "", r.severity, r.ip ?? "",
    (r.details ?? "").replaceAll("\n"," ").replaceAll('"','""')
  ].map(x => `"${String(x)}"`).join(","));
  return [head.join(","), ...lines].join("\n");
}


===== lib\admin\logs\handlers.ts =====
import type { LogEntry, LogFilters } from "./types";
import { LogsRepo } from "./repo";
import { applyFilters } from "./service";
import { toCSV } from "./csv";
import { countBySeverity, countByAction, trendLast7Days } from "./analytics";

export function loadLogs(filters?: LogFilters): LogEntry[] {
  return applyFilters(LogsRepo.all(), filters);
}

export function getAnalytics(rows: LogEntry[]) {
  return {
    totals: {
      all: rows.length,
      ...countBySeverity(rows),
    },
    topActions: countByAction(rows),
    trend7d: trendLast7Days(rows),
  };
}

export function addLog(entry: Omit<LogEntry,"id"|"timestampISO">): LogEntry {
  return LogsRepo.append(entry);
}

export function deleteLog(id: string) { LogsRepo.remove(id); }
export function clearLogs() { LogsRepo.clearAll(); }

export function exportLogsCSV(rows: LogEntry[]): Blob {
  const csv = toCSV(rows);
  return new Blob([csv], { type: "text/csv;charset=utf-8;" });
}


===== lib\admin\logs\repo.ts =====
import type { LogEntry } from "./types";

const LS_KEY = "tl_logs_v2";
const nowISO = () => new Date().toISOString();
const uid = () => (globalThis.crypto?.randomUUID?.() ?? `l_${Math.random().toString(36).slice(2)}`);

const seed: LogEntry[] = [
  { id: uid(), timestampISO: nowISO(), actorType:"admin", actorName:"Admin",
    action:"login", entityType:"auth", severity:"info", details:"Signed in", ip:"127.0.0.1" },
  { id: uid(), timestampISO: new Date(Date.now()-1*60*60*1000).toISOString(), actorType:"admin", actorName:"Admin",
    action:"create", entityType:"maintenance", entityId:"m_001", entityLabel:"BUS-01 Oil change",
    severity:"info", details:"Created maintenance record" },
  { id: uid(), timestampISO: new Date(Date.now()-3*60*60*1000).toISOString(), actorType:"system", actorName:"System",
    action:"update", entityType:"vehicle", entityId:"v_001", entityLabel:"BUS-01",
    severity:"warning", details:"Odometer sync failed; retrying" },
  { id: uid(), timestampISO: new Date(Date.now()-26*60*60*1000).toISOString(), actorType:"driver", actorName:"D. Cruz",
    action:"status_change", entityType:"trip", entityId:"t_8842", entityLabel:"Trip #8842",
    severity:"info", details:"Departed" },
];

function loadRaw(): LogEntry[] {
  if (typeof window === "undefined") return seed;
  const raw = localStorage.getItem(LS_KEY);
  if (!raw) { localStorage.setItem(LS_KEY, JSON.stringify(seed)); return seed; }
  try { return JSON.parse(raw) as LogEntry[]; } catch { return seed; }
}
function saveRaw(rows: LogEntry[]) {
  if (typeof window === "undefined") return;
  localStorage.setItem(LS_KEY, JSON.stringify(rows));
}

export const LogsRepo = {
  all(): LogEntry[] {
    return loadRaw().slice().sort((a,b)=> (a.timestampISO < b.timestampISO ? 1 : -1));
  },
  append(entry: Omit<LogEntry,"id"|"timestampISO">): LogEntry {
    const rows = loadRaw();
    const rec: LogEntry = { ...entry, id: uid(), timestampISO: nowISO() };
    rows.unshift(rec); saveRaw(rows); return rec;
  },
  remove(id: string) { saveRaw(loadRaw().filter(r => r.id !== id)); },
  clearAll() { saveRaw([]); },
};


===== lib\admin\logs\service.ts =====
import type { LogEntry, LogFilters, ActorType, EntityType, ActionType, Severity } from "./types";

export const LogConstants = {
  actorTypes: ["admin","driver","faculty","system"] as const satisfies readonly ActorType[],
  entityTypes: ["vehicle","request","trip","maintenance","driver","auth","system"] as const satisfies readonly EntityType[],
  actions: ["create","update","delete","status_change","login","logout","export","bulk"] as const satisfies readonly ActionType[],
  severities: ["info","warning","error"] as const satisfies readonly Severity[],
};

export function applyFilters(rows: LogEntry[], f?: LogFilters): LogEntry[] {
  if (!f) return rows;

  const q = (f.search ?? "").toLowerCase().trim();
  const from = f.dateFrom ? new Date(f.dateFrom + "T00:00:00") : null;
  const to = f.dateTo ? new Date(f.dateTo + "T23:59:59") : null;

  return rows.filter(r => {
    const okQ = !q || [
      r.actorName, r.action, r.entityType, r.entityLabel ?? "", r.details ?? "", r.severity, r.ip ?? ""
    ].join(" ").toLowerCase().includes(q);

    const okActor = !f.actorType || r.actorType === f.actorType;
    const okEntity = !f.entityType || r.entityType === f.entityType;
    const okAction = !f.action || r.action === f.action;
    const okSev = !f.severity || r.severity === f.severity;

    const t = new Date(r.timestampISO);
    const okFrom = !from || t >= from;
    const okTo = !to || t <= to;

    return okQ && okActor && okEntity && okAction && okSev && okFrom && okTo;
  });
}


===== lib\admin\logs\types.ts =====
export type ActorType = "admin" | "driver" | "faculty" | "system";
export type EntityType = "vehicle" | "request" | "trip" | "maintenance" | "driver" | "auth" | "system";
export type ActionType = "create" | "update" | "delete" | "status_change" | "login" | "logout" | "export" | "bulk";
export type Severity = "info" | "warning" | "error";

export type LogEntry = {
  id: string;
  timestampISO: string;
  actorType: ActorType;
  actorName: string;
  action: ActionType;
  entityType: EntityType;
  entityId?: string | null;
  entityLabel?: string | null;
  details?: string | null;
  severity: Severity;
  ip?: string | null;
};

export type LogFilters = {
  search?: string;
  actorType?: "" | ActorType;
  entityType?: "" | EntityType;
  action?: "" | ActionType;
  severity?: "" | Severity;
  dateFrom?: string;
  dateTo?: string;
};


===== lib\admin\maintenance\csv.ts =====
import type { Maintenance } from "./types";

export function toCSV(rows: Maintenance[]): string {
  const head = [
    "ID","VehicleCode","Plate","Type","Description","OdometerKm",
    "RequestDate","ServiceDate","Status","Remarks","UpdatedAt"
  ];
  const lines = rows.map(r => [
    r.id, r.vehicleCode, r.plateNo, r.type, r.description, r.odometerKm,
    r.requestDate, r.serviceDate ?? "", r.status, r.remarks ?? "", r.updatedAt
  ].map(x => `"${String(x).replaceAll('"','""')}"`).join(","));
  return [head.join(","), ...lines].join("\n");
}


===== lib\admin\maintenance\handlers.ts =====
import type { Maintenance, MaintFilters } from "./types";
import { MaintRepo } from "./repo";
import { applyFilters, validate } from "./service";
import { toCSV } from "./csv";

export function loadMaintenance(filters?: MaintFilters): Maintenance[] {
  return applyFilters(MaintRepo.all(), filters);
}

export function getMaintenance(id: string): Maintenance | null {
  return MaintRepo.byId(id);
}

export function createMaintenance(data: Omit<Maintenance,"id"|"createdAt"|"updatedAt">): Maintenance {
  const err = validate(data as any);
  if (err) throw new Error(err);
  return MaintRepo.insert(data);
}

export function updateMaintenance(id: string, data: Omit<Maintenance,"id"|"createdAt"|"updatedAt">): Maintenance | null {
  const err = validate(data as any);
  if (err) throw new Error(err);
  return MaintRepo.patch(id, data);
}

export function deleteMaintenance(id: string) {
  MaintRepo.remove(id);
}

export function deleteManyMaintenance(ids: string[]) {
  MaintRepo.bulkRemove(ids);
}

export function exportMaintenanceCSV(rows: Maintenance[]): Blob {
  const csv = toCSV(rows);
  return new Blob([csv], { type: "text/csv;charset=utf-8;" });
}


===== lib\admin\maintenance\repo.ts =====
import type { Maintenance } from "./types";

const LS_KEY = "tl_maintenance_v2";
const nowISO = () => new Date().toISOString();
const uid = () => (globalThis.crypto?.randomUUID?.() ?? `m_${Math.random().toString(36).slice(2)}`);

const seed: Maintenance[] = [
  {
    id: uid(), vehicleId: "v1", vehicleCode: "BUS-01", plateNo: "NAB-1234",
    type: "Preventive", description: "Oil change & tire rotation", odometerKm: 42133,
    requestDate: "2025-09-05", serviceDate: "2025-09-07", status: "completed",
    remarks: "Partner shop", photoUrl: null, createdAt: nowISO(), updatedAt: nowISO()
  },
  {
    id: uid(), vehicleId: "v2", vehicleCode: "VAN-03", plateNo: "XAC-9087",
    type: "Repair", description: "Brake pads replacement", odometerKm: 72810,
    requestDate: "2025-09-10", status: "in-progress",
    remarks: "", photoUrl: null, createdAt: nowISO(), updatedAt: nowISO()
  },
];

function loadRaw(): Maintenance[] {
  if (typeof window === "undefined") return seed;
  const raw = localStorage.getItem(LS_KEY);
  if (!raw) { localStorage.setItem(LS_KEY, JSON.stringify(seed)); return seed; }
  try { return JSON.parse(raw) as Maintenance[]; } catch { return seed; }
}
function saveRaw(rows: Maintenance[]) {
  if (typeof window === "undefined") return;
  localStorage.setItem(LS_KEY, JSON.stringify(rows));
}

export const MaintRepo = {
  all(): Maintenance[] { return loadRaw(); },
  byId(id: string): Maintenance | null { return loadRaw().find(r => r.id === id) ?? null; },
  insert(data: Omit<Maintenance,"id"|"createdAt"|"updatedAt">): Maintenance {
    const rows = loadRaw();
    const rec: Maintenance = { ...data, id: uid(), createdAt: nowISO(), updatedAt: nowISO() };
    rows.unshift(rec); saveRaw(rows); return rec;
  },
  patch(id: string, patch: Partial<Maintenance>): Maintenance | null {
    const rows = loadRaw();
    const i = rows.findIndex(r => r.id === id); if (i < 0) return null;
    rows[i] = { ...rows[i], ...patch, updatedAt: nowISO() };
    saveRaw(rows); return rows[i];
  },
  remove(id: string) { saveRaw(loadRaw().filter(r => r.id !== id)); },
  bulkRemove(ids: string[]) { const set = new Set(ids); saveRaw(loadRaw().filter(r => !set.has(r.id))); }
};


===== lib\admin\maintenance\service.ts =====
import type { Maintenance, MaintFilters, MaintStatus } from "./types";

export const MaintConstants = {
  types: ["Preventive","Repair","Inspection"] as const,
  statuses: ["draft","submitted","acknowledged","in-progress","completed","rejected"] as const satisfies readonly MaintStatus[],
};

export function validate(m: Partial<Maintenance>): string | null {
  if (!m.vehicleCode?.trim()) return "Vehicle code is required.";
  if (!m.plateNo?.trim()) return "Plate number is required.";
  if (!m.type) return "Type is required.";
  if (!m.description?.trim()) return "Description is required.";
  if (typeof m.odometerKm !== "number" || m.odometerKm < 0) return "Odometer must be 0 or more.";
  if (!m.requestDate) return "Request date is required.";
  if (!m.status) return "Status is required.";
  return null;
}

export function applyFilters(rows: Maintenance[], f?: MaintFilters): Maintenance[] {
  if (!f) return rows;
  const q = (f.search ?? "").toLowerCase().trim();
  return rows.filter(r => {
    const okQ = !q || [
      r.vehicleCode, r.plateNo, r.type, r.status, r.description
    ].join(" ").toLowerCase().includes(q);
    const okT = !f.type || r.type === f.type;
    const okS = !f.status || r.status === f.status;
    return okQ && okT && okS;
  });
}


===== lib\admin\maintenance\types.ts =====
export type MaintType = "Preventive" | "Repair" | "Inspection";
export type MaintStatus = "draft" | "submitted" | "acknowledged" | "in-progress" | "completed" | "rejected";

export type Maintenance = {
  id: string;
  vehicleId: string;
  vehicleCode: string;
  plateNo: string;

  type: MaintType;
  description: string;
  odometerKm: number;
  photoUrl?: string | null;

  requestDate: string;   // ISO
  serviceDate?: string;  // ISO
  status: MaintStatus;

  remarks?: string | null;
  createdAt: string;     // ISO
  updatedAt: string;     // ISO
};

export type MaintFilters = {
  search?: string;
  type?: "" | MaintType;
  status?: "" | MaintStatus;
};


===== lib\admin\requests\action.ts =====
// Mock async actions (swap with real API calls later)
export async function approveRequests(ids: string[]) {
  await delay(300);
  return { ok: true, ids };
}
export async function rejectRequests(ids: string[]) {
  await delay(300);
  return { ok: true, ids };
}
export async function deleteRequests(ids: string[]) {
  await delay(300);
  return { ok: true, ids };
}
function delay(ms: number) {
  return new Promise((res) => setTimeout(res, ms));
}


===== lib\admin\requests\data.ts =====
import type {
  RequestRow,
  TripLogRow,
  DashboardData,
} from "@/lib/admin/types";

/** Mock Requests used by Admin Requests page (safe to remove once connected to API) */
export const REQUESTS: RequestRow[] = [
  {
    id: "RQ-1021",
    dept: "CCMS",
    purpose: "Seminar",
    date: "2025-09-10",
    status: "Pending",
    requester: "Prof. Santos",
    vehicle: "Van 12",
    driver: "Dela Cruz",
    receivedAt: "2025-09-04 10:15 AM",
  },
  {
    id: "RQ-1019",
    dept: "HR",
    purpose: "Orientation",
    date: "2025-09-12",
    status: "Approved",
    requester: "HR Office",
    vehicle: "Bus 07",
    driver: "S. Reyes",
    receivedAt: "2025-09-05 3:40 PM",
  },
  {
    id: "RQ-1017",
    dept: "Registrar",
    purpose: "Enrollment Support",
    date: "2025-09-08",
    status: "Completed",
    requester: "Registrar",
    vehicle: "Car 05",
    driver: "A. Cruz",
    receivedAt: "2025-09-03 8:50 AM",
  },
  {
    id: "RQ-1016",
    dept: "Finance",
    purpose: "Audit Trip",
    date: "2025-09-09",
    status: "Rejected",
    requester: "Cashier",
    vehicle: "Van 03",
    driver: "B. Santos",
    receivedAt: "2025-09-04 11:20 AM",
  },
  {
    id: "RQ-1015",
    dept: "CCMS",
    purpose: "Training",
    date: "2025-09-06",
    status: "Approved",
    requester: "Dept Chair",
    vehicle: "Van 15",
    driver: "K. Dizon",
    receivedAt: "2025-09-02 9:10 AM",
  },
  {
    id: "RQ-1014",
    dept: "Finance",
    purpose: "Document Delivery",
    date: "2025-09-05",
    status: "Pending",
    requester: "Treasury",
    vehicle: "Car 02",
    driver: "M. Cruz",
    receivedAt: "2025-09-01 1:45 PM",
  },
];

/** Mock Trip logs (optional for dashboard) */
export const TRIPS: TripLogRow[] = [
  {
    id: "TRIP-201",
    vehicle: "Bus 12",
    driver: "Dela Cruz",
    department: "CCMS",
    date: "2025-09-10",
    distanceKm: 12.4,
  },
  {
    id: "TRIP-202",
    vehicle: "Van 07",
    driver: "S. Reyes",
    department: "HR",
    date: "2025-09-12",
    distanceKm: 7.8,
  },
];

/** Example dashboard aggregate using the mocks above */
export const DASHBOARD_DATA: DashboardData = {
  kpis: [
    { label: "Pending Requests", value: REQUESTS.filter(r => r.status === "Pending").length },
    { label: "Approved", value: REQUESTS.filter(r => r.status === "Approved").length },
    { label: "Completed", value: REQUESTS.filter(r => r.status === "Completed").length },
    { label: "Rejected", value: REQUESTS.filter(r => r.status === "Rejected").length },
  ],
  requestsByDay: [
    { date: "2025-09-01", count: 1 },
    { date: "2025-09-02", count: 1 },
    { date: "2025-09-03", count: 1 },
    { date: "2025-09-04", count: 2 },
    { date: "2025-09-05", count: 2 },
    { date: "2025-09-06", count: 1 },
    { date: "2025-09-08", count: 1 },
    { date: "2025-09-09", count: 1 },
    { date: "2025-09-10", count: 1 },
    { date: "2025-09-12", count: 1 },
  ],
  statusBreakdown: [
    { status: "Pending", count: REQUESTS.filter(r => r.status === "Pending").length },
    { status: "Approved", count: REQUESTS.filter(r => r.status === "Approved").length },
    { status: "Completed", count: REQUESTS.filter(r => r.status === "Completed").length },
    { status: "Rejected", count: REQUESTS.filter(r => r.status === "Rejected").length },
  ],
  utilization: [
    { label: "Bus", percent: 35 },
    { label: "Van", percent: 50 },
    { label: "Car", percent: 15 },
  ],
  deptUsage: [
    { dept: "CCMS", count: REQUESTS.filter(r => r.dept === "CCMS").length },
    { dept: "HR", count: REQUESTS.filter(r => r.dept === "HR").length },
    { dept: "Registrar", count: REQUESTS.filter(r => r.dept === "Registrar").length },
    { dept: "Finance", count: REQUESTS.filter(r => r.dept === "Finance").length },
  ],
  recentRequests: REQUESTS.slice(0, 5),
  recentTrips: TRIPS,
};


===== lib\admin\schedule\filters.ts =====
// src/lib/admin/schedule/filters.ts
import type { Schedule } from "./types";
import { ScheduleRepo } from "./store";

export type ScheduleFilterState = {
  status: "All" | "PLANNED" | "ONGOING" | "COMPLETED" | "CANCELLED";
  driver: "All" | string;   // driverId
  vehicle: "All" | string;  // vehicleId
  from: "" | string;        // yyyy-mm-dd
  to: "" | string;          // yyyy-mm-dd
  search: string;           // free text
  mode: "auto" | "apply";
};

export const DEFAULT_SCH_FILTERS: ScheduleFilterState = {
  status: "All",
  driver: "All",
  vehicle: "All",
  from: "",
  to: "",
  search: "",
  mode: "auto",
};

export function filterSchedules(
  rows: Schedule[],
  f: ScheduleFilterState
): Schedule[] {
  const q = (f.search ?? "").toLowerCase().trim();

  // map driverId -> driver name (lowercase) for search
  const driverNameById: Record<string, string> = Object.fromEntries(
    ScheduleRepo.constants.drivers.map((d) => [d.id, d.name.toLowerCase()])
  );

  return (rows ?? []).filter((r) => {
    const okStatus = f.status === "All" || r.status === f.status;
    const okDriver = f.driver === "All" || r.driverId === f.driver;
    const okVehicle = f.vehicle === "All" || r.vehicleId === f.vehicle;
    const okFrom = !f.from || r.date >= f.from;
    const okTo = !f.to || r.date <= f.to;

    const driverName = driverNameById[r.driverId] ?? "";
    const okSearch =
      !q ||
      [r.tripId, r.title, r.origin, r.destination, driverName].some((s) =>
        (s ?? "").toLowerCase().includes(q)
      );

    return okStatus && okDriver && okVehicle && okFrom && okTo && okSearch;
  });
}


===== lib\admin\schedule\stats.ts =====
// src/lib/admin/schedule/stats.ts
import type { Schedule } from "./types";
import { ScheduleRepo } from "./store";

export type Kpi = { key: string; label: string; value: string; sub?: string };

const yyyy_mm_dd = (d: Date) => d.toISOString().slice(0, 10);

export function computeKpis(rows: Schedule[], now = new Date()): Kpi[] {
  const todayStr = yyyy_mm_dd(now);
  const msDay = 86400000;

  const startOfToday = new Date(todayStr + "T00:00:00");
  const endOfToday = new Date(startOfToday.getTime() + msDay - 1);

  const inRange = (d: string, from: Date, to: Date) =>
    new Date(d + "T12:00:00").getTime() >= from.getTime() &&
    new Date(d + "T12:00:00").getTime() <= to.getTime();

  const day = now.getDay();
  const startOfWeek = new Date(startOfToday.getTime() - day * msDay);
  const endOfWeek = new Date(startOfWeek.getTime() + 6 * msDay);

  const next7Start = startOfToday;
  const next7End = new Date(startOfToday.getTime() + 6 * msDay);

  const drivers = ScheduleRepo.constants.drivers;

  const totalWeek = rows.filter(r => inRange(r.date, startOfWeek, endOfWeek)).length;
  const today = rows.filter(r => r.date === todayStr).length;

  const ongoingNow = rows.filter(r => {
    if (r.date !== todayStr) return false;
    const s = new Date(`${r.date}T${r.startTime}:00`);
    const e = new Date(`${r.date}T${r.endTime}:00`);
    return now >= s && now <= e && r.status !== "CANCELLED";
  }).length;

  const last7Start = new Date(startOfToday.getTime() - 6 * msDay);
  const last7 = rows.filter(r => inRange(r.date, last7Start, endOfToday));
  const completed7 = last7.filter(r => r.status === "COMPLETED").length;
  const completionRate7 = last7.length ? Math.round((completed7 / last7.length) * 100) : 0;

  const upcoming7 = rows.filter(r => inRange(r.date, next7Start, next7End)).length;

  const scheduledDriverIds = new Set(
    rows.filter(r => inRange(r.date, next7Start, next7End)).map(r => r.driverId)
  );
  const driverUtil = drivers.length ? Math.round((scheduledDriverIds.size / drivers.length) * 100) : 0;

  return [
    { key: "wk_total", label: "This Week (total)", value: String(totalWeek) },
    { key: "today", label: "Today", value: String(today), sub: `${ongoingNow} ongoing now` },
    { key: "completion", label: "Completion Rate (7d)", value: `${completionRate7}%`, sub: `${completed7}/${last7.length || 0} done` },
    { key: "upcoming", label: "Upcoming (7d)", value: String(upcoming7) },
    { key: "util", label: "Driver Utilization (7d)", value: `${driverUtil}%`, sub: `${scheduledDriverIds.size}/${drivers.length} drivers` },
  ];
}


===== lib\admin\schedule\store.ts =====
import { Schedule, ScheduleStatus, Driver, Vehicle } from "./types";

/* ---------- storage guards ---------- */
const KEY = "travilink.schedules.v1";
const KEY_SEQ = "travilink.schedules.seq.v1"; // per-day counters
const isBrowser = typeof window !== "undefined" && !!globalThis.window?.localStorage;
let MEM: Schedule[] | null = null;
let MEM_SEQ: Record<string, number> | null = null;

function readSeq(): Record<string, number> {
  if (isBrowser) {
    const raw = window.localStorage.getItem(KEY_SEQ);
    return raw ? JSON.parse(raw) : {};
  }
  return MEM_SEQ ?? (MEM_SEQ = {});
}
function writeSeq(seq: Record<string, number>) {
  if (isBrowser) window.localStorage.setItem(KEY_SEQ, JSON.stringify(seq));
  else MEM_SEQ = seq;
}

/* ---------- Trip ID helpers ---------- */
// TRIP-YYYYMMDD-0001 (per day incremental)
function fmtTripId(date: string, n: number) {
  const d = date.replaceAll("-", "");
  return `TRIP-${d}-${String(n).padStart(4, "0")}`;
}
/** Reserve and return the next Trip ID for a given date. */
function allocateTripId(date: string) {
  const seq = readSeq();
  const cur = seq[date] ?? 0;
  const next = cur + 1;
  seq[date] = next;
  writeSeq(seq);
  return fmtTripId(date, next);
}
/** Peek next Trip ID (no increment) for preview. */
function peekTripId(date: string) {
  const seq = readSeq();
  const next = (seq[date] ?? 0) + 1;
  return fmtTripId(date, next);
}

/* ---------- seed data ---------- */
const drivers: Driver[] = [
  { id: "d1", name: "Juan Dela Cruz" },
  { id: "d2", name: "Maria Santos" },
  { id: "d3", name: "Roberto Reyes" },
];

const vehicles: Vehicle[] = [
  { id: "v1", label: "Toyota HiAce", plateNo: "ABC-1234" },
  { id: "v2", label: "Hyundai County", plateNo: "XYZ-5678" },
  { id: "v3", label: "Mitsubishi L300", plateNo: "MSE-2025" },
];

function seed(): Schedule[] {
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const plus = (n: number) => new Date(today.getTime() + n * 86400000);
  const d = (dt: Date) => dt.toISOString().slice(0, 10);

  const base: Omit<Schedule, "id" | "createdAt" | "tripId">[] = [
    {
      title: "Faculty Meeting Trip",
      origin: "Main Campus",
      destination: "CTE Building",
      date: d(today),
      startTime: "08:00",
      endTime: "09:00",
      driverId: "d1",
      vehicleId: "v1",
      status: "PLANNED",
      notes: "Bring projector",
      requestId: null,
    },
    {
      title: "Library Books Transfer",
      origin: "Library",
      destination: "Archive",
      date: d(plus(1)),
      startTime: "10:00",
      endTime: "11:30",
      driverId: "d2",
      vehicleId: "v2",
      status: "PLANNED",
      requestId: null,
      notes: "",
    },
    {
      title: "Shuttle – Event",
      origin: "Gate 1",
      destination: "Gym",
      date: d(plus(-1)),
      startTime: "14:00",
      endTime: "16:00",
      driverId: "d3",
      vehicleId: "v3",
      status: "COMPLETED",
      requestId: null,
      notes: "",
    },
  ];

  const rows: Schedule[] = base.map((b, i) => ({
    ...b,
    id: `s${i + 1}`,
    tripId: allocateTripId(b.date),
    createdAt: now.toISOString(),
  }));

  if (isBrowser) window.localStorage.setItem(KEY, JSON.stringify(rows));
  else MEM = rows;

  return rows;
}

function readAll(): Schedule[] {
  if (isBrowser) {
    const raw = window.localStorage.getItem(KEY);
    const parsed: Schedule[] | null = raw ? JSON.parse(raw) : null;
    const rows = parsed ?? seed();
    return backfillTripIds(rows);
  }
  const rows = MEM ?? seed();
  return backfillTripIds(rows);
}

function writeAll(rows: Schedule[]) {
  if (isBrowser) window.localStorage.setItem(KEY, JSON.stringify(rows));
  else MEM = rows;
}

/* Backfill missing tripId for legacy rows */
function backfillTripIds(rows: Schedule[]) {
  let changed = false;
  const out = rows.map((r) => {
    if (!r.tripId) {
      changed = true;
      return { ...r, tripId: allocateTripId(r.date) };
    }
    return r;
  });
  if (changed) writeAll(out);
  return out;
}

/* ---------- conflict helpers (local) ---------- */
function overlaps(a: { date: string; startTime: string; endTime: string },
                  b: { date: string; startTime: string; endTime: string }) {
  if (a.date !== b.date) return false;
  const aS = a.date + "T" + a.startTime + ":00";
  const aE = a.date + "T" + a.endTime + ":00";
  const bS = b.date + "T" + b.startTime + ":00";
  const bE = b.date + "T" + b.endTime + ":00";
  return !(aE <= bS || bE <= aS);
}
function findConflicts(rows: Schedule[], probe: Schedule, ignoreId?: string) {
  const driver = rows.filter(
    (r) =>
      r.status !== "CANCELLED" &&
      r.id !== ignoreId &&
      r.driverId === probe.driverId &&
      overlaps(r, probe)
  );
  const vehicle = rows.filter(
    (r) =>
      r.status !== "CANCELLED" &&
      r.id !== ignoreId &&
      r.vehicleId === probe.vehicleId &&
      overlaps(r, probe)
  );
  return { driver, vehicle };
}

/* ---------- repo ---------- */
export const ScheduleRepo = {
  list(): Schedule[] {
    return readAll();
  },
  get(id: string): Schedule | undefined {
    return readAll().find((r) => r.id === id);
  },
  /** show the next Trip ID for a date without consuming it */
  peekTripId(date: string) {
    return peekTripId(date);
  },
  create(input: Omit<Schedule, "id" | "createdAt" | "tripId">): Schedule {
    const rows = readAll();
    const id =
      (globalThis.crypto?.randomUUID?.() ?? String(Date.now() + Math.random())).toString();
    const rec: Schedule = {
      ...input,
      id,
      tripId: allocateTripId(input.date), // 👈 assign immutable Trip ID
      createdAt: new Date().toISOString(),
    };

    const { driver, vehicle } = findConflicts(rows, rec);
    if (driver.length || vehicle.length) {
      const d = driver[0];
      const v = vehicle[0];
      const msg = [
        d ? `Driver busy with ${d.title || "another schedule"} (${d.date} ${d.startTime}-${d.endTime})` : "",
        v ? `Vehicle busy with ${v.title || "another schedule"} (${v.date} ${v.startTime}-${v.endTime})` : "",
      ]
        .filter(Boolean)
        .join(" • ");
      throw new Error(msg || "Conflict");
    }

    rows.unshift(rec);
    writeAll(rows);
    return rec;
  },
  update(id: string, patch: Partial<Schedule>): Schedule | undefined {
    const rows = readAll();
    const idx = rows.findIndex((r) => r.id === id);
    if (idx < 0) return;

    const prev = rows[idx];
    // tripId is immutable; ignore attempts to change it
    const { tripId: _ignore, ...patchSafe } = patch as any;
    const next = { ...prev, ...patchSafe } as Schedule;

    // only validate when changing assignment/time
    const touchesAssignment =
      (patchSafe.date && patchSafe.date !== prev.date) ||
      (patchSafe.startTime && patchSafe.startTime !== prev.startTime) ||
      (patchSafe.endTime && patchSafe.endTime !== prev.endTime) ||
      (patchSafe.driverId && patchSafe.driverId !== prev.driverId) ||
      (patchSafe.vehicleId && patchSafe.vehicleId !== prev.vehicleId);

    if (touchesAssignment) {
      const { driver, vehicle } = findConflicts(rows, next, id);
      if (driver.length || vehicle.length) {
        const d = driver[0];
        const v = vehicle[0];
        const msg = [
          d ? `Driver busy with ${d.title || "another schedule"} (${d.date} ${d.startTime}-${d.endTime})` : "",
          v ? `Vehicle busy with ${v.title || "another schedule"} (${v.date} ${v.startTime}-${v.endTime})` : "",
        ]
          .filter(Boolean)
          .join(" • ");
        throw new Error(msg || "Conflict");
      }
    }

    rows[idx] = next;
    writeAll(rows);
    return rows[idx];
  },
  removeMany(ids: string[]) {
    const set = new Set(ids);
    writeAll(readAll().filter((r) => !set.has(r.id)));
  },
  setStatus(id: string, status: ScheduleStatus) {
    return this.update(id, { status });
  },

  constants: {
    drivers,
    vehicles,
    statuses: ["PLANNED", "ONGOING", "COMPLETED", "CANCELLED"] as ScheduleStatus[],
  },
};


===== lib\admin\schedule\types.ts =====
// src/lib/admin/schedule/types.ts
export type ScheduleStatus = "PLANNED" | "ONGOING" | "COMPLETED" | "CANCELLED";
export type GeoPoint = { lat: number; lng: number };
export type PlaceRef = { address: string; placeId?: string | null; coords?: GeoPoint | null };
export type Driver = { id: string; name: string };
export type Vehicle = { id: string; label: string; plateNo: string };

export type Schedule = {
  id: string;
  tripId: string;          // 👈 NEW, immutable identifier like TRIP-20250916-0001
  requestId?: string | null;
  title: string;
  origin: string;
  destination: string;
  date: string;            // yyyy-mm-dd
  startTime: string;       // HH:mm
  endTime: string;         // HH:mm
  driverId: string;
  vehicleId: string;
  status: ScheduleStatus;
  notes?: string;
  createdAt: string;  
  originPlace?: PlaceRef | null;
  destinationPlace?: PlaceRef | null; 
};

export type ScheduleFilters = {
  q: string;
  status: ScheduleStatus | "ALL";
  dateFrom?: string | null;
  dateTo?: string | null;
  driverId?: string | "ALL";
  vehicleId?: string | "ALL";
};

export type Pagination = { page: number; pageSize: number; total: number };


===== lib\admin\schedule\utils.ts =====
// src/lib/admin/schedule/utils.ts
import type { Schedule, ScheduleFilters } from "./types";

/* -------- filters/sort/paginate ---------- */
export function applyFilters(rows: Schedule[], f: ScheduleFilters): Schedule[] {
  const q = f.q.trim().toLowerCase();
  return rows.filter((r) => {
    const qok =
      !q ||
      [r.tripId, r.title, r.origin, r.destination].some((s) =>
        s.toLowerCase().includes(q)
      );
    const sok = f.status === "ALL" || r.status === f.status;
    const dok1 = !f.dateFrom || r.date >= f.dateFrom;
    const dok2 = !f.dateTo || r.date <= f.dateTo;
    const dr = !f.driverId || f.driverId === "ALL" || r.driverId === f.driverId;
    const vh = !f.vehicleId || f.vehicleId === "ALL" || r.vehicleId === f.vehicleId;
    return qok && sok && dok1 && dok2 && dr && vh;
  });
}


export function sortByDateTime(rows: Schedule[], dir: "asc" | "desc") {
  const k = dir === "asc" ? 1 : -1;
  return [...rows].sort((a, b) => (a.date + a.startTime).localeCompare(b.date + b.startTime) * k);
}

export function paginate<T>(rows: T[], page: number, pageSize: number) {
  const start = (page - 1) * pageSize;
  const end = start + pageSize;
  return rows.slice(start, end);
}

/* -------- status guards & transitions ---------- */
export function canStart(r: Schedule)    { return r.status === "PLANNED"; }
export function canComplete(r: Schedule) { return r.status === "ONGOING"; }
export function canCancel(r: Schedule)   { return r.status === "PLANNED" || r.status === "ONGOING"; }
export function canReopen(r: Schedule)   { return r.status === "COMPLETED" || r.status === "CANCELLED"; }

/* -------- overlap & availability ---------- */
export function overlaps(a: {date:string; startTime:string; endTime:string},
                         b: {date:string; startTime:string; endTime:string}) {
  if (a.date !== b.date) return false;
  const aS = a.date + "T" + a.startTime + ":00";
  const aE = a.date + "T" + a.endTime   + ":00";
  const bS = b.date + "T" + b.startTime + ":00";
  const bE = b.date + "T" + b.endTime   + ":00";
  return !(aE <= bS || bE <= aS);
}


export function conflictsForDriver(rows: Schedule[], driverId: string, probe: Schedule, ignoreId?: string) {
  return rows.filter(r =>
    r.driverId === driverId &&
    r.id !== ignoreId &&
    r.status !== "CANCELLED" &&
    overlaps(r, probe)
  );
}
export function conflictsForVehicle(rows: Schedule[], vehicleId: string, probe: Schedule, ignoreId?: string) {
  return rows.filter(r =>
    r.vehicleId === vehicleId &&
    r.id !== ignoreId &&
    r.status !== "CANCELLED" &&
    overlaps(r, probe)
  );
}
export function isDriverAvailable(rows: Schedule[], driverId: string, probe: Schedule, ignoreId?: string) {
  return conflictsForDriver(rows, driverId, probe, ignoreId).length === 0;
}
export function isVehicleAvailable(rows: Schedule[], vehicleId: string, probe: Schedule, ignoreId?: string) {
  return conflictsForVehicle(rows, vehicleId, probe, ignoreId).length === 0;
}


===== lib\admin\vehicles\data.ts =====
import type { Vehicle } from "./types";

/** Optional extras some UIs use (safe to ignore elsewhere). */
export type VehicleExtra = {
  photoUrl?: string;
  assignedDriver?: string;
  lastCheckIn?: string;   // e.g. "08:30pm (12/02/24)"
  maxLoadKg?: number;
  nextServiceISO?: string;
  notes?: string;
};

// You can freely change images; these are Unsplash CDN placeholders.
export const sampleVehicles: Array<Vehicle & VehicleExtra> = [
  {
    id: "1",
    plateNo: "ABC-1234",
    code: "BUS-01",
    brand: "Isuzu",
    model: "LV123",
    type: "Bus",
    capacity: 45,
    status: "active",
    odometerKm: 102_345,
    lastServiceISO: "2025-08-10",
    nextServiceISO: "2026-02-10",
    notes: "",
    createdAt: "2025-08-01",
    updatedAt: "2025-09-01",
    photoUrl: "https://d1hv7ee95zft1i.cloudfront.net/custom/truck-model-photo/gallery/isuzu-buses-lv123-62ac067fee67a.jpg",
    assignedDriver: "Guy Hawkins",
    lastCheckIn: "08:30pm (12/02/24)",
    maxLoadKg: 22090,
  },
  {
    id: "2",
    plateNo: "VAN-5678",
    code: "VAN-24",
    brand: "Ford",
    model: "Transit 2024",
    type: "Van",
    capacity: 12,
    status: "active",
    odometerKm: 56_210,
    lastServiceISO: "2025-07-15",
    nextServiceISO: "2026-01-15",
    notes: "New tires July.",
    createdAt: "2025-05-12",
    updatedAt: "2025-09-01",
    photoUrl: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSPMuOaBJgzUzaSVTWRPdfs0W0-3v4_nfDJc9uIYsO6WVNv2TpddypmhX7688Ge2wlukwMOkT4gw5wHFLjoXWRF0f05basjde4IfU_bnw",
    assignedDriver: "Bessie Cooper",
    lastCheckIn: "07:10am (09/05/25)",
    maxLoadKg: 1800,
  },
  {
    id: "3",
    plateNo: "CAR-9087",
    code: "CAR-11",
    brand: "Toyota",
    model: "Vios",
    type: "Car",
    capacity: 5,
    status: "maintenance",
    odometerKm: 88_450,
    lastServiceISO: "2025-09-10",
    nextServiceISO: "2026-03-10",
    notes: "Brake pads replacement in progress.",
    createdAt: "2024-12-04",
    updatedAt: "2025-09-12",
    photoUrl: "https://images.unsplash.com/photo-1503376780353-7e6692767b70?q=80&w=1600&auto=format&fit=crop",
  },
  {
    id: "4",
    plateNo: "SUV-4321",
    code: "SUV-07",
    brand: "Mitsubishi",
    model: "Montero",
    type: "SUV",
    capacity: 7,
    status: "active",
    odometerKm: 34_980,
    lastServiceISO: "2025-06-20",
    nextServiceISO: "2025-12-20",
    notes: "",
    createdAt: "2025-01-09",
    updatedAt: "2025-09-03",
    photoUrl: "https://img.philkotse.com/crop/640x360/2020/08/05/f3xu3v8D/mitsubishi-montero-sport-rex-sanchez-06182020-a3b3.jpg",
  },
  {
    id: "5",
    plateNo: "MCY-2211",
    code: "MOTO-02",
    brand: "Honda",
    model: "Click 150i",
    type: "Motorcycle",
    capacity: 1,
    status: "inactive",
    odometerKm: 12_340,
    lastServiceISO: "2025-03-01",
    nextServiceISO: "2025-09-01",
    notes: "Temporarily decommissioned.",
    createdAt: "2023-11-22",
    updatedAt: "2025-08-15",
    photoUrl: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxQSEhMTExMVFhUWFxgaFxgXGBgXHRYWGBgYGBkaGh4YHyggHh4mHxcYIjEhJSkrLi4vGB8zODMtNygtLisBCgoKDg0OFxAQFy0dHR0rKy0tKy0tKy0wLS0rLSstLSstMCstLS4tKysrLS0tKy0rLS0tKy0tLTUtKystMCsrL//AABEIANkA6AMBIgACEQEDEQH/xAAcAAEAAgMBAQEAAAAAAAAAAAAABgcDBQgEAgH/xABGEAACAQMBBQYCBggDBwQDAAABAgMABBEhBRIxQVEGBxMiYXEygUJSYpGhsRQjM3KCwdHwFaKyJENTkrPh8QgWY8JEc6P/xAAXAQEBAQEAAAAAAAAAAAAAAAAAAQID/8QAHxEBAQEBAAEEAwAAAAAAAAAAAAERIQISQWHwAzFx/9oADAMBAAIRAxEAPwC8aUpQKUpQKUpQKUpQKUpQKUpQKUpQKVjnmVFZ3YKqglmJwABqST0qLL3iWRPxSY6lDg+tBLaVr9k7bgugTDIr4xkDQjPDINbCgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSg8m1rBLiGWCQZSVGRvZgQfnrXMFybiyuJLaXO9GxBznzD6LDPIjUEcc11VUc7Zdi7baUYWZSsig+HKmjp6eq/ZOnz1oKU2P2na3kSeP404DlIv0oz6MBj0IVvo10RZ3AkjSQAgOqsAdCAwB19darzZfczZJ+2knn0xgsI11//WAx+bEVLuyl2zRNBKczWz+DIfr4AaOThjzxsjHGgJYcqDd0pSg1faPbsVlA00xwoOFGcbzHOFGfYn2BquNjdu7mefeEi+GxwFAUqvsfQVKu9LsyNoWiQ+J4cglBi0yHfdZd0jpuljnlu54A1A+zndrcwXWEjMUS4BZ3Uh90Eb+FYnLZbQDAyByoLc2NfmVTvAZHStjXk2ZYLCgQaniT1NeugUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgVHdnyY2peJprb2r/PfuVP4Kv4VIScVTW1O18Fj2gubh3LxNaoh8Lz4cMgweA0wefMUFzUqpNp95U9wxSzQoMHXdDuQOONSM/ZCk9DWst+1Vw7BnmfeGmN4gEjQ8D5W/n04VcFoiTf2ky8oLVWHQNcSOM++Lf8T1Nb2oB2Ru40uLm5lui7TLEGDcI/DDDUqoA0OvTdYk8anysCMg5B4EVB+0pSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgiveB22j2XEjuhkeQkIgyAd3BfLYIBwdAeP3kQ2bvm3/2EAb2Ekp4Z4KB7Val9Yxzo0c0aSI3FXUMD7g19xwKi4RFGBoFAUeg04UHOHbrtpd3LxrJHNGQARGUeIMpOMhGOW1BGfQ9Ki5ti/iNMJFwPLhosJk5AYHXXGNDmri7Ydl7y9t0uboyQzedWih3XFunm8M/qlZ5F3wu9unO6+ceXFVLtDY3hJKS3ljl3V/WQYf1x4iuWBxwThqccKDJb7WNnl0Jkhcg7rNgqSWyUxkEZDA+2vCt9bdqbS5+MmKTTDOAMjoWGjD97GmcYqAXkxGm6Nw53MgndGScKSTnGTz/GvJFbu2qjPzFBdFhclXVlI6ZHmWQdCQemmuo+QNT/AGN2qt7ZYoriUJvlxGWzu4UjBJ+iCroRn151QXY7YjeIGmuZLWMEfswXd9dcAHdAxxLHmMK2uLdu+zuzryKIFrljGpUShk32UneO8oG4enlAPLlpRaiMCAQQQdQRrkV+1DuyT3EbrGpW4tW3j4294bW26qhITCRnGnHJ+InTTMxqBSlKBSlKBSlKBSlKDXdoIWeB1XiccCFJAIJAJ0yfWquvzISfBubhGQkMgcowblkN+WmRwI41P+3bzR23jw4LQtvspG8HTBVsjjoDnI6Gopb2sV/CtygKsQQdxsvGykggFhqOe6wI19jU9XcdL+O+iefteNLsjtntFWWPfEj6DclUcTyLHdI48Sca1KbLvI3HEd5avE31oysqn1yhIHtkn0qFbSlMDqk+MkEJKoKg9RrqjcDuEnjoW41rru4lTzACVOoHmHuBx9x9wqua9dmbbt7j9lKjHpnDD3U6/hWwrnW22tG2CPKeRB/nW7tu01zH8FxJj1bfH3NkUF30qprXvFul+IRyD1UqfvUgfhUg2X3kxOQJ4mi+0p8RR76Bh8gaCc0rDaXSSqHjdXU8CpBH4VmoFKUoFKUoFVd3wWRiaK8Kb8DL4FwpJwAWzGxxwGSRvDUHcPKrRry7VtEmhlikTxEdGVk08wI4DJGvTUUHNi7OW03XjLtbyNnOSreqNunyuMctDjIyDW8uuzkc2JIyswYA+YYdfTxI/MMa6MGBzxxUJ2raXFs7I8dzChZhGs6su8isd3lusQMZK6ZOnGvvZe3ZYGDxu0bdVJHuNOVdMnl8X79+4ztn8SBtglWAilMbn/dT4Kt+5IDun+9eVZ4b2a1bEitC3U6qehydPYn8azWHbKKRPDuIFYsQWkBOXA08y/CTz3l3SCAAtSGKyYx79o63NvzgmJzGeaq/xIeWuM825VnLOVWfYO3LiRy0TRCZRnVSPGUalHAbXIzhgMg++li9ne0cd2CMGOZP2kTfEvqPrL0YfgdKqSLY0LtiF3tJuIhlHlOMZKMuBjlvJgDiQ1bM3UkbIL0NBIv7K7QggH9/4XXlutgkcQBUFxUqM7B7RszLDchVkIzHKh/V3AAySmdQ2NSnEanhUmqKUpSgUpSgUpUF7f8AeTb7O34Blrrw8ou7lVZgdwvqNOeFzw5ZoJxIgYEEAgjBB4EHiDVVyWP+C3e6W/2G6b9WzH9hMBkIx6EZAboBn4STAj3p3m8Ge7kOTqiRxgY6aYP3ZNZ9td5P6bayW8kTFWGm9v5DDVSGO9nBA6Z1GmaLq09s7IgvIzHMvH6S6EHkRUP/APbMNo6LLJcspZgBvx53RjDAiPAGuMMR7jhUd7BdujbkW12T4XBJDqYuit1T1+j+78Ns3KiVABg6qy4I1wQdDyyODAjjxrM4jQz929jdK7QTTRzcySDuty8SMqp166EjgagW3uzt7s8kzIWjHCaPLRkevND6MB6E1YFkrKxCt5lfOu+JUUkvIQMeYk4wgwnDIbSpFsLtF4wKyKQdASQuDnICtukpvaYKg5B4quRnQpK12qp417hMp4VPu1PdhbXGZLUi2lOuAMxMfVR8Puv3Gqo2zsu6sH3LhCvRhqjezf1xTRJdn7YkgO9FI6Hnunj7jgfnUite8u4UYYRv6lSD/lIH4VWUe0SeNZhdg86ItJe9VxxgT5Mw/kayw96wJ1txj0kP81qp2uKwtLRXRWwu19vdEICUc8FfAyfskaH241IK5q2RtD6JOvI1cfYrtOZAsMzZbgjn6X2W+10PP341Eyr5ZgOJArzbTuWjjLKoZsgAE4GT1OD+RqHjaMkbkTZZWJOeJXqVOBvL1XGRrjiqmKife72au76+QwIrRCBBvmRFAcPJkHJznBHAHjUWsu6a7P7W4gQdF35D+Sj8augKrAENx4Eag15L6wZsYZ1KnIKHHpqDoRjkf6Vi2rxTe2+6y7gG9butyuNVUeHIOuEYkN/CxPpUe2T2hurGXK7ysmjKwII+yynUexGPSr48WdPiCyrpqPI/EA5GN06HPlx8OPpaartNsOPaMe8EIuIshPEUoW0B8NifonIKtwB/iFWeRjHY7Yhu4UaRFZWAOUwcHqY2OhHVWz6V+tZyKrfo0omj+lDIc6fxaj+MfxVAINgyEsYm3SpIYYZSGGRg4wcggg5Gle+KPaEQDlWbdPxLlsHn5kGV/iWtajcbO7QLE5gkVlQkEwvlWjI4PE3EEcQVPLSrX7N7TEsekgkA0DDAJ6bwHBvbQ8RjOBR192iW4Tw7uJX6OfKynqHTQe5APrWw7AbcNveRqz5jkIXeOBvKT5WONAytjP389KL6pX4DX7UClKUCtP2isbNo2mvIIJFjUktLGjkKOQ3gefAdTWfb22EtYjI4J5Ko4s3T096517yO3d5c+JbyOogJVgiqo1HAb3xEA668wDQR3a1zDLdyNAm4paRsDGBvOWCqBoAoO6MaYA6VikuAo5ljwXmelaID3q4u5Hu9MzLtC6T9WpzboR8bg/tD9kcup14DUJft/umgksY1gQJdxxDDg4E0gALCTrk5wfo5HIYquuyPa2bZ0htbpH8JW3WUjzwNzwOa8yvzXoek6iHb3sFDtJN7IiuFGFlC5yPquMjeXprkcuYIeG8kieJZ8eIgAYNHljucd5d3VhwOBrjgCRivFFCsirMjpJGpBRk8wIGFJbBwSq5046cuFfnY7sfd7MEscs0UtsfMhBZWjfPm8rDAVs50bQjONSa9O0tiJIzSQTNbTt/vIiMOcaeLGfJJ89fWks/VMe3YV4QNwlnA+mTvAZ1A3j5iDx541GdNNhtOyjuI2jlUMp6409Rn/wAHnmoI7bRt23poEnXXM1npJjq8LY3ydMhQOHE8Kkew+0cc3l3t4jAOEZWVvqumpXlqcDWr5eFnZ2fBKqft92Naw/WoS0bOFAwTjIJyDyGmCp5kYODgQs3mOOR8jXUl7aJNG0cih0cYZTqCDVA94fYGSwYyxbz2rHQ8WiJ4K/p0b5HXGcSqjAvvtV9ren61aomvnFVG9XaZXUYzUv7N9ovMFcaZGMdaraAqrKSMgEEjqAdRUzi2IWdmiRvCJ3l3YzukfEDvb/Dhy4aVqI6EsLr9MsX3s5GVJI1yuGB158PnWhNwygpMhcAEhh9kZ1J4Hoc54cfiqbbIiZbeFZNXESB+eWCgN+OahV3bfo8skMBWQIoZrVmAIjfO6YWbQLxG43kyMAoOMqskAaMeXcwo8ygnUDmWOF3sDoOABOgrSba7zrO2yqubhx9GLBUH1c+X7s1qNv2ybRiNmkrxSgh0inDxOGH0JFIIlQj6S7xUhTqCa0Vh3UuD+tkBx9XIH9az5TL0iS2ne5aSftIJU64KNj8Qa3Vn222dLwuRGekqsg+8jd/GtZsjsVHD8IyfYVn25bWFou9evCmdQm4ryN+6gBPz4dTWd32VtNrbLMqm5tNyZjjfCOCJANAwION8DAP1gF5jXU2+044huzJJA4/4qsgyeODwOvOoHJ3oRWrt/hljFFvY3pJR55AOGViKhdeWWrLH333/AAaO0KnjmOU/h4lbgkHaXtFaKFBXx5mOgQA4HLeY/SJ+ePcVo4LaO/mgtLOFVndxJNKrlkhjXiMDAY4Op6kKDqcRbZ9/Yz3Ra637aB2JK20YKrniBvElVzrwfoAOXRPd52VsrONprJ2lW4VCJHKtlQDgKVVcDUkg8/aqiUWcTJGis2+yqAWxjeIGCccs1mpSgUpSghvbbY1zdMBEo3FGmWAyTxP99K5y7TQMl1Mj7paJt07p3gXHIHng5z6iupu2O2xZWc9yeKIdwfWkbyoPmxFcv7B2NLfXHhh8cXmmYZEYJ88jdSScBfpEgUG+7p+wf+I3BeYH9GhOZDnAkfisQP4tjgMdRXTMUYVQqgBVAAAGAANAAOlRbZO09n7Pto4UfwoYwBvOjgEk6s7buN5ic55k1pu3Heva2kANrJHczyA+GFbeVMab0m6cgA/R0J9OICf3NwkalpHVFHFmIUD3J0qNzd4uy1ODfQZ+y28PvXIrmHb3aG5vZDJcytK2dAT5U9FUeVR7V4A5+r/Wg62/92bOmic/pds0R8j5kTHnyMNk6Z1GvGuetr20ljcSR21w25G36spJlWQ6odCVOhGQcjOahyqDnHQgjn/f3Vm2fctHleI44qC4exveKJWWC6ASQkKrjRXJ4A/VY/ceWNBU12rsaG4wzqRIo8sqHckX2YcR9k5HpXPm8so00P4/96t3u47UG4j8CZv18Q4/8WPgG9xwPyPOp2dit/aRXkayoZEm8hMMjDcO+BhUmUaHJx51OuDoNM1Jc96G0G345BAOKujQ5HRlIZj6jFXjVId7+wfAuhcIP1dxkt6TD4v+YYb33qbtEGvcMxYKqZOQFzu+w3iSPvryGvQH5GviQVUYRqcVZXddskS3VupGhcMfUJ5j/pqtohqKuvuehC3MBzqQ4/yNVkF51V/eAvgba2XONBMktu5681B+cg+6rQqr+/tSlraXSjzW90jfIgn81Wg3l7aJKu7IiuM5AYZwRwI5gjqMEV92dvwXLEDmxyT0yeZ9eJ561kDhgGHBgCPY6j8K8219oC1tbi4/4UbMPVgPKPmxA+dc1Vn3jd5MkcklrYssYjYpJKBly4+IJnRQD5d7iSDjA41OxaVi8jMzMclmJZmPUk6msU5OSWOWJyeevqetZYDw+YraPprTofvrNaWuAWO6ccNa/Saybc2PPamLxV3fFjEiYIbKkkcV0yCDkcRVB5Ub4lH5flU67te1z2RMaTFo2ORFJwDc90+vTA4e9abum7Nx7RvvCuCfBSJ3cA7uToigMOB3nB9d01Ptvdwx1NndZ6JcDj/HGP8A6UFqdnO0kV2vlOHHxIeI9uordVz1bWO0LDC3cMkbJrFcp50IHJ3XIB6b2MjQ+txdiO1C38OdBKmkijryYfZP8iOWaCR0pSggnen2Xu9orbwW7RpEHZ5S7EYYAKhwB5gAznHXFVB2qSXZExsIy4i3Y3d8AG5fU+Lz8oOVC503OpJrpqol3kdjE2nbbows8eWhc9eaMfqtgA9Dg8sUFE3u3pbqJY3kDIDnG6Bk4wN7GM41+81oLyz04ZH5e1FsHjn8KQ+CwYq++MbhGchvu9tRrjWs1rehxhtD+ftQazZ1g88scES70kjBUXhknhryqweyHdJNd/pSzTrBJby+EVCeJk7qvvZ3h5SGGOtQq7tyGVkJVgd5XBIKsCCNRwPMH0rZQd4G0YZpJ0uN2WQRiU7kZEnhruIzAggnB+LnzoNj247sLrZyGZmSWEEAyJ5SpJwN5G6kjUE1EotVDDRh8WPfjpUwsu3N5eq0FzKzhvibKJjkN1BGRnBPIZzqeFRXacUcMjLCzFV03nx5mHHhy5fI60GINnzDiOOPz/rXv2ftGSJ0ljbdkQ5U/mD1BGQR0NaVbjBH4++T/LTFelXHLh+XpUHQnZjtVBeopSRRKR5oiw31bmMHUj1FfXbLYgvbSWDA3yN6MnlKuqe2fhPoxrnWc6hueeNSPY/b6+tsATeKg+hN+sHybIcfJsVMVF2XGQQQQcEHQgjQg1jIrZbe2itzcSziMRGQhmVTvDfwN5hoD5jlsdSda1rVUY+Bq3e6+5xNbH/5FH/N5f51UjjIz0/v+/erC7ubjEkPpJGf84rUSum6hPfNaiTZF19gI4/hkU/lkfOptUe7w4lbZl8GOB+jynPQhCR+IFRUC7su06XdskBOJ7dFVlJ1eNQFWReo4A9D7ivN307TMVhHEvxTSjT7EXnP+bw6p3ZV/LbTJPCd2RDkdCOBBHNSNCPWpV277Rf4k8LhGjVId3dJBxIxJcgjivwgE4OnAVnOivWO8SeprLDx+6trb7NTgcnPy/KsN8I1cJGui/Gck69PlWh8RXwjL/q0kLRsg38ncLYG+uD8QGcHkTnlWO5uZ5lRZJGZYwQgZshATk7oPDJ1PWsl/GX3X4nAU+66D8KxW8JJwBvHXQa8Bk/gKD4W2/sVvNi9qb6zIMF1KoB+AtvIfQq+V/CpFsXuqv7m3juY1g3JF3kDSFWKngcbpAzx4860G3+zN3ZEC4gePOgJwVb92RSVz6ZzQXN2D720ud2K8CxSHA8QaI3LJz8Pvw9hVlQWESsZEjjVyNWVVBI9SBk1x7bzYIOSPUaYx/Ors7rO3BBS2nYmNsCNj9BuABOAN06ex9DoFv0pSgUpSg5478rpV2pulQVMEW9gAEnL+bPM4wNeQFV7cWuBvKd5TzHL3qe/+oO3K7SR+T2yEe6vID/L76rm2uWR8jXOMqeDZ01/rQe21viNG1HWsG2ZFYqBxxx/lUt7X9jJ9nMkoKtG6ncddVO8mGAzqDhjj7x6QuRcjB+XpUGKxu2jYFTg9a+7gjnnXUEevp8688q4Pv8AnWQtvqABqo4/PI/OqPhlx6jrWe2ccPurCh09f7/v5V+Z50HsZcUEYxwr4myVyOI10payb2h41Aa2J+HX7q88tu44qw9wa2GKzw3TLwY46HUfjQaeE8QedSzslN4bAA4YYK9eoPy/lXlt74A5MaZ+so16ZOdSa28G2k5N8jn+dagszZHeLcpgTKsvuNxiOoKjB9t3PvX53jdvoJdlzxrvJLMFjVWHEMw3iGXII3Q1V2durwOPnp/StJ2kvzL4QBJUEsf3uA4cTx140GtjXQmti0eFHsK8IHlrbyrpUg8E8u4rNzA09zoK1dsmmvuT+devbLaIOpz9w/715d7T++AGf60o92yJUEieKm/GHRnThvKrAsvpvJkVaW3OzsL7NivlQJEryRt5d0/owuZFtZdPpRgpnXLIzA8q8PbHsaINibOuox+siCtMR9IXJD5PXdcqo9HNYYe2qSbGGz5FJYMo3tAP0cOrquBqWxmMAD6OSeoS3ur7VrbRy2V5IsfgeeJifL4TnUA/VViSDw3WXpVjNPa3ayQb8M64xJGGSTAIBG8BnGhBrl//ABuRWRFLYiLKG1VyjDBU+mGYYPEEeudqReWkcM8knhi5EskJRx4sSMT4rFQuNyQOTgcSIzkFcENb2z2KsM001sj/AKF47RRSnUMyDLqDxOGD4J4heJ1rVbKucNukcdNANc+2v3VdY2FJtSySxg/2W3tRuszIW8e4TO6FBIIQfGxOu84H0TVDMrRvusMMjFSDyIOoPsdPlQdWd3u3jeWilzmWI+HJniSACGPqQRn1zSq+7mdp4udzJxPDnBJOWjPlIOTnylxx5DhjFftBc1KUoKi/9Q+xS9vb3aj9i5R/3JcYPyZQP4qocLkY6f3/AH7V2RtrZiXUEtvKMpKhVvTPMeoOCPauSu0GxZbG5kt5hh0Oh5Mp+Fh6Ea5oLa2X2hO0Ozl1CCP0m1i3XB1JjTBDr7oGXPUGq42R2cknWVVWQzoY2CKm8rRSxs6neXmfLj0J6VrNj7UktXMsLYYoyMCMh0cYZGXmD06gEVNuwfeBFazWjzK67tuba4ZRvK0aHet3CjXeXVDpwOR0oNBcd3e0jKITZS72cBgAU4Z1cHcAx1I1046VppbA27vBcI0UiHB0yUYgHzAcVIIOnXIzV09pO+6BEYWUTySEaPKNxFPXGd9vbC+9UZtbaMk8rzTOXlkOWY8SeHLQaYAA0AAA4UHysQY5Az7Zwa9VtYFlLgKFXix04Yzrj1FevsL2dk2jeR265C53pHA1jjHxNnryGeZFXNs/uNs0cNLcXEqjghKoD6Egb2P3SKCjrWLxd2OON3lbgEDMTnlu88fZHzrxXdhJC5DIyMDqrDBHoQa7B2LsG2s13LaCOIHjurq37zcWPqSa+Nr9nba5EniwxlpE3TIY42caEAgupGVzkZBoOQ4p+tegNmra7Wdy7xoGsWacjO9HM0asRpgowCr1yGx78qiUfdbtMgkWrLjkZItfbDEfjUETr8ZM1Ir3sHtKHO/ZTYHNAsv/AEi1aK5t3i/aI8f76sn+oCgwK+7oSR6jh8xyr7eInmPux+VfIYHoa+ApXVdR9X+lB6G4VuE8yA9QD+FaRZARp/4rebM1jX5j7iRWolaHbfGP+L+VeENoPnW329EN0EfRbX0B0/PFaePh7GpVXrb2uz5bQWtlBcbQlMO6CXkaO3Zk4l5SIoiCc4QZHSq32P2beY3KFkU2wbeBOd7BbKrjoUbzcBp8r87ptppcbKtSgUGNPCdQAMPH5TkDmRhv4qrDvH7Bi1vIv0WMeFKkjCME5QRKGkwXYkjB3xjhgjGgyFYINw6Nvc88COI1H41Ldh9k7y8ilvC+IYUYmSRz5hH5iicSOfQffWvfYLG3WeM729kkKPqtu++SSCNMHPXStnZ3d62z2ijMv6O29G4RkIIDEkPGQZAw1GVAyN0HPOaq0+5WHEUhUqUKR53cY3yZGA0PFUZFOQDpjXGTSneNbCPal8o4eOzf85Ln/XV592F1ZQxMq3EazMFMkLERmFUBwm6+HbAJJdsk544AxQXam/Fze3U4OVlmdlPVC7bn+XdoiZ90twRfWY+24++J8gj219cDoKV+d0EG9tK2GM7niOT0Aica/NwOnm96VR0dSlKBUQ7xOwse04uISdAfDkxp13XxqVz933gy+lBx3tzZE9lMYbiNo3HJtN4dVbgy+oyK8Pi/3pXYu19kw3UbRXESyRtxVh+R4g+oqv8AaXcfs6Rt6M3EPDypIGX3/WqzZ+dBzq839/3/ACr29n9g3F9MIbeNpHPHHwoPrO3BR6mr72d3HbOjbMjXEw+qzhV//mqt+NWDsjY8FrGIreJIk6IAMnqeZPqdaDRd3vYmLZcG4uHmfBlkxjeI4KvRBk4HqTzqV0pQKUpQKUpQK+XjDDBAI6EZr6pQai97LWU37S0t3/eiQ/yrVyd3GzD/APhRD93eX/SRUrpQQp+6nZROf0Ug+ksw/J62Oy+wez7f9napxz596T/qE1JKUGm7Q9nYrmzntdxEWVCowoAVuKNp0YKflXI11avDK8cilXRmR1PJlJUj7wa7SqmO/HsIXztG3XJA/wBpUdFGBL8gMN6AHkaCId0fbP8Aw65Mcx/2WcgOf+G40WT25N6YP0aujtLbrNfbOIIKtHeDIOQQ8KjI66GuXoH5HUVIeyvaeexuIp0JlWJXVI5HYqEf4goz5OHIcuHKguruv2JBNsu2E0Ydo/EQ5zruyvoccQDqAeB1rZr3eQQuZrSSW2mJyXB8RW5+dJMhvfRvtVXvYXvVgs4HimgmJM0simLcKgSuX3fOykYJIrL2i77nZStnb+Fn/ezEMV/dRdM+pJHpQO9vtJiKSwu7aF7rEbJcIPKIyclwG86N5WXdyRrnJGlU/brk5I45rLf3slxI0krs7ucsznJY/wAh0HAY6Ctv2Z2FLdzpBEMsx0PJV+ufQc+utBafcTsXHjXTDQDwoyfXdd/uwgz71+1Z+wtlJaQRwR/DGuM82PEsfUnJ+dKD30pSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgUpSgV+EZr9pQUx3idz5YtcbOABOr25OAeeYidF/cOB0I4VTl4JIZDHPG8cg+JXBRh+Wn312VXg2tsa3ul3biCKVRwEiK2PUZGh9qDj7xwebfh/Si4JHy4100/dNsgkn9DGvSacD5ASYFenZ3dpsuBt5LKMn/wCQvLjHQSswFBQnZDsbc37DwozuZ80jaIuNDk8zqdBrpXQvYzsfDs6Pdj80jAb8h4nngdFzyqQxoFACgADgAMAe1fVApSlApSlApSlApSlApSlApSlApSlApSlApSlApSlApSlApSlApSlApSlApSlApSlB/9k=",
  },
  {
    id: "6",
    plateNo: "VAN-8890",
    code: "VAN-30",
    brand: "Nissan",
    model: "Urvan",
    type: "Van",
    capacity: 15,
    status: "active",
    odometerKm: 76_120,
    lastServiceISO: "2025-05-02",
    nextServiceISO: "2025-11-02",
    notes: "Aircon cleaned May.",
    createdAt: "2024-06-10",
    updatedAt: "2025-09-04",
    photoUrl: "https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?q=80&w=1600&auto=format&fit=crop",
    assignedDriver: "Courtney Henry",
    maxLoadKg: 2000,
  },
];


===== lib\admin\vehicles\store.ts =====
import type { Vehicle, VehicleFilters, VehicleStatus, VehicleType } from "./types";
import { sampleVehicles } from "./data";

/**
 * IMPORTANT (SSR-safe):
 * - We initialize with sample data for BOTH server & client so the first render matches.
 * - After mount (in your page), call VehiclesRepo.hydrateFromStorage() to replace with persisted data.
 */

// In-memory DB (module-level)
let db: Vehicle[] = sampleVehicles.map(v => ({ ...v })) as Vehicle[];

// ---- localStorage helpers (client only; safe to import on server) ----
const LS_KEY = "travilink_vehicles";
const canStorage = () => typeof window !== "undefined" && !!window.localStorage;

function saveToStorage(rows: Vehicle[]) {
  if (!canStorage()) return;
  try { localStorage.setItem(LS_KEY, JSON.stringify(rows)); } catch {}
}

/** Load from localStorage into in-memory DB. Returns true if hydrated. */
function hydrateFromStorage(): boolean {
  if (!canStorage()) return false;
  try {
    const raw = localStorage.getItem(LS_KEY);
    if (!raw) return false;
    db = JSON.parse(raw) as Vehicle[];
    return true;
  } catch {
    return false;
  }
}

// ---- Utils ----
function matches(v: Vehicle, f: VehicleFilters) {
  const s = (f.search ?? "").toLowerCase();
  const okSearch = !s || [v.plateNo, v.code, v.brand, v.model].some(x => x.toLowerCase().includes(s));
  const okType = !f.type || v.type === f.type;
  const okStatus = !f.status || v.status === f.status;
  return okSearch && okType && okStatus;
}

// ---- Public API ----
export const VehiclesRepo = {
  // expose so the page can hydrate AFTER mount (prevents hydration mismatch)
  hydrateFromStorage,

  constants: {
    types: ["Bus", "Van", "Car", "SUV", "Motorcycle"] as readonly VehicleType[],
    statuses: ["active", "maintenance", "inactive"] as readonly VehicleStatus[],
  },

  list(filters: VehicleFilters = {}) {
    return db.filter(v => matches(v, filters));
  },

  get(id: string) {
    return db.find(v => v.id === id) ?? null;
  },

  create(data: Omit<Vehicle, "id" | "createdAt" | "updatedAt">) {
    const now = new Date().toISOString();
    const v: Vehicle = { ...data, id: crypto.randomUUID(), createdAt: now, updatedAt: now } as Vehicle;
    db.push(v);
    saveToStorage(db);
    return v.id;
  },

  update(id: string, patch: Partial<Vehicle>) {
    const i = db.findIndex(v => v.id === id);
    if (i >= 0) {
      db[i] = { ...db[i], ...patch, updatedAt: new Date().toISOString() };
      saveToStorage(db);
    }
  },

  remove(id: string) {
    const i = db.findIndex(v => v.id === id);
    if (i >= 0) {
      db.splice(i, 1);
      saveToStorage(db);
    }
  },

  /** DEV helper: restore sample seed (also persists) */
  resetToSample() {
    db = sampleVehicles.map(v => ({ ...v })) as Vehicle[];
    saveToStorage(db);
  },
};


===== lib\admin\vehicles\types.ts =====
export type VehicleType = "Bus" | "Van" | "Car" | "SUV" | "Motorcycle";
export type VehicleStatus = "active" | "maintenance" | "inactive";


export interface Vehicle {
id: string;
plateNo: string;
code: string;
brand: string;
model: string;
type: VehicleType;
capacity: number;
status: VehicleStatus;
odometerKm: number;
lastServiceISO: string;
notes?: string;
createdAt: string;
updatedAt: string;
}


export type VehicleFilters = {
search?: string;
type?: VehicleType | "";
status?: VehicleStatus | "";
};

===== lib\admin\vehicles\utils.ts =====
import type { Vehicle } from "./types";


export function validate(v: Omit<Vehicle, "id"|"createdAt"|"updatedAt">): string | null {
if (!v.plateNo?.trim()) return "Plate No. is required";
if (!v.code?.trim()) return "Vehicle Code is required";
if (!v.brand?.trim()) return "Brand is required";
if (!v.model?.trim()) return "Model is required";
if (v.capacity < 1) return "Capacity must be at least 1";
if (v.odometerKm < 0) return "Odometer cannot be negative";
return null;
}


export function toCSV(rows: Vehicle[]) {
const header = [
"plateNo","code","brand","model","type","capacity","status","odometerKm","lastServiceISO","notes",
];
const lines = [header.join(","), ...rows.map(r => [
r.plateNo, r.code, r.brand, r.model, r.type, String(r.capacity), r.status, String(r.odometerKm), r.lastServiceISO, r.notes ?? "",
].map(x => `"${String(x).replaceAll('"','""')}"`).join(","))];
return lines.join("\n");
}

===== lib\data\dates.ts =====
// src/lib/dates.ts
export const pad2 = (n: number) => String(n).padStart(2, "0");

export function ymdhmLocal(isoLike: string) {
  const d = new Date(isoLike); // JS converts to local tz
  return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())} `
       + `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
}


===== lib\data\driver.ts =====
// src/lib/data/driver.ts
import { supabase } from "@/lib/supabaseClient";
import type { DriverScheduleRow } from "@/app/types/schedule";   
import { ymdhmLocal } from "@/lib/data/dates";               
     
export async function getDriverSchedule(userId: string): Promise<DriverScheduleRow[]> {
  // sample shape – adjust table/column names to your schema
  const { data, error } = await supabase
    .from("trips") // or a view like v_driver_schedule
    .select("id, start_time, destination, vehicle_type, driver:user_id(name), status")
    .eq("driver_id", userId)
    .gte("start_time", new Date().toISOString())
    .order("start_time", { ascending: true });

  if (error) throw error;

  return (data ?? []).map((t: any) => ({
    id: String(t.id),
    
    date: ymdhmLocal(t.start_time),

    location: t.destination ?? "",
    vehicle: (t.vehicle_type ?? "Bus") as DriverScheduleRow["vehicle"],
    driver: t?.driver?.name ?? "",
    status: (t.status ?? "Pending") as DriverScheduleRow["status"],
  }));
}


===== lib\data\driverProfile.ts =====
import type { DriverProfile } from "@/app/types/driverProfile";
import { DRIVER as DRIVER_SEED } from "@/lib/mock";

const LS_KEY = "travilink_driver_profile";

function splitName(full?: string) {
  if (!full) return { firstName: "", lastName: "" };
  const parts = full.trim().split(/\s+/);
  if (parts.length === 1) return { firstName: parts[0], lastName: "" };
  return { firstName: parts.slice(0, -1).join(" "), lastName: parts.slice(-1)[0] };
}

export function seedFromMock(): DriverProfile {
  const { firstName, lastName } = splitName(DRIVER_SEED?.name);
  return {
    firstName,
    lastName,
    email: (DRIVER_SEED as any)?.email ?? "",
    campus: DRIVER_SEED?.campus ?? "",
    dept: DRIVER_SEED?.dept ?? "",
    phone: DRIVER_SEED?.phone ?? "",
    license: DRIVER_SEED?.license ?? "",
    canDrive: Array.isArray(DRIVER_SEED?.canDrive) ? DRIVER_SEED.canDrive : [],
    badges: Array.isArray(DRIVER_SEED?.badges) ? DRIVER_SEED.badges : [],
    avatar: undefined,
    notifyEmail: true,
    notifyPush: true,
  };
}

export function loadProfile(): DriverProfile {
  if (typeof window === "undefined") return seedFromMock();
  try {
    const raw = localStorage.getItem(LS_KEY);
    if (!raw) return seedFromMock();
    return { ...seedFromMock(), ...(JSON.parse(raw) as DriverProfile) };
  } catch {
    return seedFromMock();
  }
}

export function saveProfile(p: DriverProfile) {
  if (typeof window === "undefined") return;
  localStorage.setItem(LS_KEY, JSON.stringify(p));
}


===== lib\data\driverStatus.tsx =====
import { CheckCircle2, Truck, Moon, LogOut, Stethoscope } from "lucide-react";
import type { DriverStatus } from "@/app/types/driver";

export const tone = (s: DriverStatus) =>
  s === "Available" ? "bg-green-100 text-green-700"
: s === "On Trip"   ? "bg-sky-100 text-sky-700"
: s === "Off Duty"  ? "bg-neutral-100 text-neutral-700"
: s === "Sick"      ? "bg-amber-100 text-amber-700"
:                     "bg-rose-100 text-rose-700";

export function StatusIcon({ s }: { s: DriverStatus }) {
  if (s === "Available") return <CheckCircle2 className="h-5 w-5 text-green-600" />;
  if (s === "On Trip")   return <Truck className="h-5 w-5 text-sky-600" />;
  if (s === "Off Duty")  return <Moon className="h-5 w-5 text-neutral-600" />;
  if (s === "Sick")      return <Stethoscope className="h-5 w-5 text-amber-600" />;
  return <LogOut className="h-5 w-5 text-rose-600" />;
}


===== lib\data\statusTone.tsx =====
import type { Status } from "@/app/types/schedule";

export function statusTone(s: Status) {
  switch (s) {
    case "Approved":
      return "bg-green-100 text-green-700";
    case "Pending":
      return "bg-amber-100 text-amber-700";
    case "Assigned":
      return "bg-blue-100 text-blue-700";
  }
}


===== lib\data\admin\seeds.ts =====
import { Driver, Schedule, Vehicle } from "@/lib/types";

export const seedVehicles: Vehicle[] = [
  { id: "v1", name: "Bus 1", type: "Bus", status: "available" },
  { id: "v2", name: "Van 1", type: "Van", status: "maintenance", note: "Under maintenance" },
  { id: "v3", name: "Bus 2", type: "Bus", status: "available" },
  { id: "v4", name: "Car 3", type: "Car", status: "available" },
  { id: "v5", name: "Bus 3", type: "Bus", status: "available" },
];

export const seedDrivers: Driver[] = [
  { id: "d1", name: "Jolo Rosales", license: "Professional", vehicleTypes: ["Bus"], status: "available", phone: "09xx-xxx-xxxx", color: "#7A0010" },
  { id: "d2", name: "Mara Santos", license: "Professional", vehicleTypes: ["Van", "Car"], status: "on_trip", phone: "09xx-xxx-xxxx", color: "#0E7490" },
  { id: "d3", name: "Ken Alvarez", license: "Non-Prof", vehicleTypes: ["Car"], status: "off_duty", phone: "09xx-xxx-xxxx", color: "#4F46E5" },
  { id: "d4", name: "Ivy Dela Cruz", license: "Professional", vehicleTypes: ["Bus", "Van"], status: "available", phone: "09xx-xxx-xxxx", color: "#16A34A" },
  { id: "d5", name: "Rico Medina", license: "Professional", vehicleTypes: ["Van"], status: "sick", phone: "09xx-xxx-xxxx", color: "#EA580C" },
];

export const seedSchedules: Schedule[] = [
  { id: "s1", dept: "Hans / CCMS", purpose: "Seminar event", date: "2025-12-25", location: "Tagaytay", vehicle: "Bus", driver: "Jolo Rosales", status: "Approved" },
  { id: "s2", dept: "HR / MAIN", purpose: "Campus tour", date: "2025-12-28", location: "MSEUF Lucena", vehicle: "Van", status: "Pending" },
  { id: "s3", dept: "ENG / ME", purpose: "Field trip", date: "2026-01-10", location: "Batangas", vehicle: "Bus", status: "Assigned" },
  { id: "s4", dept: "Registrar", purpose: "Docs run", date: "2026-01-12", location: "City Hall", vehicle: "Car", status: "Pending" },
];


===== lib\data\api\client.ts =====
import { mockApi } from "./mock";
import { supabaseApi } from "./supabase";
import type { Api } from "./ports";

const which = process.env.NEXT_PUBLIC_API ?? "mock";
export const api: Api = which === "supabase" ? supabaseApi : mockApi;


===== lib\data\api\mock.ts =====
import { Api } from "./ports";
import { seedDrivers, seedSchedules, seedVehicles } from "@/lib/data/admin/seeds";
import { Driver, DriverStatus, Vehicle, VehicleStatus } from "@/lib/types";

let vehicles = [...seedVehicles];
let drivers = [...seedDrivers];
let schedules = [...seedSchedules];

export const mockApi: Api = {
  vehicles: {
    async list() { return vehicles; },
    async updateStatus(id: string, status: VehicleStatus) {
      vehicles = vehicles.map(v => v.id === id ? { ...v, status, note: status === "maintenance" ? "Under maintenance" : undefined } : v);
    },
    async add(v: Vehicle) { vehicles = [v, ...vehicles]; },
    async remove(id: string) { vehicles = vehicles.filter(v => v.id !== id); },
  },
  drivers: {
    async list() { return drivers; },
    async updateStatus(id: string, status: DriverStatus) {
      drivers = drivers.map(d => d.id === id ? { ...d, status } : d);
    },
    async add(d: Driver) { drivers = [d, ...drivers]; },
  },
  schedules: {
    async listUpcoming() { return schedules; },
  },
};


===== lib\data\api\ports.ts =====
import { Driver, DriverStatus, Schedule, Vehicle, VehicleStatus } from "@/lib/types";

export interface VehiclesPort {
  list(): Promise<Vehicle[]>;
  updateStatus(id: string, status: VehicleStatus): Promise<void>;
  add(v: Vehicle): Promise<void>;
  remove(id: string): Promise<void>;
}

export interface DriversPort {
  list(): Promise<Driver[]>;
  updateStatus(id: string, status: DriverStatus): Promise<void>;
  add(d: Driver): Promise<void>;
}

export interface SchedulesPort {
  listUpcoming(): Promise<Schedule[]>;
}

export interface Api {
  vehicles: VehiclesPort;
  drivers: DriversPort;
  schedules: SchedulesPort;
}


===== lib\data\api\supabase.ts =====
import { Api } from "./ports";
// import { createClient } from "@/lib/supabaseClient"; // use yours

export const supabaseApi: Api = {
  vehicles: {
    async list() { throw new Error("TODO: implement with Supabase"); },
    async updateStatus() { throw new Error("TODO: implement"); },
    async add() { throw new Error("TODO: implement"); },
    async remove() { throw new Error("TODO: implement"); },
  },
  drivers: {
    async list() { throw new Error("TODO: implement"); },
    async updateStatus() { throw new Error("TODO: implement"); },
    async add() { throw new Error("TODO: implement"); },
  },
  schedules: {
    async listUpcoming() { throw new Error("TODO: implement"); },
  },
};


===== lib\hooks\useDebouncedValue.ts =====
import { useEffect, useState } from "react";

export function useDebouncedValue<T>(value: T, delay = 300): T {
  const [debounced, setDebounced] = useState<T>(value);

  useEffect(() => {
    const handle = setTimeout(() => setDebounced(value), delay);
    return () => clearTimeout(handle);
  }, [value, delay]);

  return debounced;
}


===== lib\hooks\useLocalStorage.ts =====
import { useEffect, useState } from "react";

export function useLocalStorage<T>(key: string, initial: T) {
  const [value, setValue] = useState<T>(() => {
    try {
      const raw = localStorage.getItem(key);
      return raw ? (JSON.parse(raw) as T) : initial;
    } catch {
      return initial;
    }
  });

  useEffect(() => {
    try { localStorage.setItem(key, JSON.stringify(value)); } catch {}
  }, [key, value]);

  return [value, setValue] as const;
}


